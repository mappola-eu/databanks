{% set title = name %}
{% extends "layouts/application.html" %}

{% macro rendel(data, dt, standalone=False) %}
{% if dt == "reference_list" or dt == "reference_complex" %}
<ul>
    {% for entry in data %}
    <li>{{ entry }}</li>
    {% endfor %}
</ul>
{% else %}
{% if standalone %}<p>{{ data }}</p>{% else %}{{ data }}{% endif %}
{% endif %}
{% endmacro %}

{% block body %}
<h1><a href="{{ url_for('resource.index', name=name) }}">{{ name }}</a>: {{ defn_parse(defn.title, item) }}</h1>
{% if defn.update_op or defn.delete_op %}
<p>
    {% if defn.update_op %}
    ✏️
    <a href="{{ url_for('resource.edit', name=name, id=item.id) }}" role="button">{{ defn.update_op }}</a>
    {% endif %}
    {% if defn.delete_op %}
    ❌
    <a href="{{ url_for('resource.delete', name=name, id=item.id) }}" role="button">{{ defn.delete_op }}</a>
    {% endif %}
</p>
{% endif %}

{% for slide in defn.slides %}
<section role="doc-part">
    {% if slide.title %}
    <h2>{{ slide.title }}</h2>
    {% endif %}
    
    {% for part in slide.parts %}
    {% if part.title %}
    <h3>{{ part.title }}</h3>
    {% endif %}

    {% if part.view_prefix %}
    <p>{{ part.view_prefix }}</p>
    {% endif %}

    {% if part.component == "table" %}
    <table role="table">
        <tbody>
            {% for column in part.columns %}
            <tr>
                <th>{{ column.label }}</th>
                <td>{{ rendel(render_column(item, column), column.type) }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% elif part.component == "standalone" %}
    {{ rendel(render_column(item, part.single), part.single.type, standalone=True) }}
    {% elif part.component == "embed" %}
    {% set table = defn_parse_raw(part.table, item) %}
    <table role="table">
        <tbody>
            {% for row in table %}
            <tr>
                {% for column in part.columns %}
                    {% if column.heading %}
                    <th>{{ rendel(render_column(row, column)) }}</th>
                    {% else %}
                    <td>{{ rendel(render_column(row, column)) }}</td>
                    {% endif %}
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% elif part.component == "text_view" %}
    <div class="text-presentation">{{ item[part.columns.diplomatic] }}</div>
    <div class="text-presentation">{{ item[part.columns.interpretative] }}</div>
    <div class="text-presentation">{{ item[part.columns.with_metrics_visualised] }}</div>
    <div class="switch-list">
        <input type="radio" name="text-form" id="text-form--dipl" value="diplomatic" checked>
        <label for="text-form--dipl">Diplomatic</label>
        <input type="radio" name="text-form" id="text-form--intp" value="interpretative">
        <label for="text-form--intp">Interpretative</label>
        <input type="radio" name="text-form" id="text-form--mevs" value="metrics-visualised">
        <label for="text-form--mevs">With Metrics Visualised</label>
    </div>
    {% endif %}

    {% if part.view_postfix %}
    <p>{{ part.view_postfix }}</p>
    {% endif %}
    {% endfor %}
</section>
{% endfor %}

{% endblock %}