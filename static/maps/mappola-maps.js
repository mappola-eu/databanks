var xm=Object.defineProperty;var vm=(rr,Rt,Or)=>Rt in rr?xm(rr,Rt,{enumerable:!0,configurable:!0,writable:!0,value:Or}):rr[Rt]=Or;var lu=(rr,Rt,Or)=>(vm(rr,typeof Rt!="symbol"?Rt+"":Rt,Or),Or);(function(rr,Rt){typeof exports=="object"&&typeof module<"u"?Rt(exports):typeof define=="function"&&define.amd?define(["exports"],Rt):(rr=typeof globalThis<"u"?globalThis:rr||self,Rt(rr.Mappola={}))})(this,function(rr){var Yu,Ju,Qu,eh,th;"use strict";function Rt(){}const Or=A=>A;function cu(A,k){for(const R in k)A[R]=k[R];return A}function uu(A){return A()}function hu(){return Object.create(null)}function an(A){A.forEach(uu)}function ko(A){return typeof A=="function"}function Ur(A,k){return A!=A?k==k:A!==k||A&&typeof A=="object"||typeof A=="function"}let za;function pu(A,k){return za||(za=document.createElement("a")),za.href=k,A===za.href}function Sp(A){return Object.keys(A).length===0}function du(A){const k=typeof A=="string"&&A.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return k?[parseFloat(k[1]),k[2]||"px"]:[A,"px"]}const fu=typeof window<"u";let jl=fu?()=>window.performance.now():()=>Date.now(),Xl=fu?A=>requestAnimationFrame(A):Rt;const Zs=new Set;function mu(A){Zs.forEach(k=>{k.c(A)||(Zs.delete(k),k.f())}),Zs.size!==0&&Xl(mu)}function Wl(A){let k;return Zs.size===0&&Xl(mu),{promise:new Promise(R=>{Zs.add(k={c:A,f:R})}),abort(){Zs.delete(k)}}}function dt(A,k){A.appendChild(k)}function gu(A){if(!A)return document;const k=A.getRootNode?A.getRootNode():A.ownerDocument;return k&&k.host?k:A.ownerDocument}function Ip(A){const k=kt("style");return Ap(gu(A),k),k.sheet}function Ap(A,k){return dt(A.head||A,k),k.sheet}function gi(A,k,R){A.insertBefore(k,R||null)}function si(A){A.parentNode&&A.parentNode.removeChild(A)}function _u(A,k){for(let R=0;R<A.length;R+=1)A[R]&&A[R].d(k)}function kt(A){return document.createElement(A)}function Cp(A){return document.createElementNS("http://www.w3.org/2000/svg",A)}function Hi(A){return document.createTextNode(A)}function nr(){return Hi(" ")}function Hl(){return Hi("")}function ln(A,k,R,q){return A.addEventListener(k,R,q),()=>A.removeEventListener(k,R,q)}function lt(A,k,R){R==null?A.removeAttribute(k):A.getAttribute(k)!==R&&A.setAttribute(k,R)}function yu(A,k){for(const R in k)lt(A,R,k[R])}function kp(A){return Array.from(A.childNodes)}function cs(A,k){k=""+k,A.data!==k&&(A.data=k)}function js(A,k,R){A.classList[R?"add":"remove"](k)}function xu(A,k,{bubbles:R=!1,cancelable:q=!1}={}){const j=document.createEvent("CustomEvent");return j.initCustomEvent(A,R,q,k),j}const Pa=new Map;let Da=0;function Mp(A){let k=5381,R=A.length;for(;R--;)k=(k<<5)-k^A.charCodeAt(R);return k>>>0}function zp(A,k){const R={stylesheet:Ip(k),rules:{}};return Pa.set(A,R),R}function La(A,k,R,q,j,X,Y,a=0){const de=16.666/q;let ae=`{
`;for(let je=0;je<=1;je+=de){const Qe=k+(R-k)*X(je);ae+=je*100+`%{${Y(Qe,1-Qe)}}
`}const pe=ae+`100% {${Y(R,1-R)}}
}`,fe=`__svelte_${Mp(pe)}_${a}`,te=gu(A),{stylesheet:Ce,rules:ze}=Pa.get(te)||zp(te,A);ze[fe]||(ze[fe]=!0,Ce.insertRule(`@keyframes ${fe} ${pe}`,Ce.cssRules.length));const Te=A.style.animation||"";return A.style.animation=`${Te?`${Te}, `:""}${fe} ${q}ms linear ${j}ms 1 both`,Da+=1,fe}function Ba(A,k){const R=(A.style.animation||"").split(", "),q=R.filter(k?X=>X.indexOf(k)<0:X=>X.indexOf("__svelte")===-1),j=R.length-q.length;j&&(A.style.animation=q.join(", "),Da-=j,Da||Pp())}function Pp(){Xl(()=>{Da||(Pa.forEach(A=>{const{ownerNode:k}=A.stylesheet;k&&si(k)}),Pa.clear())})}let Mo;function zo(A){Mo=A}function Kl(){if(!Mo)throw new Error("Function called outside component initialization");return Mo}function Xs(A){Kl().$$.on_mount.push(A)}function vu(A){Kl().$$.on_destroy.push(A)}function Yl(){const A=Kl();return(k,R,{cancelable:q=!1}={})=>{const j=A.$$.callbacks[k];if(j){const X=xu(k,R,{cancelable:q});return j.slice().forEach(Y=>{Y.call(A,X)}),!X.defaultPrevented}return!0}}function Dp(A,k){const R=A.$$.callbacks[k.type];R&&R.slice().forEach(q=>q.call(this,k))}const Ws=[],Mn=[];let Hs=[];const Jl=[],Lp=Promise.resolve();let Ql=!1;function Bp(){Ql||(Ql=!0,Lp.then(bu))}function Vr(A){Hs.push(A)}function Rp(A){Jl.push(A)}const ec=new Set;let Ks=0;function bu(){if(Ks!==0)return;const A=Mo;do{try{for(;Ks<Ws.length;){const k=Ws[Ks];Ks++,zo(k),Fp(k.$$)}}catch(k){throw Ws.length=0,Ks=0,k}for(zo(null),Ws.length=0,Ks=0;Mn.length;)Mn.pop()();for(let k=0;k<Hs.length;k+=1){const R=Hs[k];ec.has(R)||(ec.add(R),R())}Hs.length=0}while(Ws.length);for(;Jl.length;)Jl.pop()();Ql=!1,ec.clear(),zo(A)}function Fp(A){if(A.fragment!==null){A.update(),an(A.before_update);const k=A.dirty;A.dirty=[-1],A.fragment&&A.fragment.p(A.ctx,k),A.after_update.forEach(Vr)}}function Op(A){const k=[],R=[];Hs.forEach(q=>A.indexOf(q)===-1?k.push(q):R.push(q)),R.forEach(q=>q()),Hs=k}let Po;function tc(){return Po||(Po=Promise.resolve(),Po.then(()=>{Po=null})),Po}function us(A,k,R){A.dispatchEvent(xu(`${k?"intro":"outro"}${R}`))}const Ra=new Set;let Nr;function cn(){Nr={r:0,c:[],p:Nr}}function un(){Nr.r||an(Nr.c),Nr=Nr.p}function Et(A,k){A&&A.i&&(Ra.delete(A),A.i(k))}function Ft(A,k,R,q){if(A&&A.o){if(Ra.has(A))return;Ra.add(A),Nr.c.push(()=>{Ra.delete(A),q&&(R&&A.d(1),q())}),A.o(k)}else q&&q()}const ic={duration:0};function wu(A,k,R){const q={direction:"in"};let j=k(A,R,q),X=!1,Y,a,de=0;function ae(){Y&&Ba(A,Y)}function pe(){const{delay:te=0,duration:Ce=300,easing:ze=Or,tick:Te=Rt,css:je}=j||ic;je&&(Y=La(A,0,1,Ce,te,ze,je,de++)),Te(0,1);const Qe=jl()+te,Ze=Qe+Ce;a&&a.abort(),X=!0,Vr(()=>us(A,!0,"start")),a=Wl(He=>{if(X){if(He>=Ze)return Te(1,0),us(A,!0,"end"),ae(),X=!1;if(He>=Qe){const it=ze((He-Qe)/Ce);Te(it,1-it)}}return X})}let fe=!1;return{start(){fe||(fe=!0,Ba(A),ko(j)?(j=j(q),tc().then(pe)):pe())},invalidate(){fe=!1},end(){X&&(ae(),X=!1)}}}function Tu(A,k,R){const q={direction:"out"};let j=k(A,R,q),X=!0,Y;const a=Nr;a.r+=1;function de(){const{delay:ae=0,duration:pe=300,easing:fe=Or,tick:te=Rt,css:Ce}=j||ic;Ce&&(Y=La(A,1,0,pe,ae,fe,Ce));const ze=jl()+ae,Te=ze+pe;Vr(()=>us(A,!1,"start")),Wl(je=>{if(X){if(je>=Te)return te(0,1),us(A,!1,"end"),--a.r||an(a.c),!1;if(je>=ze){const Qe=fe((je-ze)/pe);te(1-Qe,Qe)}}return X})}return ko(j)?tc().then(()=>{j=j(q),de()}):de(),{end(ae){ae&&j.tick&&j.tick(1,0),X&&(Y&&Ba(A,Y),X=!1)}}}function Fa(A,k,R,q){const j={direction:"both"};let X=k(A,R,j),Y=q?0:1,a=null,de=null,ae=null;function pe(){ae&&Ba(A,ae)}function fe(Ce,ze){const Te=Ce.b-Y;return ze*=Math.abs(Te),{a:Y,b:Ce.b,d:Te,duration:ze,start:Ce.start,end:Ce.start+ze,group:Ce.group}}function te(Ce){const{delay:ze=0,duration:Te=300,easing:je=Or,tick:Qe=Rt,css:Ze}=X||ic,He={start:jl()+ze,b:Ce};Ce||(He.group=Nr,Nr.r+=1),a||de?de=He:(Ze&&(pe(),ae=La(A,Y,Ce,Te,ze,je,Ze)),Ce&&Qe(0,1),a=fe(He,Te),Vr(()=>us(A,Ce,"start")),Wl(it=>{if(de&&it>de.start&&(a=fe(de,Te),de=null,us(A,a.b,"start"),Ze&&(pe(),ae=La(A,Y,a.b,a.duration,0,je,X.css))),a){if(it>=a.end)Qe(Y=a.b,1-Y),us(A,a.b,"end"),de||(a.b?pe():--a.group.r||an(a.group.c)),a=null;else if(it>=a.start){const Ke=it-a.start;Y=a.a+a.d*je(Ke/a.duration),Qe(Y,1-Y)}}return!!(a||de)}))}return{run(Ce){ko(X)?tc().then(()=>{X=X(j),te(Ce)}):te(Ce)},end(){pe(),a=de=null}}}function Eu(A,k){const R={},q={},j={$$scope:1};let X=A.length;for(;X--;){const Y=A[X],a=k[X];if(a){for(const de in Y)de in a||(q[de]=1);for(const de in a)j[de]||(R[de]=a[de],j[de]=1);A[X]=a}else for(const de in Y)j[de]=1}for(const Y in q)Y in R||(R[Y]=void 0);return R}function Up(A){return typeof A=="object"&&A!==null?A:{}}function Vp(A,k,R){const q=A.$$.props[k];q!==void 0&&(A.$$.bound[q]=R,R(A.$$.ctx[q]))}function sr(A){A&&A.c()}function Ki(A,k,R,q){const{fragment:j,after_update:X}=A.$$;j&&j.m(k,R),q||Vr(()=>{const Y=A.$$.on_mount.map(uu).filter(ko);A.$$.on_destroy?A.$$.on_destroy.push(...Y):an(Y),A.$$.on_mount=[]}),X.forEach(Vr)}function Yi(A,k){const R=A.$$;R.fragment!==null&&(Op(R.after_update),an(R.on_destroy),R.fragment&&R.fragment.d(k),R.on_destroy=R.fragment=null,R.ctx=[])}function Np(A,k){A.$$.dirty[0]===-1&&(Ws.push(A),Bp(),A.$$.dirty.fill(0)),A.$$.dirty[k/31|0]|=1<<k%31}function zn(A,k,R,q,j,X,Y,a=[-1]){const de=Mo;zo(A);const ae=A.$$={fragment:null,ctx:[],props:X,update:Rt,not_equal:j,bound:hu(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(k.context||(de?de.$$.context:[])),callbacks:hu(),dirty:a,skip_bound:!1,root:k.target||de.$$.root};Y&&Y(ae.root);let pe=!1;if(ae.ctx=R?R(A,k.props||{},(fe,te,...Ce)=>{const ze=Ce.length?Ce[0]:te;return ae.ctx&&j(ae.ctx[fe],ae.ctx[fe]=ze)&&(!ae.skip_bound&&ae.bound[fe]&&ae.bound[fe](ze),pe&&Np(A,fe)),te}):[],ae.update(),pe=!0,an(ae.before_update),ae.fragment=q?q(ae.ctx):!1,k.target){if(k.hydrate){const fe=kp(k.target);ae.fragment&&ae.fragment.l(fe),fe.forEach(si)}else ae.fragment&&ae.fragment.c();k.intro&&Et(A.$$.fragment),Ki(A,k.target,k.anchor,k.customElement),bu()}zo(de)}class Pn{$destroy(){Yi(this,1),this.$destroy=Rt}$on(k,R){if(!ko(R))return Rt;const q=this.$$.callbacks[k]||(this.$$.callbacks[k]=[]);return q.push(R),()=>{const j=q.indexOf(R);j!==-1&&q.splice(j,1)}}$set(k){this.$$set&&!Sp(k)&&(this.$$.skip_bound=!0,this.$$set(k),this.$$.skip_bound=!1)}}var $p=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Do={exports:{}};(function(A,k){(function(R,q){A.exports=q()})($p,function(){var R,q,j;function X(a,de){if(!R)R=de;else if(!q)q=de;else{var ae="var sharedChunk = {}; ("+R+")(sharedChunk); ("+q+")(sharedChunk);",pe={};R(pe),j=de(pe),typeof window<"u"&&(j.workerUrl=window.URL.createObjectURL(new Blob([ae],{type:"text/javascript"})))}}X(["exports"],function(a){var de=ae;function ae(i,e,r,s){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=s}function pe(i,e,r,s){const c=new de(i,e,r,s);return function(h){return c.solve(h)}}ae.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,s=0;s<8;s++){var c=this.sampleCurveX(r)-i;if(Math.abs(c)<e)return r;var h=this.sampleCurveDerivativeX(r);if(Math.abs(h)<1e-6)break;r-=c/h}var d=0,m=1;for(r=i,s=0;s<20&&(c=this.sampleCurveX(r),!(Math.abs(c-i)<e));s++)i>c?d=r:m=r,r=.5*(m-d)+d;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};const fe=pe(.25,.1,.25,1);function te(i,e,r){return Math.min(r,Math.max(e,i))}function Ce(i,e,r){const s=r-e,c=((i-e)%s+s)%s+e;return c===e?r:c}function ze(i,...e){for(const r of e)for(const s in r)i[s]=r[s];return i}let Te=1;function je(i,e){i.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function Qe(i,e,r){const s={};for(const c in i)s[c]=e.call(r||this,i[c],c,i);return s}function Ze(i,e,r){const s={};for(const c in i)e.call(r||this,i[c],c,i)&&(s[c]=i[c]);return s}function He(i){return Array.isArray(i)?i.map(He):typeof i=="object"&&i?Qe(i,He):i}const it={};function Ke(i){it[i]||(typeof console<"u"&&console.warn(i),it[i]=!0)}function It(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function gt(i){let e=0;for(let r,s,c=0,h=i.length,d=h-1;c<h;d=c++)r=i[c],s=i[d],e+=(s.x-r.x)*(r.y+s.y);return e}function rt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Kt(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,s,c,h)=>{const d=c||h;return e[s]=!d||d.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let Dt,vi,St=null;function bi(i){if(St==null){const e=i.navigator?i.navigator.userAgent:null;St=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return St}function Fi(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const $r={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){const r=window.document.createElement("canvas"),s=r.getContext("2d");if(!s)throw new Error("failed to create canvas 2d context");return r.width=i.width,r.height=i.height,s.drawImage(i,0,0,i.width,i.height),s.getImageData(-e,-e,i.width+2*e,i.height+2*e)},resolveURL:i=>(Dt||(Dt=document.createElement("a")),Dt.href=i,Dt.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(vi==null&&(vi=matchMedia("(prefers-reduced-motion: reduce)")),vi.matches)}};var tt=Er;function Er(i,e){this.x=i,this.y=e}Er.prototype={clone:function(){return new Er(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),s=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=s,this},_rotateAround:function(i,e){var r=Math.cos(i),s=Math.sin(i),c=e.y+s*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-s*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Er.convert=function(i){return i instanceof Er?i:Array.isArray(i)?new Er(i[0],i[1]):i};const Sr={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},or="mapbox-tiles";let ar,hn,Bn=500,Rn=50;function Fn(){typeof caches>"u"||ar||(ar=caches.open(or))}let mr=1/0;const qr={supported:!1,testSupport:function(i){!zi&&Zr&&(On?ps(i):Gr=i)}};let Gr,Zr,zi=!1,On=!1;function ps(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,Zr),i.isContextLost())return;qr.supported=!0}catch{}i.deleteTexture(e),zi=!0}typeof document<"u"&&(Zr=document.createElement("img"),Zr.onload=function(){Gr&&ps(Gr),Gr=null,On=!0},Zr.onerror=function(){zi=!0,Gr=null},Zr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ir={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Ir);class Oi extends Error{constructor(e,r,s,c){super(`AJAXError: ${r} (${e}): ${s}`),this.status=e,this.statusText=r,this.url=s,this.body=c}}const ds=rt()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function jr(i,e){const r=new AbortController,s=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:ds(),signal:r.signal});let c=!1,h=!1;return i.type==="json"&&s.headers.set("Accept","application/json"),((d,m,g)=>{if(h)return;const x=Date.now();fetch(s).then(w=>w.ok?((E,C,z)=>{(i.type==="arrayBuffer"?E.arrayBuffer():i.type==="json"?E.json():E.text()).then(P=>{h||(C&&z&&function($,N,ie){if(Fn(),!ar)return;const le={status:N.status,statusText:N.statusText,headers:new Headers};N.headers.forEach((se,xe)=>le.headers.set(xe,se));const ee=Kt(N.headers.get("Cache-Control")||"");ee["no-store"]||(ee["max-age"]&&le.headers.set("Expires",new Date(ie+1e3*ee["max-age"]).toUTCString()),new Date(le.headers.get("Expires")).getTime()-ie<42e4||function(se,xe){if(hn===void 0)try{new Response(new ReadableStream),hn=!0}catch{hn=!1}hn?xe(se.body):se.blob().then(xe)}(N,se=>{const xe=new Response(se,le);Fn(),ar&&ar.then(ye=>ye.put(function(Oe){const Ne=Oe.indexOf("?");return Ne<0?Oe:Oe.slice(0,Ne)}($.url),xe)).catch(ye=>Ke(ye.message))}))}(s,C,z),c=!0,e(null,P,E.headers.get("Cache-Control"),E.headers.get("Expires")))}).catch(P=>{h||e(new Error(P.message))})})(w,null,x):w.blob().then(E=>e(new Oi(w.status,w.statusText,i.url,E)))).catch(w=>{w.code!==20&&e(new Error(w.message))})})(),{cancel:()=>{h=!0,c||r.abort()}}}const Un=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(rt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!rt()){const s=i.url.substring(0,i.url.indexOf("://"));return(Sr.REGISTERED_PROTOCOLS[s]||jr)(i,e)}}if(!(/^file:/.test(r=i.url)||/^file:/.test(ds())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return jr(i,e);if(rt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(s,c){const h=new XMLHttpRequest;h.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(const d in s.headers)h.setRequestHeader(d,s.headers[d]);return s.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=s.credentials==="include",h.onerror=()=>{c(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let d=h.response;if(s.type==="json")try{d=JSON.parse(h.response)}catch(m){return c(m)}c(null,d,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else{const d=new Blob([h.response],{type:h.getResponseHeader("Content-Type")});c(new Oi(h.status,h.statusText,s.url,d))}},h.send(s.body),{cancel:()=>h.abort()}}(i,e)},Vn=function(i,e){return Un(ze(i,{type:"arrayBuffer"}),e)};function fs(i){const e=window.document.createElement("a");return e.href=i,e.protocol===window.document.location.protocol&&e.host===window.document.location.host}const xt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let gr,Xr;gr=[],Xr=0;const Wr=function(i,e){if(qr.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),Xr>=Sr.MAX_PARALLEL_IMAGE_REQUESTS){const h={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return gr.push(h),h}Xr++;let r=!1;const s=()=>{if(!r)for(r=!0,Xr--;gr.length&&Xr<Sr.MAX_PARALLEL_IMAGE_REQUESTS;){const h=gr.shift(),{requestParameters:d,callback:m,cancelled:g}=h;g||(h.cancel=Wr(d,m).cancel)}},c=Vn(i,(h,d,m,g)=>{s(),h?e(h):d&&function(x,w){typeof createImageBitmap=="function"?function(E,C){const z=new Blob([new Uint8Array(E)],{type:"image/png"});createImageBitmap(z).then(P=>{C(null,P)}).catch(P=>{C(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(x,w):function(E,C){const z=new Image;z.onload=()=>{C(null,z),URL.revokeObjectURL(z.src),z.onload=null,window.requestAnimationFrame(()=>{z.src=xt})},z.onerror=()=>C(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new Blob([new Uint8Array(E)],{type:"image/png"});z.src=E.byteLength?URL.createObjectURL(P):xt}(x,w)}(d,(x,w)=>{x!=null?e(x):w!=null&&e(null,w,{cacheControl:m,expires:g})})});return{cancel:()=>{c.cancel(),s()}}};function ms(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function Ar(i,e,r){if(r&&r[i]){const s=r[i].indexOf(e);s!==-1&&r[i].splice(s,1)}}class Cr{constructor(e,r={}){ze(this,r),this.type=e}}class Nn extends Cr{constructor(e,r={}){super("error",ze({error:e},r))}}class kr{on(e,r){return this._listeners=this._listeners||{},ms(e,r,this._listeners),this}off(e,r){return Ar(e,r,this._listeners),Ar(e,r,this._oneTimeListeners),this}once(e,r){return this._oneTimeListeners=this._oneTimeListeners||{},ms(e,r,this._oneTimeListeners),this}fire(e,r){typeof e=="string"&&(e=new Cr(e,r||{}));const s=e.type;if(this.listens(s)){e.target=this;const c=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const m of c)m.call(this,e);const h=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const m of h)Ar(s,m,this._oneTimeListeners),m.call(this,e);const d=this._eventedParent;d&&(ze(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),d.fire(e))}else e instanceof Nn&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var _e={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class ke{constructor(e,r,s,c){this.message=(e?`${e}: `:"")+s,c&&(this.identifier=c),r!=null&&r.__line__&&(this.line=r.__line__)}}function pn(i){const e=i.value;return e?[new ke(i.key,e,"constants have been deprecated as of v8")]:[]}function lr(i,...e){for(const r of e)for(const s in r)i[s]=r[s];return i}function vt(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Ji(i){if(Array.isArray(i))return i.map(Ji);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=Ji(i[r]);return e}return vt(i)}class Ui extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Vi{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[s,c]of r)this.bindings[s]=c}concat(e){return new Vi(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Hr={kind:"null"},Se={kind:"number"},ct={kind:"string"},ot={kind:"boolean"},_i={kind:"color"},Kr={kind:"object"},st={kind:"value"},Mr={kind:"collator"},ci={kind:"formatted"},$n={kind:"padding"},ti={kind:"resolvedImage"};function Ai(i,e){return{kind:"array",itemType:i,N:e}}function Lt(i){if(i.kind==="array"){const e=Lt(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const qn=[Hr,Se,ct,ot,_i,ci,Kr,Ai(st),$n,ti];function _r(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!_r(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of qn)if(!_r(r,e))return null}}return`Expected ${Lt(i)} but found ${Lt(e)} instead.`}function dn(i,e){return e.some(r=>r.kind===i.kind)}function fn(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}var Gn,mn={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function B(i){return(i=Math.round(i))<0?0:i>255?255:i}function b(i){return B(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function S(i){return(e=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:e>1?1:e;var e}function D(i,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?i+(e-i)*r*6:2*r<1?e:3*r<2?i+(e-i)*(2/3-r)*6:i}try{Gn={}.parseCSSColor=function(i){var e,r=i.replace(/ /g,"").toLowerCase();if(r in mn)return mn[r].slice();if(r[0]==="#")return r.length===4?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:r.length===7&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var s=r.indexOf("("),c=r.indexOf(")");if(s!==-1&&c+1===r.length){var h=r.substr(0,s),d=r.substr(s+1,c-(s+1)).split(","),m=1;switch(h){case"rgba":if(d.length!==4)return null;m=S(d.pop());case"rgb":return d.length!==3?null:[b(d[0]),b(d[1]),b(d[2]),m];case"hsla":if(d.length!==4)return null;m=S(d.pop());case"hsl":if(d.length!==3)return null;var g=(parseFloat(d[0])%360+360)%360/360,x=S(d[1]),w=S(d[2]),E=w<=.5?w*(x+1):w+x-w*x,C=2*w-E;return[B(255*D(C,E,g+1/3)),B(255*D(C,E,g)),B(255*D(C,E,g-1/3)),m];default:return null}}return null}}catch{}class L{constructor(e,r,s,c=1){this.r=e,this.g=r,this.b=s,this.a=c}static parse(e){if(!e)return;if(e instanceof L)return e;if(typeof e!="string")return;const r=Gn(e);return r?new L(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,s,c]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(s)},${c})`}toArray(){const{r:e,g:r,b:s,a:c}=this;return c===0?[0,0,0,0]:[255*e/c,255*r/c,255*s/c,c]}}L.black=new L(0,0,0,1),L.white=new L(1,1,1,1),L.transparent=new L(0,0,0,0),L.red=new L(1,0,0,1);class G{constructor(e,r,s){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class K{constructor(e,r,s,c,h){this.text=e,this.image=r,this.scale=s,this.fontStack=c,this.textColor=h}}class W{constructor(e){this.sections=e}static fromString(e){return new W([new K(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof W?e:W.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class Z{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Z)return e;if(typeof e=="number")return new Z([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Z(e)}}toString(){return JSON.stringify(this.values)}}class J{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new J({name:e,available:!1}):null}}function ue(i,e,r,s){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[i,e,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[i,e,r,s]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ve(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof L||i instanceof G||i instanceof W||i instanceof Z||i instanceof J)return!0;if(Array.isArray(i)){for(const e of i)if(!ve(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!ve(i[e]))return!1;return!0}return!1}function ce(i){if(i===null)return Hr;if(typeof i=="string")return ct;if(typeof i=="boolean")return ot;if(typeof i=="number")return Se;if(i instanceof L)return _i;if(i instanceof G)return Mr;if(i instanceof W)return ci;if(i instanceof Z)return $n;if(i instanceof J)return ti;if(Array.isArray(i)){const e=i.length;let r;for(const s of i){const c=ce(s);if(r){if(r===c)continue;r=st;break}r=c}return Ai(r||st,e)}return Kr}function Ve(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof L||i instanceof W||i instanceof Z||i instanceof J?i.toString():JSON.stringify(i)}class $e{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ve(e[1]))return r.error("invalid value");const s=e[1];let c=ce(s);const h=r.expectedType;return c.kind!=="array"||c.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(c=h),new $e(c,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Be{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Ye={string:ct,number:Se,boolean:ot,object:Kr};class et{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let s,c=1;const h=e[0];if(h==="array"){let m,g;if(e.length>2){const x=e[1];if(typeof x!="string"||!(x in Ye)||x==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);m=Ye[x],c++}else m=st;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);g=e[2],c++}s=Ai(m,g)}else{if(!Ye[h])throw new Error(`Types doesn't contain name = ${h}`);s=Ye[h]}const d=[];for(;c<e.length;c++){const m=r.parse(e[c],c,st);if(!m)return null;d.push(m)}return new et(s,d)}evaluate(e){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(e);if(!_r(this.type,ce(s)))return s;if(r===this.args.length-1)throw new Be(`Expected value to be of type ${Lt(this.type)}, but found ${Lt(ce(s))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const bt={"to-boolean":ot,"to-color":_i,"to-number":Se,"to-string":ct};class nt{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[0];if(!bt[s])throw new Error(`Can't parse ${s} as it is not part of the known types`);if((s==="to-boolean"||s==="to-string")&&e.length!==2)return r.error("Expected one argument.");const c=bt[s],h=[];for(let d=1;d<e.length;d++){const m=r.parse(e[d],d,st);if(!m)return null;h.push(m)}return new nt(c,h)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let r,s;for(const c of this.args){if(r=c.evaluate(e),s=null,r instanceof L)return r;if(typeof r=="string"){const h=e.parseColor(r);if(h)return h}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:ue(r[0],r[1],r[2],r[3]),!s))return new L(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Be(s||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}if(this.type.kind==="padding"){let r;for(const s of this.args){r=s.evaluate(e);const c=Z.parse(r);if(c)return c}throw new Be(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}if(this.type.kind==="number"){let r=null;for(const s of this.args){if(r=s.evaluate(e),r===null)return 0;const c=Number(r);if(!isNaN(c))return c}throw new Be(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?W.fromString(Ve(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?J.fromString(Ve(this.args[0].evaluate(e))):Ve(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const ut=["Unknown","Point","LineString","Polygon"];class wt{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ut[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=L.parse(e)),r}}class Ot{constructor(e,r,s,c){this.name=e,this.type=r,this._evaluate=s,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const s=e[0],c=Ot.definitions[s];if(!c)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(c)?c[0]:c.type,d=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,m=d.filter(([x])=>!Array.isArray(x)||x.length===e.length-1);let g=null;for(const[x,w]of m){g=new Xn(r.registry,r.path,null,r.scope);const E=[];let C=!1;for(let z=1;z<e.length;z++){const P=e[z],$=Array.isArray(x)?x[z-1]:x.type,N=g.parse(P,1+E.length,$);if(!N){C=!0;break}E.push(N)}if(!C)if(Array.isArray(x)&&x.length!==E.length)g.error(`Expected ${x.length} arguments, but found ${E.length} instead.`);else{for(let z=0;z<E.length;z++){const P=Array.isArray(x)?x[z]:x.type,$=E[z];g.concat(z+1).checkSubtype(P,$.type)}if(g.errors.length===0)return new Ot(s,h,w,E)}}if(m.length===1)r.errors.push(...g.errors);else{const x=(m.length?m:d).map(([E])=>{return C=E,Array.isArray(C)?`(${C.map(Lt).join(", ")})`:`(${Lt(C.type)}...)`;var C}).join(" | "),w=[];for(let E=1;E<e.length;E++){const C=r.parse(e[E],1+w.length);if(!C)return null;w.push(Lt(C.type))}r.error(`Expected arguments of type ${x}, but found (${w.join(", ")}) instead.`)}return null}static register(e,r){Ot.definitions=r;for(const s in r)e[s]=Ot}}class ui{constructor(e,r,s){this.type=Mr,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return r.error("Collator options argument must be an object.");const c=r.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,ot);if(!c)return null;const h=r.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,ot);if(!h)return null;let d=null;return s.locale&&(d=r.parse(s.locale,1,ct),!d)?null:new ui(c,h,d)}evaluate(e){return new G(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const Gt=8192;function wi(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Zn(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function gs(i,e){const r=(180+i[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(r*c*Gt),Math.round(s*c*Gt)]}function Ut(i,e,r){const s=i[0]-e[0],c=i[1]-e[1],h=i[0]-r[0],d=i[1]-r[1];return s*d-h*c==0&&s*h<=0&&c*d<=0}function Lo(i,e){let r=!1;for(let d=0,m=e.length;d<m;d++){const g=e[d];for(let x=0,w=g.length;x<w-1;x++){if(Ut(i,g[x],g[x+1]))return!1;(c=g[x])[1]>(s=i)[1]!=(h=g[x+1])[1]>s[1]&&s[0]<(h[0]-c[0])*(s[1]-c[1])/(h[1]-c[1])+c[0]&&(r=!r)}}var s,c,h;return r}function Bo(i,e){for(let r=0;r<e.length;r++)if(Lo(i,e[r]))return!0;return!1}function Ua(i,e,r,s){const c=s[0]-r[0],h=s[1]-r[1],d=(i[0]-r[0])*h-c*(i[1]-r[1]),m=(e[0]-r[0])*h-c*(e[1]-r[1]);return d>0&&m<0||d<0&&m>0}function Va(i,e,r){for(const x of r)for(let w=0;w<x.length-1;++w)if((m=[(d=x[w+1])[0]-(h=x[w])[0],d[1]-h[1]])[0]*(g=[(c=e)[0]-(s=i)[0],c[1]-s[1]])[1]-m[1]*g[0]!=0&&Ua(s,c,h,d)&&Ua(h,d,s,c))return!0;var s,c,h,d,m,g;return!1}function Ro(i,e){for(let r=0;r<i.length;++r)if(!Lo(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(Va(i[r],i[r+1],e))return!1;return!0}function nc(i,e){for(let r=0;r<e.length;r++)if(Ro(i,e[r]))return!0;return!1}function Js(i,e,r){const s=[];for(let c=0;c<i.length;c++){const h=[];for(let d=0;d<i[c].length;d++){const m=gs(i[c][d],r);wi(e,m),h.push(m)}s.push(h)}return s}function Fo(i,e,r){const s=[];for(let c=0;c<i.length;c++){const h=Js(i[c],e,r);s.push(h)}return s}function Na(i,e,r,s){if(i[0]<r[0]||i[0]>r[2]){const c=.5*s;let h=i[0]-r[0]>c?-s:r[0]-i[0]>c?s:0;h===0&&(h=i[0]-r[2]>c?-s:r[2]-i[0]>c?s:0),i[0]+=h}wi(e,i)}function $a(i,e,r,s){const c=Math.pow(2,s.z)*Gt,h=[s.x*Gt,s.y*Gt],d=[];for(const m of i)for(const g of m){const x=[g.x+h[0],g.y+h[1]];Na(x,e,r,c),d.push(x)}return d}function qa(i,e,r,s){const c=Math.pow(2,s.z)*Gt,h=[s.x*Gt,s.y*Gt],d=[];for(const g of i){const x=[];for(const w of g){const E=[w.x+h[0],w.y+h[1]];wi(e,E),x.push(E)}d.push(x)}if(e[2]-e[0]<=c/2){(m=e)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(const g of d)for(const x of g)Na(x,e,r,c)}var m;return d}class gn{constructor(e,r){this.type=ot,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ve(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let c=0;c<s.features.length;++c){const h=s.features[c].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new gn(s,s.features[c].geometry)}else if(s.type==="Feature"){const c=s.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new gn(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new gn(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,s){const c=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],d=r.canonicalID();if(s.type==="Polygon"){const m=Js(s.coordinates,h,d),g=$a(r.geometry(),c,h,d);if(!Zn(c,h))return!1;for(const x of g)if(!Lo(x,m))return!1}if(s.type==="MultiPolygon"){const m=Fo(s.coordinates,h,d),g=$a(r.geometry(),c,h,d);if(!Zn(c,h))return!1;for(const x of g)if(!Bo(x,m))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,s){const c=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],d=r.canonicalID();if(s.type==="Polygon"){const m=Js(s.coordinates,h,d),g=qa(r.geometry(),c,h,d);if(!Zn(c,h))return!1;for(const x of g)if(!Ro(x,m))return!1}if(s.type==="MultiPolygon"){const m=Fo(s.coordinates,h,d),g=qa(r.geometry(),c,h,d);if(!Zn(c,h))return!1;for(const x of g)if(!nc(x,m))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function _s(i){if(i instanceof Ot&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof gn)return!1;let e=!0;return i.eachChild(r=>{e&&!_s(r)&&(e=!1)}),e}function jn(i){if(i instanceof Ot&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!jn(r)&&(e=!1)}),e}function Qs(i,e){if(i instanceof Ot&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(s=>{r&&!Qs(s,e)&&(r=!1)}),r}class eo{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const s=e[1];return r.scope.has(s)?new eo(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Xn{constructor(e,r=[],s,c=new Vi,h=[]){this.registry=e,this.path=r,this.key=r.map(d=>`[${d}]`).join(""),this.scope=c,this.errors=h,this.expectedType=s}parse(e,r,s,c,h={}){return r?this.concat(r,s,c)._parse(e,h):this._parse(e,h)}_parse(e,r){function s(c,h,d){return d==="assert"?new et(h,[c]):d==="coerce"?new nt(h,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const h=this.registry[c];if(h){let d=h.parse(e,this);if(!d)return null;if(this.expectedType){const m=this.expectedType,g=d.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||g.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||g.kind!=="value"&&g.kind!=="string")if(m.kind!=="padding"||g.kind!=="value"&&g.kind!=="number"&&g.kind!=="array"){if(this.checkSubtype(m,g))return null}else d=s(d,m,r.typeAnnotation||"coerce");else d=s(d,m,r.typeAnnotation||"coerce");else d=s(d,m,r.typeAnnotation||"assert")}if(!(d instanceof $e)&&d.type.kind!=="resolvedImage"&&Oo(d)){const m=new wt;try{d=new $e(d.type,d.evaluate(m))}catch(g){return this.error(g.message),null}}return d}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,s){const c=typeof e=="number"?this.path.concat(e):this.path,h=s?this.scope.concat(s):this.scope;return new Xn(this.registry,c,r||null,h,this.errors)}error(e,...r){const s=`${this.key}${r.map(c=>`[${c}]`).join("")}`;this.errors.push(new Ui(s,e))}checkSubtype(e,r){const s=_r(e,r);return s&&this.error(s),s}}function Oo(i){if(i instanceof eo)return Oo(i.boundExpression);if(i instanceof Ot&&i.name==="error"||i instanceof ui||i instanceof gn)return!1;const e=i instanceof nt||i instanceof et;let r=!0;return i.eachChild(s=>{r=e?r&&Oo(s):r&&s instanceof $e}),!!r&&_s(i)&&Qs(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function to(i,e){const r=i.length-1;let s,c,h=0,d=r,m=0;for(;h<=d;)if(m=Math.floor((h+d)/2),s=i[m],c=i[m+1],s<=e){if(m===r||e<c)return m;h=m+1}else{if(!(s>e))throw new Be("Input is not a number.");d=m-1}return 0}class ys{constructor(e,r,s){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[c,h]of s)this.labels.push(c),this.outputs.push(h)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(e[1],1,Se);if(!s)return null;const c=[];let h=null;r.expectedType&&r.expectedType.kind!=="value"&&(h=r.expectedType);for(let d=1;d<e.length;d+=2){const m=d===1?-1/0:e[d],g=e[d+1],x=d,w=d+1;if(typeof m!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',x);if(c.length&&c[c.length-1][0]>=m)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',x);const E=r.parse(g,w,h);if(!E)return null;h=h||E.type,c.push([m,E])}return new ys(h,s,c)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=r[0])return s[0].evaluate(e);const h=r.length;return c>=r[h-1]?s[h-1].evaluate(e):s[to(r,c)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Zt(i,e,r){return i*(1-r)+e*r}var xs=Object.freeze({__proto__:null,number:Zt,color:function(i,e,r){return new L(Zt(i.r,e.r,r),Zt(i.g,e.g,r),Zt(i.b,e.b,r),Zt(i.a,e.a,r))},array:function(i,e,r){return i.map((s,c)=>Zt(s,e[c],r))},padding:function(i,e,r){const s=i.values,c=e.values;return new Z([Zt(s[0],c[0],r),Zt(s[1],c[1],r),Zt(s[2],c[2],r),Zt(s[3],c[3],r)])}});const Ga=.95047,Za=1.08883,Uo=4/29,io=6/29,ja=3*io*io,sc=Math.PI/180,oc=180/Math.PI;function Vo(i){return i>.008856451679035631?Math.pow(i,1/3):i/ja+Uo}function No(i){return i>io?i*i*i:ja*(i-Uo)}function $o(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function qo(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function At(i){const e=qo(i.r),r=qo(i.g),s=qo(i.b),c=Vo((.4124564*e+.3575761*r+.1804375*s)/Ga),h=Vo((.2126729*e+.7151522*r+.072175*s)/1);return{l:116*h-16,a:500*(c-h),b:200*(h-Vo((.0193339*e+.119192*r+.9503041*s)/Za)),alpha:i.a}}function Xa(i){let e=(i.l+16)/116,r=isNaN(i.a)?e:e+i.a/500,s=isNaN(i.b)?e:e-i.b/200;return e=1*No(e),r=Ga*No(r),s=Za*No(s),new L($o(3.2404542*r-1.5371385*e-.4985314*s),$o(-.969266*r+1.8760108*e+.041556*s),$o(.0556434*r-.2040259*e+1.0572252*s),i.alpha)}function ac(i,e,r){const s=e-i;return i+r*(s>180||s<-180?s-360*Math.round(s/360):s)}const vs={forward:At,reverse:Xa,interpolate:function(i,e,r){return{l:Zt(i.l,e.l,r),a:Zt(i.a,e.a,r),b:Zt(i.b,e.b,r),alpha:Zt(i.alpha,e.alpha,r)}}},bs={forward:function(i){const{l:e,a:r,b:s}=At(i),c=Math.atan2(s,r)*oc;return{h:c<0?c+360:c,c:Math.sqrt(r*r+s*s),l:e,alpha:i.a}},reverse:function(i){const e=i.h*sc,r=i.c;return Xa({l:i.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:i.alpha})},interpolate:function(i,e,r){return{h:ac(i.h,e.h,r),c:Zt(i.c,e.c,r),l:Zt(i.l,e.l,r),alpha:Zt(i.alpha,e.alpha,r)}}};var Wa=Object.freeze({__proto__:null,lab:vs,hcl:bs});class Ni{constructor(e,r,s,c,h){this.type=e,this.operator=r,this.interpolation=s,this.input=c,this.labels=[],this.outputs=[];for(const[d,m]of h)this.labels.push(d),this.outputs.push(m)}static interpolationFactor(e,r,s,c){let h=0;if(e.name==="exponential")h=Go(r,e.base,s,c);else if(e.name==="linear")h=Go(r,1,s,c);else if(e.name==="cubic-bezier"){const d=e.controlPoints;h=new de(d[0],d[1],d[2],d[3]).solve(Go(r,1,s,c))}return h}static parse(e,r){let[s,c,h,...d]=e;if(!Array.isArray(c)||c.length===0)return r.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const x=c[1];if(typeof x!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:x}}else{if(c[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const x=c.slice(1);if(x.length!==4||x.some(w=>typeof w!="number"||w<0||w>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:x}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(h=r.parse(h,2,Se),!h)return null;const m=[];let g=null;s==="interpolate-hcl"||s==="interpolate-lab"?g=_i:r.expectedType&&r.expectedType.kind!=="value"&&(g=r.expectedType);for(let x=0;x<d.length;x+=2){const w=d[x],E=d[x+1],C=x+3,z=x+4;if(typeof w!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(m.length&&m[m.length-1][0]>=w)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',C);const P=r.parse(E,z,g);if(!P)return null;g=g||P.type,m.push([w,P])}return g.kind==="number"||g.kind==="color"||g.kind==="padding"||g.kind==="array"&&g.itemType.kind==="number"&&typeof g.N=="number"?new Ni(g,s,c,h,m):r.error(`Type ${Lt(g)} is not interpolatable.`)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=r[0])return s[0].evaluate(e);const h=r.length;if(c>=r[h-1])return s[h-1].evaluate(e);const d=to(r,c),m=Ni.interpolationFactor(this.interpolation,c,r[d],r[d+1]),g=s[d].evaluate(e),x=s[d+1].evaluate(e);return this.operator==="interpolate"?xs[this.type.kind.toLowerCase()](g,x,m):this.operator==="interpolate-hcl"?bs.reverse(bs.interpolate(bs.forward(g),bs.forward(x),m)):vs.reverse(vs.interpolate(vs.forward(g),vs.forward(x),m))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Go(i,e,r,s){const c=s-r,h=i-r;return c===0?0:e===1?h/c:(Math.pow(e,h)-1)/(Math.pow(e,c)-1)}class ro{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let s=null;const c=r.expectedType;c&&c.kind!=="value"&&(s=c);const h=[];for(const m of e.slice(1)){const g=r.parse(m,1+h.length,s,void 0,{typeAnnotation:"omit"});if(!g)return null;s=s||g.type,h.push(g)}if(!s)throw new Error("No output type");const d=c&&h.some(m=>_r(c,m.type));return new ro(d?st:s,h)}evaluate(e){let r,s=null,c=0;for(const h of this.args)if(c++,s=h.evaluate(e),s&&s instanceof J&&!s.available&&(r||(r=s.name),s=null,c===this.args.length&&(s=r)),s!==null)break;return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class no{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let h=1;h<e.length-1;h+=2){const d=e[h];if(typeof d!="string")return r.error(`Expected string, but found ${typeof d} instead.`,h);if(/[^a-zA-Z0-9_]/.test(d))return r.error("Variable names must contain only alphanumeric characters or '_'.",h);const m=r.parse(e[h+1],h+1);if(!m)return null;s.push([d,m])}const c=r.parse(e[e.length-1],e.length-1,r.expectedType,s);return c?new no(s,c):null}outputDefined(){return this.result.outputDefined()}}class Zo{constructor(e,r,s){this.type=e,this.index=r,this.input=s}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Se),c=r.parse(e[2],2,Ai(r.expectedType||st));return s&&c?new Zo(c.type.itemType,s,c):null}evaluate(e){const r=this.index.evaluate(e),s=this.input.evaluate(e);if(r<0)throw new Be(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new Be(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new Be(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class jo{constructor(e,r){this.type=ot,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,st),c=r.parse(e[2],2,st);return s&&c?dn(s.type,[ot,ct,Se,Hr,st])?new jo(s,c):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Lt(s.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!s)return!1;if(!fn(r,["boolean","string","number","null"]))throw new Be(`Expected first argument to be of type boolean, string, number or null, but found ${Lt(ce(r))} instead.`);if(!fn(s,["string","array"]))throw new Be(`Expected second argument to be of type array or string, but found ${Lt(ce(s))} instead.`);return s.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class so{constructor(e,r,s){this.type=Se,this.needle=e,this.haystack=r,this.fromIndex=s}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,st),c=r.parse(e[2],2,st);if(!s||!c)return null;if(!dn(s.type,[ot,ct,Se,Hr,st]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Lt(s.type)} instead`);if(e.length===4){const h=r.parse(e[3],3,Se);return h?new so(s,c,h):null}return new so(s,c)}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!fn(r,["boolean","string","number","null"]))throw new Be(`Expected first argument to be of type boolean, string, number or null, but found ${Lt(ce(r))} instead.`);if(!fn(s,["string","array"]))throw new Be(`Expected second argument to be of type array or string, but found ${Lt(ce(s))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return s.indexOf(r,c)}return s.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Xo{constructor(e,r,s,c,h,d){this.inputType=e,this.type=r,this.input=s,this.cases=c,this.outputs=h,this.otherwise=d}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let s,c;r.expectedType&&r.expectedType.kind!=="value"&&(c=r.expectedType);const h={},d=[];for(let x=2;x<e.length-1;x+=2){let w=e[x];const E=e[x+1];Array.isArray(w)||(w=[w]);const C=r.concat(x);if(w.length===0)return C.error("Expected at least one branch label.");for(const P of w){if(typeof P!="number"&&typeof P!="string")return C.error("Branch labels must be numbers or strings.");if(typeof P=="number"&&Math.abs(P)>Number.MAX_SAFE_INTEGER)return C.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof P=="number"&&Math.floor(P)!==P)return C.error("Numeric branch labels must be integer values.");if(s){if(C.checkSubtype(s,ce(P)))return null}else s=ce(P);if(h[String(P)]!==void 0)return C.error("Branch labels must be unique.");h[String(P)]=d.length}const z=r.parse(E,x,c);if(!z)return null;c=c||z.type,d.push(z)}const m=r.parse(e[1],1,st);if(!m)return null;const g=r.parse(e[e.length-1],e.length-1,c);return g?m.type.kind!=="value"&&r.concat(1).checkSubtype(s,m.type)?null:new Xo(s,c,m,h,d,g):null}evaluate(e){const r=this.input.evaluate(e);return(ce(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class Wo{constructor(e,r,s){this.type=e,this.branches=r,this.otherwise=s}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const c=[];for(let d=1;d<e.length-1;d+=2){const m=r.parse(e[d],d,ot);if(!m)return null;const g=r.parse(e[d+1],d+1,s);if(!g)return null;c.push([m,g]),s=s||g.type}const h=r.parse(e[e.length-1],e.length-1,s);if(!h)return null;if(!s)throw new Error("Can't infer output type");return new Wo(s,c,h)}evaluate(e){for(const[r,s]of this.branches)if(r.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,s]of this.branches)e(r),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class oo{constructor(e,r,s,c){this.type=e,this.input=r,this.beginIndex=s,this.endIndex=c}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,st),c=r.parse(e[2],2,Se);if(!s||!c)return null;if(!dn(s.type,[Ai(st),ct,st]))return r.error(`Expected first argument to be of type array or string, but found ${Lt(s.type)} instead`);if(e.length===4){const h=r.parse(e[3],3,Se);return h?new oo(s.type,s,c,h):null}return new oo(s.type,s,c)}evaluate(e){const r=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!fn(r,["string","array"]))throw new Be(`Expected first argument to be of type array or string, but found ${Lt(ce(r))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return r.slice(s,c)}return r.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Ha(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Ka(i,e,r,s){return s.compare(e,r)===0}function Wn(i,e,r){const s=i!=="=="&&i!=="!=";return class Ep{constructor(h,d,m){this.type=ot,this.lhs=h,this.rhs=d,this.collator=m,this.hasUntypedArgument=h.type.kind==="value"||d.type.kind==="value"}static parse(h,d){if(h.length!==3&&h.length!==4)return d.error("Expected two or three arguments.");const m=h[0];let g=d.parse(h[1],1,st);if(!g)return null;if(!Ha(m,g.type))return d.concat(1).error(`"${m}" comparisons are not supported for type '${Lt(g.type)}'.`);let x=d.parse(h[2],2,st);if(!x)return null;if(!Ha(m,x.type))return d.concat(2).error(`"${m}" comparisons are not supported for type '${Lt(x.type)}'.`);if(g.type.kind!==x.type.kind&&g.type.kind!=="value"&&x.type.kind!=="value")return d.error(`Cannot compare types '${Lt(g.type)}' and '${Lt(x.type)}'.`);s&&(g.type.kind==="value"&&x.type.kind!=="value"?g=new et(x.type,[g]):g.type.kind!=="value"&&x.type.kind==="value"&&(x=new et(g.type,[x])));let w=null;if(h.length===4){if(g.type.kind!=="string"&&x.type.kind!=="string"&&g.type.kind!=="value"&&x.type.kind!=="value")return d.error("Cannot use collator to compare non-string types.");if(w=d.parse(h[3],3,Mr),!w)return null}return new Ep(g,x,w)}evaluate(h){const d=this.lhs.evaluate(h),m=this.rhs.evaluate(h);if(s&&this.hasUntypedArgument){const g=ce(d),x=ce(m);if(g.kind!==x.kind||g.kind!=="string"&&g.kind!=="number")throw new Be(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${g.kind}, ${x.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const g=ce(d),x=ce(m);if(g.kind!=="string"||x.kind!=="string")return e(h,d,m)}return this.collator?r(h,d,m,this.collator.evaluate(h)):e(h,d,m)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}}}const lc=Wn("==",function(i,e,r){return e===r},Ka),cc=Wn("!=",function(i,e,r){return e!==r},function(i,e,r,s){return!Ka(0,e,r,s)}),uc=Wn("<",function(i,e,r){return e<r},function(i,e,r,s){return s.compare(e,r)<0}),hc=Wn(">",function(i,e,r){return e>r},function(i,e,r,s){return s.compare(e,r)>0}),pc=Wn("<=",function(i,e,r){return e<=r},function(i,e,r,s){return s.compare(e,r)<=0}),dc=Wn(">=",function(i,e,r){return e>=r},function(i,e,r,s){return s.compare(e,r)>=0});class Ho{constructor(e,r,s,c,h){this.type=ct,this.number=e,this.locale=r,this.currency=s,this.minFractionDigits=c,this.maxFractionDigits=h}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const s=r.parse(e[1],1,Se);if(!s)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return r.error("NumberFormat options argument must be an object.");let h=null;if(c.locale&&(h=r.parse(c.locale,1,ct),!h))return null;let d=null;if(c.currency&&(d=r.parse(c.currency,1,ct),!d))return null;let m=null;if(c["min-fraction-digits"]&&(m=r.parse(c["min-fraction-digits"],1,Se),!m))return null;let g=null;return c["max-fraction-digits"]&&(g=r.parse(c["max-fraction-digits"],1,Se),!g)?null:new Ho(s,h,d,m,g)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class ao{constructor(e){this.type=ci,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return r.error("First argument must be an image or text section.");const c=[];let h=!1;for(let d=1;d<=e.length-1;++d){const m=e[d];if(h&&typeof m=="object"&&!Array.isArray(m)){h=!1;let g=null;if(m["font-scale"]&&(g=r.parse(m["font-scale"],1,Se),!g))return null;let x=null;if(m["text-font"]&&(x=r.parse(m["text-font"],1,Ai(ct)),!x))return null;let w=null;if(m["text-color"]&&(w=r.parse(m["text-color"],1,_i),!w))return null;const E=c[c.length-1];E.scale=g,E.font=x,E.textColor=w}else{const g=r.parse(e[d],1,st);if(!g)return null;const x=g.type.kind;if(x!=="string"&&x!=="value"&&x!=="null"&&x!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,c.push({content:g,scale:null,font:null,textColor:null})}}return new ao(c)}evaluate(e){return new W(this.sections.map(r=>{const s=r.content.evaluate(e);return ce(s)===ti?new K("",s,null,null,null):new K(Ve(s),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}}class Ko{constructor(e){this.type=ti,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const s=r.parse(e[1],1,ct);return s?new Ko(s):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),s=J.fromString(r);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(r)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}}class Yo{constructor(e){this.type=Se,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=r.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Lt(s.type)} instead.`):new Yo(s):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Be(`Expected value to be of type string or array, but found ${Lt(ce(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Hn={"==":lc,"!=":cc,">":hc,"<":uc,">=":dc,"<=":pc,array:et,at:Zo,boolean:et,case:Wo,coalesce:ro,collator:ui,format:ao,image:Ko,in:jo,"index-of":so,interpolate:Ni,"interpolate-hcl":Ni,"interpolate-lab":Ni,length:Yo,let:no,literal:$e,match:Xo,number:et,"number-format":Ho,object:et,slice:oo,step:ys,string:et,"to-boolean":nt,"to-color":nt,"to-number":nt,"to-string":nt,var:eo,within:gn};function Ya(i,[e,r,s,c]){e=e.evaluate(i),r=r.evaluate(i),s=s.evaluate(i);const h=c?c.evaluate(i):1,d=ue(e,r,s,h);if(d)throw new Be(d);return new L(e/255*h,r/255*h,s/255*h,h)}function Ja(i,e){return i in e}function lo(i,e){const r=e[i];return r===void 0?null:r}function _n(i){return{type:i}}function Qa(i){return{result:"success",value:i}}function Kn(i){return{result:"error",value:i}}function $t(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function el(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function _t(i){return!!i.expression&&i.expression.interpolated}function Ct(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Nt(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function jt(i){return i}function ws(i,e){const r=e.type==="color",s=i.stops&&typeof i.stops[0][0]=="object",c=s||!(s||i.property!==void 0),h=i.type||(_t(e)?"exponential":"interval");if(r||e.type==="padding"){const x=r?L.parse:Z.parse;(i=lr({},i)).stops&&(i.stops=i.stops.map(w=>[w[0],x(w[1])])),i.default=x(i.default?i.default:e.default)}if(i.colorSpace&&i.colorSpace!=="rgb"&&!Wa[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let d,m,g;if(h==="exponential")d=tl;else if(h==="interval")d=mc;else if(h==="categorical"){d=fc,m=Object.create(null);for(const x of i.stops)m[x[0]]=x[1];g=typeof i.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);d=gc}if(s){const x={},w=[];for(let z=0;z<i.stops.length;z++){const P=i.stops[z],$=P[0].zoom;x[$]===void 0&&(x[$]={zoom:$,type:i.type,property:i.property,default:i.default,stops:[]},w.push($)),x[$].stops.push([P[0].value,P[1]])}const E=[];for(const z of w)E.push([x[z].zoom,ws(x[z],e)]);const C={name:"linear"};return{kind:"composite",interpolationType:C,interpolationFactor:Ni.interpolationFactor.bind(void 0,C),zoomStops:E.map(z=>z[0]),evaluate:({zoom:z},P)=>tl({stops:E,base:i.base},e,z).evaluate(z,P)}}if(c){const x=h==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:x,interpolationFactor:Ni.interpolationFactor.bind(void 0,x),zoomStops:i.stops.map(w=>w[0]),evaluate:({zoom:w})=>d(i,e,w,m,g)}}return{kind:"source",evaluate(x,w){const E=w&&w.properties?w.properties[i.property]:void 0;return E===void 0?Yn(i.default,e.default):d(i,e,E,m,g)}}}function Yn(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function fc(i,e,r,s,c){return Yn(typeof r===c?s[r]:void 0,i.default,e.default)}function mc(i,e,r){if(Ct(r)!=="number")return Yn(i.default,e.default);const s=i.stops.length;if(s===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[s-1][0])return i.stops[s-1][1];const c=to(i.stops.map(h=>h[0]),r);return i.stops[c][1]}function tl(i,e,r){const s=i.base!==void 0?i.base:1;if(Ct(r)!=="number")return Yn(i.default,e.default);const c=i.stops.length;if(c===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[c-1][0])return i.stops[c-1][1];const h=to(i.stops.map(w=>w[0]),r),d=function(w,E,C,z){const P=z-C,$=w-C;return P===0?0:E===1?$/P:(Math.pow(E,$)-1)/(Math.pow(E,P)-1)}(r,s,i.stops[h][0],i.stops[h+1][0]),m=i.stops[h][1],g=i.stops[h+1][1];let x=xs[e.type]||jt;if(i.colorSpace&&i.colorSpace!=="rgb"){const w=Wa[i.colorSpace];x=(E,C)=>w.reverse(w.interpolate(w.forward(E),w.forward(C),d))}return typeof m.evaluate=="function"?{evaluate(...w){const E=m.evaluate.apply(void 0,w),C=g.evaluate.apply(void 0,w);if(E!==void 0&&C!==void 0)return x(E,C,d)}}:x(m,g,d)}function gc(i,e,r){switch(e.type){case"color":r=L.parse(r);break;case"formatted":r=W.fromString(r.toString());break;case"resolvedImage":r=J.fromString(r.toString());break;case"padding":r=Z.parse(r);break;default:Ct(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return Yn(r,i.default,e.default)}Ot.register(Hn,{error:[{kind:"error"},[ct],(i,[e])=>{throw new Be(e.evaluate(i))}],typeof:[ct,[st],(i,[e])=>Lt(ce(e.evaluate(i)))],"to-rgba":[Ai(Se,4),[_i],(i,[e])=>e.evaluate(i).toArray()],rgb:[_i,[Se,Se,Se],Ya],rgba:[_i,[Se,Se,Se,Se],Ya],has:{type:ot,overloads:[[[ct],(i,[e])=>Ja(e.evaluate(i),i.properties())],[[ct,Kr],(i,[e,r])=>Ja(e.evaluate(i),r.evaluate(i))]]},get:{type:st,overloads:[[[ct],(i,[e])=>lo(e.evaluate(i),i.properties())],[[ct,Kr],(i,[e,r])=>lo(e.evaluate(i),r.evaluate(i))]]},"feature-state":[st,[ct],(i,[e])=>lo(e.evaluate(i),i.featureState||{})],properties:[Kr,[],i=>i.properties()],"geometry-type":[ct,[],i=>i.geometryType()],id:[st,[],i=>i.id()],zoom:[Se,[],i=>i.globals.zoom],"heatmap-density":[Se,[],i=>i.globals.heatmapDensity||0],"line-progress":[Se,[],i=>i.globals.lineProgress||0],accumulated:[st,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Se,_n(Se),(i,e)=>{let r=0;for(const s of e)r+=s.evaluate(i);return r}],"*":[Se,_n(Se),(i,e)=>{let r=1;for(const s of e)r*=s.evaluate(i);return r}],"-":{type:Se,overloads:[[[Se,Se],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[Se],(i,[e])=>-e.evaluate(i)]]},"/":[Se,[Se,Se],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[Se,[Se,Se],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[Se,[],()=>Math.LN2],pi:[Se,[],()=>Math.PI],e:[Se,[],()=>Math.E],"^":[Se,[Se,Se],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[Se,[Se],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Se,[Se],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Se,[Se],(i,[e])=>Math.log(e.evaluate(i))],log2:[Se,[Se],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Se,[Se],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Se,[Se],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Se,[Se],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Se,[Se],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Se,[Se],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Se,[Se],(i,[e])=>Math.atan(e.evaluate(i))],min:[Se,_n(Se),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[Se,_n(Se),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[Se,[Se],(i,[e])=>Math.abs(e.evaluate(i))],round:[Se,[Se],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[Se,[Se],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Se,[Se],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[ot,[ct,st],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[ot,[st],(i,[e])=>i.id()===e.value],"filter-type-==":[ot,[ct],(i,[e])=>i.geometryType()===e.value],"filter-<":[ot,[ct,st],(i,[e,r])=>{const s=i.properties()[e.value],c=r.value;return typeof s==typeof c&&s<c}],"filter-id-<":[ot,[st],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r<s}],"filter->":[ot,[ct,st],(i,[e,r])=>{const s=i.properties()[e.value],c=r.value;return typeof s==typeof c&&s>c}],"filter-id->":[ot,[st],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r>s}],"filter-<=":[ot,[ct,st],(i,[e,r])=>{const s=i.properties()[e.value],c=r.value;return typeof s==typeof c&&s<=c}],"filter-id-<=":[ot,[st],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r<=s}],"filter->=":[ot,[ct,st],(i,[e,r])=>{const s=i.properties()[e.value],c=r.value;return typeof s==typeof c&&s>=c}],"filter-id->=":[ot,[st],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r>=s}],"filter-has":[ot,[st],(i,[e])=>e.value in i.properties()],"filter-has-id":[ot,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[ot,[Ai(ct)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[ot,[Ai(st)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[ot,[ct,Ai(st)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[ot,[ct,Ai(st)],(i,[e,r])=>function(s,c,h,d){for(;h<=d;){const m=h+d>>1;if(c[m]===s)return!0;c[m]>s?d=m-1:h=m+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:ot,overloads:[[[ot,ot],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[_n(ot),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:ot,overloads:[[[ot,ot],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[_n(ot),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[ot,[ot],(i,[e])=>!e.evaluate(i)],"is-supported-script":[ot,[ct],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[ct,[ct],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[ct,[ct],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[ct,_n(st),(i,e)=>e.map(r=>Ve(r.evaluate(i))).join("")],"resolved-locale":[ct,[Mr],(i,[e])=>e.evaluate(i).resolvedLocale()]});class co{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new wt,this._defaultValue=r?function(s){return s.type==="color"&&Nt(s.default)?new L(0,0,0,0):s.type==="color"?L.parse(s.default)||null:s.type==="padding"?Z.parse(s.default)||null:s.default===void 0?null:s.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,s,c,h,d){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=c,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=d,this.expression.evaluate(this._evaluator)}evaluate(e,r,s,c,h,d){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=c,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=d||null;try{const m=this.expression.evaluate(this._evaluator);if(m==null||typeof m=="number"&&m!=m)return this._defaultValue;if(this._enumValues&&!(m in this._enumValues))throw new Be(`Expected value to be one of ${Object.keys(this._enumValues).map(g=>JSON.stringify(g)).join(", ")}, but found ${JSON.stringify(m)} instead.`);return m}catch(m){return this._warningHistory[m.message]||(this._warningHistory[m.message]=!0,typeof console<"u"&&console.warn(m.message)),this._defaultValue}}}function Ts(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Hn}function Es(i,e){const r=new Xn(Hn,[],e?function(c){const h={color:_i,string:ct,number:Se,enum:ct,boolean:ot,formatted:ci,padding:$n,resolvedImage:ti};return c.type==="array"?Ai(h[c.value]||st,c.length):h[c.type]}(e):void 0),s=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?Qa(new co(s,e)):Kn(r.errors)}class Ss{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!jn(r.expression)}evaluateWithoutErrorHandling(e,r,s,c,h,d){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,c,h,d)}evaluate(e,r,s,c,h,d){return this._styleExpression.evaluate(e,r,s,c,h,d)}}class Jo{constructor(e,r,s,c){this.kind=e,this.zoomStops=s,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!jn(r.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,r,s,c,h,d){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,c,h,d)}evaluate(e,r,s,c,h,d){return this._styleExpression.evaluate(e,r,s,c,h,d)}interpolationFactor(e,r,s){return this.interpolationType?Ni.interpolationFactor(this.interpolationType,e,r,s):0}}function il(i,e){const r=Es(i,e);if(r.result==="error")return r;const s=r.value.expression,c=_s(s);if(!c&&!$t(e))return Kn([new Ui("","data expressions not supported")]);const h=Qs(s,["zoom"]);if(!h&&!el(e))return Kn([new Ui("","zoom expressions not supported")]);const d=ho(s);return d||h?d instanceof Ui?Kn([d]):d instanceof Ni&&!_t(e)?Kn([new Ui("",'"interpolate" expressions cannot be used with this property')]):Qa(d?new Jo(c?"camera":"composite",r.value,d.labels,d instanceof Ni?d.interpolation:void 0):new Ss(c?"constant":"source",r.value)):Kn([new Ui("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class uo{constructor(e,r){this._parameters=e,this._specification=r,lr(this,ws(this._parameters,this._specification))}static deserialize(e){return new uo(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ho(i){let e=null;if(i instanceof no)e=ho(i.result);else if(i instanceof ro){for(const r of i.args)if(e=ho(r),e)break}else(i instanceof ys||i instanceof Ni)&&i.input instanceof Ot&&i.input.name==="zoom"&&(e=i);return e instanceof Ui||i.eachChild(r=>{const s=ho(r);s instanceof Ui?e=s:!e&&s?e=new Ui("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new Ui("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function cr(i){const e=i.key,r=i.value,s=i.valueSpec||{},c=i.objectElementValidators||{},h=i.style,d=i.styleSpec;let m=[];const g=Ct(r);if(g!=="object")return[new ke(e,r,`object expected, ${g} found`)];for(const x in r){const w=x.split(".")[0],E=s[w]||s["*"];let C;if(c[w])C=c[w];else if(s[w])C=qi;else if(c["*"])C=c["*"];else{if(!s["*"]){m.push(new ke(e,r[x],`unknown property "${x}"`));continue}C=qi}m=m.concat(C({key:(e&&`${e}.`)+x,value:r[x],valueSpec:E,style:h,styleSpec:d,object:r,objectKey:x},r))}for(const x in s)c[x]||s[x].required&&s[x].default===void 0&&r[x]===void 0&&m.push(new ke(e,r,`missing required property "${x}"`));return m}function rl(i){const e=i.value,r=i.valueSpec,s=i.style,c=i.styleSpec,h=i.key,d=i.arrayElementValidator||qi;if(Ct(e)!=="array")return[new ke(h,e,`array expected, ${Ct(e)} found`)];if(r.length&&e.length!==r.length)return[new ke(h,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new ke(h,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let m={type:r.value,values:r.values};c.$version<7&&(m.function=r.function),Ct(r.value)==="object"&&(m=r.value);let g=[];for(let x=0;x<e.length;x++)g=g.concat(d({array:e,arrayIndex:x,value:e[x],valueSpec:m,style:s,styleSpec:c,key:`${h}[${x}]`}));return g}function Qo(i){const e=i.key,r=i.value,s=i.valueSpec;let c=Ct(r);return c==="number"&&r!=r&&(c="NaN"),c!=="number"?[new ke(e,r,`number expected, ${c} found`)]:"minimum"in s&&r<s.minimum?[new ke(e,r,`${r} is less than the minimum value ${s.minimum}`)]:"maximum"in s&&r>s.maximum?[new ke(e,r,`${r} is greater than the maximum value ${s.maximum}`)]:[]}function nl(i){const e=i.valueSpec,r=vt(i.value.type);let s,c,h,d={};const m=r!=="categorical"&&i.value.property===void 0,g=!m,x=Ct(i.value.stops)==="array"&&Ct(i.value.stops[0])==="array"&&Ct(i.value.stops[0][0])==="object",w=cr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(z){if(r==="identity")return[new ke(z.key,z.value,'identity function may not have a "stops" property')];let P=[];const $=z.value;return P=P.concat(rl({key:z.key,value:$,valueSpec:z.valueSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:E})),Ct($)==="array"&&$.length===0&&P.push(new ke(z.key,$,"array must have at least one stop")),P},default:function(z){return qi({key:z.key,value:z.value,valueSpec:e,style:z.style,styleSpec:z.styleSpec})}}});return r==="identity"&&m&&w.push(new ke(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||w.push(new ke(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!_t(i.valueSpec)&&w.push(new ke(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(g&&!$t(i.valueSpec)?w.push(new ke(i.key,i.value,"property functions not supported")):m&&!el(i.valueSpec)&&w.push(new ke(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!x||i.value.property!==void 0||w.push(new ke(i.key,i.value,'"property" property is required')),w;function E(z){let P=[];const $=z.value,N=z.key;if(Ct($)!=="array")return[new ke(N,$,`array expected, ${Ct($)} found`)];if($.length!==2)return[new ke(N,$,`array length 2 expected, length ${$.length} found`)];if(x){if(Ct($[0])!=="object")return[new ke(N,$,`object expected, ${Ct($[0])} found`)];if($[0].zoom===void 0)return[new ke(N,$,"object stop key must have zoom")];if($[0].value===void 0)return[new ke(N,$,"object stop key must have value")];if(h&&h>vt($[0].zoom))return[new ke(N,$[0].zoom,"stop zoom values must appear in ascending order")];vt($[0].zoom)!==h&&(h=vt($[0].zoom),c=void 0,d={}),P=P.concat(cr({key:`${N}[0]`,value:$[0],valueSpec:{zoom:{}},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{zoom:Qo,value:C}}))}else P=P.concat(C({key:`${N}[0]`,value:$[0],valueSpec:{},style:z.style,styleSpec:z.styleSpec},$));return Ts(Ji($[1]))?P.concat([new ke(`${N}[1]`,$[1],"expressions are not allowed in function stops.")]):P.concat(qi({key:`${N}[1]`,value:$[1],valueSpec:e,style:z.style,styleSpec:z.styleSpec}))}function C(z,P){const $=Ct(z.value),N=vt(z.value),ie=z.value!==null?z.value:P;if(s){if($!==s)return[new ke(z.key,ie,`${$} stop domain type must match previous stop domain type ${s}`)]}else s=$;if($!=="number"&&$!=="string"&&$!=="boolean")return[new ke(z.key,ie,"stop domain value must be a number, string, or boolean")];if($!=="number"&&r!=="categorical"){let le=`number expected, ${$} found`;return $t(e)&&r===void 0&&(le+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ke(z.key,ie,le)]}return r!=="categorical"||$!=="number"||isFinite(N)&&Math.floor(N)===N?r!=="categorical"&&$==="number"&&c!==void 0&&N<c?[new ke(z.key,ie,"stop domain values must appear in ascending order")]:(c=N,r==="categorical"&&N in d?[new ke(z.key,ie,"stop domain values must be unique")]:(d[N]=!0,[])):[new ke(z.key,ie,`integer expected, found ${N}`)]}}function yn(i){const e=(i.expressionContext==="property"?il:Es)(Ji(i.value),i.valueSpec);if(e.result==="error")return e.value.map(s=>new ke(`${i.key}${s.key}`,i.value,s.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new ke(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!jn(r))return[new ke(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!jn(r))return[new ke(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Qs(r,["zoom","feature-state"]))return[new ke(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!_s(r))return[new ke(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Is(i){const e=i.key,r=i.value,s=i.valueSpec,c=[];return Array.isArray(s.values)?s.values.indexOf(vt(r))===-1&&c.push(new ke(e,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(s.values).indexOf(vt(r))===-1&&c.push(new ke(e,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),c}function Jn(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Jn(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const _c={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function po(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Jn(i)||(i=As(i));const e=Es(i,_c);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,s,c)=>e.value.evaluate(r,s,{},c),needGeometry:ol(i)}}function sl(i,e){return i<e?-1:i>e?1:0}function ol(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(ol(i[e]))return!0;return!1}function As(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?ea(i[1],i[2],"=="):e==="!="?Qn(ea(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ea(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(As))):e==="all"?["all"].concat(i.slice(1).map(As)):e==="none"?["all"].concat(i.slice(1).map(As).map(Qn)):e==="in"?fo(i[1],i.slice(2)):e==="!in"?Qn(fo(i[1],i.slice(2))):e==="has"?Cs(i[1]):e==="!has"?Qn(Cs(i[1])):e!=="within"||i;var r}function ea(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function fo(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(sl)]]:["filter-in-small",i,["literal",e]]}}function Cs(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Qn(i){return["!",i]}function ks(i){return Jn(Ji(i.value))?yn(lr({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):al(i)}function al(i){const e=i.value,r=i.key;if(Ct(e)!=="array")return[new ke(r,e,`array expected, ${Ct(e)} found`)];const s=i.styleSpec;let c,h=[];if(e.length<1)return[new ke(r,e,"filter array must have at least 1 element")];switch(h=h.concat(Is({key:`${r}[0]`,value:e[0],valueSpec:s.filter_operator,style:i.style,styleSpec:i.styleSpec})),vt(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&vt(e[1])==="$type"&&h.push(new ke(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&h.push(new ke(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=Ct(e[1]),c!=="string"&&h.push(new ke(`${r}[1]`,e[1],`string expected, ${c} found`)));for(let d=2;d<e.length;d++)c=Ct(e[d]),vt(e[1])==="$type"?h=h.concat(Is({key:`${r}[${d}]`,value:e[d],valueSpec:s.geometry_type,style:i.style,styleSpec:i.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&h.push(new ke(`${r}[${d}]`,e[d],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let d=1;d<e.length;d++)h=h.concat(al({key:`${r}[${d}]`,value:e[d],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":c=Ct(e[1]),e.length!==2?h.push(new ke(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&h.push(new ke(`${r}[1]`,e[1],`string expected, ${c} found`));break;case"within":c=Ct(e[1]),e.length!==2?h.push(new ke(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="object"&&h.push(new ke(`${r}[1]`,e[1],`object expected, ${c} found`))}return h}function Ms(i,e){const r=i.key,s=i.style,c=i.styleSpec,h=i.value,d=i.objectKey,m=c[`${e}_${i.layerType}`];if(!m)return[];const g=d.match(/^(.*)-transition$/);if(e==="paint"&&g&&m[g[1]]&&m[g[1]].transition)return qi({key:r,value:h,valueSpec:c.transition,style:s,styleSpec:c});const x=i.valueSpec||m[d];if(!x)return[new ke(r,h,`unknown property "${d}"`)];let w;if(Ct(h)==="string"&&$t(x)&&!x.tokens&&(w=/^{([^}]+)}$/.exec(h)))return[new ke(r,h,`"${d}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(w[1])} }\`.`)];const E=[];return i.layerType==="symbol"&&(d==="text-field"&&s&&!s.glyphs&&E.push(new ke(r,h,'use of "text-field" requires a style "glyphs" property')),d==="text-font"&&Nt(Ji(h))&&vt(h.type)==="identity"&&E.push(new ke(r,h,'"text-font" does not support identity functions'))),E.concat(qi({key:i.key,value:h,valueSpec:x,style:s,styleSpec:c,expressionContext:"property",propertyType:e,propertyKey:d}))}function ll(i){return Ms(i,"paint")}function cl(i){return Ms(i,"layout")}function ul(i){let e=[];const r=i.value,s=i.key,c=i.style,h=i.styleSpec;r.type||r.ref||e.push(new ke(s,r,'either "type" or "ref" is required'));let d=vt(r.type);const m=vt(r.ref);if(r.id){const g=vt(r.id);for(let x=0;x<i.arrayIndex;x++){const w=c.layers[x];vt(w.id)===g&&e.push(new ke(s,r.id,`duplicate layer id "${r.id}", previously used at line ${w.id.__line__}`))}}if("ref"in r){let g;["type","source","source-layer","filter","layout"].forEach(x=>{x in r&&e.push(new ke(s,r[x],`"${x}" is prohibited for ref layers`))}),c.layers.forEach(x=>{vt(x.id)===m&&(g=x)}),g?g.ref?e.push(new ke(s,r.ref,"ref cannot reference another ref layer")):d=vt(g.type):e.push(new ke(s,r.ref,`ref layer "${m}" not found`))}else if(d!=="background")if(r.source){const g=c.sources&&c.sources[r.source],x=g&&vt(g.type);g?x==="vector"&&d==="raster"?e.push(new ke(s,r.source,`layer "${r.id}" requires a raster source`)):x==="raster"&&d!=="raster"?e.push(new ke(s,r.source,`layer "${r.id}" requires a vector source`)):x!=="vector"||r["source-layer"]?x==="raster-dem"&&d!=="hillshade"?e.push(new ke(s,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):d!=="line"||!r.paint||!r.paint["line-gradient"]||x==="geojson"&&g.lineMetrics||e.push(new ke(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new ke(s,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new ke(s,r.source,`source "${r.source}" not found`))}else e.push(new ke(s,r,'missing required property "source"'));return e=e.concat(cr({key:s,value:r,valueSpec:h.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>qi({key:`${s}.type`,value:r.type,valueSpec:h.layer.type,style:i.style,styleSpec:i.styleSpec,object:r,objectKey:"type"}),filter:ks,layout:g=>cr({layer:r,key:g.key,value:g.value,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":x=>cl(lr({layerType:d},x))}}),paint:g=>cr({layer:r,key:g.key,value:g.value,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":x=>ll(lr({layerType:d},x))}})}})),e}function es(i){const e=i.value,r=i.key,s=Ct(e);return s!=="string"?[new ke(r,e,`string expected, ${s} found`)]:[]}const hl={promoteId:function({key:i,value:e}){if(Ct(e)==="string")return es({key:i,value:e});{const r=[];for(const s in e)r.push(...es({key:`${i}.${s}`,value:e[s]}));return r}}};function zs(i){const e=i.value,r=i.key,s=i.styleSpec,c=i.style;if(!e.type)return[new ke(r,e,'"type" is required')];const h=vt(e.type);let d;switch(h){case"vector":case"raster":case"raster-dem":return d=cr({key:r,value:e,valueSpec:s[`source_${h.replace("-","_")}`],style:i.style,styleSpec:s,objectElementValidators:hl}),d;case"geojson":if(d=cr({key:r,value:e,valueSpec:s.source_geojson,style:c,styleSpec:s,objectElementValidators:hl}),e.cluster)for(const m in e.clusterProperties){const[g,x]=e.clusterProperties[m],w=typeof g=="string"?[g,["accumulated"],["get",m]]:g;d.push(...yn({key:`${r}.${m}.map`,value:x,expressionContext:"cluster-map"})),d.push(...yn({key:`${r}.${m}.reduce`,value:w,expressionContext:"cluster-reduce"}))}return d;case"video":return cr({key:r,value:e,valueSpec:s.source_video,style:c,styleSpec:s});case"image":return cr({key:r,value:e,valueSpec:s.source_image,style:c,styleSpec:s});case"canvas":return[new ke(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Is({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:c,styleSpec:s})}}function Ps(i){const e=i.value,r=i.styleSpec,s=r.light,c=i.style;let h=[];const d=Ct(e);if(e===void 0)return h;if(d!=="object")return h=h.concat([new ke("light",e,`object expected, ${d} found`)]),h;for(const m in e){const g=m.match(/^(.*)-transition$/);h=h.concat(g&&s[g[1]]&&s[g[1]].transition?qi({key:m,value:e[m],valueSpec:r.transition,style:c,styleSpec:r}):s[m]?qi({key:m,value:e[m],valueSpec:s[m],style:c,styleSpec:r}):[new ke(m,e[m],`unknown property "${m}"`)])}return h}function $i(i){const e=i.value,r=i.styleSpec,s=r.terrain,c=i.style;let h=[];const d=Ct(e);if(e===void 0)return h;if(d!=="object")return h=h.concat([new ke("terrain",e,`object expected, ${d} found`)]),h;for(const m in e)h=h.concat(s[m]?qi({key:m,value:e[m],valueSpec:s[m],style:c,styleSpec:r}):[new ke(m,e[m],`unknown property "${m}"`)]);return h}const Ds={"*":()=>[],array:rl,boolean:function(i){const e=i.value,r=i.key,s=Ct(e);return s!=="boolean"?[new ke(r,e,`boolean expected, ${s} found`)]:[]},number:Qo,color:function(i){const e=i.key,r=i.value,s=Ct(r);return s!=="string"?[new ke(e,r,`color expected, ${s} found`)]:Gn(r)===null?[new ke(e,r,`color expected, "${r}" found`)]:[]},constants:pn,enum:Is,filter:ks,function:nl,layer:ul,object:cr,source:zs,light:Ps,terrain:$i,string:es,formatted:function(i){return es(i).length===0?[]:yn(i)},resolvedImage:function(i){return es(i).length===0?[]:yn(i)},padding:function(i){const e=i.key,r=i.value;if(Ct(r)==="array"){if(r.length<1||r.length>4)return[new ke(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const s={type:"number"};let c=[];for(let h=0;h<r.length;h++)c=c.concat(qi({key:`${e}[${h}]`,value:r[h],valueSpec:s}));return c}return Qo({key:e,value:r,valueSpec:{}})}};function qi(i){const e=i.value,r=i.valueSpec,s=i.styleSpec;return r.expression&&Nt(vt(e))?nl(i):r.expression&&Ts(Ji(e))?yn(i):r.type&&Ds[r.type]?Ds[r.type](i):cr(lr({},i,{valueSpec:r.type?s[r.type]:r}))}function yc(i){const e=i.value,r=i.key,s=es(i);return s.length||(e.indexOf("{fontstack}")===-1&&s.push(new ke(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&s.push(new ke(r,e,'"glyphs" url must include a "{range}" token'))),s}function Yr(i,e=_e){let r=[];return r=r.concat(qi({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:yc,"*":()=>[]}})),i.constants&&(r=r.concat(pn({key:"constants",value:i.constants,style:i,styleSpec:e}))),pl(r)}function pl(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function zr(i){return function(...e){return pl(i.apply(this,e))}}Yr.source=zr(zs),Yr.light=zr(Ps),Yr.terrain=zr($i),Yr.layer=zr(ul),Yr.filter=zr(ks),Yr.paintProperty=zr(ll),Yr.layoutProperty=zr(cl);const Ls=Yr,ta=Ls.light,xc=Ls.paintProperty,vc=Ls.layoutProperty;function mo(i,e){let r=!1;if(e&&e.length)for(const s of e)i.fire(new Nn(new Error(s.message))),r=!0;return r}class Bs{constructor(e,r,s){const c=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const d=new Int32Array(this.arrayBuffer);e=d[0],this.d=(r=d[1])+2*(s=d[2]);for(let g=0;g<this.d*this.d;g++){const x=d[3+g],w=d[3+g+1];c.push(x===w?null:d.subarray(x,w))}const m=d[3+c.length+1];this.keys=d.subarray(d[3+c.length],m),this.bboxes=d.subarray(m),this.insert=this._insertReadonly}else{this.d=r+2*s;for(let d=0;d<this.d*this.d;d++)c.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=s,this.scale=r/e,this.uid=0;const h=s/r*e;this.min=-h,this.max=e+h}insert(e,r,s,c,h){this._forEachCell(r,s,c,h,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(h)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,s,c,h,d){this.cells[h].push(d)}query(e,r,s,c,h){const d=this.min,m=this.max;if(e<=d&&r<=d&&m<=s&&m<=c&&!h)return Array.prototype.slice.call(this.keys);{const g=[];return this._forEachCell(e,r,s,c,this._queryCell,g,{},h),g}}_queryCell(e,r,s,c,h,d,m,g){const x=this.cells[h];if(x!==null){const w=this.keys,E=this.bboxes;for(let C=0;C<x.length;C++){const z=x[C];if(m[z]===void 0){const P=4*z;(g?g(E[P+0],E[P+1],E[P+2],E[P+3]):e<=E[P+2]&&r<=E[P+3]&&s>=E[P+0]&&c>=E[P+1])?(m[z]=!0,d.push(w[z])):m[z]=!1}}}}_forEachCell(e,r,s,c,h,d,m,g){const x=this._convertToCellCoord(e),w=this._convertToCellCoord(r),E=this._convertToCellCoord(s),C=this._convertToCellCoord(c);for(let z=x;z<=E;z++)for(let P=w;P<=C;P++){const $=this.d*P+z;if((!g||g(this._convertFromCellCoord(z),this._convertFromCellCoord(P),this._convertFromCellCoord(z+1),this._convertFromCellCoord(P+1)))&&h.call(this,e,r,s,c,$,d,m,g))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let s=0;for(let d=0;d<this.cells.length;d++)s+=this.cells[d].length;const c=new Int32Array(r+s+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;let h=r;for(let d=0;d<e.length;d++){const m=e[d];c[3+d]=h,c.set(m,h),h+=m.length}return c[3+e.length]=h,c.set(this.keys,h),h+=this.keys.length,c[3+e.length+1]=h,c.set(this.bboxes,h),h+=this.bboxes.length,c.buffer}static serialize(e,r){const s=e.toArrayBuffer();return r&&r.push(s),{buffer:s}}static deserialize(e){return new Bs(e.buffer)}}const Pr={};function Ue(i,e,r={}){if(Pr[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),Pr[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}Ue("Object",Object),Ue("TransferableGridIndex",Bs),Ue("Color",L),Ue("Error",Error),Ue("AJAXError",Oi),Ue("ResolvedImage",J),Ue("StylePropertyFunction",uo),Ue("StyleExpression",co,{omit:["_evaluator"]}),Ue("ZoomDependentExpression",Jo),Ue("ZoomConstantExpression",Ss),Ue("CompoundExpression",Ot,{omit:["_evaluate"]});for(const i in Hn)Hn[i]._classRegistryKey||Ue(`Expression_${i}`,Hn[i]);function dl(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function xn(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(dl(i)||Fi(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const s of i)r.push(xn(s,e));return r}if(typeof i=="object"){const r=i.constructor,s=r._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");if(!Pr[s])throw new Error(`${s} is not registered.`);const c=r.serialize?r.serialize(i,e):{};if(r.serialize){if(e&&c===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const h in i){if(!i.hasOwnProperty(h)||Pr[s].omit.indexOf(h)>=0)continue;const d=i[h];c[h]=Pr[s].shallow.indexOf(h)>=0?d:xn(d,e)}i instanceof Error&&(c.message=i.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(c.$name=s),c}throw new Error("can't serialize object of type "+typeof i)}function Jr(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||dl(i)||Fi(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(Jr);if(typeof i=="object"){const e=i.$name||"Object";if(!Pr[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=Pr[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const s=Object.create(r.prototype);for(const c of Object.keys(i)){if(c==="$name")continue;const h=i[c];s[c]=Pr[e].shallow.indexOf(c)>=0?h:Jr(h)}return s}throw new Error("can't deserialize object of type "+typeof i)}class ia{constructor(){this.first=!0}update(e,r){const s=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=s,!0))}}const Pe={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function go(i){for(const e of i)if(na(e.charCodeAt(0)))return!0;return!1}function bc(i){for(const e of i)if(!ra(e.charCodeAt(0)))return!1;return!0}function ra(i){return!(Pe.Arabic(i)||Pe["Arabic Supplement"](i)||Pe["Arabic Extended-A"](i)||Pe["Arabic Presentation Forms-A"](i)||Pe["Arabic Presentation Forms-B"](i))}function na(i){return!(i!==746&&i!==747&&(i<4352||!(Pe["Bopomofo Extended"](i)||Pe.Bopomofo(i)||Pe["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Pe["CJK Compatibility Ideographs"](i)||Pe["CJK Compatibility"](i)||Pe["CJK Radicals Supplement"](i)||Pe["CJK Strokes"](i)||!(!Pe["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Pe["CJK Unified Ideographs Extension A"](i)||Pe["CJK Unified Ideographs"](i)||Pe["Enclosed CJK Letters and Months"](i)||Pe["Hangul Compatibility Jamo"](i)||Pe["Hangul Jamo Extended-A"](i)||Pe["Hangul Jamo Extended-B"](i)||Pe["Hangul Jamo"](i)||Pe["Hangul Syllables"](i)||Pe.Hiragana(i)||Pe["Ideographic Description Characters"](i)||Pe.Kanbun(i)||Pe["Kangxi Radicals"](i)||Pe["Katakana Phonetic Extensions"](i)||Pe.Katakana(i)&&i!==12540||!(!Pe["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Pe["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Pe["Unified Canadian Aboriginal Syllabics"](i)||Pe["Unified Canadian Aboriginal Syllabics Extended"](i)||Pe["Vertical Forms"](i)||Pe["Yijing Hexagram Symbols"](i)||Pe["Yi Syllables"](i)||Pe["Yi Radicals"](i))))}function fl(i){return!(na(i)||function(e){return!!(Pe["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Pe["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Pe["Letterlike Symbols"](e)||Pe["Number Forms"](e)||Pe["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Pe["Control Pictures"](e)&&e!==9251||Pe["Optical Character Recognition"](e)||Pe["Enclosed Alphanumerics"](e)||Pe["Geometric Shapes"](e)||Pe["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Pe["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Pe["CJK Symbols and Punctuation"](e)||Pe.Katakana(e)||Pe["Private Use Area"](e)||Pe["CJK Compatibility Forms"](e)||Pe["Small Form Variants"](e)||Pe["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function ml(i){return i>=1424&&i<=2303||Pe["Arabic Presentation Forms-A"](i)||Pe["Arabic Presentation Forms-B"](i)}function wc(i,e){return!(!e&&ml(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Pe.Khmer(i))}function gl(i){for(const e of i)if(ml(e.charCodeAt(0)))return!0;return!1}const sa="deferred",oa="loading",aa="loaded";let la=null,Pi="unavailable",Qr=null;const _l=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(Pi="error"),la&&la(i)};function ts(){ca.fire(new Cr("pluginStateChange",{pluginStatus:Pi,pluginURL:Qr}))}const ca=new kr,Rs=function(){return Pi},yl=function(){if(Pi!==sa||!Qr)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Pi=oa,ts(),Qr&&Vn({url:Qr},i=>{i?_l(i):(Pi=aa,ts())})},Qi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Pi===aa||Qi.applyArabicShaping!=null,isLoading:()=>Pi===oa,setState(i){if(!rt())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Pi=i.pluginStatus,Qr=i.pluginURL},isParsed(){if(!rt())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Qi.applyArabicShaping!=null&&Qi.processBidirectionalText!=null&&Qi.processStyledBidirectionalText!=null},getPluginURL(){if(!rt())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Qr}};class Xt{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ia,this.transition={})}isSupportedScript(e){return function(r,s){for(const c of r)if(!wc(c.charCodeAt(0),s))return!1;return!0}(e,Qi.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),s=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*r}}}class Fs{constructor(e,r){this.property=e,this.value=r,this.expression=function(s,c){if(Nt(s))return new uo(s,c);if(Ts(s)){const h=il(s,c);if(h.result==="error")throw new Error(h.value.map(d=>`${d.key}: ${d.message}`).join(", "));return h.value}{let h=s;return c.type==="color"&&typeof s=="string"?h=L.parse(s):c.type!=="padding"||typeof s!="number"&&!Array.isArray(s)||(h=Z.parse(s)),{kind:"constant",evaluate:()=>h}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,s){return this.property.possiblyEvaluate(this,e,r,s)}}class _o{constructor(e){this.property=e,this.value=new Fs(e,void 0)}transitioned(e,r){return new vl(this.property,this.value,r,ze({},e.transition,this.transition),e.now)}untransitioned(){return new vl(this.property,this.value,null,{},0)}}class xl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return He(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new _o(this._values[e].property)),this._values[e].value=new Fs(this._values[e].property,r===null?void 0:He(r))}getTransition(e){return He(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new _o(this._values[e].property)),this._values[e].transition=He(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s);const c=this.getTransition(r);c!==void 0&&(e[`${r}-transition`]=c)}return e}transitioned(e,r){const s=new bl(this._properties);for(const c of Object.keys(this._values))s._values[c]=this._values[c].transitioned(e,r._values[c]);return s}untransitioned(){const e=new bl(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class vl{constructor(e,r,s,c,h){this.property=e,this.value=r,this.begin=h+c.delay||0,this.end=this.begin+c.duration||0,e.specification.transition&&(c.delay||c.duration)&&(this.prior=s)}possiblyEvaluate(e,r,s){const c=e.now||0,h=this.value.possiblyEvaluate(e,r,s),d=this.prior;if(d){if(c>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(c<this.begin)return d.possiblyEvaluate(e,r,s);{const m=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(d.possiblyEvaluate(e,r,s),h,function(g){if(g<=0)return 0;if(g>=1)return 1;const x=g*g,w=x*g;return 4*(g<.5?w:3*(g-x)+w-.75)}(m))}}return h}}class bl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,s){const c=new Os(this._properties);for(const h of Object.keys(this._values))c._values[h]=this._values[h].possiblyEvaluate(e,r,s);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Tc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return He(this._values[e].value)}setValue(e,r){this._values[e]=new Fs(this._values[e].property,r===null?void 0:He(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s)}return e}possiblyEvaluate(e,r,s){const c=new Os(this._properties);for(const h of Object.keys(this._values))c._values[h]=this._values[h].possiblyEvaluate(e,r,s);return c}}class yr{constructor(e,r,s){this.property=e,this.value=r,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,s,c){return this.property.evaluate(this.value,this.parameters,e,r,s,c)}}class Os{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class qe{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,s){const c=xs[this.specification.type];return c?c(e,r,s):e}}class Je{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,s,c){return new yr(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},s,c)}:e.expression,r)}interpolate(e,r,s){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new yr(this,{kind:"constant",value:void 0},e.parameters);const c=xs[this.specification.type];return c?new yr(this,{kind:"constant",value:c(e.value.value,r.value.value,s)},e.parameters):e}evaluate(e,r,s,c,h,d){return e.kind==="constant"?e.value:e.evaluate(r,s,c,h,d)}}class is extends Je{possiblyEvaluate(e,r,s,c){if(e.value===void 0)return new yr(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const h=e.expression.evaluate(r,null,{},s,c),d=e.property.specification.type==="resolvedImage"&&typeof h!="string"?h.name:h,m=this._calculate(d,d,d,r);return new yr(this,{kind:"constant",value:m},r)}if(e.expression.kind==="camera"){const h=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new yr(this,{kind:"constant",value:h},r)}return new yr(this,e.expression,r)}evaluate(e,r,s,c,h,d){if(e.kind==="source"){const m=e.evaluate(r,s,c,h,d);return this._calculate(m,m,m,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},s,c),e.evaluate({zoom:Math.floor(r.zoom)},s,c),e.evaluate({zoom:Math.floor(r.zoom)+1},s,c),r):e.value}_calculate(e,r,s,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class ua{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,c){if(e.value!==void 0){if(e.expression.kind==="constant"){const h=e.expression.evaluate(r,null,{},s,c);return this._calculate(h,h,h,r)}return this._calculate(e.expression.evaluate(new Xt(Math.floor(r.zoom-1),r)),e.expression.evaluate(new Xt(Math.floor(r.zoom),r)),e.expression.evaluate(new Xt(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,s,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class en{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,c){return!!e.expression.evaluate(r,null,{},s,c)}interpolate(){return!1}}class yi{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const s=e[r];s.specification.overridable&&this.overridableProperties.push(r);const c=this.defaultPropertyValues[r]=new Fs(s,void 0),h=this.defaultTransitionablePropertyValues[r]=new _o(s);this.defaultTransitioningPropertyValues[r]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=c.possiblyEvaluate({})}}}Ue("DataDrivenProperty",Je),Ue("DataConstantProperty",qe),Ue("CrossFadedDataDrivenProperty",is),Ue("CrossFadedProperty",ua),Ue("ColorRampProperty",en);const tn="-transition";class xr extends kr{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new Tc(r.layout)),r.paint)){this._transitionablePaint=new xl(r.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Os(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,s={}){r!=null&&this._validate(vc,`layers.${this.id}.layout.${e}`,e,r,s)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(tn)?this._transitionablePaint.getTransition(e.slice(0,-tn.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,s={}){if(r!=null&&this._validate(xc,`layers.${this.id}.paint.${e}`,e,r,s))return!1;if(e.endsWith(tn))return this._transitionablePaint.setTransition(e.slice(0,-tn.length),r||void 0),!1;{const c=this._transitionablePaint._values[e],h=c.property.specification["property-type"]==="cross-faded-data-driven",d=c.value.isDataDriven(),m=c.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const g=this._transitionablePaint._values[e].value;return g.isDataDriven()||d||h||this._handleOverridablePaintPropertyUpdate(e,m,g)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Ze(e,(r,s)=>!(r===void 0||s==="layout"&&!Object.keys(r).length||s==="paint"&&!Object.keys(r).length))}_validate(e,r,s,c,h={}){return(!h||h.validate!==!1)&&mo(this,e.call(Ls,{key:r,layerType:this.type,objectKey:s,value:c,styleSpec:_e,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof yr&&$t(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const wl={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class rn{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Jt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ii(i,e=1){let r=0,s=0;return{members:i.map(c=>{const h=wl[c.type].BYTES_PER_ELEMENT,d=r=ha(r,Math.max(e,h)),m=c.components||1;return s=Math.max(s,h),r+=h*m,{name:c.name,type:c.type,components:m,offset:d}}),size:ha(r,Math.max(s,e)),alignment:e}}function ha(i,e){return Math.ceil(i/e)*e}class vn extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const c=2*e;return this.int16[c+0]=r,this.int16[c+1]=s,e}}vn.prototype.bytesPerElement=4,Ue("StructArrayLayout2i4",vn);class l extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,s,c)}emplace(e,r,s,c,h){const d=4*e;return this.int16[d+0]=r,this.int16[d+1]=s,this.int16[d+2]=c,this.int16[d+3]=h,e}}l.prototype.bytesPerElement=8,Ue("StructArrayLayout4i8",l);class t extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,h,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,s,c,h,d)}emplace(e,r,s,c,h,d,m){const g=6*e;return this.int16[g+0]=r,this.int16[g+1]=s,this.int16[g+2]=c,this.int16[g+3]=h,this.int16[g+4]=d,this.int16[g+5]=m,e}}t.prototype.bytesPerElement=12,Ue("StructArrayLayout2i4i12",t);class n extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,h,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,s,c,h,d)}emplace(e,r,s,c,h,d,m){const g=4*e,x=8*e;return this.int16[g+0]=r,this.int16[g+1]=s,this.uint8[x+4]=c,this.uint8[x+5]=h,this.uint8[x+6]=d,this.uint8[x+7]=m,e}}n.prototype.bytesPerElement=8,Ue("StructArrayLayout2i4ub8",n);class o extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const c=2*e;return this.float32[c+0]=r,this.float32[c+1]=s,e}}o.prototype.bytesPerElement=8,Ue("StructArrayLayout2f8",o);class u extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,h,d,m,g,x,w){const E=this.length;return this.resize(E+1),this.emplace(E,e,r,s,c,h,d,m,g,x,w)}emplace(e,r,s,c,h,d,m,g,x,w,E){const C=10*e;return this.uint16[C+0]=r,this.uint16[C+1]=s,this.uint16[C+2]=c,this.uint16[C+3]=h,this.uint16[C+4]=d,this.uint16[C+5]=m,this.uint16[C+6]=g,this.uint16[C+7]=x,this.uint16[C+8]=w,this.uint16[C+9]=E,e}}u.prototype.bytesPerElement=20,Ue("StructArrayLayout10ui20",u);class p extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,h,d,m,g,x,w,E,C){const z=this.length;return this.resize(z+1),this.emplace(z,e,r,s,c,h,d,m,g,x,w,E,C)}emplace(e,r,s,c,h,d,m,g,x,w,E,C,z){const P=12*e;return this.int16[P+0]=r,this.int16[P+1]=s,this.int16[P+2]=c,this.int16[P+3]=h,this.uint16[P+4]=d,this.uint16[P+5]=m,this.uint16[P+6]=g,this.uint16[P+7]=x,this.int16[P+8]=w,this.int16[P+9]=E,this.int16[P+10]=C,this.int16[P+11]=z,e}}p.prototype.bytesPerElement=24,Ue("StructArrayLayout4i4ui4i24",p);class f extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const h=3*e;return this.float32[h+0]=r,this.float32[h+1]=s,this.float32[h+2]=c,e}}f.prototype.bytesPerElement=12,Ue("StructArrayLayout3f12",f);class _ extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}_.prototype.bytesPerElement=4,Ue("StructArrayLayout1ul4",_);class y extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,h,d,m,g,x){const w=this.length;return this.resize(w+1),this.emplace(w,e,r,s,c,h,d,m,g,x)}emplace(e,r,s,c,h,d,m,g,x,w){const E=10*e,C=5*e;return this.int16[E+0]=r,this.int16[E+1]=s,this.int16[E+2]=c,this.int16[E+3]=h,this.int16[E+4]=d,this.int16[E+5]=m,this.uint32[C+3]=g,this.uint16[E+8]=x,this.uint16[E+9]=w,e}}y.prototype.bytesPerElement=20,Ue("StructArrayLayout6i1ul2ui20",y);class v extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,h,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,s,c,h,d)}emplace(e,r,s,c,h,d,m){const g=6*e;return this.int16[g+0]=r,this.int16[g+1]=s,this.int16[g+2]=c,this.int16[g+3]=h,this.int16[g+4]=d,this.int16[g+5]=m,e}}v.prototype.bytesPerElement=12,Ue("StructArrayLayout2i2i2i12",v);class T extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,s,c,h)}emplace(e,r,s,c,h,d){const m=4*e,g=8*e;return this.float32[m+0]=r,this.float32[m+1]=s,this.float32[m+2]=c,this.int16[g+6]=h,this.int16[g+7]=d,e}}T.prototype.bytesPerElement=16,Ue("StructArrayLayout2f1f2i16",T);class I extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,s,c)}emplace(e,r,s,c,h){const d=12*e,m=3*e;return this.uint8[d+0]=r,this.uint8[d+1]=s,this.float32[m+1]=c,this.float32[m+2]=h,e}}I.prototype.bytesPerElement=12,Ue("StructArrayLayout2ub2f12",I);class M extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const h=3*e;return this.uint16[h+0]=r,this.uint16[h+1]=s,this.uint16[h+2]=c,e}}M.prototype.bytesPerElement=6,Ue("StructArrayLayout3ui6",M);class U extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,h,d,m,g,x,w,E,C,z,P,$,N,ie){const le=this.length;return this.resize(le+1),this.emplace(le,e,r,s,c,h,d,m,g,x,w,E,C,z,P,$,N,ie)}emplace(e,r,s,c,h,d,m,g,x,w,E,C,z,P,$,N,ie,le){const ee=24*e,se=12*e,xe=48*e;return this.int16[ee+0]=r,this.int16[ee+1]=s,this.uint16[ee+2]=c,this.uint16[ee+3]=h,this.uint32[se+2]=d,this.uint32[se+3]=m,this.uint32[se+4]=g,this.uint16[ee+10]=x,this.uint16[ee+11]=w,this.uint16[ee+12]=E,this.float32[se+7]=C,this.float32[se+8]=z,this.uint8[xe+36]=P,this.uint8[xe+37]=$,this.uint8[xe+38]=N,this.uint32[se+10]=ie,this.int16[ee+22]=le,e}}U.prototype.bytesPerElement=48,Ue("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",U);class F extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,h,d,m,g,x,w,E,C,z,P,$,N,ie,le,ee,se,xe,ye,Oe,Ne,De,Ae,Ee,Le){const Me=this.length;return this.resize(Me+1),this.emplace(Me,e,r,s,c,h,d,m,g,x,w,E,C,z,P,$,N,ie,le,ee,se,xe,ye,Oe,Ne,De,Ae,Ee,Le)}emplace(e,r,s,c,h,d,m,g,x,w,E,C,z,P,$,N,ie,le,ee,se,xe,ye,Oe,Ne,De,Ae,Ee,Le,Me){const we=34*e,We=17*e;return this.int16[we+0]=r,this.int16[we+1]=s,this.int16[we+2]=c,this.int16[we+3]=h,this.int16[we+4]=d,this.int16[we+5]=m,this.int16[we+6]=g,this.int16[we+7]=x,this.uint16[we+8]=w,this.uint16[we+9]=E,this.uint16[we+10]=C,this.uint16[we+11]=z,this.uint16[we+12]=P,this.uint16[we+13]=$,this.uint16[we+14]=N,this.uint16[we+15]=ie,this.uint16[we+16]=le,this.uint16[we+17]=ee,this.uint16[we+18]=se,this.uint16[we+19]=xe,this.uint16[we+20]=ye,this.uint16[we+21]=Oe,this.uint16[we+22]=Ne,this.uint32[We+12]=De,this.float32[We+13]=Ae,this.float32[We+14]=Ee,this.float32[We+15]=Le,this.float32[We+16]=Me,e}}F.prototype.bytesPerElement=68,Ue("StructArrayLayout8i15ui1ul4f68",F);class O extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}O.prototype.bytesPerElement=4,Ue("StructArrayLayout1f4",O);class H extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const h=3*e;return this.int16[h+0]=r,this.int16[h+1]=s,this.int16[h+2]=c,e}}H.prototype.bytesPerElement=6,Ue("StructArrayLayout3i6",H);class Q extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const h=4*e;return this.uint32[2*e+0]=r,this.uint16[h+2]=s,this.uint16[h+3]=c,e}}Q.prototype.bytesPerElement=8,Ue("StructArrayLayout1ul2ui8",Q);class re extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const c=2*e;return this.uint16[c+0]=r,this.uint16[c+1]=s,e}}re.prototype.bytesPerElement=4,Ue("StructArrayLayout2ui4",re);class V extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}V.prototype.bytesPerElement=2,Ue("StructArrayLayout1ui2",V);class oe extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,s,c)}emplace(e,r,s,c,h){const d=4*e;return this.float32[d+0]=r,this.float32[d+1]=s,this.float32[d+2]=c,this.float32[d+3]=h,e}}oe.prototype.bytesPerElement=16,Ue("StructArrayLayout4f16",oe);class ne extends rn{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new tt(this.anchorPointX,this.anchorPointY)}}ne.prototype.size=20;class me extends y{get(e){return new ne(this,e)}}Ue("CollisionBoxArray",me);class ge extends rn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ge.prototype.size=48;class be extends U{get(e){return new ge(this,e)}}Ue("PlacedSymbolArray",be);class he extends rn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}he.prototype.size=68;class Re extends F{get(e){return new he(this,e)}}Ue("SymbolInstanceArray",Re);class Ie extends O{getoffsetX(e){return this.float32[1*e+0]}}Ue("GlyphOffsetArray",Ie);class Fe extends H{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Ue("SymbolLineVertexArray",Fe);class at extends rn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}at.prototype.size=8;class ht extends Q{get(e){return new at(this,e)}}Ue("FeatureIndexArray",ht);class Xe extends vn{}class zt extends vn{}class Pt extends vn{}class yt extends t{}class Tt extends n{}class Bt extends o{}class hi extends u{}class vr extends p{}class ur extends f{}class br extends _{}class nn extends v{}class er extends I{}class Di extends M{}class Dr extends re{}const yo=ii([{name:"a_pos",components:2,type:"Int16"}],4),{members:oi}=yo;class ft{constructor(e=[]){this.segments=e}prepareSegment(e,r,s,c){let h=this.segments[this.segments.length-1];return e>ft.MAX_VERTEX_ARRAY_LENGTH&&Ke(`Max vertices per segment is ${ft.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!h||h.vertexLength+e>ft.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==c)&&(h={vertexOffset:r.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},c!==void 0&&(h.sortKey=c),this.segments.push(h)),h}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,s,c){return new ft([{vertexOffset:e,primitiveOffset:r,vertexLength:s,primitiveLength:c,vaos:{},sortKey:0}])}}function Mt(i,e){return 256*(i=te(Math.floor(i),0,255))+te(Math.floor(e),0,255)}ft.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ue("SegmentVector",ft);const pi=ii([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var di={exports:{}},Wt={exports:{}};Wt.exports=function(i,e){var r,s,c,h,d,m,g,x;for(s=i.length-(r=3&i.length),c=e,d=3432918353,m=461845907,x=0;x<s;)g=255&i.charCodeAt(x)|(255&i.charCodeAt(++x))<<8|(255&i.charCodeAt(++x))<<16|(255&i.charCodeAt(++x))<<24,++x,c=27492+(65535&(h=5*(65535&(c=(c^=g=(65535&(g=(g=(65535&g)*d+(((g>>>16)*d&65535)<<16)&4294967295)<<15|g>>>17))*m+(((g>>>16)*m&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(h>>>16)&65535)<<16);switch(g=0,r){case 3:g^=(255&i.charCodeAt(x+2))<<16;case 2:g^=(255&i.charCodeAt(x+1))<<8;case 1:c^=g=(65535&(g=(g=(65535&(g^=255&i.charCodeAt(x)))*d+(((g>>>16)*d&65535)<<16)&4294967295)<<15|g>>>17))*m+(((g>>>16)*m&65535)<<16)&4294967295}return c^=i.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var tr={exports:{}};tr.exports=function(i,e){for(var r,s=i.length,c=e^s,h=0;s>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(h)|(255&i.charCodeAt(++h))<<8|(255&i.charCodeAt(++h))<<16|(255&i.charCodeAt(++h))<<24))+((1540483477*(r>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),s-=4,++h;switch(s){case 3:c^=(255&i.charCodeAt(h+2))<<16;case 2:c^=(255&i.charCodeAt(h+1))<<8;case 1:c=1540483477*(65535&(c^=255&i.charCodeAt(h)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var bn=Wt.exports,pa=tr.exports;di.exports=bn,di.exports.murmur3=bn,di.exports.murmur2=pa;class rs{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,s,c){this.ids.push(Tl(e)),this.positions.push(r,s,c)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Tl(e);let s=0,c=this.ids.length-1;for(;s<c;){const d=s+c>>1;this.ids[d]>=r?c=d:s=d+1}const h=[];for(;this.ids[s]===r;)h.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return h}static serialize(e,r){const s=new Float64Array(e.ids),c=new Uint32Array(e.positions);return da(s,c,0,s.length-1),r&&r.push(s.buffer,c.buffer),{ids:s,positions:c}}static deserialize(e){const r=new rs;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Tl(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:di.exports(String(i))}function da(i,e,r,s){for(;r<s;){const c=i[r+s>>1];let h=r-1,d=s+1;for(;;){do h++;while(i[h]<c);do d--;while(i[d]>c);if(h>=d)break;sn(i,h,d),sn(e,3*h,3*d),sn(e,3*h+1,3*d+1),sn(e,3*h+2,3*d+2)}d-r<s-d?(da(i,e,r,d),r=d+1):(da(i,e,d+1,s),s=d)}}function sn(i,e,r){const s=i[e];i[e]=i[r],i[r]=s}Ue("FeaturePositionMap",rs);class wn{constructor(e,r){this.gl=e.gl,this.location=r}}class Tn extends wn{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class xo extends wn{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class ih extends wn{constructor(e,r){super(e,r),this.current=L.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Md=new Float32Array(16);function Ec(i){return[Mt(255*i.r,255*i.g),Mt(255*i.b,255*i.a)]}class fa{constructor(e,r,s){this.value=e,this.uniformNames=r.map(c=>`u_${c}`),this.type=s}setUniform(e,r,s){e.set(s.constantOr(this.value))}getBinding(e,r,s){return this.type==="color"?new ih(e,r):new Tn(e,r)}}class vo{constructor(e,r){this.uniformNames=r.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,s,c){const h=c==="u_pattern_to"?this.patternTo:c==="u_pattern_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;h&&e.set(h)}getBinding(e,r,s){return s.substr(0,9)==="u_pattern"?new xo(e,r):new Tn(e,r)}}class En{constructor(e,r,s,c){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map(h=>({name:`a_${h}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,r,s,c,h){const d=this.paintVertexArray.length,m=this.expression.evaluate(new Xt(0),r,{},c,[],h);this.paintVertexArray.resize(e),this._setPaintValue(d,e,m)}updatePaintArray(e,r,s,c){const h=this.expression.evaluate({zoom:0},s,c);this._setPaintValue(e,r,h)}_setPaintValue(e,r,s){if(this.type==="color"){const c=Ec(s);for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,c[0],c[1])}else{for(let c=e;c<r;c++)this.paintVertexArray.emplace(c,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Lr{constructor(e,r,s,c,h,d){this.expression=e,this.uniformNames=r.map(m=>`u_${m}_t`),this.type=s,this.useIntegerZoom=c,this.zoom=h,this.maxValue=0,this.paintVertexAttributes=r.map(m=>({name:`a_${m}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,r,s,c,h){const d=this.expression.evaluate(new Xt(this.zoom),r,{},c,[],h),m=this.expression.evaluate(new Xt(this.zoom+1),r,{},c,[],h),g=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(g,e,d,m)}updatePaintArray(e,r,s,c){const h=this.expression.evaluate({zoom:this.zoom},s,c),d=this.expression.evaluate({zoom:this.zoom+1},s,c);this._setPaintValue(e,r,h,d)}_setPaintValue(e,r,s,c){if(this.type==="color"){const h=Ec(s),d=Ec(c);for(let m=e;m<r;m++)this.paintVertexArray.emplace(m,h[0],h[1],d[0],d[1])}else{for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,s,c);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,c=te(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);e.set(c)}getBinding(e,r,s){return new Tn(e,r)}}class ns{constructor(e,r,s,c,h,d){this.expression=e,this.type=r,this.useIntegerZoom=s,this.zoom=c,this.layerId=d,this.zoomInPaintVertexArray=new h,this.zoomOutPaintVertexArray=new h}populatePaintArray(e,r,s){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(e,r,s,c,h){this._setPaintValues(e,r,s.patterns&&s.patterns[this.layerId],h)}_setPaintValues(e,r,s,c){if(!c||!s)return;const{min:h,mid:d,max:m}=s,g=c[h],x=c[d],w=c[m];if(g&&x&&w)for(let E=e;E<r;E++)this.zoomInPaintVertexArray.emplace(E,x.tl[0],x.tl[1],x.br[0],x.br[1],g.tl[0],g.tl[1],g.br[0],g.br[1],x.pixelRatio,g.pixelRatio),this.zoomOutPaintVertexArray.emplace(E,x.tl[0],x.tl[1],x.br[0],x.br[1],w.tl[0],w.tl[1],w.br[0],w.br[1],x.pixelRatio,w.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,pi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,pi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class rh{constructor(e,r,s){this.binders={},this._buffers=[];const c=[];for(const h in e.paint._values){if(!s(h))continue;const d=e.paint.get(h);if(!(d instanceof yr&&$t(d.property.specification)))continue;const m=zd(h,e.type),g=d.value,x=d.property.specification.type,w=d.property.useIntegerZoom,E=d.property.specification["property-type"],C=E==="cross-faded"||E==="cross-faded-data-driven";if(g.kind==="constant")this.binders[h]=C?new vo(g.value,m):new fa(g.value,m,x),c.push(`/u_${h}`);else if(g.kind==="source"||C){const z=nh(h,x,"source");this.binders[h]=C?new ns(g,x,w,r,z,e.id):new En(g,m,x,z),c.push(`/a_${h}`)}else{const z=nh(h,x,"composite");this.binders[h]=new Lr(g,m,x,w,r,z),c.push(`/z_${h}`)}}this.cacheKey=c.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof En||r instanceof Lr?r.maxValue:0}populatePaintArrays(e,r,s,c,h){for(const d in this.binders){const m=this.binders[d];(m instanceof En||m instanceof Lr||m instanceof ns)&&m.populatePaintArray(e,r,s,c,h)}}setConstantPatternPositions(e,r){for(const s in this.binders){const c=this.binders[s];c instanceof vo&&c.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,s,c,h){let d=!1;for(const m in e){const g=r.getPositions(m);for(const x of g){const w=s.feature(x.index);for(const E in this.binders){const C=this.binders[E];if((C instanceof En||C instanceof Lr||C instanceof ns)&&C.expression.isStateDependent===!0){const z=c.paint.get(E);C.expression=z.value,C.updatePaintArray(x.start,x.end,w,e[m],h),d=!0}}}}return d}defines(){const e=[];for(const r in this.binders){const s=this.binders[r];(s instanceof fa||s instanceof vo)&&e.push(...s.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof En||s instanceof Lr)for(let c=0;c<s.paintVertexAttributes.length;c++)e.push(s.paintVertexAttributes[c].name);else if(s instanceof ns)for(let c=0;c<pi.members.length;c++)e.push(pi.members[c].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof fa||s instanceof vo||s instanceof Lr)for(const c of s.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const s=[];for(const c in this.binders){const h=this.binders[c];if(h instanceof fa||h instanceof vo||h instanceof Lr){for(const d of h.uniformNames)if(r[d]){const m=h.getBinding(e,r[d],d);s.push({name:d,property:c,binding:m})}}}return s}setUniforms(e,r,s,c){for(const{name:h,property:d,binding:m}of r)this.binders[d].setUniform(m,c,s.get(d),h)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const s=this.binders[r];if(e&&s instanceof ns){const c=e.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(s instanceof En||s instanceof Lr)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const r in this.binders){const s=this.binders[r];(s instanceof En||s instanceof Lr||s instanceof ns)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof En||r instanceof Lr||r instanceof ns)&&r.destroy()}}}class Us{constructor(e,r,s=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new rh(c,r,s);this.needsUpload=!1,this._featureMap=new rs,this._bufferOffset=0}populatePaintArrays(e,r,s,c,h,d){for(const m in this.programConfigurations)this.programConfigurations[m].populatePaintArrays(e,r,c,h,d);r.id!==void 0&&this._featureMap.add(r.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,s,c){for(const h of s)this.needsUpload=this.programConfigurations[h.id].updatePaintArrays(e,this._featureMap,r,h,c)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function zd(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function nh(i,e,r){const s={color:{source:o,composite:oe},number:{source:O,composite:o}},c=function(h){return{"line-pattern":{source:hi,composite:hi},"fill-pattern":{source:hi,composite:hi},"fill-extrusion-pattern":{source:hi,composite:hi}}[h]}(i);return c&&c[r]||s[e][r]}Ue("ConstantBinder",fa),Ue("CrossFadedConstantBinder",vo),Ue("SourceExpressionBinder",En),Ue("CrossFadedCompositeBinder",ns),Ue("CompositeExpressionBinder",Lr),Ue("ProgramConfiguration",rh,{omit:["_buffers"]}),Ue("ProgramConfigurationSet",Us);var ai=8192;const Sc=Math.pow(2,14)-1,sh=-Sc-1;function Vs(i){const e=ai/i.extent,r=i.loadGeometry();for(let s=0;s<r.length;s++){const c=r[s];for(let h=0;h<c.length;h++){const d=c[h],m=Math.round(d.x*e),g=Math.round(d.y*e);d.x=te(m,sh,Sc),d.y=te(g,sh,Sc),(m<d.x||m>d.x+1||g<d.y||g>d.y+1)&&Ke("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Ns(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Vs(i):[]}}function El(i,e,r,s,c){i.emplaceBack(2*e+(s+1)/2,2*r+(c+1)/2)}class Ic{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new zt,this.indexArray=new Di,this.segments=new ft,this.programConfigurations=new Us(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){const c=this.layers[0],h=[];let d=null,m=!1;c.type==="circle"&&(d=c.layout.get("circle-sort-key"),m=!d.isConstant());for(const{feature:g,id:x,index:w,sourceLayerIndex:E}of e){const C=this.layers[0]._featureFilter.needGeometry,z=Ns(g,C);if(!this.layers[0]._featureFilter.filter(new Xt(this.zoom),z,s))continue;const P=m?d.evaluate(z,{},s):void 0,$={id:x,properties:g.properties,type:g.type,sourceLayerIndex:E,index:w,geometry:C?z.geometry:Vs(g),patterns:{},sortKey:P};h.push($)}m&&h.sort((g,x)=>g.sortKey-x.sortKey);for(const g of h){const{geometry:x,index:w,sourceLayerIndex:E}=g,C=e[w].feature;this.addFeature(g,x,w,s),r.featureIndex.insert(C,x,w,E,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,oi),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,s,c){for(const h of r)for(const d of h){const m=d.x,g=d.y;if(m<0||m>=ai||g<0||g>=ai)continue;const x=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),w=x.vertexLength;El(this.layoutVertexArray,m,g,-1,-1),El(this.layoutVertexArray,m,g,1,-1),El(this.layoutVertexArray,m,g,1,1),El(this.layoutVertexArray,m,g,-1,1),this.indexArray.emplaceBack(w,w+1,w+2),this.indexArray.emplaceBack(w,w+3,w+2),x.vertexLength+=4,x.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},c)}}function oh(i,e){for(let r=0;r<i.length;r++)if(bo(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(bo(i,e[r]))return!0;return!!Ac(i,e)}function Pd(i,e,r){return!!bo(i,e)||!!Cc(e,i,r)}function ah(i,e){if(i.length===1)return ch(e,i[0]);for(let r=0;r<e.length;r++){const s=e[r];for(let c=0;c<s.length;c++)if(bo(i,s[c]))return!0}for(let r=0;r<i.length;r++)if(ch(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Ac(i,e[r]))return!0;return!1}function Dd(i,e,r){if(i.length>1){if(Ac(i,e))return!0;for(let s=0;s<e.length;s++)if(Cc(e[s],i,r))return!0}for(let s=0;s<i.length;s++)if(Cc(i[s],e,r))return!0;return!1}function Ac(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const s=i[r],c=i[r+1];for(let h=0;h<e.length-1;h++)if(Ld(s,c,e[h],e[h+1]))return!0}return!1}function Ld(i,e,r,s){return It(i,r,s)!==It(e,r,s)&&It(i,e,r)!==It(i,e,s)}function Cc(i,e,r){const s=r*r;if(e.length===1)return i.distSqr(e[0])<s;for(let c=1;c<e.length;c++)if(lh(i,e[c-1],e[c])<s)return!0;return!1}function lh(i,e,r){const s=e.distSqr(r);if(s===0)return i.distSqr(e);const c=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/s;return i.distSqr(c<0?e:c>1?r:r.sub(e)._mult(c)._add(e))}function ch(i,e){let r,s,c,h=!1;for(let d=0;d<i.length;d++){r=i[d];for(let m=0,g=r.length-1;m<r.length;g=m++)s=r[m],c=r[g],s.y>e.y!=c.y>e.y&&e.x<(c.x-s.x)*(e.y-s.y)/(c.y-s.y)+s.x&&(h=!h)}return h}function bo(i,e){let r=!1;for(let s=0,c=i.length-1;s<i.length;c=s++){const h=i[s],d=i[c];h.y>e.y!=d.y>e.y&&e.x<(d.x-h.x)*(e.y-h.y)/(d.y-h.y)+h.x&&(r=!r)}return r}function Bd(i,e,r){const s=r[0],c=r[2];if(i.x<s.x&&e.x<s.x||i.x>c.x&&e.x>c.x||i.y<s.y&&e.y<s.y||i.y>c.y&&e.y>c.y)return!1;const h=It(i,e,r[0]);return h!==It(i,e,r[1])||h!==It(i,e,r[2])||h!==It(i,e,r[3])}function ma(i,e,r){const s=e.paint.get(i).value;return s.kind==="constant"?s.value:r.programConfigurations.get(e.id).getMaxValue(i)}function Sl(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Il(i,e,r,s,c){if(!e[0]&&!e[1])return i;const h=tt.convert(e)._mult(c);r==="viewport"&&h._rotate(-s);const d=[];for(let m=0;m<i.length;m++)d.push(i[m].sub(h));return d}Ue("CircleBucket",Ic,{omit:["layers"]});const Rd=new yi({"circle-sort-key":new Je(_e.layout_circle["circle-sort-key"])});var Fd={paint:new yi({"circle-radius":new Je(_e.paint_circle["circle-radius"]),"circle-color":new Je(_e.paint_circle["circle-color"]),"circle-blur":new Je(_e.paint_circle["circle-blur"]),"circle-opacity":new Je(_e.paint_circle["circle-opacity"]),"circle-translate":new qe(_e.paint_circle["circle-translate"]),"circle-translate-anchor":new qe(_e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new qe(_e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new qe(_e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Je(_e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Je(_e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Je(_e.paint_circle["circle-stroke-opacity"])}),layout:Rd},Li=1e-6,Bi=typeof Float32Array<"u"?Float32Array:Array;function uh(){var i=new Bi(9);return Bi!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function kc(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function hh(i,e,r){var s=e[0],c=e[1],h=e[2],d=e[3],m=e[4],g=e[5],x=e[6],w=e[7],E=e[8],C=e[9],z=e[10],P=e[11],$=e[12],N=e[13],ie=e[14],le=e[15],ee=r[0],se=r[1],xe=r[2],ye=r[3];return i[0]=ee*s+se*m+xe*E+ye*$,i[1]=ee*c+se*g+xe*C+ye*N,i[2]=ee*h+se*x+xe*z+ye*ie,i[3]=ee*d+se*w+xe*P+ye*le,i[4]=(ee=r[4])*s+(se=r[5])*m+(xe=r[6])*E+(ye=r[7])*$,i[5]=ee*c+se*g+xe*C+ye*N,i[6]=ee*h+se*x+xe*z+ye*ie,i[7]=ee*d+se*w+xe*P+ye*le,i[8]=(ee=r[8])*s+(se=r[9])*m+(xe=r[10])*E+(ye=r[11])*$,i[9]=ee*c+se*g+xe*C+ye*N,i[10]=ee*h+se*x+xe*z+ye*ie,i[11]=ee*d+se*w+xe*P+ye*le,i[12]=(ee=r[12])*s+(se=r[13])*m+(xe=r[14])*E+(ye=r[15])*$,i[13]=ee*c+se*g+xe*C+ye*N,i[14]=ee*h+se*x+xe*z+ye*ie,i[15]=ee*d+se*w+xe*P+ye*le,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var ga,Od=hh;function ph(){var i=new Bi(3);return Bi!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function dh(i,e,r){var s=new Bi(3);return s[0]=i,s[1]=e,s[2]=r,s}function Al(i,e,r){var s=e[0],c=e[1],h=e[2],d=e[3];return i[0]=r[0]*s+r[4]*c+r[8]*h+r[12]*d,i[1]=r[1]*s+r[5]*c+r[9]*h+r[13]*d,i[2]=r[2]*s+r[6]*c+r[10]*h+r[14]*d,i[3]=r[3]*s+r[7]*c+r[11]*h+r[15]*d,i}function fh(){var i=new Bi(4);return Bi!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function mh(i,e){const r=Al([],[i.x,i.y,0,1],e);return new tt(r[0]/r[3],r[1]/r[3])}ph(),ga=new Bi(4),Bi!=Float32Array&&(ga[0]=0,ga[1]=0,ga[2]=0,ga[3]=0),ph(),dh(1,0,0),dh(0,1,0),fh(),fh(),uh(),function(){var i;i=new Bi(2),Bi!=Float32Array&&(i[0]=0,i[1]=0)}();class gh extends Ic{}Ue("HeatmapBucket",gh,{omit:["layers"]});var Ud={paint:new yi({"heatmap-radius":new Je(_e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Je(_e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new qe(_e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new en(_e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new qe(_e.paint_heatmap["heatmap-opacity"])})};function Mc(i,{width:e,height:r},s,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*r*s)throw new RangeError(`mismatched image size. expected: ${c.length} but got: ${e*r*s}`)}else c=new Uint8Array(e*r*s);return i.width=e,i.height=r,i.data=c,i}function _h(i,{width:e,height:r},s){if(e===i.width&&r===i.height)return;const c=Mc({},{width:e,height:r},s);zc(i,c,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},s),i.width=e,i.height=r,i.data=c.data}function zc(i,e,r,s,c,h){if(c.width===0||c.height===0)return e;if(c.width>i.width||c.height>i.height||r.x>i.width-c.width||r.y>i.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||s.x>e.width-c.width||s.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const d=i.data,m=e.data;if(d===m)throw new Error("srcData equals dstData, so image is already copied");for(let g=0;g<c.height;g++){const x=((r.y+g)*i.width+r.x)*h,w=((s.y+g)*e.width+s.x)*h;for(let E=0;E<c.width*h;E++)m[w+E]=d[x+E]}return e}class _a{constructor(e,r){Mc(this,e,1,r)}resize(e){_h(this,e,1)}clone(){return new _a({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,c,h){zc(e,r,s,c,h,1)}}class hr{constructor(e,r){Mc(this,e,4,r)}resize(e){_h(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new hr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,c,h){zc(e,r,s,c,h,4)}}function yh(i){const e={},r=i.resolution||256,s=i.clips?i.clips.length:1,c=i.image||new hr({width:r,height:s});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const h=(d,m,g)=>{e[i.evaluationKey]=g;const x=i.expression.evaluate(e);c.data[d+m+0]=Math.floor(255*x.r/x.a),c.data[d+m+1]=Math.floor(255*x.g/x.a),c.data[d+m+2]=Math.floor(255*x.b/x.a),c.data[d+m+3]=Math.floor(255*x.a)};if(i.clips)for(let d=0,m=0;d<s;++d,m+=4*r)for(let g=0,x=0;g<r;g++,x+=4){const w=g/(r-1),{start:E,end:C}=i.clips[d];h(m,x,E*(1-w)+C*w)}else for(let d=0,m=0;d<r;d++,m+=4)h(0,m,d/(r-1));return c}Ue("AlphaImage",_a),Ue("RGBAImage",hr);var Vd={paint:new yi({"hillshade-illumination-direction":new qe(_e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new qe(_e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new qe(_e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new qe(_e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new qe(_e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new qe(_e.paint_hillshade["hillshade-accent-color"])})};const Nd=ii([{name:"a_pos",components:2,type:"Int16"}],4),{members:$d}=Nd;var Cl={exports:{}};function kl(i,e,r){r=r||2;var s,c,h,d,m,g,x,w=e&&e.length,E=w?e[0]*r:i.length,C=xh(i,0,E,r,!0),z=[];if(!C||C.next===C.prev)return z;if(w&&(C=function($,N,ie,le){var ee,se,xe,ye=[];for(ee=0,se=N.length;ee<se;ee++)(xe=xh($,N[ee]*le,ee<se-1?N[ee+1]*le:$.length,le,!1))===xe.next&&(xe.steiner=!0),ye.push(Kd(xe));for(ye.sort(Xd),ee=0;ee<ye.length;ee++)ie=Wd(ye[ee],ie);return ie}(i,e,C,r)),i.length>80*r){s=h=i[0],c=d=i[1];for(var P=r;P<E;P+=r)(m=i[P])<s&&(s=m),(g=i[P+1])<c&&(c=g),m>h&&(h=m),g>d&&(d=g);x=(x=Math.max(h-s,d-c))!==0?32767/x:0}return ya(C,z,r,s,c,x,0),z}function xh(i,e,r,s,c){var h,d;if(c===Lc(i,e,r,s)>0)for(h=e;h<r;h+=s)d=wh(h,i[h],i[h+1],d);else for(h=r-s;h>=e;h-=s)d=wh(h,i[h],i[h+1],d);return d&&Ml(d,d.next)&&(va(d),d=d.next),d}function $s(i,e){if(!i)return i;e||(e=i);var r,s=i;do if(r=!1,s.steiner||!Ml(s,s.next)&&ei(s.prev,s,s.next)!==0)s=s.next;else{if(va(s),(s=e=s.prev)===s.next)break;r=!0}while(r||s!==e);return e}function ya(i,e,r,s,c,h,d){if(i){!d&&h&&function(w,E,C,z){var P=w;do P.z===0&&(P.z=Pc(P.x,P.y,E,C,z)),P.prevZ=P.prev,P.nextZ=P.next,P=P.next;while(P!==w);P.prevZ.nextZ=null,P.prevZ=null,function($){var N,ie,le,ee,se,xe,ye,Oe,Ne=1;do{for(ie=$,$=null,se=null,xe=0;ie;){for(xe++,le=ie,ye=0,N=0;N<Ne&&(ye++,le=le.nextZ);N++);for(Oe=Ne;ye>0||Oe>0&&le;)ye!==0&&(Oe===0||!le||ie.z<=le.z)?(ee=ie,ie=ie.nextZ,ye--):(ee=le,le=le.nextZ,Oe--),se?se.nextZ=ee:$=ee,ee.prevZ=se,se=ee;ie=le}se.nextZ=null,Ne*=2}while(xe>1)}(P)}(i,s,c,h);for(var m,g,x=i;i.prev!==i.next;)if(m=i.prev,g=i.next,h?Gd(i,s,c,h):qd(i))e.push(m.i/r|0),e.push(i.i/r|0),e.push(g.i/r|0),va(i),i=g.next,x=g.next;else if((i=g)===x){d?d===1?ya(i=Zd($s(i),e,r),e,r,s,c,h,2):d===2&&jd(i,e,r,s,c,h):ya($s(i),e,r,s,c,h,1);break}}}function qd(i){var e=i.prev,r=i,s=i.next;if(ei(e,r,s)>=0)return!1;for(var c=e.x,h=r.x,d=s.x,m=e.y,g=r.y,x=s.y,w=c<h?c<d?c:d:h<d?h:d,E=m<g?m<x?m:x:g<x?g:x,C=c>h?c>d?c:d:h>d?h:d,z=m>g?m>x?m:x:g>x?g:x,P=s.next;P!==e;){if(P.x>=w&&P.x<=C&&P.y>=E&&P.y<=z&&wo(c,m,h,g,d,x,P.x,P.y)&&ei(P.prev,P,P.next)>=0)return!1;P=P.next}return!0}function Gd(i,e,r,s){var c=i.prev,h=i,d=i.next;if(ei(c,h,d)>=0)return!1;for(var m=c.x,g=h.x,x=d.x,w=c.y,E=h.y,C=d.y,z=m<g?m<x?m:x:g<x?g:x,P=w<E?w<C?w:C:E<C?E:C,$=m>g?m>x?m:x:g>x?g:x,N=w>E?w>C?w:C:E>C?E:C,ie=Pc(z,P,e,r,s),le=Pc($,N,e,r,s),ee=i.prevZ,se=i.nextZ;ee&&ee.z>=ie&&se&&se.z<=le;){if(ee.x>=z&&ee.x<=$&&ee.y>=P&&ee.y<=N&&ee!==c&&ee!==d&&wo(m,w,g,E,x,C,ee.x,ee.y)&&ei(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,se.x>=z&&se.x<=$&&se.y>=P&&se.y<=N&&se!==c&&se!==d&&wo(m,w,g,E,x,C,se.x,se.y)&&ei(se.prev,se,se.next)>=0))return!1;se=se.nextZ}for(;ee&&ee.z>=ie;){if(ee.x>=z&&ee.x<=$&&ee.y>=P&&ee.y<=N&&ee!==c&&ee!==d&&wo(m,w,g,E,x,C,ee.x,ee.y)&&ei(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;se&&se.z<=le;){if(se.x>=z&&se.x<=$&&se.y>=P&&se.y<=N&&se!==c&&se!==d&&wo(m,w,g,E,x,C,se.x,se.y)&&ei(se.prev,se,se.next)>=0)return!1;se=se.nextZ}return!0}function Zd(i,e,r){var s=i;do{var c=s.prev,h=s.next.next;!Ml(c,h)&&vh(c,s,s.next,h)&&xa(c,h)&&xa(h,c)&&(e.push(c.i/r|0),e.push(s.i/r|0),e.push(h.i/r|0),va(s),va(s.next),s=i=h),s=s.next}while(s!==i);return $s(s)}function jd(i,e,r,s,c,h){var d=i;do{for(var m=d.next.next;m!==d.prev;){if(d.i!==m.i&&Yd(d,m)){var g=bh(d,m);return d=$s(d,d.next),g=$s(g,g.next),ya(d,e,r,s,c,h,0),void ya(g,e,r,s,c,h,0)}m=m.next}d=d.next}while(d!==i)}function Xd(i,e){return i.x-e.x}function Wd(i,e){var r=function(c,h){var d,m=h,g=c.x,x=c.y,w=-1/0;do{if(x<=m.y&&x>=m.next.y&&m.next.y!==m.y){var E=m.x+(x-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(E<=g&&E>w&&(w=E,d=m.x<m.next.x?m:m.next,E===g))return d}m=m.next}while(m!==h);if(!d)return null;var C,z=d,P=d.x,$=d.y,N=1/0;m=d;do g>=m.x&&m.x>=P&&g!==m.x&&wo(x<$?g:w,x,P,$,x<$?w:g,x,m.x,m.y)&&(C=Math.abs(x-m.y)/(g-m.x),xa(m,c)&&(C<N||C===N&&(m.x>d.x||m.x===d.x&&Hd(d,m)))&&(d=m,N=C)),m=m.next;while(m!==z);return d}(i,e);if(!r)return e;var s=bh(r,i);return $s(s,s.next),$s(r,r.next)}function Hd(i,e){return ei(i.prev,i,e.prev)<0&&ei(e.next,i,i.next)<0}function Pc(i,e,r,s,c){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*c|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Kd(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function wo(i,e,r,s,c,h,d,m){return(c-d)*(e-m)>=(i-d)*(h-m)&&(i-d)*(s-m)>=(r-d)*(e-m)&&(r-d)*(h-m)>=(c-d)*(s-m)}function Yd(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,s){var c=r;do{if(c.i!==r.i&&c.next.i!==r.i&&c.i!==s.i&&c.next.i!==s.i&&vh(c,c.next,r,s))return!0;c=c.next}while(c!==r);return!1}(i,e)&&(xa(i,e)&&xa(e,i)&&function(r,s){var c=r,h=!1,d=(r.x+s.x)/2,m=(r.y+s.y)/2;do c.y>m!=c.next.y>m&&c.next.y!==c.y&&d<(c.next.x-c.x)*(m-c.y)/(c.next.y-c.y)+c.x&&(h=!h),c=c.next;while(c!==r);return h}(i,e)&&(ei(i.prev,i,e.prev)||ei(i,e.prev,e))||Ml(i,e)&&ei(i.prev,i,i.next)>0&&ei(e.prev,e,e.next)>0)}function ei(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function Ml(i,e){return i.x===e.x&&i.y===e.y}function vh(i,e,r,s){var c=Pl(ei(i,e,r)),h=Pl(ei(i,e,s)),d=Pl(ei(r,s,i)),m=Pl(ei(r,s,e));return c!==h&&d!==m||!(c!==0||!zl(i,r,e))||!(h!==0||!zl(i,s,e))||!(d!==0||!zl(r,i,s))||!(m!==0||!zl(r,e,s))}function zl(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function Pl(i){return i>0?1:i<0?-1:0}function xa(i,e){return ei(i.prev,i,i.next)<0?ei(i,e,i.next)>=0&&ei(i,i.prev,e)>=0:ei(i,e,i.prev)<0||ei(i,i.next,e)<0}function bh(i,e){var r=new Dc(i.i,i.x,i.y),s=new Dc(e.i,e.x,e.y),c=i.next,h=e.prev;return i.next=e,e.prev=i,r.next=c,c.prev=r,s.next=r,r.prev=s,h.next=s,s.prev=h,s}function wh(i,e,r,s){var c=new Dc(i,e,r);return s?(c.next=s.next,c.prev=s,s.next.prev=c,s.next=c):(c.prev=c,c.next=c),c}function va(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Dc(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Lc(i,e,r,s){for(var c=0,h=e,d=r-s;h<r;h+=s)c+=(i[d]-i[h])*(i[h+1]+i[d+1]),d=h;return c}function Jd(i,e,r,s,c){Th(i,e,r||0,s||i.length-1,c||Qd)}function Th(i,e,r,s,c){for(;s>r;){if(s-r>600){var h=s-r+1,d=e-r+1,m=Math.log(h),g=.5*Math.exp(2*m/3),x=.5*Math.sqrt(m*g*(h-g)/h)*(d-h/2<0?-1:1);Th(i,e,Math.max(r,Math.floor(e-d*g/h+x)),Math.min(s,Math.floor(e+(h-d)*g/h+x)),c)}var w=i[e],E=r,C=s;for(ba(i,r,e),c(i[s],w)>0&&ba(i,r,s);E<C;){for(ba(i,E,C),E++,C--;c(i[E],w)<0;)E++;for(;c(i[C],w)>0;)C--}c(i[r],w)===0?ba(i,r,C):ba(i,++C,s),C<=e&&(r=C+1),e<=C&&(s=C-1)}}function ba(i,e,r){var s=i[e];i[e]=i[r],i[r]=s}function Qd(i,e){return i<e?-1:i>e?1:0}function Bc(i,e){const r=i.length;if(r<=1)return[i];const s=[];let c,h;for(let d=0;d<r;d++){const m=gt(i[d]);m!==0&&(i[d].area=Math.abs(m),h===void 0&&(h=m<0),h===m<0?(c&&s.push(c),c=[i[d]]):c.push(i[d]))}if(c&&s.push(c),e>1)for(let d=0;d<s.length;d++)s[d].length<=e||(Jd(s[d],e,1,s[d].length-1,ef),s[d]=s[d].slice(0,e));return s}function ef(i,e){return e.area-i.area}function Rc(i,e,r){const s=r.patternDependencies;let c=!1;for(const h of e){const d=h.paint.get(`${i}-pattern`);d.isConstant()||(c=!0);const m=d.constantOr(null);m&&(c=!0,s[m.to]=!0,s[m.from]=!0)}return c}function Fc(i,e,r,s,c){const h=c.patternDependencies;for(const d of e){const m=d.paint.get(`${i}-pattern`).value;if(m.kind!=="constant"){let g=m.evaluate({zoom:s-1},r,{},c.availableImages),x=m.evaluate({zoom:s},r,{},c.availableImages),w=m.evaluate({zoom:s+1},r,{},c.availableImages);g=g&&g.name?g.name:g,x=x&&x.name?x.name:x,w=w&&w.name?w.name:w,h[g]=!0,h[x]=!0,h[w]=!0,r.patterns[d.id]={min:g,mid:x,max:w}}}return r}Cl.exports=kl,Cl.exports.default=kl,kl.deviation=function(i,e,r,s){var c=e&&e.length,h=Math.abs(Lc(i,0,c?e[0]*r:i.length,r));if(c)for(var d=0,m=e.length;d<m;d++)h-=Math.abs(Lc(i,e[d]*r,d<m-1?e[d+1]*r:i.length,r));var g=0;for(d=0;d<s.length;d+=3){var x=s[d]*r,w=s[d+1]*r,E=s[d+2]*r;g+=Math.abs((i[x]-i[E])*(i[w+1]-i[x+1])-(i[x]-i[w])*(i[E+1]-i[x+1]))}return h===0&&g===0?0:Math.abs((g-h)/h)},kl.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},s=0,c=0;c<i.length;c++){for(var h=0;h<i[c].length;h++)for(var d=0;d<e;d++)r.vertices.push(i[c][h][d]);c>0&&r.holes.push(s+=i[c-1].length)}return r};class Oc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Pt,this.indexArray=new Di,this.indexArray2=new Dr,this.programConfigurations=new Us(e.layers,e.zoom),this.segments=new ft,this.segments2=new ft,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.hasPattern=Rc("fill",this.layers,r);const c=this.layers[0].layout.get("fill-sort-key"),h=!c.isConstant(),d=[];for(const{feature:m,id:g,index:x,sourceLayerIndex:w}of e){const E=this.layers[0]._featureFilter.needGeometry,C=Ns(m,E);if(!this.layers[0]._featureFilter.filter(new Xt(this.zoom),C,s))continue;const z=h?c.evaluate(C,{},s,r.availableImages):void 0,P={id:g,properties:m.properties,type:m.type,sourceLayerIndex:w,index:x,geometry:E?C.geometry:Vs(m),patterns:{},sortKey:z};d.push(P)}h&&d.sort((m,g)=>m.sortKey-g.sortKey);for(const m of d){const{geometry:g,index:x,sourceLayerIndex:w}=m;if(this.hasPattern){const E=Fc("fill",this.layers,m,this.zoom,r);this.patternFeatures.push(E)}else this.addFeature(m,g,x,s,{});r.featureIndex.insert(e[x].feature,g,x,w,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}addFeatures(e,r,s){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$d),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,s,c,h){for(const d of Bc(r,500)){let m=0;for(const z of d)m+=z.length;const g=this.segments.prepareSegment(m,this.layoutVertexArray,this.indexArray),x=g.vertexLength,w=[],E=[];for(const z of d){if(z.length===0)continue;z!==d[0]&&E.push(w.length/2);const P=this.segments2.prepareSegment(z.length,this.layoutVertexArray,this.indexArray2),$=P.vertexLength;this.layoutVertexArray.emplaceBack(z[0].x,z[0].y),this.indexArray2.emplaceBack($+z.length-1,$),w.push(z[0].x),w.push(z[0].y);for(let N=1;N<z.length;N++)this.layoutVertexArray.emplaceBack(z[N].x,z[N].y),this.indexArray2.emplaceBack($+N-1,$+N),w.push(z[N].x),w.push(z[N].y);P.vertexLength+=z.length,P.primitiveLength+=z.length}const C=Cl.exports(w,E);for(let z=0;z<C.length;z+=3)this.indexArray.emplaceBack(x+C[z],x+C[z+1],x+C[z+2]);g.vertexLength+=m,g.primitiveLength+=C.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,c)}}Ue("FillBucket",Oc,{omit:["layers","patternFeatures"]});const tf=new yi({"fill-sort-key":new Je(_e.layout_fill["fill-sort-key"])});var rf={paint:new yi({"fill-antialias":new qe(_e.paint_fill["fill-antialias"]),"fill-opacity":new Je(_e.paint_fill["fill-opacity"]),"fill-color":new Je(_e.paint_fill["fill-color"]),"fill-outline-color":new Je(_e.paint_fill["fill-outline-color"]),"fill-translate":new qe(_e.paint_fill["fill-translate"]),"fill-translate-anchor":new qe(_e.paint_fill["fill-translate-anchor"]),"fill-pattern":new is(_e.paint_fill["fill-pattern"])}),layout:tf};const nf=ii([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),sf=ii([{name:"a_centroid",components:2,type:"Int16"}],4),{members:of}=nf;var ss={},af=tt,Eh=To;function To(i,e,r,s,c){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=s,this._values=c,i.readFields(lf,this,e)}function lf(i,e,r){i==1?e.id=r.readVarint():i==2?function(s,c){for(var h=s.readVarint()+s.pos;s.pos<h;){var d=c._keys[s.readVarint()],m=c._values[s.readVarint()];c.properties[d]=m}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function cf(i){for(var e,r,s=0,c=0,h=i.length,d=h-1;c<h;d=c++)s+=((r=i[d]).x-(e=i[c]).x)*(e.y+r.y);return s}To.types=["Unknown","Point","LineString","Polygon"],To.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,s=1,c=0,h=0,d=0,m=[];i.pos<r;){if(c<=0){var g=i.readVarint();s=7&g,c=g>>3}if(c--,s===1||s===2)h+=i.readSVarint(),d+=i.readSVarint(),s===1&&(e&&m.push(e),e=[]),e.push(new af(h,d));else{if(s!==7)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&m.push(e),m},To.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,s=0,c=0,h=0,d=1/0,m=-1/0,g=1/0,x=-1/0;i.pos<e;){if(s<=0){var w=i.readVarint();r=7&w,s=w>>3}if(s--,r===1||r===2)(c+=i.readSVarint())<d&&(d=c),c>m&&(m=c),(h+=i.readSVarint())<g&&(g=h),h>x&&(x=h);else if(r!==7)throw new Error("unknown command "+r)}return[d,g,m,x]},To.prototype.toGeoJSON=function(i,e,r){var s,c,h=this.extent*Math.pow(2,r),d=this.extent*i,m=this.extent*e,g=this.loadGeometry(),x=To.types[this.type];function w(z){for(var P=0;P<z.length;P++){var $=z[P];z[P]=[360*($.x+d)/h-180,360/Math.PI*Math.atan(Math.exp((180-360*($.y+m)/h)*Math.PI/180))-90]}}switch(this.type){case 1:var E=[];for(s=0;s<g.length;s++)E[s]=g[s][0];w(g=E);break;case 2:for(s=0;s<g.length;s++)w(g[s]);break;case 3:for(g=function(z){var P=z.length;if(P<=1)return[z];for(var $,N,ie=[],le=0;le<P;le++){var ee=cf(z[le]);ee!==0&&(N===void 0&&(N=ee<0),N===ee<0?($&&ie.push($),$=[z[le]]):$.push(z[le]))}return $&&ie.push($),ie}(g),s=0;s<g.length;s++)for(c=0;c<g[s].length;c++)w(g[s][c])}g.length===1?g=g[0]:x="Multi"+x;var C={type:"Feature",geometry:{type:x,coordinates:g},properties:this.properties};return"id"in this&&(C.id=this.id),C};var uf=Eh,Sh=Ih;function Ih(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(hf,this,e),this.length=this._features.length}function hf(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(s){for(var c=null,h=s.readVarint()+s.pos;s.pos<h;){var d=s.readVarint()>>3;c=d===1?s.readString():d===2?s.readFloat():d===3?s.readDouble():d===4?s.readVarint64():d===5?s.readVarint():d===6?s.readSVarint():d===7?s.readBoolean():null}return c}(r))}Ih.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new uf(this._pbf,e,this.extent,this._keys,this._values)};var pf=Sh;function df(i,e,r){if(i===3){var s=new pf(r,r.readVarint()+r.pos);s.length&&(e[s.name]=s)}}ss.VectorTile=function(i,e){this.layers=i.readFields(df,{},e)},ss.VectorTileFeature=Eh,ss.VectorTileLayer=Sh;const ff=ss.VectorTileFeature.types,Uc=Math.pow(2,13);function wa(i,e,r,s,c,h,d,m){i.emplaceBack(e,r,2*Math.floor(s*Uc)+d,c*Uc*2,h*Uc*2,Math.round(m))}class Vc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new yt,this.centroidVertexArray=new Xe,this.indexArray=new Di,this.programConfigurations=new Us(e.layers,e.zoom),this.segments=new ft,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.features=[],this.hasPattern=Rc("fill-extrusion",this.layers,r);for(const{feature:c,id:h,index:d,sourceLayerIndex:m}of e){const g=this.layers[0]._featureFilter.needGeometry,x=Ns(c,g);if(!this.layers[0]._featureFilter.filter(new Xt(this.zoom),x,s))continue;const w={id:h,sourceLayerIndex:m,index:d,geometry:g?x.geometry:Vs(c),properties:c.properties,type:c.type,patterns:{}};this.hasPattern?this.features.push(Fc("fill-extrusion",this.layers,w,this.zoom,r)):this.addFeature(w,w.geometry,d,s,{}),r.featureIndex.insert(c,w.geometry,d,m,this.index,!0)}}addFeatures(e,r,s){for(const c of this.features){const{geometry:h}=c;this.addFeature(c,h,c.index,r,s)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,of),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,sf.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,s,c,h){const d={x:0,y:0,vertexCount:0};for(const m of Bc(r,500)){let g=0;for(const P of m)g+=P.length;let x=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const P of m){if(P.length===0||gf(P))continue;let $=0;for(let N=0;N<P.length;N++){const ie=P[N];if(N>=1){const le=P[N-1];if(!mf(ie,le)){x.vertexLength+4>ft.MAX_VERTEX_ARRAY_LENGTH&&(x=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ee=ie.sub(le)._perp()._unit(),se=le.dist(ie);$+se>32768&&($=0),wa(this.layoutVertexArray,ie.x,ie.y,ee.x,ee.y,0,0,$),wa(this.layoutVertexArray,ie.x,ie.y,ee.x,ee.y,0,1,$),d.x+=2*ie.x,d.y+=2*ie.y,d.vertexCount+=2,$+=se,wa(this.layoutVertexArray,le.x,le.y,ee.x,ee.y,0,0,$),wa(this.layoutVertexArray,le.x,le.y,ee.x,ee.y,0,1,$),d.x+=2*le.x,d.y+=2*le.y,d.vertexCount+=2;const xe=x.vertexLength;this.indexArray.emplaceBack(xe,xe+2,xe+1),this.indexArray.emplaceBack(xe+1,xe+2,xe+3),x.vertexLength+=4,x.primitiveLength+=2}}}}if(x.vertexLength+g>ft.MAX_VERTEX_ARRAY_LENGTH&&(x=this.segments.prepareSegment(g,this.layoutVertexArray,this.indexArray)),ff[e.type]!=="Polygon")continue;const w=[],E=[],C=x.vertexLength;for(const P of m)if(P.length!==0){P!==m[0]&&E.push(w.length/2);for(let $=0;$<P.length;$++){const N=P[$];wa(this.layoutVertexArray,N.x,N.y,0,0,1,1,0),d.x+=N.x,d.y+=N.y,d.vertexCount+=1,w.push(N.x),w.push(N.y)}}const z=Cl.exports(w,E);for(let P=0;P<z.length;P+=3)this.indexArray.emplaceBack(C+z[P],C+z[P+2],C+z[P+1]);x.primitiveLength+=z.length/3,x.vertexLength+=g}for(let m=0;m<d.vertexCount;m++)this.centroidVertexArray.emplaceBack(Math.floor(d.x/d.vertexCount),Math.floor(d.y/d.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,c)}}function mf(i,e){return i.x===e.x&&(i.x<0||i.x>ai)||i.y===e.y&&(i.y<0||i.y>ai)}function gf(i){return i.every(e=>e.x<0)||i.every(e=>e.x>ai)||i.every(e=>e.y<0)||i.every(e=>e.y>ai)}Ue("FillExtrusionBucket",Vc,{omit:["layers","features"]});var _f={paint:new yi({"fill-extrusion-opacity":new qe(_e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Je(_e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new qe(_e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new qe(_e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new is(_e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Je(_e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Je(_e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new qe(_e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Ta(i,e){return i.x*e.x+i.y*e.y}function Ah(i,e){if(i.length===1){let r=0;const s=e[r++];let c;for(;!c||s.equals(c);)if(c=e[r++],!c)return 1/0;for(;r<e.length;r++){const h=e[r],d=i[0],m=c.sub(s),g=h.sub(s),x=d.sub(s),w=Ta(m,m),E=Ta(m,g),C=Ta(g,g),z=Ta(x,m),P=Ta(x,g),$=w*C-E*E,N=(C*z-E*P)/$,ie=(w*P-E*z)/$,le=s.z*(1-N-ie)+c.z*N+h.z*ie;if(isFinite(le))return le}return 1/0}{let r=1/0;for(const s of e)r=Math.min(r,s.z);return r}}const yf=ii([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:xf}=yf,vf=ii([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:bf}=vf,wf=ss.VectorTileFeature.types,Tf=Math.cos(Math.PI/180*37.5),Ch=Math.pow(2,14)/.5;class Nc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Tt,this.layoutVertexArray2=new Bt,this.indexArray=new Di,this.programConfigurations=new Us(e.layers,e.zoom),this.segments=new ft,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.hasPattern=Rc("line",this.layers,r);const c=this.layers[0].layout.get("line-sort-key"),h=!c.isConstant(),d=[];for(const{feature:m,id:g,index:x,sourceLayerIndex:w}of e){const E=this.layers[0]._featureFilter.needGeometry,C=Ns(m,E);if(!this.layers[0]._featureFilter.filter(new Xt(this.zoom),C,s))continue;const z=h?c.evaluate(C,{},s):void 0,P={id:g,properties:m.properties,type:m.type,sourceLayerIndex:w,index:x,geometry:E?C.geometry:Vs(m),patterns:{},sortKey:z};d.push(P)}h&&d.sort((m,g)=>m.sortKey-g.sortKey);for(const m of d){const{geometry:g,index:x,sourceLayerIndex:w}=m;if(this.hasPattern){const E=Fc("line",this.layers,m,this.zoom,r);this.patternFeatures.push(E)}else this.addFeature(m,g,x,s,{});r.featureIndex.insert(e[x].feature,g,x,w,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}addFeatures(e,r,s){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,bf)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,xf),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,s,c,h){const d=this.layers[0].layout,m=d.get("line-join").evaluate(e,{}),g=d.get("line-cap"),x=d.get("line-miter-limit"),w=d.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const E of r)this.addLine(E,e,m,g,x,w);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,c)}addLine(e,r,s,c,h,d){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ie=0;ie<e.length-1;ie++)this.totalDistance+=e[ie].dist(e[ie+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const m=wf[r.type]==="Polygon";let g=e.length;for(;g>=2&&e[g-1].equals(e[g-2]);)g--;let x=0;for(;x<g-1&&e[x].equals(e[x+1]);)x++;if(g<(m?3:2))return;s==="bevel"&&(h=1.05);const w=this.overscaling<=16?122880/(512*this.overscaling):0,E=this.segments.prepareSegment(10*g,this.layoutVertexArray,this.indexArray);let C,z,P,$,N;this.e1=this.e2=-1,m&&(C=e[g-2],N=e[x].sub(C)._unit()._perp());for(let ie=x;ie<g;ie++){if(P=ie===g-1?m?e[x+1]:void 0:e[ie+1],P&&e[ie].equals(P))continue;N&&($=N),C&&(z=C),C=e[ie],N=P?P.sub(C)._unit()._perp():$,$=$||N;let le=$.add(N);le.x===0&&le.y===0||le._unit();const ee=$.x*N.x+$.y*N.y,se=le.x*N.x+le.y*N.y,xe=se!==0?1/se:1/0,ye=2*Math.sqrt(2-2*se),Oe=se<Tf&&z&&P,Ne=$.x*N.y-$.y*N.x>0;if(Oe&&ie>x){const Ee=C.dist(z);if(Ee>2*w){const Le=C.sub(C.sub(z)._mult(w/Ee)._round());this.updateDistance(z,Le),this.addCurrentVertex(Le,$,0,0,E),z=Le}}const De=z&&P;let Ae=De?s:m?"butt":c;if(De&&Ae==="round"&&(xe<d?Ae="miter":xe<=2&&(Ae="fakeround")),Ae==="miter"&&xe>h&&(Ae="bevel"),Ae==="bevel"&&(xe>2&&(Ae="flipbevel"),xe<h&&(Ae="miter")),z&&this.updateDistance(z,C),Ae==="miter")le._mult(xe),this.addCurrentVertex(C,le,0,0,E);else if(Ae==="flipbevel"){if(xe>100)le=N.mult(-1);else{const Ee=xe*$.add(N).mag()/$.sub(N).mag();le._perp()._mult(Ee*(Ne?-1:1))}this.addCurrentVertex(C,le,0,0,E),this.addCurrentVertex(C,le.mult(-1),0,0,E)}else if(Ae==="bevel"||Ae==="fakeround"){const Ee=-Math.sqrt(xe*xe-1),Le=Ne?Ee:0,Me=Ne?0:Ee;if(z&&this.addCurrentVertex(C,$,Le,Me,E),Ae==="fakeround"){const we=Math.round(180*ye/Math.PI/20);for(let We=1;We<we;We++){let Ge=We/we;if(Ge!==.5){const qt=Ge-.5;Ge+=Ge*qt*(Ge-1)*((1.0904+ee*(ee*(3.55645-1.43519*ee)-3.2452))*qt*qt+(.848013+ee*(.215638*ee-1.06021)))}const pt=N.sub($)._mult(Ge)._add($)._unit()._mult(Ne?-1:1);this.addHalfVertex(C,pt.x,pt.y,!1,Ne,0,E)}}P&&this.addCurrentVertex(C,N,-Le,-Me,E)}else if(Ae==="butt")this.addCurrentVertex(C,le,0,0,E);else if(Ae==="square"){const Ee=z?1:-1;this.addCurrentVertex(C,le,Ee,Ee,E)}else Ae==="round"&&(z&&(this.addCurrentVertex(C,$,0,0,E),this.addCurrentVertex(C,$,1,1,E,!0)),P&&(this.addCurrentVertex(C,N,-1,-1,E,!0),this.addCurrentVertex(C,N,0,0,E)));if(Oe&&ie<g-1){const Ee=C.dist(P);if(Ee>2*w){const Le=C.add(P.sub(C)._mult(w/Ee)._round());this.updateDistance(C,Le),this.addCurrentVertex(Le,N,0,0,E),C=Le}}}}addCurrentVertex(e,r,s,c,h,d=!1){const m=r.y*c-r.x,g=-r.y-r.x*c;this.addHalfVertex(e,r.x+r.y*s,r.y-r.x*s,d,!1,s,h),this.addHalfVertex(e,m,g,d,!0,-c,h),this.distance>Ch/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,r,s,c,h,d))}addHalfVertex({x:e,y:r},s,c,h,d,m,g){const x=.5*(this.lineClips?this.scaledDistance*(Ch-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(h?1:0),(r<<1)+(d?1:0),Math.round(63*s)+128,Math.round(63*c)+128,1+(m===0?0:m<0?-1:1)|(63&x)<<2,x>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const w=g.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),g.primitiveLength++),d?this.e2=w:this.e1=w}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}Ue("LineBucket",Nc,{omit:["layers","patternFeatures"]});const Ef=new yi({"line-cap":new qe(_e.layout_line["line-cap"]),"line-join":new Je(_e.layout_line["line-join"]),"line-miter-limit":new qe(_e.layout_line["line-miter-limit"]),"line-round-limit":new qe(_e.layout_line["line-round-limit"]),"line-sort-key":new Je(_e.layout_line["line-sort-key"])});var kh={paint:new yi({"line-opacity":new Je(_e.paint_line["line-opacity"]),"line-color":new Je(_e.paint_line["line-color"]),"line-translate":new qe(_e.paint_line["line-translate"]),"line-translate-anchor":new qe(_e.paint_line["line-translate-anchor"]),"line-width":new Je(_e.paint_line["line-width"]),"line-gap-width":new Je(_e.paint_line["line-gap-width"]),"line-offset":new Je(_e.paint_line["line-offset"]),"line-blur":new Je(_e.paint_line["line-blur"]),"line-dasharray":new ua(_e.paint_line["line-dasharray"]),"line-pattern":new is(_e.paint_line["line-pattern"]),"line-gradient":new en(_e.paint_line["line-gradient"])}),layout:Ef};const Mh=new class extends Je{possiblyEvaluate(i,e){return e=new Xt(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,r,s){return e=ze({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,r,s)}}(kh.paint.properties["line-width"].specification);function zh(i,e){return e>0?e+2*i:i}Mh.useIntegerZoom=!0;const Sf=ii([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),If=ii([{name:"a_projected_pos",components:3,type:"Float32"}],4);ii([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Af=ii([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);ii([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ph=ii([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Cf=ii([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function kf(i,e,r){return i.sections.forEach(s=>{s.text=function(c,h,d){const m=h.layout.get("text-transform").evaluate(d,{});return m==="uppercase"?c=c.toLocaleUpperCase():m==="lowercase"&&(c=c.toLocaleLowerCase()),Qi.applyArabicShaping&&(c=Qi.applyArabicShaping(c)),c}(s.text,e,r)}),i}ii([{name:"triangle",components:3,type:"Uint16"}]),ii([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ii([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ii([{type:"Float32",name:"offsetX"}]),ii([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Ea={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var xi=24,$c=Vt,Dh=function(i,e,r,s,c){var h,d,m=8*c-s-1,g=(1<<m)-1,x=g>>1,w=-7,E=r?c-1:0,C=r?-1:1,z=i[e+E];for(E+=C,h=z&(1<<-w)-1,z>>=-w,w+=m;w>0;h=256*h+i[e+E],E+=C,w-=8);for(d=h&(1<<-w)-1,h>>=-w,w+=s;w>0;d=256*d+i[e+E],E+=C,w-=8);if(h===0)h=1-x;else{if(h===g)return d?NaN:1/0*(z?-1:1);d+=Math.pow(2,s),h-=x}return(z?-1:1)*d*Math.pow(2,h-s)},Lh=function(i,e,r,s,c,h){var d,m,g,x=8*h-c-1,w=(1<<x)-1,E=w>>1,C=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,z=s?0:h-1,P=s?1:-1,$=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(m=isNaN(e)?1:0,d=w):(d=Math.floor(Math.log(e)/Math.LN2),e*(g=Math.pow(2,-d))<1&&(d--,g*=2),(e+=d+E>=1?C/g:C*Math.pow(2,1-E))*g>=2&&(d++,g/=2),d+E>=w?(m=0,d=w):d+E>=1?(m=(e*g-1)*Math.pow(2,c),d+=E):(m=e*Math.pow(2,E-1)*Math.pow(2,c),d=0));c>=8;i[r+z]=255&m,z+=P,m/=256,c-=8);for(d=d<<c|m,x+=c;x>0;i[r+z]=255&d,z+=P,d/=256,x-=8);i[r+z-P]|=128*$};function Vt(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Vt.Varint=0,Vt.Fixed64=1,Vt.Bytes=2,Vt.Fixed32=5;var os,qc=4294967296,Bh=1/qc,Rh=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Sn(i){return i.type===Vt.Bytes?i.readVarint()+i.pos:i.pos+1}function Eo(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Fh(i,e,r){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(s);for(var c=r.pos-1;c>=i;c--)r.buf[c+s]=r.buf[c]}function Mf(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function zf(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function Pf(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function Df(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function Lf(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function Bf(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function Rf(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function Ff(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function Of(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function Dl(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function So(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function Oh(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function Uf(i,e,r){i===1&&r.readMessage(Vf,e)}function Vf(i,e,r){if(i===3){const{id:s,bitmap:c,width:h,height:d,left:m,top:g,advance:x}=r.readMessage(Nf,{});e.push({id:s,bitmap:new _a({width:h+6,height:d+6},c),metrics:{width:h,height:d,left:m,top:g,advance:x}})}}function Nf(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}function Uh(i){let e=0,r=0;for(const d of i)e+=d.w*d.h,r=Math.max(r,d.w);i.sort((d,m)=>m.h-d.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let c=0,h=0;for(const d of i)for(let m=s.length-1;m>=0;m--){const g=s[m];if(!(d.w>g.w||d.h>g.h)){if(d.x=g.x,d.y=g.y,h=Math.max(h,d.y+d.h),c=Math.max(c,d.x+d.w),d.w===g.w&&d.h===g.h){const x=s.pop();m<s.length&&(s[m]=x)}else d.h===g.h?(g.x+=d.w,g.w-=d.w):d.w===g.w?(g.y+=d.h,g.h-=d.h):(s.push({x:g.x+d.w,y:g.y,w:g.w-d.w,h:d.h}),g.y+=d.h,g.h-=d.h);break}}return{w:c,h,fill:e/(c*h)||0}}Vt.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var s=this.readVarint(),c=s>>3,h=this.pos;this.type=7&s,i(c,e,this),this.pos===h&&this.skip(s)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Dl(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Oh(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Dl(this.buf,this.pos)+Dl(this.buf,this.pos+4)*qc;return this.pos+=8,i},readSFixed64:function(){var i=Dl(this.buf,this.pos)+Oh(this.buf,this.pos+4)*qc;return this.pos+=8,i},readFloat:function(){var i=Dh(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Dh(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,s=this.buf;return e=127&(r=s[this.pos++]),r<128?e:(e|=(127&(r=s[this.pos++]))<<7,r<128?e:(e|=(127&(r=s[this.pos++]))<<14,r<128?e:(e|=(127&(r=s[this.pos++]))<<21,r<128?e:function(c,h,d){var m,g,x=d.buf;if(m=(112&(g=x[d.pos++]))>>4,g<128||(m|=(127&(g=x[d.pos++]))<<3,g<128)||(m|=(127&(g=x[d.pos++]))<<10,g<128)||(m|=(127&(g=x[d.pos++]))<<17,g<128)||(m|=(127&(g=x[d.pos++]))<<24,g<128)||(m|=(1&(g=x[d.pos++]))<<31,g<128))return Eo(c,m,h);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=s[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Rh?function(r,s,c){return Rh.decode(r.subarray(s,c))}(this.buf,e,i):function(r,s,c){for(var h="",d=s;d<c;){var m,g,x,w=r[d],E=null,C=w>239?4:w>223?3:w>191?2:1;if(d+C>c)break;C===1?w<128&&(E=w):C===2?(192&(m=r[d+1]))==128&&(E=(31&w)<<6|63&m)<=127&&(E=null):C===3?(g=r[d+2],(192&(m=r[d+1]))==128&&(192&g)==128&&((E=(15&w)<<12|(63&m)<<6|63&g)<=2047||E>=55296&&E<=57343)&&(E=null)):C===4&&(g=r[d+2],x=r[d+3],(192&(m=r[d+1]))==128&&(192&g)==128&&(192&x)==128&&((E=(15&w)<<18|(63&m)<<12|(63&g)<<6|63&x)<=65535||E>=1114112)&&(E=null)),E===null?(E=65533,C=1):E>65535&&(E-=65536,h+=String.fromCharCode(E>>>10&1023|55296),E=56320|1023&E),h+=String.fromCharCode(E),d+=C}return h}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Vt.Bytes)return i.push(this.readVarint(e));var r=Sn(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Vt.Bytes)return i.push(this.readSVarint());var e=Sn(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Vt.Bytes)return i.push(this.readBoolean());var e=Sn(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Vt.Bytes)return i.push(this.readFloat());var e=Sn(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Vt.Bytes)return i.push(this.readDouble());var e=Sn(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Vt.Bytes)return i.push(this.readFixed32());var e=Sn(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Vt.Bytes)return i.push(this.readSFixed32());var e=Sn(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Vt.Bytes)return i.push(this.readFixed64());var e=Sn(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Vt.Bytes)return i.push(this.readSFixed64());var e=Sn(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Vt.Varint)for(;this.buf[this.pos++]>127;);else if(e===Vt.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Vt.Fixed32)this.pos+=4;else{if(e!==Vt.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),So(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),So(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),So(this.buf,-1&i,this.pos),So(this.buf,Math.floor(i*Bh),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),So(this.buf,-1&i,this.pos),So(this.buf,Math.floor(i*Bh),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var s,c;if(e>=0?(s=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(h,d,m){m.buf[m.pos++]=127&h|128,h>>>=7,m.buf[m.pos++]=127&h|128,h>>>=7,m.buf[m.pos++]=127&h|128,h>>>=7,m.buf[m.pos++]=127&h|128,m.buf[m.pos]=127&(h>>>=7)}(s,0,r),function(h,d){var m=(7&h)<<4;d.buf[d.pos++]|=m|((h>>>=3)?128:0),h&&(d.buf[d.pos++]=127&h|((h>>>=7)?128:0),h&&(d.buf[d.pos++]=127&h|((h>>>=7)?128:0),h&&(d.buf[d.pos++]=127&h|((h>>>=7)?128:0),h&&(d.buf[d.pos++]=127&h|((h>>>=7)?128:0),h&&(d.buf[d.pos++]=127&h)))))}(c,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(s,c,h){for(var d,m,g=0;g<c.length;g++){if((d=c.charCodeAt(g))>55295&&d<57344){if(!m){d>56319||g+1===c.length?(s[h++]=239,s[h++]=191,s[h++]=189):m=d;continue}if(d<56320){s[h++]=239,s[h++]=191,s[h++]=189,m=d;continue}d=m-55296<<10|d-56320|65536,m=null}else m&&(s[h++]=239,s[h++]=191,s[h++]=189,m=null);d<128?s[h++]=d:(d<2048?s[h++]=d>>6|192:(d<65536?s[h++]=d>>12|224:(s[h++]=d>>18|240,s[h++]=d>>12&63|128),s[h++]=d>>6&63|128),s[h++]=63&d|128)}return h}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&Fh(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),Lh(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Lh(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var s=this.pos-r;s>=128&&Fh(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeMessage:function(i,e,r){this.writeTag(i,Vt.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,Mf,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,zf,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,Lf,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,Pf,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,Df,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,Bf,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,Rf,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,Ff,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,Of,e)},writeBytesField:function(i,e){this.writeTag(i,Vt.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Vt.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Vt.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Vt.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Vt.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Vt.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Vt.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Vt.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Vt.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Vt.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,Boolean(e))}};class Gc{constructor(e,{pixelRatio:r,version:s,stretchX:c,stretchY:h,content:d}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=c,this.stretchY=h,this.content=d,this.version=s}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Vh{constructor(e,r){const s={},c={};this.haveRenderCallbacks=[];const h=[];this.addImages(e,s,h),this.addImages(r,c,h);const{w:d,h:m}=Uh(h),g=new hr({width:d||1,height:m||1});for(const x in e){const w=e[x],E=s[x].paddedRect;hr.copy(w.data,g,{x:0,y:0},{x:E.x+1,y:E.y+1},w.data)}for(const x in r){const w=r[x],E=c[x].paddedRect,C=E.x+1,z=E.y+1,P=w.data.width,$=w.data.height;hr.copy(w.data,g,{x:0,y:0},{x:C,y:z},w.data),hr.copy(w.data,g,{x:0,y:$-1},{x:C,y:z-1},{width:P,height:1}),hr.copy(w.data,g,{x:0,y:0},{x:C,y:z+$},{width:P,height:1}),hr.copy(w.data,g,{x:P-1,y:0},{x:C-1,y:z},{width:1,height:$}),hr.copy(w.data,g,{x:0,y:0},{x:C+P,y:z},{width:1,height:$})}this.image=g,this.iconPositions=s,this.patternPositions=c}addImages(e,r,s){for(const c in e){const h=e[c],d={x:0,y:0,w:h.data.width+2,h:h.data.height+2};s.push(d),r[c]=new Gc(d,h),h.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),r),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),r)}patchUpdatedImage(e,r,s){if(!e||!r||e.version===r.version)return;e.version=r.version;const[c,h]=e.tl;s.update(r.data,void 0,{x:c,y:h})}}Ue("ImagePosition",Gc),Ue("ImageAtlas",Vh),a.WritingMode=void 0,(os=a.WritingMode||(a.WritingMode={}))[os.none=0]="none",os[os.horizontal=1]="horizontal",os[os.vertical=2]="vertical",os[os.horizontalOnly=3]="horizontalOnly";const Ll=-17;class Sa{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const s=new Sa;return s.scale=e||1,s.fontStack=r,s}static forImage(e){const r=new Sa;return r.imageName=e,r}}class Io{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const s=new Io;for(let c=0;c<e.sections.length;c++){const h=e.sections[c];h.image?s.addImageSection(h):s.addTextSection(h,r)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let s=0;s<e.length;s++){const c=e.charCodeAt(s+1)||null,h=e.charCodeAt(s-1)||null;r+=c&&fl(c)&&!Ea[e[s+1]]||h&&fl(h)&&!Ea[e[s-1]]||!Ea[e[s]]?e[s]:Ea[e[s]]}return r}(this.text)}trim(){let e=0;for(let s=0;s<this.text.length&&Rl[this.text.charCodeAt(s)];s++)e++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&Rl[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const s=new Io;return s.text=this.text.substring(e,r),s.sectionIndex=this.sectionIndex.slice(e,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(Sa.forText(e.scale,e.fontStack||r));const s=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(s)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void Ke("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(Sa.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Ke("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Bl(i,e,r,s,c,h,d,m,g,x,w,E,C,z,P,$){const N=Io.fromFeature(i,c);let ie;E===a.WritingMode.vertical&&N.verticalizePunctuation();const{processBidirectionalText:le,processStyledBidirectionalText:ee}=Qi;if(le&&N.sections.length===1){ie=[];const ye=le(N.toString(),Zc(N,x,h,e,s,z,P));for(const Oe of ye){const Ne=new Io;Ne.text=Oe,Ne.sections=N.sections;for(let De=0;De<Oe.length;De++)Ne.sectionIndex.push(0);ie.push(Ne)}}else if(ee){ie=[];const ye=ee(N.text,N.sectionIndex,Zc(N,x,h,e,s,z,P));for(const Oe of ye){const Ne=new Io;Ne.text=Oe[0],Ne.sectionIndex=Oe[1],Ne.sections=N.sections,ie.push(Ne)}}else ie=function(ye,Oe){const Ne=[],De=ye.text;let Ae=0;for(const Ee of Oe)Ne.push(ye.substring(Ae,Ee)),Ae=Ee;return Ae<De.length&&Ne.push(ye.substring(Ae,De.length)),Ne}(N,Zc(N,x,h,e,s,z,P));const se=[],xe={positionedLines:se,text:N.toString(),top:w[1],bottom:w[1],left:w[0],right:w[0],writingMode:E,iconsInText:!1,verticalizable:!1};return function(ye,Oe,Ne,De,Ae,Ee,Le,Me,we,We,Ge,pt){let qt=0,Ht=Ll,li=0,dr=0;const Ti=Me==="right"?1:Me==="left"?0:.5;let ri=0;for(const ni of Ae){ni.trim();const Si=ni.getMaxScale(),ki=(Si-1)*xi,Ri={positionedGlyphs:[],lineOffset:0};ye.positionedLines[ri]=Ri;const Zi=Ri.positionedGlyphs;let ji=0;if(!ni.length()){Ht+=Ee,++ri;continue}for(let mi=0;mi<ni.length();mi++){const mt=ni.getSection(mi),ir=ni.getSectionIndex(mi),Ii=ni.getCharCode(mi);let Mi=0,wr=null,Br=null,Rr=null,An=xi;const Tr=!(we===a.WritingMode.horizontal||!Ge&&!na(Ii)||Ge&&(Rl[Ii]||(fi=Ii,Pe.Arabic(fi)||Pe["Arabic Supplement"](fi)||Pe["Arabic Extended-A"](fi)||Pe["Arabic Presentation Forms-A"](fi)||Pe["Arabic Presentation Forms-B"](fi))));if(mt.imageName){const fr=De[mt.imageName];if(!fr)continue;Rr=mt.imageName,ye.iconsInText=ye.iconsInText||!0,Br=fr.paddedRect;const Xi=fr.displaySize;mt.scale=mt.scale*xi/pt,wr={width:Xi[0],height:Xi[1],left:1,top:-3,advance:Tr?Xi[1]:Xi[0]},Mi=ki+(xi-Xi[1]*mt.scale),An=wr.advance;const Cn=Tr?Xi[0]*mt.scale-xi*Si:Xi[1]*mt.scale-xi*Si;Cn>0&&Cn>ji&&(ji=Cn)}else{const fr=Ne[mt.fontStack],Xi=fr&&fr[Ii];if(Xi&&Xi.rect)Br=Xi.rect,wr=Xi.metrics;else{const Cn=Oe[mt.fontStack],Ca=Cn&&Cn[Ii];if(!Ca)continue;wr=Ca.metrics}Mi=(Si-mt.scale)*xi}Tr?(ye.verticalizable=!0,Zi.push({glyph:Ii,imageName:Rr,x:qt,y:Ht+Mi,vertical:Tr,scale:mt.scale,fontStack:mt.fontStack,sectionIndex:ir,metrics:wr,rect:Br}),qt+=An*mt.scale+We):(Zi.push({glyph:Ii,imageName:Rr,x:qt,y:Ht+Mi,vertical:Tr,scale:mt.scale,fontStack:mt.fontStack,sectionIndex:ir,metrics:wr,rect:Br}),qt+=wr.advance*mt.scale+We)}Zi.length!==0&&(li=Math.max(qt-We,li),Gf(Zi,0,Zi.length-1,Ti,ji)),qt=0;const Yt=Ee*Si+ji;Ri.lineOffset=Math.max(ji,ki),Ht+=Yt,dr=Math.max(Yt,dr),++ri}var fi;const Ei=Ht-Ll,{horizontalAlign:Ci,verticalAlign:Gi}=jc(Le);(function(ni,Si,ki,Ri,Zi,ji,Yt,mi,mt){const ir=(Si-ki)*Zi;let Ii=0;Ii=ji!==Yt?-mi*Ri-Ll:(-Ri*mt+.5)*Yt;for(const Mi of ni)for(const wr of Mi.positionedGlyphs)wr.x+=ir,wr.y+=Ii})(ye.positionedLines,Ti,Ci,Gi,li,dr,Ee,Ei,Ae.length),ye.top+=-Gi*Ei,ye.bottom=ye.top+Ei,ye.left+=-Ci*li,ye.right=ye.left+li}(xe,e,r,s,ie,d,m,g,E,x,C,$),!function(ye){for(const Oe of ye)if(Oe.positionedGlyphs.length!==0)return!1;return!0}(se)&&xe}const Rl={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},$f={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Nh(i,e,r,s,c,h){if(e.imageName){const d=s[e.imageName];return d?d.displaySize[0]*e.scale*xi/h+c:0}{const d=r[e.fontStack],m=d&&d[i];return m?m.metrics.advance*e.scale+c:0}}function $h(i,e,r,s){const c=Math.pow(i-e,2);return s?i<e?c/2:2*c:c+Math.abs(r)*r}function qf(i,e,r){let s=0;return i===10&&(s-=1e4),r&&(s+=150),i!==40&&i!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function qh(i,e,r,s,c,h){let d=null,m=$h(e,r,c,h);for(const g of s){const x=$h(e-g.x,r,c,h)+g.badness;x<=m&&(d=g,m=x)}return{index:i,x:e,priorBreak:d,badness:m}}function Gh(i){return i?Gh(i.priorBreak).concat(i.index):[]}function Zc(i,e,r,s,c,h,d){if(h!=="point")return[];if(!i)return[];const m=[],g=function(C,z,P,$,N,ie){let le=0;for(let ee=0;ee<C.length();ee++){const se=C.getSection(ee);le+=Nh(C.getCharCode(ee),se,$,N,z,ie)}return le/Math.max(1,Math.ceil(le/P))}(i,e,r,s,c,d),x=i.text.indexOf("\u200B")>=0;let w=0;for(let C=0;C<i.length();C++){const z=i.getSection(C),P=i.getCharCode(C);if(Rl[P]||(w+=Nh(P,z,s,c,e,d)),C<i.length()-1){const $=!((E=P)<11904||!(Pe["Bopomofo Extended"](E)||Pe.Bopomofo(E)||Pe["CJK Compatibility Forms"](E)||Pe["CJK Compatibility Ideographs"](E)||Pe["CJK Compatibility"](E)||Pe["CJK Radicals Supplement"](E)||Pe["CJK Strokes"](E)||Pe["CJK Symbols and Punctuation"](E)||Pe["CJK Unified Ideographs Extension A"](E)||Pe["CJK Unified Ideographs"](E)||Pe["Enclosed CJK Letters and Months"](E)||Pe["Halfwidth and Fullwidth Forms"](E)||Pe.Hiragana(E)||Pe["Ideographic Description Characters"](E)||Pe["Kangxi Radicals"](E)||Pe["Katakana Phonetic Extensions"](E)||Pe.Katakana(E)||Pe["Vertical Forms"](E)||Pe["Yi Radicals"](E)||Pe["Yi Syllables"](E)));($f[P]||$||z.imageName)&&m.push(qh(C+1,w,g,m,qf(P,i.getCharCode(C+1),$&&x),!1))}}var E;return Gh(qh(i.length(),w,g,m,0,!0))}function jc(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Gf(i,e,r,s,c){if(!s&&!c)return;const h=i[r],d=(i[r].x+h.metrics.advance*h.scale)*s;for(let m=e;m<=r;m++)i[m].x-=d,i[m].y+=c}function Zf(i,e,r){const{horizontalAlign:s,verticalAlign:c}=jc(r),h=e[0]-i.displaySize[0]*s,d=e[1]-i.displaySize[1]*c;return{image:i,top:d,bottom:d+i.displaySize[1],left:h,right:h+i.displaySize[0]}}function Zh(i,e,r,s,c,h){const d=i.image;let m;if(d.content){const N=d.content,ie=d.pixelRatio||1;m=[N[0]/ie,N[1]/ie,d.displaySize[0]-N[2]/ie,d.displaySize[1]-N[3]/ie]}const g=e.left*h,x=e.right*h;let w,E,C,z;r==="width"||r==="both"?(z=c[0]+g-s[3],E=c[0]+x+s[1]):(z=c[0]+(g+x-d.displaySize[0])/2,E=z+d.displaySize[0]);const P=e.top*h,$=e.bottom*h;return r==="height"||r==="both"?(w=c[1]+P-s[0],C=c[1]+$+s[2]):(w=c[1]+(P+$-d.displaySize[1])/2,C=w+d.displaySize[1]),{image:d,top:w,right:E,bottom:C,left:z,collisionPadding:m}}const In=128;function jh(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Xt(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:c}=r;let h=0;for(;h<s.length&&s[h]<=i;)h++;h=Math.max(0,h-1);let d=h;for(;d<s.length&&s[d]<i+1;)d++;d=Math.min(s.length-1,d);const m=s[h],g=s[d];return r.kind==="composite"?{kind:"composite",minZoom:m,maxZoom:g,interpolationType:c}:{kind:"camera",minZoom:m,maxZoom:g,minSize:r.evaluate(new Xt(m)),maxSize:r.evaluate(new Xt(g)),interpolationType:c}}}class as extends tt{constructor(e,r,s,c){super(e,r),this.angle=s,c!==void 0&&(this.segment=c)}clone(){return new as(this.x,this.y,this.angle,this.segment)}}function Xh(i,e,r,s,c){if(e.segment===void 0)return!0;let h=e,d=e.segment+1,m=0;for(;m>-r/2;){if(d--,d<0)return!1;m-=i[d].dist(h),h=i[d]}m+=i[d].dist(i[d+1]),d++;const g=[];let x=0;for(;m<r/2;){const w=i[d],E=i[d+1];if(!E)return!1;let C=i[d-1].angleTo(w)-w.angleTo(E);for(C=Math.abs((C+3*Math.PI)%(2*Math.PI)-Math.PI),g.push({distance:m,angleDelta:C}),x+=C;m-g[0].distance>s;)x-=g.shift().angleDelta;if(x>c)return!1;d++,m+=w.dist(E)}return!0}function Wh(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function Hh(i,e,r){return i?.6*e*r:0}function Kh(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function jf(i,e,r,s,c,h){const d=Hh(r,c,h),m=Kh(r,s)*h;let g=0;const x=Wh(i)/2;for(let w=0;w<i.length-1;w++){const E=i[w],C=i[w+1],z=E.dist(C);if(g+z>x){const P=(x-g)/z,$=Zt(E.x,C.x,P),N=Zt(E.y,C.y,P),ie=new as($,N,C.angleTo(E),w);return ie._round(),!d||Xh(i,ie,m,d,e)?ie:void 0}g+=z}}function Xf(i,e,r,s,c,h,d,m,g){const x=Hh(s,h,d),w=Kh(s,c),E=w*d,C=i[0].x===0||i[0].x===g||i[0].y===0||i[0].y===g;return e-E<e/4&&(e=E+e/4),Yh(i,C?e/2*m%e:(w/2+2*h)*d*m%e,e,x,r,E,C,!1,g)}function Yh(i,e,r,s,c,h,d,m,g){const x=h/2,w=Wh(i);let E=0,C=e-r,z=[];for(let P=0;P<i.length-1;P++){const $=i[P],N=i[P+1],ie=$.dist(N),le=N.angleTo($);for(;C+r<E+ie;){C+=r;const ee=(C-E)/ie,se=Zt($.x,N.x,ee),xe=Zt($.y,N.y,ee);if(se>=0&&se<g&&xe>=0&&xe<g&&C-x>=0&&C+x<=w){const ye=new as(se,xe,le,P);ye._round(),s&&!Xh(i,ye,h,s,c)||z.push(ye)}}E+=ie}return m||z.length||d||(z=Yh(i,E/2,r,s,c,h,d,!0,g)),z}function Jh(i,e,r,s,c){const h=[];for(let d=0;d<i.length;d++){const m=i[d];let g;for(let x=0;x<m.length-1;x++){let w=m[x],E=m[x+1];w.x<e&&E.x<e||(w.x<e?w=new tt(e,w.y+(e-w.x)/(E.x-w.x)*(E.y-w.y))._round():E.x<e&&(E=new tt(e,w.y+(e-w.x)/(E.x-w.x)*(E.y-w.y))._round()),w.y<r&&E.y<r||(w.y<r?w=new tt(w.x+(r-w.y)/(E.y-w.y)*(E.x-w.x),r)._round():E.y<r&&(E=new tt(w.x+(r-w.y)/(E.y-w.y)*(E.x-w.x),r)._round()),w.x>=s&&E.x>=s||(w.x>=s?w=new tt(s,w.y+(s-w.x)/(E.x-w.x)*(E.y-w.y))._round():E.x>=s&&(E=new tt(s,w.y+(s-w.x)/(E.x-w.x)*(E.y-w.y))._round()),w.y>=c&&E.y>=c||(w.y>=c?w=new tt(w.x+(c-w.y)/(E.y-w.y)*(E.x-w.x),c)._round():E.y>=c&&(E=new tt(w.x+(c-w.y)/(E.y-w.y)*(E.x-w.x),c)._round()),g&&w.equals(g[g.length-1])||(g=[w],h.push(g)),g.push(E)))))}}return h}function Qh(i,e,r,s){const c=[],h=i.image,d=h.pixelRatio,m=h.paddedRect.w-2,g=h.paddedRect.h-2,x=i.right-i.left,w=i.bottom-i.top,E=h.stretchX||[[0,m]],C=h.stretchY||[[0,g]],z=(Ee,Le)=>Ee+Le[1]-Le[0],P=E.reduce(z,0),$=C.reduce(z,0),N=m-P,ie=g-$;let le=0,ee=P,se=0,xe=$,ye=0,Oe=N,Ne=0,De=ie;if(h.content&&s){const Ee=h.content;le=Fl(E,0,Ee[0]),se=Fl(C,0,Ee[1]),ee=Fl(E,Ee[0],Ee[2]),xe=Fl(C,Ee[1],Ee[3]),ye=Ee[0]-le,Ne=Ee[1]-se,Oe=Ee[2]-Ee[0]-ee,De=Ee[3]-Ee[1]-xe}const Ae=(Ee,Le,Me,we)=>{const We=Ol(Ee.stretch-le,ee,x,i.left),Ge=Ul(Ee.fixed-ye,Oe,Ee.stretch,P),pt=Ol(Le.stretch-se,xe,w,i.top),qt=Ul(Le.fixed-Ne,De,Le.stretch,$),Ht=Ol(Me.stretch-le,ee,x,i.left),li=Ul(Me.fixed-ye,Oe,Me.stretch,P),dr=Ol(we.stretch-se,xe,w,i.top),Ti=Ul(we.fixed-Ne,De,we.stretch,$),ri=new tt(We,pt),fi=new tt(Ht,pt),Ei=new tt(Ht,dr),Ci=new tt(We,dr),Gi=new tt(Ge/d,qt/d),ni=new tt(li/d,Ti/d),Si=e*Math.PI/180;if(Si){const Zi=Math.sin(Si),ji=Math.cos(Si),Yt=[ji,-Zi,Zi,ji];ri._matMult(Yt),fi._matMult(Yt),Ci._matMult(Yt),Ei._matMult(Yt)}const ki=Ee.stretch+Ee.fixed,Ri=Le.stretch+Le.fixed;return{tl:ri,tr:fi,bl:Ci,br:Ei,tex:{x:h.paddedRect.x+1+ki,y:h.paddedRect.y+1+Ri,w:Me.stretch+Me.fixed-ki,h:we.stretch+we.fixed-Ri},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Gi,pixelOffsetBR:ni,minFontScaleX:Oe/d/x,minFontScaleY:De/d/w,isSDF:r}};if(s&&(h.stretchX||h.stretchY)){const Ee=ep(E,N,P),Le=ep(C,ie,$);for(let Me=0;Me<Ee.length-1;Me++){const we=Ee[Me],We=Ee[Me+1];for(let Ge=0;Ge<Le.length-1;Ge++)c.push(Ae(we,Le[Ge],We,Le[Ge+1]))}}else c.push(Ae({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:m+1},{fixed:0,stretch:g+1}));return c}function Fl(i,e,r){let s=0;for(const c of i)s+=Math.max(e,Math.min(r,c[1]))-Math.max(e,Math.min(r,c[0]));return s}function ep(i,e,r){const s=[{fixed:-1,stretch:0}];for(const[c,h]of i){const d=s[s.length-1];s.push({fixed:c-d.stretch,stretch:d.stretch}),s.push({fixed:c-d.stretch,stretch:d.stretch+(h-c)})}return s.push({fixed:e+1,stretch:r}),s}function Ol(i,e,r,s){return i/e*r+s}function Ul(i,e,r,s){return i-e*r/s}Ue("Anchor",as);class Vl{constructor(e,r,s,c,h,d,m,g,x,w){if(this.boxStartIndex=e.length,x){let E=d.top,C=d.bottom;const z=d.collisionPadding;z&&(E-=z[1],C+=z[3]);let P=C-E;P>0&&(P=Math.max(10,P),this.circleDiameter=P)}else{let E=d.top*m-g[0],C=d.bottom*m+g[2],z=d.left*m-g[3],P=d.right*m+g[1];const $=d.collisionPadding;if($&&(z-=$[0]*m,E-=$[1]*m,P+=$[2]*m,C+=$[3]*m),w){const N=new tt(z,E),ie=new tt(P,E),le=new tt(z,C),ee=new tt(P,C),se=w*Math.PI/180;N._rotate(se),ie._rotate(se),le._rotate(se),ee._rotate(se),z=Math.min(N.x,ie.x,le.x,ee.x),P=Math.max(N.x,ie.x,le.x,ee.x),E=Math.min(N.y,ie.y,le.y,ee.y),C=Math.max(N.y,ie.y,le.y,ee.y)}e.emplaceBack(r.x,r.y,z,E,P,C,s,c,h)}this.boxEndIndex=e.length}}class Wf{constructor(e=[],r=Hf){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:s}=this,c=r[e];for(;e>0;){const h=e-1>>1,d=r[h];if(s(c,d)>=0)break;r[e]=d,e=h}r[e]=c}_down(e){const{data:r,compare:s}=this,c=this.length>>1,h=r[e];for(;e<c;){let d=1+(e<<1),m=r[d];const g=d+1;if(g<this.length&&s(r[g],m)<0&&(d=g,m=r[g]),s(m,h)>=0)break;r[e]=m,e=d}r[e]=h}}function Hf(i,e){return i<e?-1:i>e?1:0}function Kf(i,e=1,r=!1){let s=1/0,c=1/0,h=-1/0,d=-1/0;const m=i[0];for(let z=0;z<m.length;z++){const P=m[z];(!z||P.x<s)&&(s=P.x),(!z||P.y<c)&&(c=P.y),(!z||P.x>h)&&(h=P.x),(!z||P.y>d)&&(d=P.y)}const g=Math.min(h-s,d-c);let x=g/2;const w=new Wf([],Yf);if(g===0)return new tt(s,c);for(let z=s;z<h;z+=g)for(let P=c;P<d;P+=g)w.push(new Ao(z+x,P+x,x,i));let E=function(z){let P=0,$=0,N=0;const ie=z[0];for(let le=0,ee=ie.length,se=ee-1;le<ee;se=le++){const xe=ie[le],ye=ie[se],Oe=xe.x*ye.y-ye.x*xe.y;$+=(xe.x+ye.x)*Oe,N+=(xe.y+ye.y)*Oe,P+=3*Oe}return new Ao($/P,N/P,0,z)}(i),C=w.length;for(;w.length;){const z=w.pop();(z.d>E.d||!E.d)&&(E=z,r&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,C)),z.max-E.d<=e||(x=z.h/2,w.push(new Ao(z.p.x-x,z.p.y-x,x,i)),w.push(new Ao(z.p.x+x,z.p.y-x,x,i)),w.push(new Ao(z.p.x-x,z.p.y+x,x,i)),w.push(new Ao(z.p.x+x,z.p.y+x,x,i)),C+=4)}return r&&(console.log(`num probes: ${C}`),console.log(`best distance: ${E.d}`)),E.p}function Yf(i,e){return e.max-i.max}function Ao(i,e,r,s){this.p=new tt(i,e),this.h=r,this.d=function(c,h){let d=!1,m=1/0;for(let g=0;g<h.length;g++){const x=h[g];for(let w=0,E=x.length,C=E-1;w<E;C=w++){const z=x[w],P=x[C];z.y>c.y!=P.y>c.y&&c.x<(P.x-z.x)*(c.y-z.y)/(P.y-z.y)+z.x&&(d=!d),m=Math.min(m,lh(c,z,P))}}return(d?1:-1)*Math.sqrt(m)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}const Xc=Number.POSITIVE_INFINITY;function tp(i,e){return e[1]!==Xc?function(r,s,c){let h=0,d=0;switch(s=Math.abs(s),c=Math.abs(c),r){case"top-right":case"top-left":case"top":d=c-7;break;case"bottom-right":case"bottom-left":case"bottom":d=7-c}switch(r){case"top-right":case"bottom-right":case"right":h=-s;break;case"top-left":case"bottom-left":case"left":h=s}return[h,d]}(i,e[0],e[1]):function(r,s){let c=0,h=0;s<0&&(s=0);const d=s/Math.sqrt(2);switch(r){case"top-right":case"top-left":h=d-7;break;case"bottom-right":case"bottom-left":h=7-d;break;case"bottom":h=7-s;break;case"top":h=s-7}switch(r){case"top-right":case"bottom-right":c=-d;break;case"top-left":case"bottom-left":c=d;break;case"left":c=s;break;case"right":c=-s}return[c,h]}(i,e[0])}function Wc(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Jf(i,e,r,s,c,h,d,m,g,x,w){let E=h.textMaxSize.evaluate(e,{});E===void 0&&(E=d);const C=i.layers[0].layout,z=C.get("icon-offset").evaluate(e,{},w),P=rp(r.horizontal),$=d/24,N=i.tilePixelRatio*$,ie=i.tilePixelRatio*E/24,le=i.tilePixelRatio*m,ee=i.tilePixelRatio*C.get("symbol-spacing"),se=C.get("text-padding")*i.tilePixelRatio,xe=function(we,We,Ge,pt=1){const qt=we.get("icon-padding").evaluate(We,{},Ge),Ht=qt&&qt.values;return[Ht[0]*pt,Ht[1]*pt,Ht[2]*pt,Ht[3]*pt]}(C,e,w,i.tilePixelRatio),ye=C.get("text-max-angle")/180*Math.PI,Oe=C.get("text-rotation-alignment")!=="viewport"&&C.get("symbol-placement")!=="point",Ne=C.get("icon-rotation-alignment")==="map"&&C.get("symbol-placement")!=="point",De=C.get("symbol-placement"),Ae=ee/2,Ee=C.get("icon-text-fit");let Le;s&&Ee!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(Le=Zh(s,r.vertical,Ee,C.get("icon-text-fit-padding"),z,$)),P&&(s=Zh(s,P,Ee,C.get("icon-text-fit-padding"),z,$)));const Me=(we,We)=>{We.x<0||We.x>=ai||We.y<0||We.y>=ai||function(Ge,pt,qt,Ht,li,dr,Ti,ri,fi,Ei,Ci,Gi,ni,Si,ki,Ri,Zi,ji,Yt,mi,mt,ir,Ii,Mi,wr){const Br=Ge.addToLineVertexArray(pt,qt);let Rr,An,Tr,fr,Xi=0,Cn=0,Ca=0,xp=0,nu=-1,su=-1;const kn={};let vp=di.exports(""),ou=0,au=0;if(ri._unevaluatedLayout.getValue("text-radial-offset")===void 0?[ou,au]=ri.layout.get("text-offset").evaluate(mt,{},Mi).map(Wi=>Wi*xi):(ou=ri.layout.get("text-radial-offset").evaluate(mt,{},Mi)*xi,au=Xc),Ge.allowVerticalPlacement&&Ht.vertical){const Wi=ri.layout.get("text-rotate").evaluate(mt,{},Mi)+90;Tr=new Vl(fi,pt,Ei,Ci,Gi,Ht.vertical,ni,Si,ki,Wi),Ti&&(fr=new Vl(fi,pt,Ei,Ci,Gi,Ti,Zi,ji,ki,Wi))}if(li){const Wi=ri.layout.get("icon-rotate").evaluate(mt,{}),on=ri.layout.get("icon-text-fit")!=="none",ka=Qh(li,Wi,Ii,on),Ma=Ti?Qh(Ti,Wi,Ii,on):void 0;An=new Vl(fi,pt,Ei,Ci,Gi,li,Zi,ji,!1,Wi),Xi=4*ka.length;const Tp=Ge.iconSizeData;let Gs=null;Tp.kind==="source"?(Gs=[In*ri.layout.get("icon-size").evaluate(mt,{})],Gs[0]>ls&&Ke(`${Ge.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Tp.kind==="composite"&&(Gs=[In*ir.compositeIconSizes[0].evaluate(mt,{},Mi),In*ir.compositeIconSizes[1].evaluate(mt,{},Mi)],(Gs[0]>ls||Gs[1]>ls)&&Ke(`${Ge.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ge.addSymbols(Ge.icon,ka,Gs,mi,Yt,mt,a.WritingMode.none,pt,Br.lineStartIndex,Br.lineLength,-1,Mi),nu=Ge.icon.placedSymbolArray.length-1,Ma&&(Cn=4*Ma.length,Ge.addSymbols(Ge.icon,Ma,Gs,mi,Yt,mt,a.WritingMode.vertical,pt,Br.lineStartIndex,Br.lineLength,-1,Mi),su=Ge.icon.placedSymbolArray.length-1)}const bp=Object.keys(Ht.horizontal);for(const Wi of bp){const on=Ht.horizontal[Wi];if(!Rr){vp=di.exports(on.text);const Ma=ri.layout.get("text-rotate").evaluate(mt,{},Mi);Rr=new Vl(fi,pt,Ei,Ci,Gi,on,ni,Si,ki,Ma)}const ka=on.positionedLines.length===1;if(Ca+=ip(Ge,pt,on,dr,ri,ki,mt,Ri,Br,Ht.vertical?a.WritingMode.horizontal:a.WritingMode.horizontalOnly,ka?bp:[Wi],kn,nu,ir,Mi),ka)break}Ht.vertical&&(xp+=ip(Ge,pt,Ht.vertical,dr,ri,ki,mt,Ri,Br,a.WritingMode.vertical,["vertical"],kn,su,ir,Mi));const hm=Rr?Rr.boxStartIndex:Ge.collisionBoxArray.length,pm=Rr?Rr.boxEndIndex:Ge.collisionBoxArray.length,dm=Tr?Tr.boxStartIndex:Ge.collisionBoxArray.length,fm=Tr?Tr.boxEndIndex:Ge.collisionBoxArray.length,mm=An?An.boxStartIndex:Ge.collisionBoxArray.length,gm=An?An.boxEndIndex:Ge.collisionBoxArray.length,_m=fr?fr.boxStartIndex:Ge.collisionBoxArray.length,ym=fr?fr.boxEndIndex:Ge.collisionBoxArray.length;let Fr=-1;const Zl=(Wi,on)=>Wi&&Wi.circleDiameter?Math.max(Wi.circleDiameter,on):on;Fr=Zl(Rr,Fr),Fr=Zl(Tr,Fr),Fr=Zl(An,Fr),Fr=Zl(fr,Fr);const wp=Fr>-1?1:0;wp&&(Fr*=wr/xi),Ge.glyphOffsetArray.length>=Co.MAX_GLYPHS&&Ke("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),mt.sortKey!==void 0&&Ge.addToSortKeyRanges(Ge.symbolInstances.length,mt.sortKey),Ge.symbolInstances.emplaceBack(pt.x,pt.y,kn.right>=0?kn.right:-1,kn.center>=0?kn.center:-1,kn.left>=0?kn.left:-1,kn.vertical||-1,nu,su,vp,hm,pm,dm,fm,mm,gm,_m,ym,Ei,Ca,xp,Xi,Cn,wp,0,ni,ou,au,Fr)}(i,We,we,r,s,c,Le,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,N,[se,se,se,se],Oe,g,le,xe,Ne,z,e,h,x,w,d)};if(De==="line")for(const we of Jh(e.geometry,0,0,ai,ai)){const We=Xf(we,ee,ye,r.vertical||P,s,24,ie,i.overscaling,ai);for(const Ge of We){const pt=P;pt&&Qf(i,pt.text,Ae,Ge)||Me(we,Ge)}}else if(De==="line-center"){for(const we of e.geometry)if(we.length>1){const We=jf(we,ye,r.vertical||P,s,24,ie);We&&Me(we,We)}}else if(e.type==="Polygon")for(const we of Bc(e.geometry,0)){const We=Kf(we,16);Me(we[0],new as(We.x,We.y,0))}else if(e.type==="LineString")for(const we of e.geometry)Me(we,new as(we[0].x,we[0].y,0));else if(e.type==="Point")for(const we of e.geometry)for(const We of we)Me([We],new as(We.x,We.y,0))}const ls=32640;function ip(i,e,r,s,c,h,d,m,g,x,w,E,C,z,P){const $=function(le,ee,se,xe,ye,Oe,Ne,De){const Ae=xe.layout.get("text-rotate").evaluate(Oe,{})*Math.PI/180,Ee=[];for(const Le of ee.positionedLines)for(const Me of Le.positionedGlyphs){if(!Me.rect)continue;const we=Me.rect||{};let We=4,Ge=!0,pt=1,qt=0;const Ht=(ye||De)&&Me.vertical,li=Me.metrics.advance*Me.scale/2;if(De&&ee.verticalizable){const Yt=(Me.scale-1)*xi,mi=(xi-Me.metrics.width*Me.scale)/2;qt=Le.lineOffset/2-(Me.imageName?-mi:Yt)}if(Me.imageName){const Yt=Ne[Me.imageName];Ge=Yt.sdf,pt=Yt.pixelRatio,We=1/pt}const dr=ye?[Me.x+li,Me.y]:[0,0];let Ti=ye?[0,0]:[Me.x+li+se[0],Me.y+se[1]-qt],ri=[0,0];Ht&&(ri=Ti,Ti=[0,0]);const fi=(Me.metrics.left-We)*Me.scale-li+Ti[0],Ei=(-Me.metrics.top-We)*Me.scale+Ti[1],Ci=fi+we.w*Me.scale/pt,Gi=Ei+we.h*Me.scale/pt,ni=new tt(fi,Ei),Si=new tt(Ci,Ei),ki=new tt(fi,Gi),Ri=new tt(Ci,Gi);if(Ht){const Yt=new tt(-li,li-Ll),mi=-Math.PI/2,mt=12-li,ir=new tt(22-mt,-(Me.imageName?mt:0)),Ii=new tt(...ri);ni._rotateAround(mi,Yt)._add(ir)._add(Ii),Si._rotateAround(mi,Yt)._add(ir)._add(Ii),ki._rotateAround(mi,Yt)._add(ir)._add(Ii),Ri._rotateAround(mi,Yt)._add(ir)._add(Ii)}if(Ae){const Yt=Math.sin(Ae),mi=Math.cos(Ae),mt=[mi,-Yt,Yt,mi];ni._matMult(mt),Si._matMult(mt),ki._matMult(mt),Ri._matMult(mt)}const Zi=new tt(0,0),ji=new tt(0,0);Ee.push({tl:ni,tr:Si,bl:ki,br:Ri,tex:we,writingMode:ee.writingMode,glyphOffset:dr,sectionIndex:Me.sectionIndex,isSDF:Ge,pixelOffsetTL:Zi,pixelOffsetBR:ji,minFontScaleX:0,minFontScaleY:0})}return Ee}(0,r,m,c,h,d,s,i.allowVerticalPlacement),N=i.textSizeData;let ie=null;N.kind==="source"?(ie=[In*c.layout.get("text-size").evaluate(d,{})],ie[0]>ls&&Ke(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):N.kind==="composite"&&(ie=[In*z.compositeTextSizes[0].evaluate(d,{},P),In*z.compositeTextSizes[1].evaluate(d,{},P)],(ie[0]>ls||ie[1]>ls)&&Ke(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,$,ie,m,h,d,x,e,g.lineStartIndex,g.lineLength,C,P);for(const le of w)E[le]=i.text.placedSymbolArray.length-1;return 4*$.length}function rp(i){for(const e in i)return i[e];return null}function Qf(i,e,r,s){const c=i.compareText;if(e in c){const h=c[e];for(let d=h.length-1;d>=0;d--)if(s.dist(h[d])<r)return!0}else c[e]=[];return c[e].push(s),!1}const em=ss.VectorTileFeature.types,tm=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Nl(i,e,r,s,c,h,d,m,g,x,w,E,C){const z=m?Math.min(ls,Math.round(m[0])):0,P=m?Math.min(ls,Math.round(m[1])):0;i.emplaceBack(e,r,Math.round(32*s),Math.round(32*c),h,d,(z<<1)+(g?1:0),P,16*x,16*w,256*E,256*C)}function Hc(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function im(i){for(const e of i.sections)if(gl(e.text))return!0;return!1}class Kc{constructor(e){this.layoutVertexArray=new vr,this.indexArray=new Di,this.programConfigurations=e,this.segments=new ft,this.dynamicLayoutVertexArray=new ur,this.opacityVertexArray=new br,this.placedSymbolArray=new be}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,s,c){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Sf.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,If.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,tm,!0),this.opacityVertexBuffer.itemSize=1),(s||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ue("SymbolBuffers",Kc);class Yc{constructor(e,r,s){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new s,this.segments=new ft,this.collisionVertexArray=new er}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Af.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ue("CollisionBuffers",Yc);class Co{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(d=>d.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=kc([]),this.placementViewportMatrix=kc([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=jh(this.zoom,r["text-size"]),this.iconSizeData=jh(this.zoom,r["icon-size"]);const s=this.layers[0].layout,c=s.get("symbol-sort-key"),h=s.get("symbol-z-order");this.canOverlap=Qc(s,"text-overlap","text-allow-overlap")!=="never"||Qc(s,"icon-overlap","icon-allow-overlap")!=="never"||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&!c.isConstant(),this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(d=>a.WritingMode[d])),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.sourceID=e.sourceID}createArrays(){this.text=new Kc(new Us(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Kc(new Us(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Ie,this.lineVertexArray=new Fe,this.symbolInstances=new Re}calculateGlyphDependencies(e,r,s,c,h){for(let d=0;d<e.length;d++)if(r[e.charCodeAt(d)]=!0,(s||c)&&h){const m=Ea[e.charAt(d)];m&&(r[m.charCodeAt(0)]=!0)}}populate(e,r,s){const c=this.layers[0],h=c.layout,d=h.get("text-font"),m=h.get("text-field"),g=h.get("icon-image"),x=(m.value.kind!=="constant"||m.value.value instanceof W&&!m.value.value.isEmpty()||m.value.value.toString().length>0)&&(d.value.kind!=="constant"||d.value.value.length>0),w=g.value.kind!=="constant"||!!g.value.value||Object.keys(g.parameters).length>0,E=h.get("symbol-sort-key");if(this.features=[],!x&&!w)return;const C=r.iconDependencies,z=r.glyphDependencies,P=r.availableImages,$=new Xt(this.zoom);for(const{feature:N,id:ie,index:le,sourceLayerIndex:ee}of e){const se=c._featureFilter.needGeometry,xe=Ns(N,se);if(!c._featureFilter.filter($,xe,s))continue;let ye,Oe;if(se||(xe.geometry=Vs(N)),x){const De=c.getValueAndResolveTokens("text-field",xe,s,P),Ae=W.factory(De);im(Ae)&&(this.hasRTLText=!0),(!this.hasRTLText||Rs()==="unavailable"||this.hasRTLText&&Qi.isParsed())&&(ye=kf(Ae,c,xe))}if(w){const De=c.getValueAndResolveTokens("icon-image",xe,s,P);Oe=De instanceof J?De:J.fromString(De)}if(!ye&&!Oe)continue;const Ne=this.sortFeaturesByKey?E.evaluate(xe,{},s):void 0;if(this.features.push({id:ie,text:ye,icon:Oe,index:le,sourceLayerIndex:ee,geometry:xe.geometry,properties:N.properties,type:em[N.type],sortKey:Ne}),Oe&&(C[Oe.name]=!0),ye){const De=d.evaluate(xe,{},s).join(","),Ae=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(a.WritingMode.vertical)>=0;for(const Ee of ye.sections)if(Ee.image)C[Ee.image.name]=!0;else{const Le=go(ye.toString()),Me=Ee.fontStack||De,we=z[Me]=z[Me]||{};this.calculateGlyphDependencies(Ee.text,we,Ae,this.allowVerticalPlacement,Le)}}}h.get("symbol-placement")==="line"&&(this.features=function(N){const ie={},le={},ee=[];let se=0;function xe(De){ee.push(N[De]),se++}function ye(De,Ae,Ee){const Le=le[De];return delete le[De],le[Ae]=Le,ee[Le].geometry[0].pop(),ee[Le].geometry[0]=ee[Le].geometry[0].concat(Ee[0]),Le}function Oe(De,Ae,Ee){const Le=ie[Ae];return delete ie[Ae],ie[De]=Le,ee[Le].geometry[0].shift(),ee[Le].geometry[0]=Ee[0].concat(ee[Le].geometry[0]),Le}function Ne(De,Ae,Ee){const Le=Ee?Ae[0][Ae[0].length-1]:Ae[0][0];return`${De}:${Le.x}:${Le.y}`}for(let De=0;De<N.length;De++){const Ae=N[De],Ee=Ae.geometry,Le=Ae.text?Ae.text.toString():null;if(!Le){xe(De);continue}const Me=Ne(Le,Ee),we=Ne(Le,Ee,!0);if(Me in le&&we in ie&&le[Me]!==ie[we]){const We=Oe(Me,we,Ee),Ge=ye(Me,we,ee[We].geometry);delete ie[Me],delete le[we],le[Ne(Le,ee[Ge].geometry,!0)]=Ge,ee[We].geometry=null}else Me in le?ye(Me,we,Ee):we in ie?Oe(Me,we,Ee):(xe(De),ie[Me]=se-1,le[we]=se-1)}return ee.filter(De=>De.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((N,ie)=>N.sortKey-ie.sortKey)}update(e,r,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,s),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,s))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const s=this.lineVertexArray.length;if(e.segment!==void 0){let c=e.dist(r[e.segment+1]),h=e.dist(r[e.segment]);const d={};for(let m=e.segment+1;m<r.length;m++)d[m]={x:r[m].x,y:r[m].y,tileUnitDistanceFromAnchor:c},m<r.length-1&&(c+=r[m+1].dist(r[m]));for(let m=e.segment||0;m>=0;m--)d[m]={x:r[m].x,y:r[m].y,tileUnitDistanceFromAnchor:h},m>0&&(h+=r[m-1].dist(r[m]));for(let m=0;m<r.length;m++){const g=d[m];this.lineVertexArray.emplaceBack(g.x,g.y,g.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,r,s,c,h,d,m,g,x,w,E,C){const z=e.indexArray,P=e.layoutVertexArray,$=e.segments.prepareSegment(4*r.length,P,z,this.canOverlap?d.sortKey:void 0),N=this.glyphOffsetArray.length,ie=$.vertexLength,le=this.allowVerticalPlacement&&m===a.WritingMode.vertical?Math.PI/2:0,ee=d.text&&d.text.sections;for(let se=0;se<r.length;se++){const{tl:xe,tr:ye,bl:Oe,br:Ne,tex:De,pixelOffsetTL:Ae,pixelOffsetBR:Ee,minFontScaleX:Le,minFontScaleY:Me,glyphOffset:we,isSDF:We,sectionIndex:Ge}=r[se],pt=$.vertexLength,qt=we[1];Nl(P,g.x,g.y,xe.x,qt+xe.y,De.x,De.y,s,We,Ae.x,Ae.y,Le,Me),Nl(P,g.x,g.y,ye.x,qt+ye.y,De.x+De.w,De.y,s,We,Ee.x,Ae.y,Le,Me),Nl(P,g.x,g.y,Oe.x,qt+Oe.y,De.x,De.y+De.h,s,We,Ae.x,Ee.y,Le,Me),Nl(P,g.x,g.y,Ne.x,qt+Ne.y,De.x+De.w,De.y+De.h,s,We,Ee.x,Ee.y,Le,Me),Hc(e.dynamicLayoutVertexArray,g,le),z.emplaceBack(pt,pt+1,pt+2),z.emplaceBack(pt+1,pt+2,pt+3),$.vertexLength+=4,$.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(we[0]),se!==r.length-1&&Ge===r[se+1].sectionIndex||e.programConfigurations.populatePaintArrays(P.length,d,d.index,{},C,ee&&ee[Ge])}e.placedSymbolArray.emplaceBack(g.x,g.y,N,this.glyphOffsetArray.length-N,ie,x,w,g.segment,s?s[0]:0,s?s[1]:0,c[0],c[1],m,0,!1,0,E)}_addCollisionDebugVertex(e,r,s,c,h,d){return r.emplaceBack(0,0),e.emplaceBack(s.x,s.y,c,h,Math.round(d.x),Math.round(d.y))}addCollisionDebugVertices(e,r,s,c,h,d,m){const g=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),x=g.vertexLength,w=h.layoutVertexArray,E=h.collisionVertexArray,C=m.anchorX,z=m.anchorY;this._addCollisionDebugVertex(w,E,d,C,z,new tt(e,r)),this._addCollisionDebugVertex(w,E,d,C,z,new tt(s,r)),this._addCollisionDebugVertex(w,E,d,C,z,new tt(s,c)),this._addCollisionDebugVertex(w,E,d,C,z,new tt(e,c)),g.vertexLength+=4;const P=h.indexArray;P.emplaceBack(x,x+1),P.emplaceBack(x+1,x+2),P.emplaceBack(x+2,x+3),P.emplaceBack(x+3,x),g.primitiveLength+=4}addDebugCollisionBoxes(e,r,s,c){for(let h=e;h<r;h++){const d=this.collisionBoxArray.get(h);this.addCollisionDebugVertices(d.x1,d.y1,d.x2,d.y2,c?this.textCollisionBox:this.iconCollisionBox,d.anchorPoint,s)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Yc(nn,Ph.members,Dr),this.iconCollisionBox=new Yc(nn,Ph.members,Dr);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,s,c,h,d,m,g,x){const w={};for(let E=r;E<s;E++){const C=e.get(E);w.textBox={x1:C.x1,y1:C.y1,x2:C.x2,y2:C.y2,anchorPointX:C.anchorPointX,anchorPointY:C.anchorPointY},w.textFeatureIndex=C.featureIndex;break}for(let E=c;E<h;E++){const C=e.get(E);w.verticalTextBox={x1:C.x1,y1:C.y1,x2:C.x2,y2:C.y2,anchorPointX:C.anchorPointX,anchorPointY:C.anchorPointY},w.verticalTextFeatureIndex=C.featureIndex;break}for(let E=d;E<m;E++){const C=e.get(E);w.iconBox={x1:C.x1,y1:C.y1,x2:C.x2,y2:C.y2,anchorPointX:C.anchorPointX,anchorPointY:C.anchorPointY},w.iconFeatureIndex=C.featureIndex;break}for(let E=g;E<x;E++){const C=e.get(E);w.verticalIconBox={x1:C.x1,y1:C.y1,x2:C.x2,y2:C.y2,anchorPointX:C.anchorPointX,anchorPointY:C.anchorPointY},w.verticalIconFeatureIndex=C.featureIndex;break}return w}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const s=e.placedSymbolArray.get(r),c=s.vertexStartIndex+4*s.numGlyphs;for(let h=s.vertexStartIndex;h<c;h+=4)e.indexArray.emplaceBack(h,h+1,h+2),e.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),s=Math.cos(e),c=[],h=[],d=[];for(let m=0;m<this.symbolInstances.length;++m){d.push(m);const g=this.symbolInstances.get(m);c.push(0|Math.round(r*g.anchorX+s*g.anchorY)),h.push(g.featureIndex)}return d.sort((m,g)=>c[m]-c[g]||h[g]-h[m]),d}addToSortKeyRanges(e,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((c,h,d)=>{c>=0&&d.indexOf(c)===h&&this.addIndicesForPlacedSymbol(this.text,c)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ue("SymbolBucket",Co,{omit:["layers","collisionBoxArray","features","compareText"]}),Co.MAX_GLYPHS=65535,Co.addDynamicAttributes=Hc;const rm=new yi({"symbol-placement":new qe(_e.layout_symbol["symbol-placement"]),"symbol-spacing":new qe(_e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new qe(_e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Je(_e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new qe(_e.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new qe(_e.layout_symbol["icon-allow-overlap"]),"icon-overlap":new qe(_e.layout_symbol["icon-overlap"]),"icon-ignore-placement":new qe(_e.layout_symbol["icon-ignore-placement"]),"icon-optional":new qe(_e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new qe(_e.layout_symbol["icon-rotation-alignment"]),"icon-size":new Je(_e.layout_symbol["icon-size"]),"icon-text-fit":new qe(_e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new qe(_e.layout_symbol["icon-text-fit-padding"]),"icon-image":new Je(_e.layout_symbol["icon-image"]),"icon-rotate":new Je(_e.layout_symbol["icon-rotate"]),"icon-padding":new Je(_e.layout_symbol["icon-padding"]),"icon-keep-upright":new qe(_e.layout_symbol["icon-keep-upright"]),"icon-offset":new Je(_e.layout_symbol["icon-offset"]),"icon-anchor":new Je(_e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new qe(_e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new qe(_e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new qe(_e.layout_symbol["text-rotation-alignment"]),"text-field":new Je(_e.layout_symbol["text-field"]),"text-font":new Je(_e.layout_symbol["text-font"]),"text-size":new Je(_e.layout_symbol["text-size"]),"text-max-width":new Je(_e.layout_symbol["text-max-width"]),"text-line-height":new qe(_e.layout_symbol["text-line-height"]),"text-letter-spacing":new Je(_e.layout_symbol["text-letter-spacing"]),"text-justify":new Je(_e.layout_symbol["text-justify"]),"text-radial-offset":new Je(_e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new qe(_e.layout_symbol["text-variable-anchor"]),"text-anchor":new Je(_e.layout_symbol["text-anchor"]),"text-max-angle":new qe(_e.layout_symbol["text-max-angle"]),"text-writing-mode":new qe(_e.layout_symbol["text-writing-mode"]),"text-rotate":new Je(_e.layout_symbol["text-rotate"]),"text-padding":new qe(_e.layout_symbol["text-padding"]),"text-keep-upright":new qe(_e.layout_symbol["text-keep-upright"]),"text-transform":new Je(_e.layout_symbol["text-transform"]),"text-offset":new Je(_e.layout_symbol["text-offset"]),"text-allow-overlap":new qe(_e.layout_symbol["text-allow-overlap"]),"text-overlap":new qe(_e.layout_symbol["text-overlap"]),"text-ignore-placement":new qe(_e.layout_symbol["text-ignore-placement"]),"text-optional":new qe(_e.layout_symbol["text-optional"])});var Jc={paint:new yi({"icon-opacity":new Je(_e.paint_symbol["icon-opacity"]),"icon-color":new Je(_e.paint_symbol["icon-color"]),"icon-halo-color":new Je(_e.paint_symbol["icon-halo-color"]),"icon-halo-width":new Je(_e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Je(_e.paint_symbol["icon-halo-blur"]),"icon-translate":new qe(_e.paint_symbol["icon-translate"]),"icon-translate-anchor":new qe(_e.paint_symbol["icon-translate-anchor"]),"text-opacity":new Je(_e.paint_symbol["text-opacity"]),"text-color":new Je(_e.paint_symbol["text-color"],{runtimeType:_i,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Je(_e.paint_symbol["text-halo-color"]),"text-halo-width":new Je(_e.paint_symbol["text-halo-width"]),"text-halo-blur":new Je(_e.paint_symbol["text-halo-blur"]),"text-translate":new qe(_e.paint_symbol["text-translate"]),"text-translate-anchor":new qe(_e.paint_symbol["text-translate-anchor"])}),layout:rm};class np{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Hr,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ue("FormatSectionOverride",np,{omit:["defaultValue"]});class $l extends xr{constructor(e){super(e,Jc)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const s=this.layout.get("text-writing-mode");if(s){const c=[];for(const h of s)c.indexOf(h)<0&&c.push(h);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,s,c){const h=this.layout.get(e).evaluate(r,{},s,c),d=this._unevaluatedLayout._values[e];return d.isDataDriven()||Ts(d.value)||!h?h:function(m,g){return g.replace(/{([^{}]+)}/g,(x,w)=>w in m?String(m[w]):"")}(r.properties,h)}createBucket(e){return new Co(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Jc.paint.overridableProperties){if(!$l.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),s=new np(r),c=new co(s,r.property.specification);let h=null;h=r.value.kind==="constant"||r.value.kind==="source"?new Ss("source",c):new Jo("composite",c,r.value.zoomStops),this.paint._values[e]=new yr(r.property,h,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&$l.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const s=e.get("text-field"),c=Jc.paint.properties[r];let h=!1;const d=m=>{for(const g of m)if(c.overrides&&c.overrides.hasOverride(g))return void(h=!0)};if(s.value.kind==="constant"&&s.value.value instanceof W)d(s.value.value.sections);else if(s.value.kind==="source"){const m=x=>{h||(x instanceof $e&&ce(x.value)===ci?d(x.value.sections):x instanceof ao?d(x.sections):x.eachChild(m))},g=s.value;g._styleExpression&&m(g._styleExpression.expression)}return h}}function Qc(i,e,r){let s="never";const c=i.get(e);return c?s=c:i.get(r)&&(s="always"),s}var nm={paint:new yi({"background-color":new qe(_e.paint_background["background-color"]),"background-pattern":new ua(_e.paint_background["background-pattern"]),"background-opacity":new qe(_e.paint_background["background-opacity"])})},sm={paint:new yi({"raster-opacity":new qe(_e.paint_raster["raster-opacity"]),"raster-hue-rotate":new qe(_e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new qe(_e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new qe(_e.paint_raster["raster-brightness-max"]),"raster-saturation":new qe(_e.paint_raster["raster-saturation"]),"raster-contrast":new qe(_e.paint_raster["raster-contrast"]),"raster-resampling":new qe(_e.paint_raster["raster-resampling"]),"raster-fade-duration":new qe(_e.paint_raster["raster-fade-duration"])})};class om extends xr{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const am={circle:class extends xr{constructor(i){super(i,Fd)}createBucket(i){return new Ic(i)}queryRadius(i){const e=i;return ma("circle-radius",this,e)+ma("circle-stroke-width",this,e)+Sl(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,r,s,c,h,d,m){const g=Il(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,d),x=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r),w=this.paint.get("circle-pitch-alignment")==="map",E=w?g:function(z,P){return z.map($=>mh($,P))}(g,m),C=w?x*d:x;for(const z of s)for(const P of z){const $=w?P:mh(P,m);let N=C;const ie=Al([],[P.x,P.y,0,1],m);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?N*=ie[3]/h.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(N*=h.cameraToCenterDistance/ie[3]),Pd(E,$,N))return!0}return!1}},heatmap:class extends xr{constructor(i){super(i,Ud),this._updateColorRamp()}createBucket(i){return new gh(i)}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=yh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends xr{constructor(i){super(i,Vd)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends xr{constructor(i){super(i,rf)}recalculate(i,e){super.recalculate(i,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Oc(i)}queryRadius(){return Sl(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,r,s,c,h,d){return ah(Il(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,d),s)}isTileClipped(){return!0}},"fill-extrusion":class extends xr{constructor(i){super(i,_f)}createBucket(i){return new Vc(i)}queryRadius(){return Sl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,e,r,s,c,h,d,m){const g=Il(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,d),x=this.paint.get("fill-extrusion-height").evaluate(e,r),w=this.paint.get("fill-extrusion-base").evaluate(e,r),E=function(z,P,$,N){const ie=[];for(const le of z){const ee=[le.x,le.y,0,1];Al(ee,ee,P),ie.push(new tt(ee[0]/ee[3],ee[1]/ee[3]))}return ie}(g,m),C=function(z,P,$,N){const ie=[],le=[],ee=N[8]*P,se=N[9]*P,xe=N[10]*P,ye=N[11]*P,Oe=N[8]*$,Ne=N[9]*$,De=N[10]*$,Ae=N[11]*$;for(const Ee of z){const Le=[],Me=[];for(const we of Ee){const We=we.x,Ge=we.y,pt=N[0]*We+N[4]*Ge+N[12],qt=N[1]*We+N[5]*Ge+N[13],Ht=N[2]*We+N[6]*Ge+N[14],li=N[3]*We+N[7]*Ge+N[15],dr=Ht+xe,Ti=li+ye,ri=pt+Oe,fi=qt+Ne,Ei=Ht+De,Ci=li+Ae,Gi=new tt((pt+ee)/Ti,(qt+se)/Ti);Gi.z=dr/Ti,Le.push(Gi);const ni=new tt(ri/Ci,fi/Ci);ni.z=Ei/Ci,Me.push(ni)}ie.push(Le),le.push(Me)}return[ie,le]}(s,w,x,m);return function(z,P,$){let N=1/0;ah($,P)&&(N=Ah($,P[0]));for(let ie=0;ie<P.length;ie++){const le=P[ie],ee=z[ie];for(let se=0;se<le.length-1;se++){const xe=le[se],ye=[xe,le[se+1],ee[se+1],ee[se],xe];oh($,ye)&&(N=Math.min(N,Ah($,ye)))}}return N!==1/0&&N}(C[0],C[1],E)}},line:class extends xr{constructor(i){super(i,kh),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){i==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof ys,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=Mh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Nc(i)}queryRadius(i){const e=i,r=zh(ma("line-width",this,e),ma("line-gap-width",this,e)),s=ma("line-offset",this,e);return r/2+Math.abs(s)+Sl(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,r,s,c,h,d){const m=Il(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,d),g=d/2*zh(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),x=this.paint.get("line-offset").evaluate(e,r);return x&&(s=function(w,E){const C=[];for(let z=0;z<w.length;z++){const P=w[z],$=[];for(let N=0;N<P.length;N++){const ie=P[N-1],le=P[N],ee=P[N+1],se=N===0?new tt(0,0):le.sub(ie)._unit()._perp(),xe=N===P.length-1?new tt(0,0):ee.sub(le)._unit()._perp(),ye=se._add(xe)._unit(),Oe=ye.x*xe.x+ye.y*xe.y;Oe!==0&&ye._mult(1/Oe),$.push(ye._mult(E)._add(le))}C.push($)}return C}(s,x*d)),function(w,E,C){for(let z=0;z<E.length;z++){const P=E[z];if(w.length>=3){for(let $=0;$<P.length;$++)if(bo(w,P[$]))return!0}if(Dd(w,P,C))return!0}return!1}(m,s,g)}isTileClipped(){return!0}},symbol:$l,background:class extends xr{constructor(i){super(i,nm)}},raster:class extends xr{constructor(i){super(i,sm)}}};class lm{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const sp=63710088e-1;class Qt{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Qt(Ce(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,s=this.lat*r,c=e.lat*r,h=Math.sin(s)*Math.sin(c)+Math.cos(s)*Math.cos(c)*Math.cos((e.lng-this.lng)*r);return sp*Math.acos(Math.min(h,1))}toBounds(e=0){const r=360*e/40075017,s=r/Math.cos(Math.PI/180*this.lat);return new qs(new Qt(this.lng-s,this.lat-r),new Qt(this.lng+s,this.lat+r))}static convert(e){if(e instanceof Qt)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Qt(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Qt(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class qs{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Qt?new Qt(e.lng,e.lat):Qt.convert(e),this}setSouthWest(e){return this._sw=e instanceof Qt?new Qt(e.lng,e.lat):Qt.convert(e),this}extend(e){const r=this._sw,s=this._ne;let c,h;if(e instanceof Qt)c=e,h=e;else{if(!(e instanceof qs))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(qs.convert(e)):this.extend(Qt.convert(e)):this;if(c=e._sw,h=e._ne,!c||!h)return this}return r||s?(r.lng=Math.min(c.lng,r.lng),r.lat=Math.min(c.lat,r.lat),s.lng=Math.max(h.lng,s.lng),s.lat=Math.max(h.lat,s.lat)):(this._sw=new Qt(c.lng,c.lat),this._ne=new Qt(h.lng,h.lat)),this}getCenter(){return new Qt((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Qt(this.getWest(),this.getNorth())}getSouthEast(){return new Qt(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:s}=Qt.convert(e);let c=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&c}static convert(e){return e instanceof qs?e:e&&new qs(e)}}const op=2*Math.PI*sp;function ap(i){return op*Math.cos(i*Math.PI/180)}function lp(i){return(180+i)/360}function cp(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function up(i,e){return i/ap(e)}function eu(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class ql{constructor(e,r,s=0){this.x=+e,this.y=+r,this.z=+s}static fromLngLat(e,r=0){const s=Qt.convert(e);return new ql(lp(s.lng),cp(s.lat),up(r,s.lat))}toLngLat(){return new Qt(360*this.x-180,eu(this.y))}toAltitude(){return this.z*ap(eu(this.y))}meterInMercatorCoordinateUnits(){return 1/op*(e=eu(this.y),1/Math.cos(e*Math.PI/180));var e}}function hp(i,e,r){var s=2*Math.PI*6378137/256/Math.pow(2,r);return[i*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class tu{constructor(e,r,s){if(e<0||e>25||s<0||s>=Math.pow(2,e)||r<0||r>=Math.pow(2,e))throw new Error(`x=${r}, y=${s}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=s,this.key=Ia(0,e,e,r,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,s){const c=(d=this.y,m=this.z,g=hp(256*(h=this.x),256*(d=Math.pow(2,m)-d-1),m),x=hp(256*(h+1),256*(d+1),m),g[0]+","+g[1]+","+x[0]+","+x[1]);var h,d,m,g,x;const w=function(E,C,z){let P,$="";for(let N=E;N>0;N--)P=1<<N-1,$+=(C&P?1:0)+(z&P?2:0);return $}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,w).replace(/{bbox-epsg-3857}/g,c)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new tt((e.x*r-this.x)*ai,(e.y*r-this.y)*ai)}toString(){return`${this.z}/${this.x}/${this.y}`}}class pp{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Ia(e,r.z,r.z,r.x,r.y)}}class pr{constructor(e,r,s,c,h){if(e<s)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${s}`);this.overscaledZ=e,this.wrap=r,this.canonical=new tu(s,+c,+h),this.key=Ia(r,e,s,c,h)}clone(){return new pr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new pr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new pr(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-e;return e>this.canonical.z?Ia(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):Ia(this.wrap*+r,e,e,this.canonical.x>>s,this.canonical.y>>s)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new pr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,c=2*this.canonical.y;return[new pr(r,this.wrap,r,s,c),new pr(r,this.wrap,r,s+1,c),new pr(r,this.wrap,r,s,c+1),new pr(r,this.wrap,r,s+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new pr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new pr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new pp(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new ql(e.x-this.wrap,e.y))}}function Ia(i,e,r,s,c){(i*=2)<0&&(i=-1*i-1);const h=1<<r;return(h*h*i+h*c+s).toString(36)+r.toString(36)+e.toString(36)}Ue("CanonicalTileID",tu),Ue("OverscaledTileID",pr,{omit:["posMatrix"]});class dp{constructor(e,r,s){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return void Ke(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const c=this.dim=r.height-2;this.data=new Uint32Array(r.data.buffer),this.encoding=s||"mapbox";for(let h=0;h<c;h++)this.data[this._idx(-1,h)]=this.data[this._idx(0,h)],this.data[this._idx(c,h)]=this.data[this._idx(c-1,h)],this.data[this._idx(h,-1)]=this.data[this._idx(h,0)],this.data[this._idx(h,c)]=this.data[this._idx(h,c-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(c,-1)]=this.data[this._idx(c-1,0)],this.data[this._idx(-1,c)]=this.data[this._idx(0,c-1)],this.data[this._idx(c,c)]=this.data[this._idx(c-1,c-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let h=0;h<c;h++)for(let d=0;d<c;d++){const m=this.get(h,d);m>this.max&&(this.max=m),m<this.min&&(this.min=m)}}get(e,r){const s=new Uint8Array(this.data.buffer),c=4*this._idx(e,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(s[c],s[c+1],s[c+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}_unpackMapbox(e,r,s){return(256*e*256+256*r+s)/10-1e4}_unpackTerrarium(e,r,s){return 256*e+r+s/256-32768}getPixels(){return new hr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=r*this.dim,h=r*this.dim+this.dim,d=s*this.dim,m=s*this.dim+this.dim;switch(r){case-1:c=h-1;break;case 1:h=c+1}switch(s){case-1:d=m-1;break;case 1:m=d+1}const g=-r*this.dim,x=-s*this.dim;for(let w=d;w<m;w++)for(let E=c;E<h;E++)this.data[this._idx(E,w)]=e.data[this._idx(E+g,w+x)]}}Ue("DEMData",dp);class fp{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const s=e[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class mp{constructor(e,r,s,c,h){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=s,e._y=c,this.properties=e.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class gp{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Bs(ai,16,0),this.grid3D=new Bs(ai,16,0),this.featureIndexArray=new ht,this.promoteId=r}insert(e,r,s,c,h,d){const m=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,c,h);const g=d?this.grid3D:this.grid;for(let x=0;x<r.length;x++){const w=r[x],E=[1/0,1/0,-1/0,-1/0];for(let C=0;C<w.length;C++){const z=w[C];E[0]=Math.min(E[0],z.x),E[1]=Math.min(E[1],z.y),E[2]=Math.max(E[2],z.x),E[3]=Math.max(E[3],z.y)}E[0]<ai&&E[1]<ai&&E[2]>=0&&E[3]>=0&&g.insert(m,E[0],E[1],E[2],E[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ss.VectorTile(new $c(this.rawTileData)).layers,this.sourceLayerCoder=new fp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,s,c){this.loadVTLayers();const h=e.params||{},d=ai/e.tileSize/e.scale,m=po(h.filter),g=e.queryGeometry,x=e.queryPadding*d,w=yp(g),E=this.grid.query(w.minX-x,w.minY-x,w.maxX+x,w.maxY+x),C=yp(e.cameraQueryGeometry),z=this.grid3D.query(C.minX-x,C.minY-x,C.maxX+x,C.maxY+x,(N,ie,le,ee)=>function(se,xe,ye,Oe,Ne){for(const Ae of se)if(xe<=Ae.x&&ye<=Ae.y&&Oe>=Ae.x&&Ne>=Ae.y)return!0;const De=[new tt(xe,ye),new tt(xe,Ne),new tt(Oe,Ne),new tt(Oe,ye)];if(se.length>2){for(const Ae of De)if(bo(se,Ae))return!0}for(let Ae=0;Ae<se.length-1;Ae++)if(Bd(se[Ae],se[Ae+1],De))return!0;return!1}(e.cameraQueryGeometry,N-x,ie-x,le+x,ee+x));for(const N of z)E.push(N);E.sort(cm);const P={};let $;for(let N=0;N<E.length;N++){const ie=E[N];if(ie===$)continue;$=ie;const le=this.featureIndexArray.get(ie);let ee=null;this.loadMatchingFeature(P,le.bucketIndex,le.sourceLayerIndex,le.featureIndex,m,h.layers,h.availableImages,r,s,c,(se,xe,ye)=>(ee||(ee=Vs(se)),xe.queryIntersectsFeature(g,se,ye,ee,this.z,e.transform,d,e.pixelPosMatrix)))}return P}loadMatchingFeature(e,r,s,c,h,d,m,g,x,w,E){const C=this.bucketLayerIDs[r];if(d&&!function(N,ie){for(let le=0;le<N.length;le++)if(ie.indexOf(N[le])>=0)return!0;return!1}(d,C))return;const z=this.sourceLayerCoder.decode(s),P=this.vtLayers[z].feature(c);if(h.needGeometry){const N=Ns(P,!0);if(!h.filter(new Xt(this.tileID.overscaledZ),N,this.tileID.canonical))return}else if(!h.filter(new Xt(this.tileID.overscaledZ),P))return;const $=this.getId(P,z);for(let N=0;N<C.length;N++){const ie=C[N];if(d&&d.indexOf(ie)<0)continue;const le=g[ie];if(!le)continue;let ee={};$&&w&&(ee=w.getState(le.sourceLayer||"_geojsonTileLayer",$));const se=ze({},x[ie]);se.paint=_p(se.paint,le.paint,P,ee,m),se.layout=_p(se.layout,le.layout,P,ee,m);const xe=!E||E(P,le,ee);if(!xe)continue;const ye=new mp(P,this.z,this.x,this.y,$);ye.layer=se;let Oe=e[ie];Oe===void 0&&(Oe=e[ie]=[]),Oe.push({featureIndex:c,feature:ye,intersectionZ:xe})}}lookupSymbolFeatures(e,r,s,c,h,d,m,g){const x={};this.loadVTLayers();const w=po(h);for(const E of e)this.loadMatchingFeature(x,s,c,E,w,d,m,g,r);return x}hasLayer(e){for(const r of this.bucketLayerIDs)for(const s of r)if(e===s)return!0;return!1}getId(e,r){let s=e.id;return this.promoteId&&(s=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof s=="boolean"&&(s=Number(s))),s}}function _p(i,e,r,s,c){return Qe(i,(h,d)=>{const m=e instanceof Os?e.get(d):null;return m&&m.evaluate?m.evaluate(r,s,c):m})}function yp(i){let e=1/0,r=1/0,s=-1/0,c=-1/0;for(const h of i)e=Math.min(e,h.x),r=Math.min(r,h.y),s=Math.max(s,h.x),c=Math.max(c,h.y);return{minX:e,minY:r,maxX:s,maxY:c}}function cm(i,e){return e-i}var iu;Ue("FeatureIndex",gp,{omit:["rawTileData","sourceLayerCoder"]}),a.PerformanceMarkers=void 0,(iu=a.PerformanceMarkers||(a.PerformanceMarkers={})).create="create",iu.load="load",iu.fullLoad="fullLoad";let Gl=null,Aa=[];const ru=1e3/30,um={mark(i){performance.mark(i)},frame(i){const e=i;Gl!=null&&Aa.push(e-Gl),Gl=e},clearMetrics(){Gl=null,Aa=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const i in a.PerformanceMarkers)performance.clearMarks(a.PerformanceMarkers[i])},getPerformanceMetrics(){performance.measure("loadTime",a.PerformanceMarkers.create,a.PerformanceMarkers.load),performance.measure("fullLoadTime",a.PerformanceMarkers.create,a.PerformanceMarkers.fullLoad);const i=performance.getEntriesByName("loadTime")[0].duration,e=performance.getEntriesByName("fullLoadTime")[0].duration,r=Aa.length,s=1/(Aa.reduce((h,d)=>h+d,0)/r/1e3),c=Aa.filter(h=>h>ru).reduce((h,d)=>h+(d-ru)/ru,0);return{loadTime:i,fullLoadTime:e,fps:s,percentDroppedFrames:c/(r+c)*100}}};a.AJAXError=Oi,a.ARRAY_TYPE=Bi,a.Actor=class{constructor(i,e,r){this.target=i,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},je(["receive","process"],this),this.invoker=new lm(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=rt()?i:window}send(i,e,r,s,c=!1){const h=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[h]=r);const d=bi(this.globalScope)?void 0:[];return this.target.postMessage({id:h,type:i,hasCallback:!!r,targetMapId:s,mustQueue:c,sourceMapId:this.mapId,data:xn(e,d)},d),{cancel:()=>{r&&delete this.callbacks[h],this.target.postMessage({id:h,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(i){const e=i.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){delete this.tasks[r];const s=this.cancelCallbacks[r];delete this.cancelCallbacks[r],s&&s()}else rt()||e.mustQueue?(this.tasks[r]=e,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,e)}process(){if(!this.taskQueue.length)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){if(e.type==="<response>"){const r=this.callbacks[i];delete this.callbacks[i],r&&(e.error?r(Jr(e.error)):r(null,Jr(e.data)))}else{let r=!1;const s=bi(this.globalScope)?void 0:[],c=e.hasCallback?(m,g)=>{r=!0,delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:m?xn(m):null,data:xn(g,s)},s)}:m=>{r=!0};let h=null;const d=Jr(e.data);if(this.parent[e.type])h=this.parent[e.type](e.sourceMapId,d,c);else if(this.parent.getWorkerSource){const m=e.type.split(".");h=this.parent.getWorkerSource(e.sourceMapId,m[0],d.source)[m[1]](d,c)}else c(new Error(`Could not find function ${e.type}`));!r&&h&&h.cancel&&(this.cancelCallbacks[i]=h.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.AlphaImage=_a,a.CanonicalTileID=tu,a.CollisionBoxArray=me,a.CollisionCircleLayoutArray=class extends T{},a.Color=L,a.DEMData=dp,a.DataConstantProperty=qe,a.DictionaryCoder=fp,a.EXTENT=ai,a.ErrorEvent=Nn,a.EvaluationParameters=Xt,a.Event=Cr,a.Evented=kr,a.FeatureIndex=gp,a.FillBucket=Oc,a.FillExtrusionBucket=Vc,a.GeoJSONFeature=mp,a.ImageAtlas=Vh,a.ImagePosition=Gc,a.LineBucket=Nc,a.LineStripIndexArray=class extends V{},a.LngLat=Qt,a.LngLatBounds=qs,a.MercatorCoordinate=ql,a.ONE_EM=xi,a.OverscaledTileID=pr,a.PerformanceUtils=um,a.PosArray=Xe,a.Properties=yi,a.QuadTriangleArray=class extends M{},a.RGBAImage=hr,a.RasterBoundsArray=class extends l{},a.RequestPerformance=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},a.ResourceType=Ir,a.SegmentVector=ft,a.SymbolBucket=Co,a.Transitionable=xl,a.TriangleIndexArray=Di,a.Uniform1f=Tn,a.Uniform1i=class extends wn{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},a.Uniform2f=class extends wn{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},a.Uniform3f=class extends wn{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},a.Uniform4f=xo,a.UniformColor=ih,a.UniformMatrix4f=class extends wn{constructor(i,e){super(i,e),this.current=Md}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},a.UnwrappedTileID=pp,a.ValidationError=ke,a.ZoomHistory=ia,a.add=function(i,e,r){return i[0]=e[0]+r[0],i[1]=e[1]+r[1],i[2]=e[2]+r[2],i},a.addDynamicAttributes=Hc,a.asyncAll=function(i,e,r){if(!i.length)return r(null,[]);let s=i.length;const c=new Array(i.length);let h=null;i.forEach((d,m)=>{e(d,(g,x)=>{g&&(h=g),c[m]=x,--s==0&&r(h,c)})})},a.bezier=pe,a.bindAll=je,a.cacheEntryPossiblyAdded=function(i){mr++,mr>Rn&&(i.getActor().send("enforceCacheSizeLimit",Bn),mr=0)},a.clamp=te,a.clearTileCache=function(i){const e=caches.delete(or);i&&e.catch(i).then(()=>i())},a.clipLine=Jh,a.clone=function(i){var e=new Bi(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},a.clone$1=He,a.clone$2=function(i){var e=new Bi(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},a.collisionCircleLayout=Cf,a.config=Sr,a.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},a.create=function(){var i=new Bi(16);return Bi!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},a.create$1=uh,a.createExpression=Es,a.createFilter=po,a.createLayout=ii,a.createStyleLayer=function(i){return i.type==="custom"?new om(i):new am[i.type](i)},a.cross=function(i,e,r){var s=e[0],c=e[1],h=e[2],d=r[0],m=r[1],g=r[2];return i[0]=c*g-h*m,i[1]=h*d-s*g,i[2]=s*m-c*d,i},a.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]},a.dot$1=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},a.ease=fe,a.emitValidationErrors=mo,a.enforceCacheSizeLimit=function(i){Fn(),ar&&ar.then(e=>{e.keys().then(r=>{for(let s=0;s<r.length-i;s++)e.delete(r[s])})})},a.equals=function(i,e){var r=i[0],s=i[1],c=i[2],h=i[3],d=i[4],m=i[5],g=i[6],x=i[7],w=i[8],E=i[9],C=i[10],z=i[11],P=i[12],$=i[13],N=i[14],ie=i[15],le=e[0],ee=e[1],se=e[2],xe=e[3],ye=e[4],Oe=e[5],Ne=e[6],De=e[7],Ae=e[8],Ee=e[9],Le=e[10],Me=e[11],we=e[12],We=e[13],Ge=e[14],pt=e[15];return Math.abs(r-le)<=Li*Math.max(1,Math.abs(r),Math.abs(le))&&Math.abs(s-ee)<=Li*Math.max(1,Math.abs(s),Math.abs(ee))&&Math.abs(c-se)<=Li*Math.max(1,Math.abs(c),Math.abs(se))&&Math.abs(h-xe)<=Li*Math.max(1,Math.abs(h),Math.abs(xe))&&Math.abs(d-ye)<=Li*Math.max(1,Math.abs(d),Math.abs(ye))&&Math.abs(m-Oe)<=Li*Math.max(1,Math.abs(m),Math.abs(Oe))&&Math.abs(g-Ne)<=Li*Math.max(1,Math.abs(g),Math.abs(Ne))&&Math.abs(x-De)<=Li*Math.max(1,Math.abs(x),Math.abs(De))&&Math.abs(w-Ae)<=Li*Math.max(1,Math.abs(w),Math.abs(Ae))&&Math.abs(E-Ee)<=Li*Math.max(1,Math.abs(E),Math.abs(Ee))&&Math.abs(C-Le)<=Li*Math.max(1,Math.abs(C),Math.abs(Le))&&Math.abs(z-Me)<=Li*Math.max(1,Math.abs(z),Math.abs(Me))&&Math.abs(P-we)<=Li*Math.max(1,Math.abs(P),Math.abs(we))&&Math.abs($-We)<=Li*Math.max(1,Math.abs($),Math.abs(We))&&Math.abs(N-Ge)<=Li*Math.max(1,Math.abs(N),Math.abs(Ge))&&Math.abs(ie-pt)<=Li*Math.max(1,Math.abs(ie),Math.abs(pt))},a.evaluateSizeForFeature=function(i,{uSize:e,uSizeT:r},{lowerSize:s,upperSize:c}){return i.kind==="source"?s/In:i.kind==="composite"?Zt(s/In,c/In,r):e},a.evaluateSizeForZoom=function(i,e){let r=0,s=0;if(i.kind==="constant")s=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:c,minZoom:h,maxZoom:d}=i,m=c?te(Ni.interpolationFactor(c,e,h,d),0,1):0;i.kind==="camera"?s=Zt(i.minSize,i.maxSize,m):r=m}return{uSizeT:r,uSize:s}},a.evaluateVariableOffset=tp,a.evented=ca,a.exported=$r,a.exported$1=qr,a.extend=ze,a.filterObject=Ze,a.fromRotation=function(i,e){var r=Math.sin(e),s=Math.cos(e);return i[0]=s,i[1]=r,i[2]=0,i[3]=-r,i[4]=s,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},a.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},a.getAnchorAlignment=jc,a.getAnchorJustification=Wc,a.getArrayBuffer=Vn,a.getImage=Wr,a.getJSON=function(i,e){return Un(ze(i,{type:"json"}),e)},a.getOverlapMode=Qc,a.getRTLTextPluginStatus=Rs,a.getReferrer=ds,a.getVideo=function(i,e){const r=window.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let s=0;s<i.length;s++){const c=window.document.createElement("source");fs(i[s])||(r.crossOrigin="Anonymous"),c.src=i[s],r.appendChild(c)}return{cancel:()=>{}}},a.identity=kc,a.invert=function(i,e){var r=e[0],s=e[1],c=e[2],h=e[3],d=e[4],m=e[5],g=e[6],x=e[7],w=e[8],E=e[9],C=e[10],z=e[11],P=e[12],$=e[13],N=e[14],ie=e[15],le=r*m-s*d,ee=r*g-c*d,se=r*x-h*d,xe=s*g-c*m,ye=s*x-h*m,Oe=c*x-h*g,Ne=w*$-E*P,De=w*N-C*P,Ae=w*ie-z*P,Ee=E*N-C*$,Le=E*ie-z*$,Me=C*ie-z*N,we=le*Me-ee*Le+se*Ee+xe*Ae-ye*De+Oe*Ne;return we?(i[0]=(m*Me-g*Le+x*Ee)*(we=1/we),i[1]=(c*Le-s*Me-h*Ee)*we,i[2]=($*Oe-N*ye+ie*xe)*we,i[3]=(C*ye-E*Oe-z*xe)*we,i[4]=(g*Ae-d*Me-x*De)*we,i[5]=(r*Me-c*Ae+h*De)*we,i[6]=(N*se-P*Oe-ie*ee)*we,i[7]=(w*Oe-C*se+z*ee)*we,i[8]=(d*Le-m*Ae+x*Ne)*we,i[9]=(s*Ae-r*Le-h*Ne)*we,i[10]=(P*ye-$*se+ie*le)*we,i[11]=(E*se-w*ye-z*le)*we,i[12]=(m*De-d*Ee-g*Ne)*we,i[13]=(r*Ee-s*De+c*Ne)*we,i[14]=($*ee-P*xe-N*le)*we,i[15]=(w*xe-E*ee+C*le)*we,i):null},a.isImageBitmap=Fi,a.isSafari=bi,a.isWorker=rt,a.keysDifference=function(i,e){const r=[];for(const s in i)s in e||r.push(s);return r},a.lazyLoadRTLTextPlugin=function(){Qi.isLoading()||Qi.isLoaded()||Rs()!=="deferred"||yl()},a.makeRequest=Un,a.mapObject=Qe,a.mercatorXfromLng=lp,a.mercatorYfromLat=cp,a.mercatorZfromAltitude=up,a.mul=Od,a.mul$1=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},a.multiply=hh,a.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},a.normalize=function(i,e){var r=e[0],s=e[1],c=e[2],h=r*r+s*s+c*c;return h>0&&(h=1/Math.sqrt(h)),i[0]=e[0]*h,i[1]=e[1]*h,i[2]=e[2]*h,i},a.number=Zt,a.ortho=function(i,e,r,s,c,h,d){var m=1/(e-r),g=1/(s-c),x=1/(h-d);return i[0]=-2*m,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*g,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*x,i[11]=0,i[12]=(e+r)*m,i[13]=(c+s)*g,i[14]=(d+h)*x,i[15]=1,i},a.parseCacheControl=Kt,a.parseGlyphPbf=function(i){return new $c(i).readFields(Uf,[])},a.pbf=$c,a.performSymbolLayout=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=ai/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0].layout,r=i.bucket.layers[0]._unevaluatedLayout._values,s={layoutIconSize:r["icon-size"].possiblyEvaluate(new Xt(i.bucket.zoom+1),i.canonical),layoutTextSize:r["text-size"].possiblyEvaluate(new Xt(i.bucket.zoom+1),i.canonical),textMaxSize:r["text-size"].possiblyEvaluate(new Xt(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:g,maxZoom:x}=i.bucket.textSizeData;s.compositeTextSizes=[r["text-size"].possiblyEvaluate(new Xt(g),i.canonical),r["text-size"].possiblyEvaluate(new Xt(x),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:g,maxZoom:x}=i.bucket.iconSizeData;s.compositeIconSizes=[r["icon-size"].possiblyEvaluate(new Xt(g),i.canonical),r["icon-size"].possiblyEvaluate(new Xt(x),i.canonical)]}const c=e.get("text-line-height")*xi,h=e.get("text-rotation-alignment")!=="viewport"&&e.get("symbol-placement")!=="point",d=e.get("text-keep-upright"),m=e.get("text-size");for(const g of i.bucket.features){const x=e.get("text-font").evaluate(g,{},i.canonical).join(","),w=m.evaluate(g,{},i.canonical),E=s.layoutTextSize.evaluate(g,{},i.canonical),C=s.layoutIconSize.evaluate(g,{},i.canonical),z={horizontal:{},vertical:void 0},P=g.text;let $,N=[0,0];if(P){const ee=P.toString(),se=e.get("text-letter-spacing").evaluate(g,{},i.canonical)*xi,xe=bc(ee)?se:0,ye=e.get("text-anchor").evaluate(g,{},i.canonical),Oe=e.get("text-variable-anchor");if(!Oe){const Le=e.get("text-radial-offset").evaluate(g,{},i.canonical);N=Le?tp(ye,[Le*xi,Xc]):e.get("text-offset").evaluate(g,{},i.canonical).map(Me=>Me*xi)}let Ne=h?"center":e.get("text-justify").evaluate(g,{},i.canonical);const De=e.get("symbol-placement"),Ae=De==="point"?e.get("text-max-width").evaluate(g,{},i.canonical)*xi:0,Ee=()=>{i.bucket.allowVerticalPlacement&&go(ee)&&(z.vertical=Bl(P,i.glyphMap,i.glyphPositions,i.imagePositions,x,Ae,c,ye,"left",xe,N,a.WritingMode.vertical,!0,De,E,w))};if(!h&&Oe){const Le=Ne==="auto"?Oe.map(we=>Wc(we)):[Ne];let Me=!1;for(let we=0;we<Le.length;we++){const We=Le[we];if(!z.horizontal[We])if(Me)z.horizontal[We]=z.horizontal[0];else{const Ge=Bl(P,i.glyphMap,i.glyphPositions,i.imagePositions,x,Ae,c,"center",We,xe,N,a.WritingMode.horizontal,!1,De,E,w);Ge&&(z.horizontal[We]=Ge,Me=Ge.positionedLines.length===1)}}Ee()}else{Ne==="auto"&&(Ne=Wc(ye));const Le=Bl(P,i.glyphMap,i.glyphPositions,i.imagePositions,x,Ae,c,ye,Ne,xe,N,a.WritingMode.horizontal,!1,De,E,w);Le&&(z.horizontal[Ne]=Le),Ee(),go(ee)&&h&&d&&(z.vertical=Bl(P,i.glyphMap,i.glyphPositions,i.imagePositions,x,Ae,c,ye,Ne,xe,N,a.WritingMode.vertical,!1,De,E,w))}}let ie=!1;if(g.icon&&g.icon.name){const ee=i.imageMap[g.icon.name];ee&&($=Zf(i.imagePositions[g.icon.name],e.get("icon-offset").evaluate(g,{},i.canonical),e.get("icon-anchor").evaluate(g,{},i.canonical)),ie=!!ee.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=ie:i.bucket.sdfIcons!==ie&&Ke("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ee.pixelRatio!==i.bucket.pixelRatio||e.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const le=rp(z.horizontal)||z.vertical;i.bucket.iconsInText=!!le&&le.iconsInText,(le||$)&&Jf(i.bucket,g,z,$,i.imageMap,s,E,C,N,ie,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},a.perspective=function(i,e,r,s,c){var h,d=1/Math.tan(e/2);return i[0]=d/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=d,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,c!=null&&c!==1/0?(i[10]=(c+s)*(h=1/(s-c)),i[14]=2*c*s*h):(i[10]=-1,i[14]=-2*s),i},a.pick=function(i,e){const r={};for(let s=0;s<e.length;s++){const c=e[s];c in i&&(r[c]=i[c])}return r},a.plugin=Qi,a.pointGeometry=tt,a.polygonIntersectsPolygon=oh,a.potpack=Uh,a.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.register=Ue,a.registerForPluginStateChange=function(i){return i({pluginStatus:Pi,pluginURL:Qr}),ca.on("pluginStateChange",i),i},a.renderColorRamp=yh,a.rotateX=function(i,e,r){var s=Math.sin(r),c=Math.cos(r),h=e[4],d=e[5],m=e[6],g=e[7],x=e[8],w=e[9],E=e[10],C=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=h*c+x*s,i[5]=d*c+w*s,i[6]=m*c+E*s,i[7]=g*c+C*s,i[8]=x*c-h*s,i[9]=w*c-d*s,i[10]=E*c-m*s,i[11]=C*c-g*s,i},a.rotateZ=function(i,e,r){var s=Math.sin(r),c=Math.cos(r),h=e[0],d=e[1],m=e[2],g=e[3],x=e[4],w=e[5],E=e[6],C=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=h*c+x*s,i[1]=d*c+w*s,i[2]=m*c+E*s,i[3]=g*c+C*s,i[4]=x*c-h*s,i[5]=w*c-d*s,i[6]=E*c-m*s,i[7]=C*c-g*s,i},a.scale=function(i,e,r){var s=r[0],c=r[1],h=r[2];return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=e[3]*s,i[4]=e[4]*c,i[5]=e[5]*c,i[6]=e[6]*c,i[7]=e[7]*c,i[8]=e[8]*h,i[9]=e[9]*h,i[10]=e[10]*h,i[11]=e[11]*h,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},a.scale$1=function(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i},a.setCacheLimits=function(i,e){Bn=i,Rn=e},a.setRTLTextPlugin=function(i,e,r=!1){if(Pi===sa||Pi===oa||Pi===aa)throw new Error("setRTLTextPlugin cannot be called multiple times.");Qr=$r.resolveURL(i),Pi=sa,la=e,ts(),r||yl()},a.spec=_e,a.sphericalToCartesian=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}},a.sqrLen=function(i){var e=i[0],r=i[1];return e*e+r*r},a.sub=function(i,e,r){return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],i},a.toEvaluationFeature=Ns,a.transformMat3=function(i,e,r){var s=e[0],c=e[1],h=e[2];return i[0]=s*r[0]+c*r[3]+h*r[6],i[1]=s*r[1]+c*r[4]+h*r[7],i[2]=s*r[2]+c*r[5]+h*r[8],i},a.transformMat4=Al,a.transformMat4$1=function(i,e,r){var s=e[0],c=e[1];return i[0]=r[0]*s+r[4]*c+r[12],i[1]=r[1]*s+r[5]*c+r[13],i},a.translate=function(i,e,r){var s,c,h,d,m,g,x,w,E,C,z,P,$=r[0],N=r[1],ie=r[2];return e===i?(i[12]=e[0]*$+e[4]*N+e[8]*ie+e[12],i[13]=e[1]*$+e[5]*N+e[9]*ie+e[13],i[14]=e[2]*$+e[6]*N+e[10]*ie+e[14],i[15]=e[3]*$+e[7]*N+e[11]*ie+e[15]):(c=e[1],h=e[2],d=e[3],m=e[4],g=e[5],x=e[6],w=e[7],E=e[8],C=e[9],z=e[10],P=e[11],i[0]=s=e[0],i[1]=c,i[2]=h,i[3]=d,i[4]=m,i[5]=g,i[6]=x,i[7]=w,i[8]=E,i[9]=C,i[10]=z,i[11]=P,i[12]=s*$+m*N+E*ie+e[12],i[13]=c*$+g*N+C*ie+e[13],i[14]=h*$+x*N+z*ie+e[14],i[15]=d*$+w*N+P*ie+e[15]),i},a.triggerPluginCompletionEvent=_l,a.unicodeBlockLookup=Pe,a.uniqueId=function(){return Te++},a.validateCustomStyleLayer=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},a.validateLight=ta,a.validateStyle=Ls,a.vectorTile=ss,a.warnOnce=Ke,a.wrap=Ce}),X(["./shared"],function(a){function de(B){const b=typeof B;if(b==="number"||b==="boolean"||b==="string"||B==null)return JSON.stringify(B);if(Array.isArray(B)){let L="[";for(const G of B)L+=`${de(G)},`;return`${L}]`}const S=Object.keys(B).sort();let D="{";for(let L=0;L<S.length;L++)D+=`${JSON.stringify(S[L])}:${de(B[S[L]])},`;return`${D}}`}function ae(B){let b="";for(const S of a.refProperties)b+=`/${de(B[S])}`;return b}class pe{constructor(b){this.keyCache={},b&&this.replace(b)}replace(b){this._layerConfigs={},this._layers={},this.update(b,[])}update(b,S){for(const L of b){this._layerConfigs[L.id]=L;const G=this._layers[L.id]=a.createStyleLayer(L);G._featureFilter=a.createFilter(G.filter),this.keyCache[L.id]&&delete this.keyCache[L.id]}for(const L of S)delete this.keyCache[L],delete this._layerConfigs[L],delete this._layers[L];this.familiesBySource={};const D=function(L,G){const K={};for(let Z=0;Z<L.length;Z++){const J=G&&G[L[Z].id]||ae(L[Z]);G&&(G[L[Z].id]=J);let ue=K[J];ue||(ue=K[J]=[]),ue.push(L[Z])}const W=[];for(const Z in K)W.push(K[Z]);return W}(Object.values(this._layerConfigs),this.keyCache);for(const L of D){const G=L.map(ve=>this._layers[ve.id]),K=G[0];if(K.visibility==="none")continue;const W=K.source||"";let Z=this.familiesBySource[W];Z||(Z=this.familiesBySource[W]={});const J=K.sourceLayer||"_geojsonTileLayer";let ue=Z[J];ue||(ue=Z[J]=[]),ue.push(G)}}}class fe{constructor(b){const S={},D=[];for(const W in b){const Z=b[W],J=S[W]={};for(const ue in Z){const ve=Z[+ue];if(!ve||ve.bitmap.width===0||ve.bitmap.height===0)continue;const ce={x:0,y:0,w:ve.bitmap.width+2,h:ve.bitmap.height+2};D.push(ce),J[ue]={rect:ce,metrics:ve.metrics}}}const{w:L,h:G}=a.potpack(D),K=new a.AlphaImage({width:L||1,height:G||1});for(const W in b){const Z=b[W];for(const J in Z){const ue=Z[+J];if(!ue||ue.bitmap.width===0||ue.bitmap.height===0)continue;const ve=S[W][J].rect;a.AlphaImage.copy(ue.bitmap,K,{x:0,y:0},{x:ve.x+1,y:ve.y+1},ue.bitmap)}}this.image=K,this.positions=S}}a.register("GlyphAtlas",fe);class te{constructor(b){this.tileID=new a.OverscaledTileID(b.tileID.overscaledZ,b.tileID.wrap,b.tileID.canonical.z,b.tileID.canonical.x,b.tileID.canonical.y),this.uid=b.uid,this.zoom=b.zoom,this.pixelRatio=b.pixelRatio,this.tileSize=b.tileSize,this.source=b.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=b.showCollisionBoxes,this.collectResourceTiming=!!b.collectResourceTiming,this.returnDependencies=!!b.returnDependencies,this.promoteId=b.promoteId}parse(b,S,D,L,G){this.status="parsing",this.data=b,this.collisionBoxArray=new a.CollisionBoxArray;const K=new a.DictionaryCoder(Object.keys(b.layers).sort()),W=new a.FeatureIndex(this.tileID,this.promoteId);W.bucketLayerIDs=[];const Z={},J={featureIndex:W,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:D},ue=S.familiesBySource[this.source];for(const nt in ue){const ut=b.layers[nt];if(!ut)continue;ut.version===1&&a.warnOnce(`Vector tile source "${this.source}" layer "${nt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const wt=K.encode(nt),Ot=[];for(let ui=0;ui<ut.length;ui++){const Gt=ut.feature(ui),wi=W.getId(Gt,nt);Ot.push({feature:Gt,id:wi,index:ui,sourceLayerIndex:wt})}for(const ui of ue[nt]){const Gt=ui[0];Gt.source!==this.source&&a.warnOnce(`layer.source = ${Gt.source} does not equal this.source = ${this.source}`),Gt.minzoom&&this.zoom<Math.floor(Gt.minzoom)||Gt.maxzoom&&this.zoom>=Gt.maxzoom||Gt.visibility!=="none"&&(Ce(ui,this.zoom,D),(Z[Gt.id]=Gt.createBucket({index:W.bucketLayerIDs.length,layers:ui,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:wt,sourceID:this.source})).populate(Ot,J,this.tileID.canonical),W.bucketLayerIDs.push(ui.map(wi=>wi.id)))}}let ve,ce,Ve,$e;const Be=a.mapObject(J.glyphDependencies,nt=>Object.keys(nt).map(Number));Object.keys(Be).length?L.send("getGlyphs",{uid:this.uid,stacks:Be},(nt,ut)=>{ve||(ve=nt,ce=ut,bt.call(this))}):ce={};const Ye=Object.keys(J.iconDependencies);Ye.length?L.send("getImages",{icons:Ye,source:this.source,tileID:this.tileID,type:"icons"},(nt,ut)=>{ve||(ve=nt,Ve=ut,bt.call(this))}):Ve={};const et=Object.keys(J.patternDependencies);function bt(){if(ve)return G(ve);if(ce&&Ve&&$e){const nt=new fe(ce),ut=new a.ImageAtlas(Ve,$e);for(const wt in Z){const Ot=Z[wt];Ot instanceof a.SymbolBucket?(Ce(Ot.layers,this.zoom,D),a.performSymbolLayout({bucket:Ot,glyphMap:ce,glyphPositions:nt.positions,imageMap:Ve,imagePositions:ut.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Ot.hasPattern&&(Ot instanceof a.LineBucket||Ot instanceof a.FillBucket||Ot instanceof a.FillExtrusionBucket)&&(Ce(Ot.layers,this.zoom,D),Ot.addFeatures(J,this.tileID.canonical,ut.patternPositions))}this.status="done",G(null,{buckets:Object.values(Z).filter(wt=>!wt.isEmpty()),featureIndex:W,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:nt.image,imageAtlas:ut,glyphMap:this.returnDependencies?ce:null,iconMap:this.returnDependencies?Ve:null,glyphPositions:this.returnDependencies?nt.positions:null})}}et.length?L.send("getImages",{icons:et,source:this.source,tileID:this.tileID,type:"patterns"},(nt,ut)=>{ve||(ve=nt,$e=ut,bt.call(this))}):$e={},bt.call(this)}}function Ce(B,b,S){const D=new a.EvaluationParameters(b);for(const L of B)L.recalculate(D,S)}function ze(B,b){const S=a.getArrayBuffer(B.request,(D,L,G,K)=>{D?b(D):L&&b(null,{vectorTile:new a.vectorTile.VectorTile(new a.pbf(L)),rawData:L,cacheControl:G,expires:K})});return()=>{S.cancel(),b()}}class Te{constructor(b,S,D,L){this.actor=b,this.layerIndex=S,this.availableImages=D,this.loadVectorData=L||ze,this.loading={},this.loaded={}}loadTile(b,S){const D=b.uid;this.loading||(this.loading={});const L=!!(b&&b.request&&b.request.collectResourceTiming)&&new a.RequestPerformance(b.request),G=this.loading[D]=new te(b);G.abort=this.loadVectorData(b,(K,W)=>{if(delete this.loading[D],K||!W)return G.status="done",this.loaded[D]=G,S(K);const Z=W.rawData,J={};W.expires&&(J.expires=W.expires),W.cacheControl&&(J.cacheControl=W.cacheControl);const ue={};if(L){const ve=L.finish();ve&&(ue.resourceTiming=JSON.parse(JSON.stringify(ve)))}G.vectorTile=W.vectorTile,G.parse(W.vectorTile,this.layerIndex,this.availableImages,this.actor,(ve,ce)=>{if(ve||!ce)return S(ve);S(null,a.extend({rawTileData:Z.slice(0)},ce,J,ue))}),this.loaded=this.loaded||{},this.loaded[D]=G})}reloadTile(b,S){const D=this.loaded,L=b.uid,G=this;if(D&&D[L]){const K=D[L];K.showCollisionBoxes=b.showCollisionBoxes;const W=(Z,J)=>{const ue=K.reloadCallback;ue&&(delete K.reloadCallback,K.parse(K.vectorTile,G.layerIndex,this.availableImages,G.actor,ue)),S(Z,J)};K.status==="parsing"?K.reloadCallback=W:K.status==="done"&&(K.vectorTile?K.parse(K.vectorTile,this.layerIndex,this.availableImages,this.actor,W):W())}}abortTile(b,S){const D=this.loading,L=b.uid;D&&D[L]&&D[L].abort&&(D[L].abort(),delete D[L]),S()}removeTile(b,S){const D=this.loaded,L=b.uid;D&&D[L]&&delete D[L],S()}}class je{constructor(){this.loaded={}}loadTile(b,S){const{uid:D,encoding:L,rawImageData:G}=b,K=a.isImageBitmap(G)?this.getImageData(G):G,W=new a.DEMData(D,K,L);this.loaded=this.loaded||{},this.loaded[D]=W,S(null,W)}getImageData(b){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(b.width,b.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=b.width,this.offscreenCanvas.height=b.height,this.offscreenCanvasContext.drawImage(b,0,0,b.width,b.height);const S=this.offscreenCanvasContext.getImageData(-1,-1,b.width+2,b.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new a.RGBAImage({width:S.width,height:S.height},S.data)}removeTile(b){const S=this.loaded,D=b.uid;S&&S[D]&&delete S[D]}}var Qe=function B(b,S){var D,L=b&&b.type;if(L==="FeatureCollection")for(D=0;D<b.features.length;D++)B(b.features[D],S);else if(L==="GeometryCollection")for(D=0;D<b.geometries.length;D++)B(b.geometries[D],S);else if(L==="Feature")B(b.geometry,S);else if(L==="Polygon")Ze(b.coordinates,S);else if(L==="MultiPolygon")for(D=0;D<b.coordinates.length;D++)Ze(b.coordinates[D],S);return b};function Ze(B,b){if(B.length!==0){He(B[0],b);for(var S=1;S<B.length;S++)He(B[S],!b)}}function He(B,b){for(var S=0,D=0,L=0,G=B.length,K=G-1;L<G;K=L++){var W=(B[L][0]-B[K][0])*(B[K][1]+B[L][1]),Z=S+W;D+=Math.abs(S)>=Math.abs(W)?S-Z+W:W-Z+S,S=Z}S+D>=0!=!!b&&B.reverse()}const it=a.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Ke{constructor(b){this._feature=b,this.extent=a.EXTENT,this.type=b.type,this.properties=b.tags,"id"in b&&!isNaN(b.id)&&(this.id=parseInt(b.id,10))}loadGeometry(){if(this._feature.type===1){const b=[];for(const S of this._feature.geometry)b.push([new a.pointGeometry(S[0],S[1])]);return b}{const b=[];for(const S of this._feature.geometry){const D=[];for(const L of S)D.push(new a.pointGeometry(L[0],L[1]));b.push(D)}return b}}toGeoJSON(b,S,D){return it.call(this,b,S,D)}}class It{constructor(b){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=b.length,this._features=b}feature(b){return new Ke(this._features[b])}}var gt={exports:{}},rt=a.pointGeometry,Kt=a.vectorTile.VectorTileFeature,Dt=vi;function vi(B,b){this.options=b||{},this.features=B,this.length=B.length}function St(B,b){this.id=typeof B.id=="number"?B.id:void 0,this.type=B.type,this.rawGeometry=B.type===1?[B.geometry]:B.geometry,this.properties=B.tags,this.extent=b||4096}vi.prototype.feature=function(B){return new St(this.features[B],this.options.extent)},St.prototype.loadGeometry=function(){var B=this.rawGeometry;this.geometry=[];for(var b=0;b<B.length;b++){for(var S=B[b],D=[],L=0;L<S.length;L++)D.push(new rt(S[L][0],S[L][1]));this.geometry.push(D)}return this.geometry},St.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var B=this.geometry,b=1/0,S=-1/0,D=1/0,L=-1/0,G=0;G<B.length;G++)for(var K=B[G],W=0;W<K.length;W++){var Z=K[W];b=Math.min(b,Z.x),S=Math.max(S,Z.x),D=Math.min(D,Z.y),L=Math.max(L,Z.y)}return[b,D,S,L]},St.prototype.toGeoJSON=Kt.prototype.toGeoJSON;var bi=a.pbf,Fi=Dt;function $r(B){var b=new bi;return function(S,D){for(var L in S.layers)D.writeMessage(3,tt,S.layers[L])}(B,b),b.finish()}function tt(B,b){var S;b.writeVarintField(15,B.version||1),b.writeStringField(1,B.name||""),b.writeVarintField(5,B.extent||4096);var D={keys:[],values:[],keycache:{},valuecache:{}};for(S=0;S<B.length;S++)D.feature=B.feature(S),b.writeMessage(2,Er,D);var L=D.keys;for(S=0;S<L.length;S++)b.writeStringField(3,L[S]);var G=D.values;for(S=0;S<G.length;S++)b.writeMessage(4,Bn,G[S])}function Er(B,b){var S=B.feature;S.id!==void 0&&b.writeVarintField(1,S.id),b.writeMessage(2,Sr,B),b.writeVarintField(3,S.type),b.writeMessage(4,hn,S)}function Sr(B,b){var S=B.feature,D=B.keys,L=B.values,G=B.keycache,K=B.valuecache;for(var W in S.properties){var Z=S.properties[W],J=G[W];if(Z!==null){J===void 0&&(D.push(W),G[W]=J=D.length-1),b.writeVarint(J);var ue=typeof Z;ue!=="string"&&ue!=="boolean"&&ue!=="number"&&(Z=JSON.stringify(Z));var ve=ue+":"+Z,ce=K[ve];ce===void 0&&(L.push(Z),K[ve]=ce=L.length-1),b.writeVarint(ce)}}}function or(B,b){return(b<<3)+(7&B)}function ar(B){return B<<1^B>>31}function hn(B,b){for(var S=B.loadGeometry(),D=B.type,L=0,G=0,K=S.length,W=0;W<K;W++){var Z=S[W],J=1;D===1&&(J=Z.length),b.writeVarint(or(1,J));for(var ue=D===3?Z.length-1:Z.length,ve=0;ve<ue;ve++){ve===1&&D!==1&&b.writeVarint(or(2,ue-1));var ce=Z[ve].x-L,Ve=Z[ve].y-G;b.writeVarint(ar(ce)),b.writeVarint(ar(Ve)),L+=ce,G+=Ve}D===3&&b.writeVarint(or(7,1))}}function Bn(B,b){var S=typeof B;S==="string"?b.writeStringField(1,B):S==="boolean"?b.writeBooleanField(7,B):S==="number"&&(B%1!=0?b.writeDoubleField(3,B):B<0?b.writeSVarintField(6,B):b.writeVarintField(5,B))}function Rn(B,b,S,D,L,G){if(L-D<=S)return;const K=D+L>>1;Fn(B,b,K,D,L,G%2),Rn(B,b,S,D,K-1,G+1),Rn(B,b,S,K+1,L,G+1)}function Fn(B,b,S,D,L,G){for(;L>D;){if(L-D>600){const J=L-D+1,ue=S-D+1,ve=Math.log(J),ce=.5*Math.exp(2*ve/3),Ve=.5*Math.sqrt(ve*ce*(J-ce)/J)*(ue-J/2<0?-1:1);Fn(B,b,S,Math.max(D,Math.floor(S-ue*ce/J+Ve)),Math.min(L,Math.floor(S+(J-ue)*ce/J+Ve)),G)}const K=b[2*S+G];let W=D,Z=L;for(mr(B,b,D,S),b[2*L+G]>K&&mr(B,b,D,L);W<Z;){for(mr(B,b,W,Z),W++,Z--;b[2*W+G]<K;)W++;for(;b[2*Z+G]>K;)Z--}b[2*D+G]===K?mr(B,b,D,Z):(Z++,mr(B,b,Z,L)),Z<=S&&(D=Z+1),S<=Z&&(L=Z-1)}}function mr(B,b,S,D){qr(B,S,D),qr(b,2*S,2*D),qr(b,2*S+1,2*D+1)}function qr(B,b,S){const D=B[b];B[b]=B[S],B[S]=D}function Gr(B,b,S,D){const L=B-S,G=b-D;return L*L+G*G}gt.exports=$r,gt.exports.fromVectorTileJs=$r,gt.exports.fromGeojsonVt=function(B,b){b=b||{};var S={};for(var D in B)S[D]=new Fi(B[D].features,b),S[D].name=D,S[D].version=b.version,S[D].extent=b.extent;return $r({layers:S})},gt.exports.GeoJSONWrapper=Fi;const Zr=B=>B[0],zi=B=>B[1];class On{constructor(b,S=Zr,D=zi,L=64,G=Float64Array){this.nodeSize=L,this.points=b;const K=b.length<65536?Uint16Array:Uint32Array,W=this.ids=new K(b.length),Z=this.coords=new G(2*b.length);for(let J=0;J<b.length;J++)W[J]=J,Z[2*J]=S(b[J]),Z[2*J+1]=D(b[J]);Rn(W,Z,L,0,W.length-1,0)}range(b,S,D,L){return function(G,K,W,Z,J,ue,ve){const ce=[0,G.length-1,0],Ve=[];let $e,Be;for(;ce.length;){const Ye=ce.pop(),et=ce.pop(),bt=ce.pop();if(et-bt<=ve){for(let wt=bt;wt<=et;wt++)$e=K[2*wt],Be=K[2*wt+1],$e>=W&&$e<=J&&Be>=Z&&Be<=ue&&Ve.push(G[wt]);continue}const nt=Math.floor((bt+et)/2);$e=K[2*nt],Be=K[2*nt+1],$e>=W&&$e<=J&&Be>=Z&&Be<=ue&&Ve.push(G[nt]);const ut=(Ye+1)%2;(Ye===0?W<=$e:Z<=Be)&&(ce.push(bt),ce.push(nt-1),ce.push(ut)),(Ye===0?J>=$e:ue>=Be)&&(ce.push(nt+1),ce.push(et),ce.push(ut))}return Ve}(this.ids,this.coords,b,S,D,L,this.nodeSize)}within(b,S,D){return function(L,G,K,W,Z,J){const ue=[0,L.length-1,0],ve=[],ce=Z*Z;for(;ue.length;){const Ve=ue.pop(),$e=ue.pop(),Be=ue.pop();if($e-Be<=J){for(let ut=Be;ut<=$e;ut++)Gr(G[2*ut],G[2*ut+1],K,W)<=ce&&ve.push(L[ut]);continue}const Ye=Math.floor((Be+$e)/2),et=G[2*Ye],bt=G[2*Ye+1];Gr(et,bt,K,W)<=ce&&ve.push(L[Ye]);const nt=(Ve+1)%2;(Ve===0?K-Z<=et:W-Z<=bt)&&(ue.push(Be),ue.push(Ye-1),ue.push(nt)),(Ve===0?K+Z>=et:W+Z>=bt)&&(ue.push(Ye+1),ue.push($e),ue.push(nt))}return ve}(this.ids,this.coords,b,S,D,this.nodeSize)}}const ps={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:B=>B},Ir=Math.fround||(Oi=new Float32Array(1),B=>(Oi[0]=+B,Oi[0]));var Oi;class ds{constructor(b){this.options=Wr(Object.create(ps),b),this.trees=new Array(this.options.maxZoom+1)}load(b){const{log:S,minZoom:D,maxZoom:L,nodeSize:G}=this.options;S&&console.time("total time");const K=`prepare ${b.length} points`;S&&console.time(K),this.points=b;let W=[];for(let Z=0;Z<b.length;Z++)b[Z].geometry&&W.push(Un(b[Z],Z));this.trees[L+1]=new On(W,ms,Ar,G,Float32Array),S&&console.timeEnd(K);for(let Z=L;Z>=D;Z--){const J=+Date.now();W=this._cluster(W,Z),this.trees[Z]=new On(W,ms,Ar,G,Float32Array),S&&console.log("z%d: %d clusters in %dms",Z,W.length,+Date.now()-J)}return S&&console.timeEnd("total time"),this}getClusters(b,S){let D=((b[0]+180)%360+360)%360-180;const L=Math.max(-90,Math.min(90,b[1]));let G=b[2]===180?180:((b[2]+180)%360+360)%360-180;const K=Math.max(-90,Math.min(90,b[3]));if(b[2]-b[0]>=360)D=-180,G=180;else if(D>G){const ue=this.getClusters([D,L,180,K],S),ve=this.getClusters([-180,L,G,K],S);return ue.concat(ve)}const W=this.trees[this._limitZoom(S)],Z=W.range(xt(D),gr(K),xt(G),gr(L)),J=[];for(const ue of Z){const ve=W.points[ue];J.push(ve.numPoints?Vn(ve):this.points[ve.index])}return J}getChildren(b){const S=this._getOriginId(b),D=this._getOriginZoom(b),L="No cluster with the specified id.",G=this.trees[D];if(!G)throw new Error(L);const K=G.points[S];if(!K)throw new Error(L);const W=this.options.radius/(this.options.extent*Math.pow(2,D-1)),Z=G.within(K.x,K.y,W),J=[];for(const ue of Z){const ve=G.points[ue];ve.parentId===b&&J.push(ve.numPoints?Vn(ve):this.points[ve.index])}if(J.length===0)throw new Error(L);return J}getLeaves(b,S,D){const L=[];return this._appendLeaves(L,b,S=S||10,D=D||0,0),L}getTile(b,S,D){const L=this.trees[this._limitZoom(b)],G=Math.pow(2,b),{extent:K,radius:W}=this.options,Z=W/K,J=(D-Z)/G,ue=(D+1+Z)/G,ve={features:[]};return this._addTileFeatures(L.range((S-Z)/G,J,(S+1+Z)/G,ue),L.points,S,D,G,ve),S===0&&this._addTileFeatures(L.range(1-Z/G,J,1,ue),L.points,G,D,G,ve),S===G-1&&this._addTileFeatures(L.range(0,J,Z/G,ue),L.points,-1,D,G,ve),ve.features.length?ve:null}getClusterExpansionZoom(b){let S=this._getOriginZoom(b)-1;for(;S<=this.options.maxZoom;){const D=this.getChildren(b);if(S++,D.length!==1)break;b=D[0].properties.cluster_id}return S}_appendLeaves(b,S,D,L,G){const K=this.getChildren(S);for(const W of K){const Z=W.properties;if(Z&&Z.cluster?G+Z.point_count<=L?G+=Z.point_count:G=this._appendLeaves(b,Z.cluster_id,D,L,G):G<L?G++:b.push(W),b.length===D)break}return G}_addTileFeatures(b,S,D,L,G,K){for(const W of b){const Z=S[W],J=Z.numPoints;let ue,ve,ce;if(J)ue=fs(Z),ve=Z.x,ce=Z.y;else{const Be=this.points[Z.index];ue=Be.properties,ve=xt(Be.geometry.coordinates[0]),ce=gr(Be.geometry.coordinates[1])}const Ve={type:1,geometry:[[Math.round(this.options.extent*(ve*G-D)),Math.round(this.options.extent*(ce*G-L))]],tags:ue};let $e;J?$e=Z.id:this.options.generateId?$e=Z.index:this.points[Z.index].id&&($e=this.points[Z.index].id),$e!==void 0&&(Ve.id=$e),K.features.push(Ve)}}_limitZoom(b){return Math.max(this.options.minZoom,Math.min(Math.floor(+b),this.options.maxZoom+1))}_cluster(b,S){const D=[],{radius:L,extent:G,reduce:K,minPoints:W}=this.options,Z=L/(G*Math.pow(2,S));for(let J=0;J<b.length;J++){const ue=b[J];if(ue.zoom<=S)continue;ue.zoom=S;const ve=this.trees[S+1],ce=ve.within(ue.x,ue.y,Z),Ve=ue.numPoints||1;let $e=Ve;for(const Be of ce){const Ye=ve.points[Be];Ye.zoom>S&&($e+=Ye.numPoints||1)}if($e>Ve&&$e>=W){let Be=ue.x*Ve,Ye=ue.y*Ve,et=K&&Ve>1?this._map(ue,!0):null;const bt=(J<<5)+(S+1)+this.points.length;for(const nt of ce){const ut=ve.points[nt];if(ut.zoom<=S)continue;ut.zoom=S;const wt=ut.numPoints||1;Be+=ut.x*wt,Ye+=ut.y*wt,ut.parentId=bt,K&&(et||(et=this._map(ue,!0)),K(et,this._map(ut)))}ue.parentId=bt,D.push(jr(Be/$e,Ye/$e,bt,$e,et))}else if(D.push(ue),$e>1)for(const Be of ce){const Ye=ve.points[Be];Ye.zoom<=S||(Ye.zoom=S,D.push(Ye))}}return D}_getOriginId(b){return b-this.points.length>>5}_getOriginZoom(b){return(b-this.points.length)%32}_map(b,S){if(b.numPoints)return S?Wr({},b.properties):b.properties;const D=this.points[b.index].properties,L=this.options.map(D);return S&&L===D?Wr({},L):L}}function jr(B,b,S,D,L){return{x:Ir(B),y:Ir(b),zoom:1/0,id:S,parentId:-1,numPoints:D,properties:L}}function Un(B,b){const[S,D]=B.geometry.coordinates;return{x:Ir(xt(S)),y:Ir(gr(D)),zoom:1/0,index:b,parentId:-1}}function Vn(B){return{type:"Feature",id:B.id,properties:fs(B),geometry:{type:"Point",coordinates:[(b=B.x,360*(b-.5)),Xr(B.y)]}};var b}function fs(B){const b=B.numPoints,S=b>=1e4?`${Math.round(b/1e3)}k`:b>=1e3?Math.round(b/100)/10+"k":b;return Wr(Wr({},B.properties),{cluster:!0,cluster_id:B.id,point_count:b,point_count_abbreviated:S})}function xt(B){return B/360+.5}function gr(B){const b=Math.sin(B*Math.PI/180),S=.5-.25*Math.log((1+b)/(1-b))/Math.PI;return S<0?0:S>1?1:S}function Xr(B){const b=(180-360*B)*Math.PI/180;return 360*Math.atan(Math.exp(b))/Math.PI-90}function Wr(B,b){for(const S in b)B[S]=b[S];return B}function ms(B){return B.x}function Ar(B){return B.y}function Cr(B,b,S,D){for(var L,G=D,K=S-b>>1,W=S-b,Z=B[b],J=B[b+1],ue=B[S],ve=B[S+1],ce=b+3;ce<S;ce+=3){var Ve=Nn(B[ce],B[ce+1],Z,J,ue,ve);if(Ve>G)L=ce,G=Ve;else if(Ve===G){var $e=Math.abs(ce-K);$e<W&&(L=ce,W=$e)}}G>D&&(L-b>3&&Cr(B,b,L,D),B[L+2]=G,S-L>3&&Cr(B,L,S,D))}function Nn(B,b,S,D,L,G){var K=L-S,W=G-D;if(K!==0||W!==0){var Z=((B-S)*K+(b-D)*W)/(K*K+W*W);Z>1?(S=L,D=G):Z>0&&(S+=K*Z,D+=W*Z)}return(K=B-S)*K+(W=b-D)*W}function kr(B,b,S,D){var L={id:B===void 0?null:B,type:b,geometry:S,tags:D,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(G){var K=G.geometry,W=G.type;if(W==="Point"||W==="MultiPoint"||W==="LineString")_e(G,K);else if(W==="Polygon"||W==="MultiLineString")for(var Z=0;Z<K.length;Z++)_e(G,K[Z]);else if(W==="MultiPolygon")for(Z=0;Z<K.length;Z++)for(var J=0;J<K[Z].length;J++)_e(G,K[Z][J])}(L),L}function _e(B,b){for(var S=0;S<b.length;S+=3)B.minX=Math.min(B.minX,b[S]),B.minY=Math.min(B.minY,b[S+1]),B.maxX=Math.max(B.maxX,b[S]),B.maxY=Math.max(B.maxY,b[S+1])}function ke(B,b,S,D){if(b.geometry){var L=b.geometry.coordinates,G=b.geometry.type,K=Math.pow(S.tolerance/((1<<S.maxZoom)*S.extent),2),W=[],Z=b.id;if(S.promoteId?Z=b.properties[S.promoteId]:S.generateId&&(Z=D||0),G==="Point")pn(L,W);else if(G==="MultiPoint")for(var J=0;J<L.length;J++)pn(L[J],W);else if(G==="LineString")lr(L,W,K,!1);else if(G==="MultiLineString"){if(S.lineMetrics){for(J=0;J<L.length;J++)lr(L[J],W=[],K,!1),B.push(kr(Z,"LineString",W,b.properties));return}vt(L,W,K,!1)}else if(G==="Polygon")vt(L,W,K,!0);else{if(G!=="MultiPolygon"){if(G==="GeometryCollection"){for(J=0;J<b.geometry.geometries.length;J++)ke(B,{id:Z,geometry:b.geometry.geometries[J],properties:b.properties},S,D);return}throw new Error("Input data is not a valid GeoJSON object.")}for(J=0;J<L.length;J++){var ue=[];vt(L[J],ue,K,!0),W.push(ue)}}B.push(kr(Z,G,W,b.properties))}}function pn(B,b){b.push(Ji(B[0])),b.push(Ui(B[1])),b.push(0)}function lr(B,b,S,D){for(var L,G,K=0,W=0;W<B.length;W++){var Z=Ji(B[W][0]),J=Ui(B[W][1]);b.push(Z),b.push(J),b.push(0),W>0&&(K+=D?(L*J-Z*G)/2:Math.sqrt(Math.pow(Z-L,2)+Math.pow(J-G,2))),L=Z,G=J}var ue=b.length-3;b[2]=1,Cr(b,0,ue,S),b[ue+2]=1,b.size=Math.abs(K),b.start=0,b.end=b.size}function vt(B,b,S,D){for(var L=0;L<B.length;L++){var G=[];lr(B[L],G,S,D),b.push(G)}}function Ji(B){return B/360+.5}function Ui(B){var b=Math.sin(B*Math.PI/180),S=.5-.25*Math.log((1+b)/(1-b))/Math.PI;return S<0?0:S>1?1:S}function Vi(B,b,S,D,L,G,K,W){if(D/=b,G>=(S/=b)&&K<D)return B;if(K<S||G>=D)return null;for(var Z=[],J=0;J<B.length;J++){var ue=B[J],ve=ue.geometry,ce=ue.type,Ve=L===0?ue.minX:ue.minY,$e=L===0?ue.maxX:ue.maxY;if(Ve>=S&&$e<D)Z.push(ue);else if(!($e<S||Ve>=D)){var Be=[];if(ce==="Point"||ce==="MultiPoint")Hr(ve,Be,S,D,L);else if(ce==="LineString")Se(ve,Be,S,D,L,!1,W.lineMetrics);else if(ce==="MultiLineString")ot(ve,Be,S,D,L,!1);else if(ce==="Polygon")ot(ve,Be,S,D,L,!0);else if(ce==="MultiPolygon")for(var Ye=0;Ye<ve.length;Ye++){var et=[];ot(ve[Ye],et,S,D,L,!0),et.length&&Be.push(et)}if(Be.length){if(W.lineMetrics&&ce==="LineString"){for(Ye=0;Ye<Be.length;Ye++)Z.push(kr(ue.id,ce,Be[Ye],ue.tags));continue}ce!=="LineString"&&ce!=="MultiLineString"||(Be.length===1?(ce="LineString",Be=Be[0]):ce="MultiLineString"),ce!=="Point"&&ce!=="MultiPoint"||(ce=Be.length===3?"Point":"MultiPoint"),Z.push(kr(ue.id,ce,Be,ue.tags))}}}return Z.length?Z:null}function Hr(B,b,S,D,L){for(var G=0;G<B.length;G+=3){var K=B[G+L];K>=S&&K<=D&&(b.push(B[G]),b.push(B[G+1]),b.push(B[G+2]))}}function Se(B,b,S,D,L,G,K){for(var W,Z,J=ct(B),ue=L===0?Kr:st,ve=B.start,ce=0;ce<B.length-3;ce+=3){var Ve=B[ce],$e=B[ce+1],Be=B[ce+2],Ye=B[ce+3],et=B[ce+4],bt=L===0?Ve:$e,nt=L===0?Ye:et,ut=!1;K&&(W=Math.sqrt(Math.pow(Ve-Ye,2)+Math.pow($e-et,2))),bt<S?nt>S&&(Z=ue(J,Ve,$e,Ye,et,S),K&&(J.start=ve+W*Z)):bt>D?nt<D&&(Z=ue(J,Ve,$e,Ye,et,D),K&&(J.start=ve+W*Z)):_i(J,Ve,$e,Be),nt<S&&bt>=S&&(Z=ue(J,Ve,$e,Ye,et,S),ut=!0),nt>D&&bt<=D&&(Z=ue(J,Ve,$e,Ye,et,D),ut=!0),!G&&ut&&(K&&(J.end=ve+W*Z),b.push(J),J=ct(B)),K&&(ve+=W)}var wt=B.length-3;Ve=B[wt],$e=B[wt+1],Be=B[wt+2],(bt=L===0?Ve:$e)>=S&&bt<=D&&_i(J,Ve,$e,Be),wt=J.length-3,G&&wt>=3&&(J[wt]!==J[0]||J[wt+1]!==J[1])&&_i(J,J[0],J[1],J[2]),J.length&&b.push(J)}function ct(B){var b=[];return b.size=B.size,b.start=B.start,b.end=B.end,b}function ot(B,b,S,D,L,G){for(var K=0;K<B.length;K++)Se(B[K],b,S,D,L,G,!1)}function _i(B,b,S,D){B.push(b),B.push(S),B.push(D)}function Kr(B,b,S,D,L,G){var K=(G-b)/(D-b);return B.push(G),B.push(S+(L-S)*K),B.push(1),K}function st(B,b,S,D,L,G){var K=(G-S)/(L-S);return B.push(b+(D-b)*K),B.push(G),B.push(1),K}function Mr(B,b){for(var S=[],D=0;D<B.length;D++){var L,G=B[D],K=G.type;if(K==="Point"||K==="MultiPoint"||K==="LineString")L=ci(G.geometry,b);else if(K==="MultiLineString"||K==="Polygon"){L=[];for(var W=0;W<G.geometry.length;W++)L.push(ci(G.geometry[W],b))}else if(K==="MultiPolygon")for(L=[],W=0;W<G.geometry.length;W++){for(var Z=[],J=0;J<G.geometry[W].length;J++)Z.push(ci(G.geometry[W][J],b));L.push(Z)}S.push(kr(G.id,K,L,G.tags))}return S}function ci(B,b){var S=[];S.size=B.size,B.start!==void 0&&(S.start=B.start,S.end=B.end);for(var D=0;D<B.length;D+=3)S.push(B[D]+b,B[D+1],B[D+2]);return S}function $n(B,b){if(B.transformed)return B;var S,D,L,G=1<<B.z,K=B.x,W=B.y;for(S=0;S<B.features.length;S++){var Z=B.features[S],J=Z.geometry,ue=Z.type;if(Z.geometry=[],ue===1)for(D=0;D<J.length;D+=2)Z.geometry.push(ti(J[D],J[D+1],b,G,K,W));else for(D=0;D<J.length;D++){var ve=[];for(L=0;L<J[D].length;L+=2)ve.push(ti(J[D][L],J[D][L+1],b,G,K,W));Z.geometry.push(ve)}}return B.transformed=!0,B}function ti(B,b,S,D,L,G){return[Math.round(S*(B*D-L)),Math.round(S*(b*D-G))]}function Ai(B,b,S,D,L){for(var G=b===L.maxZoom?0:L.tolerance/((1<<b)*L.extent),K={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:S,y:D,z:b,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},W=0;W<B.length;W++){K.numFeatures++,Lt(K,B[W],G,L);var Z=B[W].minX,J=B[W].minY,ue=B[W].maxX,ve=B[W].maxY;Z<K.minX&&(K.minX=Z),J<K.minY&&(K.minY=J),ue>K.maxX&&(K.maxX=ue),ve>K.maxY&&(K.maxY=ve)}return K}function Lt(B,b,S,D){var L=b.geometry,G=b.type,K=[];if(G==="Point"||G==="MultiPoint")for(var W=0;W<L.length;W+=3)K.push(L[W]),K.push(L[W+1]),B.numPoints++,B.numSimplified++;else if(G==="LineString")qn(K,L,B,S,!1,!1);else if(G==="MultiLineString"||G==="Polygon")for(W=0;W<L.length;W++)qn(K,L[W],B,S,G==="Polygon",W===0);else if(G==="MultiPolygon")for(var Z=0;Z<L.length;Z++){var J=L[Z];for(W=0;W<J.length;W++)qn(K,J[W],B,S,!0,W===0)}if(K.length){var ue=b.tags||null;if(G==="LineString"&&D.lineMetrics){for(var ve in ue={},b.tags)ue[ve]=b.tags[ve];ue.mapbox_clip_start=L.start/L.size,ue.mapbox_clip_end=L.end/L.size}var ce={geometry:K,type:G==="Polygon"||G==="MultiPolygon"?3:G==="LineString"||G==="MultiLineString"?2:1,tags:ue};b.id!==null&&(ce.id=b.id),B.features.push(ce)}}function qn(B,b,S,D,L,G){var K=D*D;if(D>0&&b.size<(L?K:D))S.numPoints+=b.length/3;else{for(var W=[],Z=0;Z<b.length;Z+=3)(D===0||b[Z+2]>K)&&(S.numSimplified++,W.push(b[Z]),W.push(b[Z+1])),S.numPoints++;L&&function(J,ue){for(var ve=0,ce=0,Ve=J.length,$e=Ve-2;ce<Ve;$e=ce,ce+=2)ve+=(J[ce]-J[$e])*(J[ce+1]+J[$e+1]);if(ve>0===ue)for(ce=0,Ve=J.length;ce<Ve/2;ce+=2){var Be=J[ce],Ye=J[ce+1];J[ce]=J[Ve-2-ce],J[ce+1]=J[Ve-1-ce],J[Ve-2-ce]=Be,J[Ve-1-ce]=Ye}}(W,G),B.push(W)}}function _r(B,b){var S=(b=this.options=function(L,G){for(var K in G)L[K]=G[K];return L}(Object.create(this.options),b)).debug;if(S&&console.time("preprocess data"),b.maxZoom<0||b.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(b.promoteId&&b.generateId)throw new Error("promoteId and generateId cannot be used together.");var D=function(L,G){var K=[];if(L.type==="FeatureCollection")for(var W=0;W<L.features.length;W++)ke(K,L.features[W],G,W);else ke(K,L.type==="Feature"?L:{geometry:L},G);return K}(B,b);this.tiles={},this.tileCoords=[],S&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",b.indexMaxZoom,b.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),D=function(L,G){var K=G.buffer/G.extent,W=L,Z=Vi(L,1,-1-K,K,0,-1,2,G),J=Vi(L,1,1-K,2+K,0,-1,2,G);return(Z||J)&&(W=Vi(L,1,-K,1+K,0,-1,2,G)||[],Z&&(W=Mr(Z,1).concat(W)),J&&(W=W.concat(Mr(J,-1)))),W}(D,b),D.length&&this.splitTile(D,0,0,0),S&&(D.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function dn(B,b,S){return 32*((1<<B)*S+b)+B}function fn(B,b){const S=B.tileID.canonical;if(!this._geoJSONIndex)return b(null,null);const D=this._geoJSONIndex.getTile(S.z,S.x,S.y);if(!D)return b(null,null);const L=new It(D.features);let G=gt.exports(L);G.byteOffset===0&&G.byteLength===G.buffer.byteLength||(G=new Uint8Array(G)),b(null,{vectorTile:L,rawData:G.buffer})}_r.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},_r.prototype.splitTile=function(B,b,S,D,L,G,K){for(var W=[B,b,S,D],Z=this.options,J=Z.debug;W.length;){D=W.pop(),S=W.pop(),b=W.pop(),B=W.pop();var ue=1<<b,ve=dn(b,S,D),ce=this.tiles[ve];if(!ce&&(J>1&&console.time("creation"),ce=this.tiles[ve]=Ai(B,b,S,D,Z),this.tileCoords.push({z:b,x:S,y:D}),J)){J>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",b,S,D,ce.numFeatures,ce.numPoints,ce.numSimplified),console.timeEnd("creation"));var Ve="z"+b;this.stats[Ve]=(this.stats[Ve]||0)+1,this.total++}if(ce.source=B,L){if(b===Z.maxZoom||b===L)continue;var $e=1<<L-b;if(S!==Math.floor(G/$e)||D!==Math.floor(K/$e))continue}else if(b===Z.indexMaxZoom||ce.numPoints<=Z.indexMaxPoints)continue;if(ce.source=null,B.length!==0){J>1&&console.time("clipping");var Be,Ye,et,bt,nt,ut,wt=.5*Z.buffer/Z.extent,Ot=.5-wt,ui=.5+wt,Gt=1+wt;Be=Ye=et=bt=null,nt=Vi(B,ue,S-wt,S+ui,0,ce.minX,ce.maxX,Z),ut=Vi(B,ue,S+Ot,S+Gt,0,ce.minX,ce.maxX,Z),B=null,nt&&(Be=Vi(nt,ue,D-wt,D+ui,1,ce.minY,ce.maxY,Z),Ye=Vi(nt,ue,D+Ot,D+Gt,1,ce.minY,ce.maxY,Z),nt=null),ut&&(et=Vi(ut,ue,D-wt,D+ui,1,ce.minY,ce.maxY,Z),bt=Vi(ut,ue,D+Ot,D+Gt,1,ce.minY,ce.maxY,Z),ut=null),J>1&&console.timeEnd("clipping"),W.push(Be||[],b+1,2*S,2*D),W.push(Ye||[],b+1,2*S,2*D+1),W.push(et||[],b+1,2*S+1,2*D),W.push(bt||[],b+1,2*S+1,2*D+1)}}},_r.prototype.getTile=function(B,b,S){var D=this.options,L=D.extent,G=D.debug;if(B<0||B>24)return null;var K=1<<B,W=dn(B,b=(b%K+K)%K,S);if(this.tiles[W])return $n(this.tiles[W],L);G>1&&console.log("drilling down to z%d-%d-%d",B,b,S);for(var Z,J=B,ue=b,ve=S;!Z&&J>0;)J--,ue=Math.floor(ue/2),ve=Math.floor(ve/2),Z=this.tiles[dn(J,ue,ve)];return Z&&Z.source?(G>1&&console.log("found parent tile z%d-%d-%d",J,ue,ve),G>1&&console.time("drilling down"),this.splitTile(Z.source,J,ue,ve,B,b,S),G>1&&console.timeEnd("drilling down"),this.tiles[W]?$n(this.tiles[W],L):null):null};class Gn extends Te{constructor(b,S,D,L){super(b,S,D,fn),L&&(this.loadGeoJSON=L)}loadData(b,S){var D;(D=this._pendingRequest)===null||D===void 0||D.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const L=!!(b&&b.request&&b.request.collectResourceTiming)&&new a.RequestPerformance(b.request);this._pendingCallback=S,this._pendingRequest=this.loadGeoJSON(b,(G,K)=>{if(delete this._pendingCallback,delete this._pendingRequest,G||!K)return S(G);if(typeof K!="object")return S(new Error(`Input data given to '${b.source}' is not a valid GeoJSON object.`));{Qe(K,!0);try{if(b.filter){const Z=a.createExpression(b.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Z.result==="error")throw new Error(Z.value.map(ue=>`${ue.key}: ${ue.message}`).join(", "));K={type:"FeatureCollection",features:K.features.filter(ue=>Z.value.evaluate({zoom:0},ue))}}this._geoJSONIndex=b.cluster?new ds(function({superclusterOptions:Z,clusterProperties:J}){if(!J||!Z)return Z;const ue={},ve={},ce={accumulated:null,zoom:0},Ve={properties:null},$e=Object.keys(J);for(const Be of $e){const[Ye,et]=J[Be],bt=a.createExpression(et),nt=a.createExpression(typeof Ye=="string"?[Ye,["accumulated"],["get",Be]]:Ye);ue[Be]=bt.value,ve[Be]=nt.value}return Z.map=Be=>{Ve.properties=Be;const Ye={};for(const et of $e)Ye[et]=ue[et].evaluate(ce,Ve);return Ye},Z.reduce=(Be,Ye)=>{Ve.properties=Ye;for(const et of $e)ce.accumulated=Be[et],Be[et]=ve[et].evaluate(ce,Ve)},Z}(b)).load(K.features):function(Z,J){return new _r(Z,J)}(K,b.geojsonVtOptions)}catch(Z){return S(Z)}this.loaded={};const W={};if(L){const Z=L.finish();Z&&(W.resourceTiming={},W.resourceTiming[b.source]=JSON.parse(JSON.stringify(Z)))}S(null,W)}})}reloadTile(b,S){const D=this.loaded;return D&&D[b.uid]?super.reloadTile(b,S):this.loadTile(b,S)}loadGeoJSON(b,S){if(b.request)return a.getJSON(b.request,S);if(typeof b.data=="string")try{S(null,JSON.parse(b.data))}catch{S(new Error(`Input data given to '${b.source}' is not a valid GeoJSON object.`))}else S(new Error(`Input data given to '${b.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(b,S){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),S()}getClusterExpansionZoom(b,S){try{S(null,this._geoJSONIndex.getClusterExpansionZoom(b.clusterId))}catch(D){S(D)}}getClusterChildren(b,S){try{S(null,this._geoJSONIndex.getChildren(b.clusterId))}catch(D){S(D)}}getClusterLeaves(b,S){try{S(null,this._geoJSONIndex.getLeaves(b.clusterId,b.limit,b.offset))}catch(D){S(D)}}}class mn{constructor(b){this.self=b,this.actor=new a.Actor(b,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Te,geojson:Gn},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(S,D)=>{if(this.workerSourceTypes[S])throw new Error(`Worker source with name "${S}" already registered.`);this.workerSourceTypes[S]=D},this.self.registerRTLTextPlugin=S=>{if(a.plugin.isParsed())throw new Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=S.applyArabicShaping,a.plugin.processBidirectionalText=S.processBidirectionalText,a.plugin.processStyledBidirectionalText=S.processStyledBidirectionalText}}setReferrer(b,S){this.referrer=S}setImages(b,S,D){this.availableImages[b]=S;for(const L in this.workerSources[b]){const G=this.workerSources[b][L];for(const K in G)G[K].availableImages=S}D()}setLayers(b,S,D){this.getLayerIndex(b).replace(S),D()}updateLayers(b,S,D){this.getLayerIndex(b).update(S.layers,S.removedIds),D()}loadTile(b,S,D){this.getWorkerSource(b,S.type,S.source).loadTile(S,D)}loadDEMTile(b,S,D){this.getDEMWorkerSource(b,S.source).loadTile(S,D)}reloadTile(b,S,D){this.getWorkerSource(b,S.type,S.source).reloadTile(S,D)}abortTile(b,S,D){this.getWorkerSource(b,S.type,S.source).abortTile(S,D)}removeTile(b,S,D){this.getWorkerSource(b,S.type,S.source).removeTile(S,D)}removeDEMTile(b,S){this.getDEMWorkerSource(b,S.source).removeTile(S)}removeSource(b,S,D){if(!this.workerSources[b]||!this.workerSources[b][S.type]||!this.workerSources[b][S.type][S.source])return;const L=this.workerSources[b][S.type][S.source];delete this.workerSources[b][S.type][S.source],L.removeSource!==void 0?L.removeSource(S,D):D()}loadWorkerSource(b,S,D){try{this.self.importScripts(S.url),D()}catch(L){D(L.toString())}}syncRTLPluginState(b,S,D){try{a.plugin.setState(S);const L=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&L!=null){this.self.importScripts(L);const G=a.plugin.isParsed();D(G?void 0:new Error(`RTL Text Plugin failed to import scripts from ${L}`),G)}}catch(L){D(L.toString())}}getAvailableImages(b){let S=this.availableImages[b];return S||(S=[]),S}getLayerIndex(b){let S=this.layerIndexes[b];return S||(S=this.layerIndexes[b]=new pe),S}getWorkerSource(b,S,D){if(this.workerSources[b]||(this.workerSources[b]={}),this.workerSources[b][S]||(this.workerSources[b][S]={}),!this.workerSources[b][S][D]){const L={send:(G,K,W)=>{this.actor.send(G,K,W,b)}};this.workerSources[b][S][D]=new this.workerSourceTypes[S](L,this.getLayerIndex(b),this.getAvailableImages(b))}return this.workerSources[b][S][D]}getDEMWorkerSource(b,S){return this.demWorkerSources[b]||(this.demWorkerSources[b]={}),this.demWorkerSources[b][S]||(this.demWorkerSources[b][S]=new je),this.demWorkerSources[b][S]}enforceCacheSizeLimit(b,S){a.enforceCacheSizeLimit(S)}}return a.isWorker()&&(self.worker=new mn(self)),mn}),X(["./shared"],function(a){var de=ae;function ae(l){return!function(t){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var o,u,p=new Blob([""],{type:"text/javascript"}),f=URL.createObjectURL(p);try{u=new Worker(f),o=!0}catch{o=!1}return u&&u.terminate(),URL.revokeObjectURL(f),o}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var o=document.createElement("canvas");o.width=o.height=1;var u=o.getContext("2d");if(!u)return!1;var p=u.getImageData(0,0,1,1);return p&&p.width===o.width}()?(pe[n=t&&t.failIfMajorPerformanceCaveat]===void 0&&(pe[n]=function(o){var u,p=function(f){var _=document.createElement("canvas"),y=Object.create(ae.webGLContextAttributes);return y.failIfMajorPerformanceCaveat=f,_.getContext("webgl",y)||_.getContext("experimental-webgl",y)}(o);if(!p)return!1;try{u=p.createShader(p.VERTEX_SHADER)}catch{return!1}return!(!u||p.isContextLost())&&(p.shaderSource(u,"void main() {}"),p.compileShader(u),p.getShaderParameter(u,p.COMPILE_STATUS)===!0)}(n)),pe[n]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var n}(l)}var pe={};function fe(l,t){if(Array.isArray(l)){if(!Array.isArray(t)||l.length!==t.length)return!1;for(let n=0;n<l.length;n++)if(!fe(l[n],t[n]))return!1;return!0}if(typeof l=="object"&&l!==null&&t!==null){if(typeof t!="object"||Object.keys(l).length!==Object.keys(t).length)return!1;for(const n in l)if(!fe(l[n],t[n]))return!1;return!0}return l===t}ae.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class te{static testProp(t){if(!te.docStyle)return t[0];for(let n=0;n<t.length;n++)if(t[n]in te.docStyle)return t[n];return t[0]}static create(t,n,o){const u=window.document.createElement(t);return n!==void 0&&(u.className=n),o&&o.appendChild(u),u}static createNS(t,n){return window.document.createElementNS(t,n)}static disableDrag(){te.docStyle&&te.selectProp&&(te.userSelect=te.docStyle[te.selectProp],te.docStyle[te.selectProp]="none")}static enableDrag(){te.docStyle&&te.selectProp&&(te.docStyle[te.selectProp]=te.userSelect)}static setTransform(t,n){t.style[te.transformProp]=n}static addEventListener(t,n,o,u={}){t.addEventListener(n,o,"passive"in u?u:u.capture)}static removeEventListener(t,n,o,u={}){t.removeEventListener(n,o,"passive"in u?u:u.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",te.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",te.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",te.suppressClickInternal,!0)},0)}static mousePos(t,n){const o=t.getBoundingClientRect();return new a.pointGeometry(n.clientX-o.left-t.clientLeft,n.clientY-o.top-t.clientTop)}static touchPos(t,n){const o=t.getBoundingClientRect(),u=[];for(let p=0;p<n.length;p++)u.push(new a.pointGeometry(n[p].clientX-o.left-t.clientLeft,n[p].clientY-o.top-t.clientTop));return u}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}te.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,te.selectProp=te.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),te.transformProp=te.testProp(["transform","WebkitTransform"]);class Ce{constructor(t){this._transformRequestFn=t}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}normalizeSpriteURL(t,n,o){const u=function(p){const f=p.match(ze);if(!f)throw new Error(`Unable to parse URL "${p}"`);return{protocol:f[1],authority:f[2],path:f[3]||"/",params:f[4]?f[4].split("&"):[]}}(t);return u.path+=`${n}${o}`,function(p){const f=p.params.length?`?${p.params.join("&")}`:"";return`${p.protocol}://${p.authority}${p.path}${f}`}(u)}setTransformRequest(t){this._transformRequestFn=t}}const ze=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class Te{constructor(t,n,o,u){this.context=t,this.format=o,this.texture=t.gl.createTexture(),this.update(n,u)}update(t,n,o){const{width:u,height:p}=t,f=!(this.size&&this.size[0]===u&&this.size[1]===p||o),{context:_}=this,{gl:y}=_;if(this.useMipmap=Boolean(n&&n.useMipmap),y.bindTexture(y.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!n||n.premultiply!==!1)),f)this.size=[u,p],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||a.isImageBitmap(t)?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,t):y.texImage2D(y.TEXTURE_2D,0,this.format,u,p,0,this.format,y.UNSIGNED_BYTE,t.data);else{const{x:v,y:T}=o||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||a.isImageBitmap(t)?y.texSubImage2D(y.TEXTURE_2D,0,v,T,y.RGBA,y.UNSIGNED_BYTE,t):y.texSubImage2D(y.TEXTURE_2D,0,v,T,u,p,y.RGBA,y.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&y.generateMipmap(y.TEXTURE_2D)}bind(t,n,o){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),o!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=p.LINEAR),t!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,t),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,o||t),this.filter=t),n!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,n),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function je(l){const{userImage:t}=l;return!!(t&&t.render&&t.render())&&(l.data.replace(new Uint8Array(t.data.buffer)),!0)}class Qe extends a.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:n,callback:o}of this.requestors)this._notify(n,o);this.requestors=[]}}getImage(t){return this.images[t]}addImage(t,n){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,n)&&(this.images[t]=n)}_validate(t,n){let o=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new a.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),o=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new a.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),o=!1),this._validateContent(n.content,n)||(this.fire(new a.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),o=!1),o}_validateStretch(t,n){if(!t)return!0;let o=0;for(const u of t){if(u[0]<o||u[1]<u[0]||n<u[1])return!1;o=u[1]}return!0}_validateContent(t,n){return!(t&&(t.length!==4||t[0]<0||n.data.width<t[0]||t[1]<0||n.data.height<t[1]||t[2]<0||n.data.width<t[2]||t[3]<0||n.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,n){const o=this.images[t];if(o.data.width!==n.data.width||o.data.height!==n.data.height)throw new Error(`size mismatch between old image (${o.data.width}x${o.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=o.version+1,this.images[t]=n,this.updatedImages[t]=!0}removeImage(t){const n=this.images[t];delete this.images[t],delete this.patterns[t],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,n){let o=!0;if(!this.isLoaded())for(const u of t)this.images[u]||(o=!1);this.isLoaded()||o?this._notify(t,n):this.requestors.push({ids:t,callback:n})}_notify(t,n){const o={};for(const u of t){this.images[u]||this.fire(new a.Event("styleimagemissing",{id:u}));const p=this.images[u];p?o[u]={data:p.data.clone(),pixelRatio:p.pixelRatio,sdf:p.sdf,version:p.version,stretchX:p.stretchX,stretchY:p.stretchY,content:p.content,hasRenderCallback:Boolean(p.userImage&&p.userImage.render)}:a.warnOnce(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}n(null,o)}getPixelSize(){const{width:t,height:n}=this.atlasImage;return{width:t,height:n}}getPattern(t){const n=this.patterns[t],o=this.getImage(t);if(!o)return null;if(n&&n.position.version===o.version)return n.position;if(n)n.position.version=o.version;else{const u={w:o.data.width+2,h:o.data.height+2,x:0,y:0},p=new a.ImagePosition(u,o);this.patterns[t]={bin:u,position:p}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const n=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Te(t,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const p in this.patterns)t.push(this.patterns[p].bin);const{w:n,h:o}=a.potpack(t),u=this.atlasImage;u.resize({width:n||1,height:o||1});for(const p in this.patterns){const{bin:f}=this.patterns[p],_=f.x+1,y=f.y+1,v=this.images[p].data,T=v.width,I=v.height;a.RGBAImage.copy(v,u,{x:0,y:0},{x:_,y},{width:T,height:I}),a.RGBAImage.copy(v,u,{x:0,y:I-1},{x:_,y:y-1},{width:T,height:1}),a.RGBAImage.copy(v,u,{x:0,y:0},{x:_,y:y+I},{width:T,height:1}),a.RGBAImage.copy(v,u,{x:T-1,y:0},{x:_-1,y},{width:1,height:I}),a.RGBAImage.copy(v,u,{x:0,y:0},{x:_+T,y},{width:1,height:I})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const n of t){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const o=this.images[n];o||a.warnOnce(`Image with ID: "${n}" was not found`),je(o)&&this.updateImage(n,o)}}}const Ze=1e20;function He(l,t,n,o,u,p,f,_,y){for(let v=t;v<t+o;v++)it(l,n*p+v,p,u,f,_,y);for(let v=n;v<n+u;v++)it(l,v*p+t,1,o,f,_,y)}function it(l,t,n,o,u,p,f){p[0]=0,f[0]=-Ze,f[1]=Ze,u[0]=l[t];for(let _=1,y=0,v=0;_<o;_++){u[_]=l[t+_*n];const T=_*_;do{const I=p[y];v=(u[_]-u[I]+T-I*I)/(_-I)/2}while(v<=f[y]&&--y>-1);y++,p[y]=_,f[y]=v,f[y+1]=Ze}for(let _=0,y=0;_<o;_++){for(;f[y+1]<_;)y++;const v=p[y],T=_-v;l[t+_*n]=u[v]+T*T}}class Ke{constructor(t,n){this.requestManager=t,this.localIdeographFontFamily=n,this.entries={}}setURL(t){this.url=t}getGlyphs(t,n){const o=[];for(const u in t)for(const p of t[u])o.push({stack:u,id:p});a.asyncAll(o,({stack:u,id:p},f)=>{let _=this.entries[u];_||(_=this.entries[u]={glyphs:{},requests:{},ranges:{}});let y=_.glyphs[p];if(y!==void 0)return void f(null,{stack:u,id:p,glyph:y});if(y=this._tinySDF(_,u,p),y)return _.glyphs[p]=y,void f(null,{stack:u,id:p,glyph:y});const v=Math.floor(p/256);if(256*v>65535)return void f(new Error("glyphs > 65535 not supported"));if(_.ranges[v])return void f(null,{stack:u,id:p,glyph:y});let T=_.requests[v];T||(T=_.requests[v]=[],Ke.loadGlyphRange(u,v,this.url,this.requestManager,(I,M)=>{if(M){for(const U in M)this._doesCharSupportLocalGlyph(+U)||(_.glyphs[+U]=M[+U]);_.ranges[v]=!0}for(const U of T)U(I,M);delete _.requests[v]})),T.push((I,M)=>{I?f(I):M&&f(null,{stack:u,id:p,glyph:M[p]||null})})},(u,p)=>{if(u)n(u);else if(p){const f={};for(const{stack:_,id:y,glyph:v}of p)(f[_]||(f[_]={}))[y]=v&&{id:v.id,bitmap:v.bitmap.clone(),metrics:v.metrics};n(null,f)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(a.unicodeBlockLookup["CJK Unified Ideographs"](t)||a.unicodeBlockLookup["Hangul Syllables"](t)||a.unicodeBlockLookup.Hiragana(t)||a.unicodeBlockLookup.Katakana(t))}_tinySDF(t,n,o){const u=this.localIdeographFontFamily;if(!u||!this._doesCharSupportLocalGlyph(o))return;let p=t.tinySDF;if(!p){let _="400";/bold/i.test(n)?_="900":/medium/i.test(n)?_="500":/light/i.test(n)&&(_="200"),p=t.tinySDF=new Ke.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:u,fontWeight:_})}const f=p.draw(String.fromCharCode(o));return{id:o,bitmap:new a.AlphaImage({width:f.width||30,height:f.height||30},f.data),metrics:{width:f.glyphWidth||24,height:f.glyphHeight||24,left:f.glyphLeft||0,top:f.glyphTop-27||-8,advance:f.glyphAdvance||24}}}}Ke.loadGlyphRange=function(l,t,n,o,u){const p=256*t,f=p+255,_=o.transformRequest(n.replace("{fontstack}",l).replace("{range}",`${p}-${f}`),a.ResourceType.Glyphs);a.getArrayBuffer(_,(y,v)=>{if(y)u(y);else if(v){const T={};for(const I of a.parseGlyphPbf(v))T[I.id]=I;u(null,T)}})},Ke.TinySDF=class{constructor({fontSize:l=24,buffer:t=3,radius:n=8,cutoff:o=.25,fontFamily:u="sans-serif",fontWeight:p="normal",fontStyle:f="normal"}={}){this.buffer=t,this.cutoff=o,this.radius=n;const _=this.size=l+4*t,y=this._createCanvas(_),v=this.ctx=y.getContext("2d",{willReadFrequently:!0});v.font=`${f} ${p} ${l}px ${u}`,v.textBaseline="alphabetic",v.textAlign="left",v.fillStyle="black",this.gridOuter=new Float64Array(_*_),this.gridInner=new Float64Array(_*_),this.f=new Float64Array(_),this.z=new Float64Array(_+1),this.v=new Uint16Array(_)}_createCanvas(l){const t=document.createElement("canvas");return t.width=t.height=l,t}draw(l){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:o,actualBoundingBoxLeft:u,actualBoundingBoxRight:p}=this.ctx.measureText(l),f=Math.ceil(n),_=Math.min(this.size-this.buffer,Math.ceil(p-u)),y=Math.min(this.size-this.buffer,f+Math.ceil(o)),v=_+2*this.buffer,T=y+2*this.buffer,I=Math.max(v*T,0),M=new Uint8ClampedArray(I),U={data:M,width:v,height:T,glyphWidth:_,glyphHeight:y,glyphTop:f,glyphLeft:0,glyphAdvance:t};if(_===0||y===0)return U;const{ctx:F,buffer:O,gridInner:H,gridOuter:Q}=this;F.clearRect(O,O,_,y),F.fillText(l,O,O+f);const re=F.getImageData(O,O,_,y);Q.fill(Ze,0,I),H.fill(0,0,I);for(let V=0;V<y;V++)for(let oe=0;oe<_;oe++){const ne=re.data[4*(V*_+oe)+3]/255;if(ne===0)continue;const me=(V+O)*v+oe+O;if(ne===1)Q[me]=0,H[me]=Ze;else{const ge=.5-ne;Q[me]=ge>0?ge*ge:0,H[me]=ge<0?ge*ge:0}}He(Q,0,0,v,T,v,this.f,this.v,this.z),He(H,O,O,_,y,v,this.f,this.v,this.z);for(let V=0;V<I;V++){const oe=Math.sqrt(Q[V])-Math.sqrt(H[V]);M[V]=Math.round(255-255*(oe/this.radius+this.cutoff))}return U}};const It=new a.Properties({anchor:new a.DataConstantProperty(a.spec.light.anchor),position:new class{constructor(){this.specification=a.spec.light.position}possiblyEvaluate(l,t){return a.sphericalToCartesian(l.expression.evaluate(t))}interpolate(l,t,n){return{x:a.number(l.x,t.x,n),y:a.number(l.y,t.y,n),z:a.number(l.z,t.z,n)}}},color:new a.DataConstantProperty(a.spec.light.color),intensity:new a.DataConstantProperty(a.spec.light.intensity)}),gt="-transition";class rt extends a.Evented{constructor(t){super(),this._transitionable=new a.Transitionable(It),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n={}){if(!this._validate(a.validateLight,t,n))for(const o in t){const u=t[o];o.endsWith(gt)?this._transitionable.setTransition(o.slice(0,-gt.length),u):this._transitionable.setValue(o,u)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,o){return(!o||o.validate!==!1)&&a.emitValidationErrors(this,t.call(a.validateStyle,a.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}class Kt{constructor(t,n){this.width=t,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,n){const o=t.join(",")+String(n);return this.dashEntry[o]||(this.dashEntry[o]=this.addDash(t,n)),this.dashEntry[o]}getDashRanges(t,n,o){const u=[];let p=t.length%2==1?-t[t.length-1]*o:0,f=t[0]*o,_=!0;u.push({left:p,right:f,isDash:_,zeroLength:t[0]===0});let y=t[0];for(let v=1;v<t.length;v++){_=!_;const T=t[v];p=y*o,y+=T,f=y*o,u.push({left:p,right:f,isDash:_,zeroLength:T===0})}return u}addRoundDash(t,n,o){const u=n/2;for(let p=-o;p<=o;p++){const f=this.width*(this.nextRow+o+p);let _=0,y=t[_];for(let v=0;v<this.width;v++){v/y.right>1&&(y=t[++_]);const T=Math.abs(v-y.left),I=Math.abs(v-y.right),M=Math.min(T,I);let U;const F=p/o*(u+1);if(y.isDash){const O=u-Math.abs(F);U=Math.sqrt(M*M+O*O)}else U=u-Math.sqrt(M*M+F*F);this.data[f+v]=Math.max(0,Math.min(255,U+128))}}}addRegularDash(t){for(let _=t.length-1;_>=0;--_){const y=t[_],v=t[_+1];y.zeroLength?t.splice(_,1):v&&v.isDash===y.isDash&&(v.left=y.left,t.splice(_,1))}const n=t[0],o=t[t.length-1];n.isDash===o.isDash&&(n.left=o.left-this.width,o.right=n.right+this.width);const u=this.width*this.nextRow;let p=0,f=t[p];for(let _=0;_<this.width;_++){_/f.right>1&&(f=t[++p]);const y=Math.abs(_-f.left),v=Math.abs(_-f.right),T=Math.min(y,v);this.data[u+_]=Math.max(0,Math.min(255,(f.isDash?T:-T)+128))}}addDash(t,n){const o=n?7:0,u=2*o+1;if(this.nextRow+u>this.height)return a.warnOnce("LineAtlas out of space"),null;let p=0;for(let _=0;_<t.length;_++)p+=t[_];if(p!==0){const _=this.width/p,y=this.getDashRanges(t,this.width,_);n?this.addRoundDash(y,_,o):this.addRegularDash(y)}const f={y:(this.nextRow+o+.5)/this.height,height:2*o/this.height,width:p};return this.nextRow+=u,this.dirty=!0,f}bind(t){const n=t.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}class Dt{constructor(t,n){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a.uniqueId();const o=this.workerPool.acquire(this.id);for(let u=0;u<o.length;u++){const p=new Dt.Actor(o[u],n,this.id);p.name=`Worker ${u}`,this.actors.push(p)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,n,o){a.asyncAll(this.actors,(u,p)=>{u.send(t,n,p)},o=o||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function vi(l,t,n){const o=function(u,p){if(u)return n(u);if(p){const f=a.pick(a.extend(p,l),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);p.vector_layers&&(f.vectorLayers=p.vector_layers,f.vectorLayerIds=f.vectorLayers.map(_=>_.id)),n(null,f)}};return l.url?a.getJSON(t.transformRequest(l.url,a.ResourceType.Source),o):a.exported.frame(()=>o(null,l))}Dt.Actor=a.Actor;class St{constructor(t,n,o){this.bounds=a.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=o||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),o=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*n),u=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*n),p=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*n),f=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*n);return t.x>=o&&t.x<p&&t.y>=u&&t.y<f}}class bi extends a.Evented{constructor(t,n,o,u){if(super(),this.id=t,this.dispatcher=o,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(n,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u)}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=vi(this._options,this.map._requestManager,(t,n)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t?this.fire(new a.ErrorEvent(t)):n&&(a.extend(this,n),n.bounds&&(this.tileBounds=new St(n.bounds,this.minzoom,this.maxzoom)),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}loadTile(t,n){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(o,a.ResourceType.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function p(f,_){return delete t.request,t.aborted?n(null):f&&f.status!==404?n(f):(_&&_.resourceTiming&&(t.resourceTiming=_.resourceTiming),this.map._refreshExpiredTiles&&_&&t.setExpiryData(_),t.loadVectorData(_,this.map.painter),a.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}u.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=n:t.request=t.actor.send("reloadTile",u,p.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",u,p.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Fi extends a.Evented{constructor(t,n,o,u){super(),this.id=t,this.dispatcher=o,this.setEventedParent(u),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},n),a.extend(this,a.pick(n,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=vi(this._options,this.map._requestManager,(t,n)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new a.ErrorEvent(t)):n&&(a.extend(this,n),n.bounds&&(this.tileBounds=new St(n.bounds,this.minzoom,this.maxzoom)),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,n){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=a.getImage(this.map._requestManager.transformRequest(o,a.ResourceType.Tile),(u,p,f)=>{if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(u)t.state="errored",n(u);else if(p){this.map._refreshExpiredTiles&&t.setExpiryData(f);const _=this.map.painter.context,y=_.gl;t.texture=this.map.painter.getTileTexture(p.width),t.texture?t.texture.update(p,{useMipmap:!0}):(t.texture=new Te(_,p,y.RGBA,{useMipmap:!0}),t.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST),_.extTextureFilterAnisotropic&&y.texParameterf(y.TEXTURE_2D,_.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,_.extTextureFilterAnisotropicMax)),t.state="loaded",a.cacheEntryPossiblyAdded(this.dispatcher),n(null)}})}abortTile(t,n){t.request&&(t.request.cancel(),delete t.request),n()}unloadTile(t,n){t.texture&&this.map.painter.saveTileTexture(t.texture),n()}hasTransition(){return!1}}let $r;class tt extends Fi{constructor(t,n,o,u){super(t,n,o,u),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(t,n){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function u(p,f){p&&(t.state="errored",n(p)),f&&(t.dem=f,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",n(null))}t.request=a.getImage(this.map._requestManager.transformRequest(o,a.ResourceType.Tile),function(p,f){if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(p)t.state="errored",n(p);else if(f){this.map._refreshExpiredTiles&&t.setExpiryData(f),delete f.cacheControl,delete f.expires;const _=a.isImageBitmap(f)&&($r==null&&($r=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),$r)?f:a.exported.getImageData(f,1),y={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:_,encoding:this.encoding};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",y,u.bind(this)))}}.bind(this)),t.neighboringTiles=this._getNeighboringTiles(t.tileID)}_getNeighboringTiles(t){const n=t.canonical,o=Math.pow(2,n.z),u=(n.x-1+o)%o,p=n.x===0?t.wrap-1:t.wrap,f=(n.x+1+o)%o,_=n.x+1===o?t.wrap+1:t.wrap,y={};return y[new a.OverscaledTileID(t.overscaledZ,p,n.z,u,n.y).key]={backfilled:!1},y[new a.OverscaledTileID(t.overscaledZ,_,n.z,f,n.y).key]={backfilled:!1},n.y>0&&(y[new a.OverscaledTileID(t.overscaledZ,p,n.z,u,n.y-1).key]={backfilled:!1},y[new a.OverscaledTileID(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},y[new a.OverscaledTileID(t.overscaledZ,_,n.z,f,n.y-1).key]={backfilled:!1}),n.y+1<o&&(y[new a.OverscaledTileID(t.overscaledZ,p,n.z,u,n.y+1).key]={backfilled:!1},y[new a.OverscaledTileID(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},y[new a.OverscaledTileID(t.overscaledZ,_,n.z,f,n.y+1).key]={backfilled:!1}),y}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class Er extends a.Evented{constructor(t,n,o,u){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=o.getActor(),this.setEventedParent(u),this._data=n.data,this._options=a.extend({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const p=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*p,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*p,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:a.EXTENT,radius:(n.clusterRadius||50)*p,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData("content"),this}getClusterExpansionZoom(t,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},n),this}getClusterChildren(t,n){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},n),this}getClusterLeaves(t,n,o,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:n,offset:o},u),this}_updateWorkerData(t){const n=a.extend({},this.workerOptions),o=this._data;typeof o=="string"?(n.request=this.map._requestManager.transformRequest(a.exported.resolveURL(o),a.ResourceType.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(o),this._pendingLoads++,this.fire(new a.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,n,(u,p)=>{if(this._pendingLoads--,this._removed||p&&p.abandoned)return void this.fire(new a.Event("dataabort",{dataType:"source",sourceDataType:t}));let f=null;if(p&&p.resourceTiming&&p.resourceTiming[this.id]&&(f=p.resourceTiming[this.id].slice(0)),u)return void this.fire(new a.ErrorEvent(u));const _={dataType:"source",sourceDataType:t};this._collectResourceTiming&&f&&f.length>0&&a.extend(_,{resourceTiming:f}),this.fire(new a.Event("data",_))})}loaded(){return this._pendingLoads===0}loadTile(t,n){const o=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const u={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(o,u,(p,f)=>(delete t.request,t.unloadVectorData(),t.aborted?n(null):p?n(p):(t.loadVectorData(f,this.map.painter,o==="reloadTile"),n(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return a.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Sr=a.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class or extends a.Evented{constructor(t,n,o,u){super(),this.id=t,this.dispatcher=o,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(u),this.options=n}load(t,n){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,a.getImage(this.map._requestManager.transformRequest(this.url,a.ResourceType.Image),(o,u)=>{this._loaded=!0,o?this.fire(new a.ErrorEvent(o)):u&&(this.image=u,t&&(this.coordinates=t),n&&n(),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}setCoordinates(t){this.coordinates=t;const n=t.map(a.MercatorCoordinate.fromLngLat);this.tileID=function(u){let p=1/0,f=1/0,_=-1/0,y=-1/0;for(const M of u)p=Math.min(p,M.x),f=Math.min(f,M.y),_=Math.max(_,M.x),y=Math.max(y,M.y);const v=Math.max(_-p,y-f),T=Math.max(0,Math.floor(-Math.log(v)/Math.LN2)),I=Math.pow(2,T);return new a.CanonicalTileID(T,Math.floor((p+_)/2*I),Math.floor((f+y)/2*I))}(n),this.minzoom=this.maxzoom=this.tileID.z;const o=n.map(u=>this.tileID.getTilePoint(u)._round());return this._boundsArray=new a.RasterBoundsArray,this._boundsArray.emplaceBack(o[0].x,o[0].y,0,0),this._boundsArray.emplaceBack(o[1].x,o[1].y,a.EXTENT,0),this._boundsArray.emplaceBack(o[3].x,o[3].y,0,a.EXTENT),this._boundsArray.emplaceBack(o[2].x,o[2].y,a.EXTENT,a.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,n=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Sr.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Te(t,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));for(const o in this.tiles){const u=this.tiles[o];u.state!=="loaded"&&(u.state="loaded",u.texture=this.texture)}}loadTile(t,n){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},n(null)):(t.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class ar extends or{constructor(t,n,o,u){super(t,n,o,u),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const n of t.urls)this.urls.push(this.map._requestManager.transformRequest(n,a.ResourceType.Source).url);a.getVideo(this.urls,(n,o)=>{this._loaded=!0,n?this.fire(new a.ErrorEvent(n)):o&&(this.video=o,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,n=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Sr.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new Te(t,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));for(const o in this.tiles){const u=this.tiles[o];u.state!=="loaded"&&(u.state="loaded",u.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class hn extends or{constructor(t,n,o,u){super(t,n,o,u),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(f=>typeof f!="number"))||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context,o=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,Sr.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Te(n,this.canvas,o.RGBA,{premultiply:!0});for(const u in this.tiles){const p=this.tiles[u];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Bn={vector:bi,raster:Fi,"raster-dem":tt,geojson:Er,video:ar,image:or,canvas:hn};function Rn(l,t){const n=a.create();return a.translate(n,n,[1,1,0]),a.scale(n,n,[.5*l.width,.5*l.height,1]),a.multiply(n,n,l.calculatePosMatrix(t.toUnwrapped()))}function Fn(l,t,n,o,u,p){const f=function(I,M,U){if(I)for(const F of I){const O=M[F];if(O&&O.source===U&&O.type==="fill-extrusion")return!0}else for(const F in M){const O=M[F];if(O.source===U&&O.type==="fill-extrusion")return!0}return!1}(u&&u.layers,t,l.id),_=p.maxPitchScaleFactor(),y=l.tilesIn(o,_,f);y.sort(mr);const v=[];for(const I of y)v.push({wrappedTileID:I.tileID.wrapped().key,queryResults:I.tile.queryRenderedFeatures(t,n,l._state,I.queryGeometry,I.cameraQueryGeometry,I.scale,u,p,_,Rn(l.transform,I.tileID))});const T=function(I){const M={},U={};for(const F of I){const O=F.queryResults,H=F.wrappedTileID,Q=U[H]=U[H]||{};for(const re in O){const V=O[re],oe=Q[re]=Q[re]||{},ne=M[re]=M[re]||[];for(const me of V)oe[me.featureIndex]||(oe[me.featureIndex]=!0,ne.push(me))}}return M}(v);for(const I in T)T[I].forEach(M=>{const U=M.feature,F=l.getFeatureState(U.layer["source-layer"],U.id);U.source=U.layer.source,U.layer["source-layer"]&&(U.sourceLayer=U.layer["source-layer"]),U.state=F});return T}function mr(l,t){const n=l.tileID,o=t.tileID;return n.overscaledZ-o.overscaledZ||n.canonical.y-o.canonical.y||n.wrap-o.wrap||n.canonical.x-o.canonical.x}class qr{constructor(t,n){this.tileID=t,this.uid=a.uniqueId(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const n=t+this.timeAdded;n<a.exported.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.textures.forEach(n=>t.saveTileTexture(n)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(t,n,o){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(u,p){const f={};if(!p)return f;for(const _ of u){const y=_.layerIds.map(v=>p.getLayer(v)).filter(Boolean);if(y.length!==0){_.layers=y,_.stateDependentLayerIds&&(_.stateDependentLayers=_.stateDependentLayerIds.map(v=>y.filter(T=>T.id===v)[0]));for(const v of y)f[v.id]=_}}return f}(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const p=this.buckets[u];if(p instanceof a.SymbolBucket){if(this.hasSymbolBuckets=!0,!o)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const p=this.buckets[u];if(p instanceof a.SymbolBucket&&p.hasRTLText){this.hasRTLText=!0,a.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const u in this.buckets){const p=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(u).queryRadius(p))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new a.CollisionBoxArray}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const o in this.buckets){const u=this.buckets[o];u.uploadPending()&&u.upload(t)}const n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Te(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Te(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,n,o,u,p,f,_,y,v,T){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:u,cameraQueryGeometry:p,scale:f,tileSize:this.tileSize,pixelPosMatrix:T,transform:y,params:_,queryPadding:this.queryPadding*v},t,n,o):{}}querySourceFeatures(t,n){const o=this.latestFeatureIndex;if(!o||!o.rawTileData)return;const u=o.loadVTLayers(),p=n?n.sourceLayer:"",f=u._geojsonTileLayer||u[p];if(!f)return;const _=a.createFilter(n&&n.filter),{z:y,x:v,y:T}=this.tileID.canonical,I={z:y,x:v,y:T};for(let M=0;M<f.length;M++){const U=f.feature(M);if(_.needGeometry){const H=a.toEvaluationFeature(U,!0);if(!_.filter(new a.EvaluationParameters(this.tileID.overscaledZ),H,this.tileID.canonical))continue}else if(!_.filter(new a.EvaluationParameters(this.tileID.overscaledZ),U))continue;const F=o.getId(U,p),O=new a.GeoJSONFeature(U,y,v,T,F);O.tile=I,t.push(O)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const o=a.parseCacheControl(t.cacheControl);o["max-age"]&&(this.expirationTime=Date.now()+1e3*o["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const o=Date.now();let u=!1;if(this.expirationTime>o)u=!1;else if(n)if(this.expirationTime<n)u=!0;else{const p=this.expirationTime-n;p?this.expirationTime=o+Math.max(p,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const o=this.latestFeatureIndex.loadVTLayers();for(const u in this.buckets){if(!n.style.hasLayer(u))continue;const p=this.buckets[u],f=p.layers[0].sourceLayer||"_geojsonTileLayer",_=o[f],y=t[f];if(!_||!y||Object.keys(y).length===0)continue;p.update(y,_,this.imageAtlas&&this.imageAtlas.patternPositions||{});const v=n&&n.style&&n.style.getLayer(u);v&&(this.queryPadding=Math.max(this.queryPadding,v.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<a.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=a.exported.now()+t}setDependencies(t,n){const o={};for(const u of n)o[u]=!0;this.dependencies[t]=o}hasDependency(t,n){for(const o of t){const u=this.dependencies[o];if(u){for(const p of n)if(u[p])return!0}}return!1}}class Gr{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,o){const u=t.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const p={value:n,timeout:void 0};if(o!==void 0&&(p.timeout=setTimeout(()=>{this.remove(t,p)},o)),this.data[u].push(p),this.order.push(u),this.order.length>this.max){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const o=t.wrapped().key,u=n===void 0?0:this.data[o].indexOf(n),p=this.data[o][u];return this.data[o].splice(u,1),p.timeout&&clearTimeout(p.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(p.value),this.order.splice(this.order.indexOf(o),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const o in this.data)for(const u of this.data[o])t(u.value)||n.push(u);for(const o of n)this.remove(o.value.tileID,o)}}class Zr{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,o){const u=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][u]=this.stateChanges[t][u]||{},a.extend(this.stateChanges[t][u],o),this.deletedStates[t]===null){this.deletedStates[t]={};for(const p in this.state[t])p!==u&&(this.deletedStates[t][p]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][u]===null){this.deletedStates[t][u]={};for(const p in this.state[t][u])o[p]||(this.deletedStates[t][u][p]=null)}else for(const p in o)this.deletedStates[t]&&this.deletedStates[t][u]&&this.deletedStates[t][u][p]===null&&delete this.deletedStates[t][u][p]}removeFeatureState(t,n,o){if(this.deletedStates[t]===null)return;const u=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},o&&n!==void 0)this.deletedStates[t][u]!==null&&(this.deletedStates[t][u]=this.deletedStates[t][u]||{},this.deletedStates[t][u][o]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][u])for(o in this.deletedStates[t][u]={},this.stateChanges[t][u])this.deletedStates[t][u][o]=null;else this.deletedStates[t][u]=null;else this.deletedStates[t]=null}getState(t,n){const o=String(n),u=a.extend({},(this.state[t]||{})[o],(this.stateChanges[t]||{})[o]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const p=this.deletedStates[t][n];if(p===null)return{};for(const f in p)delete u[f]}return u}initializeTileState(t,n){t.setFeatureState(this.state,n)}coalesceChanges(t,n){const o={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const p={};for(const f in this.stateChanges[u])this.state[u][f]||(this.state[u][f]={}),a.extend(this.state[u][f],this.stateChanges[u][f]),p[f]=this.state[u][f];o[u]=p}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const p={};if(this.deletedStates[u]===null)for(const f in this.state[u])p[f]={},this.state[u][f]={};else for(const f in this.deletedStates[u]){if(this.deletedStates[u][f]===null)this.state[u][f]={};else for(const _ of Object.keys(this.deletedStates[u][f]))delete this.state[u][f][_];p[f]=this.state[u][f]}o[u]=o[u]||{},a.extend(o[u],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(o).length!==0)for(const u in t)t[u].setFeatureState(o,n)}}class zi extends a.Evented{constructor(t,n,o){super(),this.id=t,this.dispatcher=o,this.on("data",u=>{u.dataType==="source"&&u.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&u.dataType==="source"&&u.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(u,p,f,_){const y=new Bn[p.type](u,p,f,_);if(y.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${y.id}`);return a.bindAll(["load","abort","unload","serialize","prepare"],y),y}(t,n,o,this),this._tiles={},this._cache=new Gr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Zr}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const n=this._tiles[t];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,n){return this._source.loadTile(t,n)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new a.Event("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const o=this._tiles[n];o.upload(t),o.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(On).map(t=>t.key)}getRenderableIds(t){const n=[];for(const o in this._tiles)this._isIdRenderable(o,t)&&n.push(this._tiles[o]);return t?n.sort((o,u)=>{const p=o.tileID,f=u.tileID,_=new a.pointGeometry(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),y=new a.pointGeometry(f.canonical.x,f.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-f.overscaledZ||y.y-_.y||y.x-_.x}).map(o=>o.tileID.key):n.map(o=>o.tileID).sort(On).map(o=>o.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,n){const o=this._tiles[t];o&&(o.state!=="loading"&&(o.state=n),this._loadTile(o,this._tileLoaded.bind(this,o,t,n)))}_tileLoaded(t,n,o,u){if(u)return t.state="errored",void(u.status!==404?this._source.fire(new a.ErrorEvent(u,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=a.exported.now(),o==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new a.Event("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const n=this.getRenderableIds();for(let u=0;u<n.length;u++){const p=n[u];if(t.neighboringTiles&&t.neighboringTiles[p]){const f=this.getTileByID(p);o(t,f),o(f,t)}}function o(u,p){u.needsHillshadePrepare=!0,u.needsTerrainPrepare=!0;let f=p.tileID.canonical.x-u.tileID.canonical.x;const _=p.tileID.canonical.y-u.tileID.canonical.y,y=Math.pow(2,u.tileID.canonical.z),v=p.tileID.key;f===0&&_===0||Math.abs(_)>1||(Math.abs(f)>1&&(Math.abs(f+y)===1?f+=y:Math.abs(f-y)===1&&(f-=y)),p.dem&&u.dem&&(u.dem.backfillBorder(p.dem,f,_),u.neighboringTiles&&u.neighboringTiles[v]&&(u.neighboringTiles[v].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,o,u){for(const p in this._tiles){let f=this._tiles[p];if(u[p]||!f.hasData()||f.tileID.overscaledZ<=n||f.tileID.overscaledZ>o)continue;let _=f.tileID;for(;f&&f.tileID.overscaledZ>n+1;){const v=f.tileID.scaledTo(f.tileID.overscaledZ-1);f=this._tiles[v.key],f&&f.hasData()&&(_=v)}let y=_;for(;y.overscaledZ>n;)if(y=y.scaledTo(y.overscaledZ-1),t[y.key]){u[_.key]=_;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const o=this._loadedParentTiles[t.key];return o&&o.tileID.overscaledZ>=n?o:null}for(let o=t.overscaledZ-1;o>=n;o--){const u=t.scaledTo(o),p=this._getLoadedTile(u);if(p)return p}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const n=Math.ceil(t.width/this._source.tileSize)+1,o=Math.ceil(t.height/this._source.tileSize)+1,u=Math.floor(n*o*5),p=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(p)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,n){const o={};for(const u in this._tiles){const p=this._tiles[u];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+n),o[p.tileID.key]=p}this._tiles=o;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(u,this._tiles[u])}}update(t,n){if(this.transform=t,this.terrain=n,!this._sourceLoaded||this._paused)return;let o;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?o=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(v=>new a.OverscaledTileID(v.canonical.z,v.wrap,v.canonical.z,v.canonical.x,v.canonical.y)):(o=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n}),this._source.hasTile&&(o=o.filter(v=>this._source.hasTile(v)))):o=[];const u=t.coveringZoomLevel(this._source),p=Math.max(u-zi.maxOverzooming,this._source.minzoom),f=Math.max(u+zi.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const v={};for(const T of o)if(T.canonical.z>this._source.minzoom){const I=T.scaledTo(T.canonical.z-1);v[I.key]=I;const M=T.scaledTo(Math.max(this._source.minzoom,Math.min(T.canonical.z,5)));v[M.key]=M}o=o.concat(Object.values(v))}const _=this._updateRetainedTiles(o,u);if(ps(this._source.type)){const v={},T={},I=Object.keys(_);for(const M of I){const U=_[M],F=this._tiles[M];if(!F||F.fadeEndTime&&F.fadeEndTime<=a.exported.now())continue;const O=this.findLoadedParent(U,p);O&&(this._addTile(O.tileID),v[O.tileID.key]=O.tileID),T[M]=U}this._retainLoadedChildren(T,u,f,_);for(const M in v)_[M]||(this._coveredTiles[M]=!0,_[M]=v[M]);if(n){const M={},U={};for(const F of o)this._tiles[F.key].hasData()?M[F.key]=F:U[F.key]=F;for(const F in U){const O=U[F].children(this._source.maxzoom);this._tiles[O[0].key]&&this._tiles[O[1].key]&&this._tiles[O[2].key]&&this._tiles[O[3].key]&&(M[O[0].key]=_[O[0].key]=O[0],M[O[1].key]=_[O[1].key]=O[1],M[O[2].key]=_[O[2].key]=O[2],M[O[3].key]=_[O[3].key]=O[3],delete U[F])}for(const F in U){const O=this.findLoadedParent(U[F],this._source.minzoom);if(O){M[O.tileID.key]=_[O.tileID.key]=O.tileID;for(const H in M)M[H].isChildOf(O.tileID)&&delete M[H]}}for(const F in this._tiles)M[F]||(this._coveredTiles[F]=!0)}}for(const v in _)this._tiles[v].clearFadeHold();const y=a.keysDifference(this._tiles,_);for(const v of y){const T=this._tiles[v];T.hasSymbolBuckets&&!T.holdingForFade()?T.setHoldDuration(this.map._fadeDuration):T.hasSymbolBuckets&&!T.symbolFadeFinished()||this._removeTile(v)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,n){const o={},u={},p=Math.max(n-zi.maxOverzooming,this._source.minzoom),f=Math.max(n+zi.maxUnderzooming,this._source.minzoom),_={};for(const y of t){const v=this._addTile(y);o[y.key]=y,v.hasData()||n<this._source.maxzoom&&(_[y.key]=y)}this._retainLoadedChildren(_,n,f,o);for(const y of t){let v=this._tiles[y.key];if(v.hasData())continue;if(n+1>this._source.maxzoom){const I=y.children(this._source.maxzoom)[0],M=this.getTile(I);if(M&&M.hasData()){o[I.key]=I;continue}}else{const I=y.children(this._source.maxzoom);if(o[I[0].key]&&o[I[1].key]&&o[I[2].key]&&o[I[3].key])continue}let T=v.wasRequested();for(let I=y.overscaledZ-1;I>=p;--I){const M=y.scaledTo(I);if(u[M.key]||(u[M.key]=!0,v=this.getTile(M),!v&&T&&(v=this._addTile(M)),v&&(o[M.key]=M,T=v.wasRequested(),v.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let o,u=this._tiles[t].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){o=this._loadedParentTiles[u.key];break}n.push(u.key);const p=u.scaledTo(u.overscaledZ-1);if(o=this._getLoadedTile(p),o)break;u=p}for(const p of n)this._loadedParentTiles[p]=o}}_addTile(t){let n=this._tiles[t.key];if(n)return n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const o=n;return n||(n=new qr(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))),n.uses++,this._tiles[t.key]=n,o||this._source.fire(new a.Event("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const o=n.getExpiryTimeout();o&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},o))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,n,o){const u=[],p=this.transform;if(!p)return u;const f=o?p.getCameraQueryGeometry(t):t,_=t.map(F=>p.pointCoordinate(F,this.terrain)),y=f.map(F=>p.pointCoordinate(F,this.terrain)),v=this.getIds();let T=1/0,I=1/0,M=-1/0,U=-1/0;for(const F of y)T=Math.min(T,F.x),I=Math.min(I,F.y),M=Math.max(M,F.x),U=Math.max(U,F.y);for(let F=0;F<v.length;F++){const O=this._tiles[v[F]];if(O.holdingForFade())continue;const H=O.tileID,Q=Math.pow(2,p.zoom-O.tileID.overscaledZ),re=n*O.queryPadding*a.EXTENT/O.tileSize/Q,V=[H.getTilePoint(new a.MercatorCoordinate(T,I)),H.getTilePoint(new a.MercatorCoordinate(M,U))];if(V[0].x-re<a.EXTENT&&V[0].y-re<a.EXTENT&&V[1].x+re>=0&&V[1].y+re>=0){const oe=_.map(me=>H.getTilePoint(me)),ne=y.map(me=>H.getTilePoint(me));u.push({tile:O,tileID:H,queryGeometry:oe,cameraQueryGeometry:ne,scale:Q})}}return u}getVisibleCoordinates(t){const n=this.getRenderableIds(t).map(o=>this._tiles[o].tileID);for(const o of n)o.posMatrix=this.transform.calculatePosMatrix(o.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(ps(this._source.type))for(const t in this._tiles){const n=this._tiles[t];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=a.exported.now())return!0}return!1}setFeatureState(t,n,o){this._state.updateState(t=t||"_geojsonTileLayer",n,o)}removeFeatureState(t,n,o){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,o)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,o){const u=this._tiles[t];u&&u.setDependencies(n,o)}reloadTilesForDependencies(t,n){for(const o in this._tiles)this._tiles[o].hasDependency(t,n)&&this._reloadTile(o,"reloading");this._cache.filter(o=>!o.hasDependency(t,n))}}function On(l,t){const n=Math.abs(2*l.wrap)-+(l.wrap<0),o=Math.abs(2*t.wrap)-+(t.wrap<0);return l.overscaledZ-t.overscaledZ||o-n||t.canonical.y-l.canonical.y||t.canonical.x-l.canonical.x}function ps(l){return l==="raster"||l==="image"||l==="video"}zi.maxOverzooming=10,zi.maxUnderzooming=3;const Ir="mapboxgl_preloaded_worker_pool";class Oi{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Oi.workerCount;)this.workers.push(new Worker(vn.workerUrl));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ir]}numActive(){return Object.keys(this.active).length}}const ds=Math.floor(a.exported.hardwareConcurrency/2);let jr;function Un(){return jr||(jr=new Oi),jr}function Vn(l,t){const n={};for(const o in l)o!=="ref"&&(n[o]=l[o]);return a.refProperties.forEach(o=>{o in t&&(n[o]=t[o])}),n}function fs(l){l=l.slice();const t=Object.create(null);for(let n=0;n<l.length;n++)t[l[n].id]=l[n];for(let n=0;n<l.length;n++)"ref"in l[n]&&(l[n]=Vn(l[n],t[l[n].ref]));return l}Oi.workerCount=Math.max(Math.min(ds,6),1);const xt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function gr(l,t,n){n.push({command:xt.addSource,args:[l,t[l]]})}function Xr(l,t,n){t.push({command:xt.removeSource,args:[l]}),n[l]=!0}function Wr(l,t,n,o){Xr(l,n,o),gr(l,t,n)}function ms(l,t,n){let o;for(o in l[n])if(Object.prototype.hasOwnProperty.call(l[n],o)&&o!=="data"&&!fe(l[n][o],t[n][o]))return!1;for(o in t[n])if(Object.prototype.hasOwnProperty.call(t[n],o)&&o!=="data"&&!fe(l[n][o],t[n][o]))return!1;return!0}function Ar(l,t,n,o,u,p){let f;for(f in t=t||{},l=l||{})Object.prototype.hasOwnProperty.call(l,f)&&(fe(l[f],t[f])||n.push({command:p,args:[o,f,t[f],u]}));for(f in t)Object.prototype.hasOwnProperty.call(t,f)&&!Object.prototype.hasOwnProperty.call(l,f)&&(fe(l[f],t[f])||n.push({command:p,args:[o,f,t[f],u]}))}function Cr(l){return l.id}function Nn(l,t){return l[t.id]=t,l}class kr{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let o=1;o<this.points.length;o++)this._distances[o]=this._distances[o-1]+this.points[o].dist(this.points[o-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=a.clamp(t,0,1);let n=1,o=this._distances[n];const u=t*this.paddedLength+this.padding;for(;o<u&&n<this._distances.length;)o=this._distances[++n];const p=n-1,f=this._distances[p],_=o-f,y=_>0?(u-f)/_:0;return this.points[p].mult(1-y).add(this.points[n].mult(y))}}function _e(l,t){let n=!0;return l==="always"||l!=="never"&&t!=="never"||(n=!1),n}class ke{constructor(t,n,o){const u=this.boxCells=[],p=this.circleCells=[];this.xCellCount=Math.ceil(t/o),this.yCellCount=Math.ceil(n/o);for(let f=0;f<this.xCellCount*this.yCellCount;f++)u.push([]),p.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,o,u,p){this._forEachCell(n,o,u,p,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(p)}insertCircle(t,n,o,u){this._forEachCell(n-u,o-u,n+u,o+u,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(o),this.circles.push(u)}_insertBoxCell(t,n,o,u,p,f){this.boxCells[p].push(f)}_insertCircleCell(t,n,o,u,p,f){this.circleCells[p].push(f)}_query(t,n,o,u,p,f,_){if(o<0||t>this.width||u<0||n>this.height)return[];const y=[];if(t<=0&&n<=0&&this.width<=o&&this.height<=u){if(p)return[{key:null,x1:t,y1:n,x2:o,y2:u}];for(let v=0;v<this.boxKeys.length;v++)y.push({key:this.boxKeys[v],x1:this.bboxes[4*v],y1:this.bboxes[4*v+1],x2:this.bboxes[4*v+2],y2:this.bboxes[4*v+3]});for(let v=0;v<this.circleKeys.length;v++){const T=this.circles[3*v],I=this.circles[3*v+1],M=this.circles[3*v+2];y.push({key:this.circleKeys[v],x1:T-M,y1:I-M,x2:T+M,y2:I+M})}}else this._forEachCell(t,n,o,u,this._queryCell,y,{hitTest:p,overlapMode:f,seenUids:{box:{},circle:{}}},_);return y}query(t,n,o,u){return this._query(t,n,o,u,!1,null)}hitTest(t,n,o,u,p,f){return this._query(t,n,o,u,!0,p,f).length>0}hitTestCircle(t,n,o,u,p){const f=t-o,_=t+o,y=n-o,v=n+o;if(_<0||f>this.width||v<0||y>this.height)return!1;const T=[];return this._forEachCell(f,y,_,v,this._queryCellCircle,T,{hitTest:!0,overlapMode:u,circle:{x:t,y:n,radius:o},seenUids:{box:{},circle:{}}},p),T.length>0}_queryCell(t,n,o,u,p,f,_,y){const{seenUids:v,hitTest:T,overlapMode:I}=_,M=this.boxCells[p];if(M!==null){const F=this.bboxes;for(const O of M)if(!v.box[O]){v.box[O]=!0;const H=4*O,Q=this.boxKeys[O];if(t<=F[H+2]&&n<=F[H+3]&&o>=F[H+0]&&u>=F[H+1]&&(!y||y(Q))&&(!T||!_e(I,Q.overlapMode))&&(f.push({key:Q,x1:F[H],y1:F[H+1],x2:F[H+2],y2:F[H+3]}),T))return!0}}const U=this.circleCells[p];if(U!==null){const F=this.circles;for(const O of U)if(!v.circle[O]){v.circle[O]=!0;const H=3*O,Q=this.circleKeys[O];if(this._circleAndRectCollide(F[H],F[H+1],F[H+2],t,n,o,u)&&(!y||y(Q))&&(!T||!_e(I,Q.overlapMode))){const re=F[H],V=F[H+1],oe=F[H+2];if(f.push({key:Q,x1:re-oe,y1:V-oe,x2:re+oe,y2:V+oe}),T)return!0}}}return!1}_queryCellCircle(t,n,o,u,p,f,_,y){const{circle:v,seenUids:T,overlapMode:I}=_,M=this.boxCells[p];if(M!==null){const F=this.bboxes;for(const O of M)if(!T.box[O]){T.box[O]=!0;const H=4*O,Q=this.boxKeys[O];if(this._circleAndRectCollide(v.x,v.y,v.radius,F[H+0],F[H+1],F[H+2],F[H+3])&&(!y||y(Q))&&!_e(I,Q.overlapMode))return f.push(!0),!0}}const U=this.circleCells[p];if(U!==null){const F=this.circles;for(const O of U)if(!T.circle[O]){T.circle[O]=!0;const H=3*O,Q=this.circleKeys[O];if(this._circlesCollide(F[H],F[H+1],F[H+2],v.x,v.y,v.radius)&&(!y||y(Q))&&!_e(I,Q.overlapMode))return f.push(!0),!0}}}_forEachCell(t,n,o,u,p,f,_,y){const v=this._convertToXCellCoord(t),T=this._convertToYCellCoord(n),I=this._convertToXCellCoord(o),M=this._convertToYCellCoord(u);for(let U=v;U<=I;U++)for(let F=T;F<=M;F++)if(p.call(this,t,n,o,u,this.xCellCount*F+U,f,_,y))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,o,u,p,f){const _=u-t,y=p-n,v=o+f;return v*v>_*_+y*y}_circleAndRectCollide(t,n,o,u,p,f,_){const y=(f-u)/2,v=Math.abs(t-(u+y));if(v>y+o)return!1;const T=(_-p)/2,I=Math.abs(n-(p+T));if(I>T+o)return!1;if(v<=y||I<=T)return!0;const M=v-y,U=I-T;return M*M+U*U<=o*o}}function pn(l,t,n,o,u){const p=a.create();return t?(a.scale(p,p,[1/u,1/u,1]),n||a.rotateZ(p,p,o.angle)):a.multiply(p,o.labelPlaneMatrix,l),p}function lr(l,t,n,o,u){if(t){const p=a.clone(l);return a.scale(p,p,[u,u,1]),n||a.rotateZ(p,p,-o.angle),p}return o.glCoordMatrix}function vt(l,t,n){let o;n?(o=[l.x,l.y,n(l.x,l.y),1],a.transformMat4(o,o,t)):(o=[l.x,l.y,0,1],Mr(o,o,t));const u=o[3];return{point:new a.pointGeometry(o[0]/u,o[1]/u),signedDistanceFromCamera:u}}function Ji(l,t){return .5+l/t*.5}function Ui(l,t){const n=l[0]/l[3],o=l[1]/l[3];return n>=-t[0]&&n<=t[0]&&o>=-t[1]&&o<=t[1]}function Vi(l,t,n,o,u,p,f,_,y,v){const T=o?l.textSizeData:l.iconSizeData,I=a.evaluateSizeForZoom(T,n.transform.zoom),M=[256/n.width*2+1,256/n.height*2+1],U=o?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;U.clear();const F=l.lineVertexArray,O=o?l.text.placedSymbolArray:l.icon.placedSymbolArray,H=n.transform.width/n.transform.height;let Q=!1;for(let re=0;re<O.length;re++){const V=O.get(re);if(V.hidden||V.writingMode===a.WritingMode.vertical&&!Q){st(V.numGlyphs,U);continue}let oe;if(Q=!1,v?(oe=[V.anchorX,V.anchorY,v(V.anchorX,V.anchorY),1],a.transformMat4(oe,oe,t)):(oe=[V.anchorX,V.anchorY,0,1],Mr(oe,oe,t)),!Ui(oe,M)){st(V.numGlyphs,U);continue}const ne=Ji(n.transform.cameraToCenterDistance,oe[3]),me=a.evaluateSizeForFeature(T,I,V),ge=f?me/ne:me*ne,be=new a.pointGeometry(V.anchorX,V.anchorY),he=vt(be,u,v).point,Re={},Ie=ct(V,ge,!1,_,t,u,p,l.glyphOffsetArray,F,U,he,be,Re,H,y,v);Q=Ie.useVertical,(Ie.notEnoughRoom||Q||Ie.needsFlipping&&ct(V,ge,!0,_,t,u,p,l.glyphOffsetArray,F,U,he,be,Re,H,y,v).notEnoughRoom)&&st(V.numGlyphs,U)}o?l.text.dynamicLayoutVertexBuffer.updateData(U):l.icon.dynamicLayoutVertexBuffer.updateData(U)}function Hr(l,t,n,o,u,p,f,_,y,v,T,I,M){const U=_.glyphStartIndex+_.numGlyphs,F=_.lineStartIndex,O=_.lineStartIndex+_.lineLength,H=t.getoffsetX(_.glyphStartIndex),Q=t.getoffsetX(U-1),re=_i(l*H,n,o,u,p,f,_.segment,F,O,y,v,T,I,M);if(!re)return null;const V=_i(l*Q,n,o,u,p,f,_.segment,F,O,y,v,T,I,M);return V?{first:re,last:V}:null}function Se(l,t,n,o){return l===a.WritingMode.horizontal&&Math.abs(n.y-t.y)>Math.abs(n.x-t.x)*o?{useVertical:!0}:(l===a.WritingMode.vertical?t.y<n.y:t.x>n.x)?{needsFlipping:!0}:null}function ct(l,t,n,o,u,p,f,_,y,v,T,I,M,U,F,O){const H=t/24,Q=l.lineOffsetX*H,re=l.lineOffsetY*H;let V;if(l.numGlyphs>1){const oe=l.glyphStartIndex+l.numGlyphs,ne=l.lineStartIndex,me=l.lineStartIndex+l.lineLength,ge=Hr(H,_,Q,re,n,T,I,l,y,p,M,F,O);if(!ge)return{notEnoughRoom:!0};const be=vt(ge.first.point,f,O).point,he=vt(ge.last.point,f,O).point;if(o&&!n){const Re=Se(l.writingMode,be,he,U);if(Re)return Re}V=[ge.first];for(let Re=l.glyphStartIndex+1;Re<oe-1;Re++)V.push(_i(H*_.getoffsetX(Re),Q,re,n,T,I,l.segment,ne,me,y,p,M,F,O));V.push(ge.last)}else{if(o&&!n){const ne=vt(I,u,O).point,me=l.lineStartIndex+l.segment+1,ge=new a.pointGeometry(y.getx(me),y.gety(me)),be=vt(ge,u,O),he=be.signedDistanceFromCamera>0?be.point:ot(I,ge,ne,1,u,O),Re=Se(l.writingMode,ne,he,U);if(Re)return Re}const oe=_i(H*_.getoffsetX(l.glyphStartIndex),Q,re,n,T,I,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,y,p,M,F,O);if(!oe)return{notEnoughRoom:!0};V=[oe]}for(const oe of V)a.addDynamicAttributes(v,oe.point,oe.angle);return{}}function ot(l,t,n,o,u,p){const f=vt(l.add(l.sub(t)._unit()),u,p).point,_=n.sub(f);return n.add(_._mult(o/_.mag()))}function _i(l,t,n,o,u,p,f,_,y,v,T,I,M,U){const F=o?l-t:l+t;let O=F>0?1:-1,H=0;o&&(O*=-1,H=Math.PI),O<0&&(H+=Math.PI);let Q=O>0?_+f:_+f+1,re=u,V=u,oe=0,ne=0;const me=Math.abs(F),ge=[];for(;oe+ne<=me;){if(Q+=O,Q<_||Q>=y)return null;if(V=re,ge.push(re),re=I[Q],re===void 0){const Fe=new a.pointGeometry(v.getx(Q),v.gety(Q)),at=vt(Fe,T,U);if(at.signedDistanceFromCamera>0)re=I[Q]=at.point;else{const ht=Q-O;re=ot(oe===0?p:new a.pointGeometry(v.getx(ht),v.gety(ht)),Fe,V,me-oe+1,T,U)}}oe+=ne,ne=V.dist(re)}const be=(me-oe)/ne,he=re.sub(V),Re=he.mult(be)._add(V);Re._add(he._unit()._perp()._mult(n*O));const Ie=H+Math.atan2(re.y-V.y,re.x-V.x);return ge.push(Re),{point:Re,angle:M?Ie:0,path:ge}}const Kr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function st(l,t){for(let n=0;n<l;n++){const o=t.length;t.resize(o+4),t.float32.set(Kr,3*o)}}function Mr(l,t,n){const o=t[0],u=t[1];return l[0]=n[0]*o+n[4]*u+n[12],l[1]=n[1]*o+n[5]*u+n[13],l[3]=n[3]*o+n[7]*u+n[15],l}const ci=100;class $n{constructor(t,n=new ke(t.width+200,t.height+200,25),o=new ke(t.width+200,t.height+200,25)){this.transform=t,this.grid=n,this.ignoredGrid=o,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+ci,this.screenBottomBoundary=t.height+ci,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,n,o,u,p,f){const _=this.projectAndGetPerspectiveRatio(u,t.anchorPointX,t.anchorPointY,f),y=o*_.perspectiveRatio,v=t.x1*y+_.point.x,T=t.y1*y+_.point.y,I=t.x2*y+_.point.x,M=t.y2*y+_.point.y;return!this.isInsideGrid(v,T,I,M)||n!=="always"&&this.grid.hitTest(v,T,I,M,n,p)||_.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[v,T,I,M],offscreen:this.isOffscreen(v,T,I,M)}}placeCollisionCircles(t,n,o,u,p,f,_,y,v,T,I,M,U,F){const O=[],H=new a.pointGeometry(n.anchorX,n.anchorY),Q=vt(H,f,F),re=Ji(this.transform.cameraToCenterDistance,Q.signedDistanceFromCamera),V=(T?p/re:p*re)/a.ONE_EM,oe=vt(H,_,F).point,ne=Hr(V,u,n.lineOffsetX*V,n.lineOffsetY*V,!1,oe,H,n,o,_,{},!1,F);let me=!1,ge=!1,be=!0;if(ne){const he=.5*M*re+U,Re=new a.pointGeometry(-100,-100),Ie=new a.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Fe=new kr,at=ne.first,ht=ne.last;let Xe=[];for(let yt=at.path.length-1;yt>=1;yt--)Xe.push(at.path[yt]);for(let yt=1;yt<ht.path.length;yt++)Xe.push(ht.path[yt]);const zt=2.5*he;if(y){const yt=Xe.map(Tt=>vt(Tt,y,F));Xe=yt.some(Tt=>Tt.signedDistanceFromCamera<=0)?[]:yt.map(Tt=>Tt.point)}let Pt=[];if(Xe.length>0){const yt=Xe[0].clone(),Tt=Xe[0].clone();for(let Bt=1;Bt<Xe.length;Bt++)yt.x=Math.min(yt.x,Xe[Bt].x),yt.y=Math.min(yt.y,Xe[Bt].y),Tt.x=Math.max(Tt.x,Xe[Bt].x),Tt.y=Math.max(Tt.y,Xe[Bt].y);Pt=yt.x>=Re.x&&Tt.x<=Ie.x&&yt.y>=Re.y&&Tt.y<=Ie.y?[Xe]:Tt.x<Re.x||yt.x>Ie.x||Tt.y<Re.y||yt.y>Ie.y?[]:a.clipLine([Xe],Re.x,Re.y,Ie.x,Ie.y)}for(const yt of Pt){Fe.reset(yt,.25*he);let Tt=0;Tt=Fe.length<=.5*he?1:Math.ceil(Fe.paddedLength/zt)+1;for(let Bt=0;Bt<Tt;Bt++){const hi=Bt/Math.max(Tt-1,1),vr=Fe.lerp(hi),ur=vr.x+ci,br=vr.y+ci;O.push(ur,br,he,0);const nn=ur-he,er=br-he,Di=ur+he,Dr=br+he;if(be=be&&this.isOffscreen(nn,er,Di,Dr),ge=ge||this.isInsideGrid(nn,er,Di,Dr),t!=="always"&&this.grid.hitTestCircle(ur,br,he,t,I)&&(me=!0,!v))return{circles:[],offscreen:!1,collisionDetected:me}}}}return{circles:!v&&me||!ge||re<this.perspectiveRatioCutoff?[]:O,offscreen:be,collisionDetected:me}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let o=1/0,u=1/0,p=-1/0,f=-1/0;for(const T of t){const I=new a.pointGeometry(T.x+ci,T.y+ci);o=Math.min(o,I.x),u=Math.min(u,I.y),p=Math.max(p,I.x),f=Math.max(f,I.y),n.push(I)}const _=this.grid.query(o,u,p,f).concat(this.ignoredGrid.query(o,u,p,f)),y={},v={};for(const T of _){const I=T.key;if(y[I.bucketInstanceId]===void 0&&(y[I.bucketInstanceId]={}),y[I.bucketInstanceId][I.featureIndex])continue;const M=[new a.pointGeometry(T.x1,T.y1),new a.pointGeometry(T.x2,T.y1),new a.pointGeometry(T.x2,T.y2),new a.pointGeometry(T.x1,T.y2)];a.polygonIntersectsPolygon(n,M)&&(y[I.bucketInstanceId][I.featureIndex]=!0,v[I.bucketInstanceId]===void 0&&(v[I.bucketInstanceId]=[]),v[I.bucketInstanceId].push(I.featureIndex))}return v}insertCollisionBox(t,n,o,u,p,f){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:p,collisionGroupID:f,overlapMode:n},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,o,u,p,f){const _=o?this.ignoredGrid:this.grid,y={bucketInstanceId:u,featureIndex:p,collisionGroupID:f,overlapMode:n};for(let v=0;v<t.length;v+=4)_.insertCircle(y,t[v],t[v+1],t[v+2])}projectAndGetPerspectiveRatio(t,n,o,u){let p;return u?(p=[n,o,u(n,o),1],a.transformMat4(p,p,t)):(p=[n,o,0,1],Mr(p,p,t)),{point:new a.pointGeometry((p[0]/p[3]+1)/2*this.transform.width+ci,(-p[1]/p[3]+1)/2*this.transform.height+ci),perspectiveRatio:.5+this.transform.cameraToCenterDistance/p[3]*.5}}isOffscreen(t,n,o,u){return o<ci||t>=this.screenRightBoundary||u<ci||n>this.screenBottomBoundary}isInsideGrid(t,n,o,u){return o>=0&&t<this.gridRightBoundary&&u>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=a.identity([]);return a.translate(t,t,[-100,-100,0]),t}}function ti(l,t,n){return t*(a.EXTENT/(l.tileSize*Math.pow(2,n-l.tileID.overscaledZ)))}class Ai{constructor(t,n,o,u){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):u&&o?1:0,this.placed=o}isHidden(){return this.opacity===0&&!this.placed}}class Lt{constructor(t,n,o,u,p){this.text=new Ai(t?t.text:null,n,o,p),this.icon=new Ai(t?t.icon:null,n,u,p)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class qn{constructor(t,n,o){this.text=t,this.icon=n,this.skipFade=o}}class _r{constructor(){this.invProjMatrix=a.create(),this.viewportMatrix=a.create(),this.circles=[]}}class dn{constructor(t,n,o,u,p){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=o,this.bucketIndex=u,this.tileID=p}}class fn{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:o=>o.collisionGroupID===n}}return this.collisionGroups[t]}}function Gn(l,t,n,o,u){const{horizontalAlign:p,verticalAlign:f}=a.getAnchorAlignment(l),_=-(p-.5)*t,y=-(f-.5)*n,v=a.evaluateVariableOffset(l,o);return new a.pointGeometry(_+v[0]*u,y+v[1]*u)}function mn(l,t,n,o,u,p){const{x1:f,x2:_,y1:y,y2:v,anchorPointX:T,anchorPointY:I}=l,M=new a.pointGeometry(t,n);return o&&M._rotate(u?p:-p),{x1:f+M.x,y1:y+M.y,x2:_+M.x,y2:v+M.y,anchorPointX:T,anchorPointY:I}}class B{constructor(t,n,o,u,p){this.transform=t.clone(),this.terrain=n,this.collisionIndex=new $n(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new fn(u),this.collisionCircleArrays={},this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,o,u){const p=o.getBucket(n),f=o.latestFeatureIndex;if(!p||!f||n.id!==p.layerIds[0])return;const _=o.collisionBoxArray,y=p.layers[0].layout,v=Math.pow(2,this.transform.zoom-o.tileID.overscaledZ),T=o.tileSize/a.EXTENT,I=this.transform.calculatePosMatrix(o.tileID.toUnwrapped()),M=y.get("text-pitch-alignment")==="map",U=y.get("text-rotation-alignment")==="map",F=ti(o,1,this.transform.zoom),O=pn(I,M,U,this.transform,F);let H=null;if(M){const re=lr(I,M,U,this.transform,F);H=a.multiply([],this.transform.labelPlaneMatrix,re)}this.retainedQueryData[p.bucketInstanceId]=new dn(p.bucketInstanceId,f,p.sourceLayerIndex,p.index,o.tileID);const Q={bucket:p,layout:y,posMatrix:I,textLabelPlaneMatrix:O,labelToScreenMatrix:H,scale:v,textPixelRatio:T,holdingForFade:o.holdingForFade(),collisionBoxArray:_,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(p.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(p.sourceID)};if(u)for(const re of p.sortKeyRanges){const{sortKey:V,symbolInstanceStart:oe,symbolInstanceEnd:ne}=re;t.push({sortKey:V,symbolInstanceStart:oe,symbolInstanceEnd:ne,parameters:Q})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:p.symbolInstances.length,parameters:Q})}attemptAnchorPlacement(t,n,o,u,p,f,_,y,v,T,I,M,U,F,O,H){const Q=[M.textOffset0,M.textOffset1],re=Gn(t,o,u,Q,p),V=this.collisionIndex.placeCollisionBox(mn(n,re.x,re.y,f,_,this.transform.angle),I,y,v,T.predicate,H);if((!O||this.collisionIndex.placeCollisionBox(mn(O,re.x,re.y,f,_,this.transform.angle),I,y,v,T.predicate,H).box.length!==0)&&V.box.length>0){let oe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[M.crossTileID]&&this.prevPlacement.placements[M.crossTileID]&&this.prevPlacement.placements[M.crossTileID].text&&(oe=this.prevPlacement.variableOffsets[M.crossTileID].anchor),M.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[M.crossTileID]={textOffset:Q,width:o,height:u,anchor:t,textBoxScale:p,prevAnchor:oe},this.markUsedJustification(U,t,M,F),U.allowVerticalPlacement&&(this.markUsedOrientation(U,F,M),this.placedOrientations[M.crossTileID]=F),{shift:re,placedGlyphBoxes:V}}}placeLayerBucketPart(t,n,o){const{bucket:u,layout:p,posMatrix:f,textLabelPlaneMatrix:_,labelToScreenMatrix:y,textPixelRatio:v,holdingForFade:T,collisionBoxArray:I,partiallyEvaluatedTextSize:M,collisionGroup:U}=t.parameters,F=p.get("text-optional"),O=p.get("icon-optional"),H=a.getOverlapMode(p,"text-overlap","text-allow-overlap"),Q=H==="always",re=a.getOverlapMode(p,"icon-overlap","icon-allow-overlap"),V=re==="always",oe=p.get("text-rotation-alignment")==="map",ne=p.get("text-pitch-alignment")==="map",me=p.get("icon-text-fit")!=="none",ge=p.get("symbol-z-order")==="viewport-y",be=Q&&(V||!u.hasIconData()||O),he=V&&(Q||!u.hasTextData()||F);!u.collisionArrays&&I&&u.deserializeCollisionBoxes(I);const Re=(Ie,Fe)=>{if(n[Ie.crossTileID])return;if(T)return void(this.placements[Ie.crossTileID]=new qn(!1,!1,!1));let at=!1,ht=!1,Xe=!0,zt=null,Pt={box:null,offscreen:null},yt={box:null,offscreen:null},Tt=null,Bt=null,hi=null,vr=0,ur=0,br=0;Fe.textFeatureIndex?vr=Fe.textFeatureIndex:Ie.useRuntimeCollisionCircles&&(vr=Ie.featureIndex),Fe.verticalTextFeatureIndex&&(ur=Fe.verticalTextFeatureIndex);const nn=this.retainedQueryData[u.bucketInstanceId].tileID,er=this.terrain?(oi,ft)=>this.terrain.getElevation(nn,oi,ft):null;for(const oi of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const ft=Fe[oi];ft&&(ft.elevation=er?er(ft.anchorPointX,ft.anchorPointY):0)}const Di=Fe.textBox;if(Di){const oi=Mt=>{let pi=a.WritingMode.horizontal;if(u.allowVerticalPlacement&&!Mt&&this.prevPlacement){const di=this.prevPlacement.placedOrientations[Ie.crossTileID];di&&(this.placedOrientations[Ie.crossTileID]=di,pi=di,this.markUsedOrientation(u,pi,Ie))}return pi},ft=(Mt,pi)=>{if(u.allowVerticalPlacement&&Ie.numVerticalGlyphVertices>0&&Fe.verticalTextBox){for(const di of u.writingModes)if(di===a.WritingMode.vertical?(Pt=pi(),yt=Pt):Pt=Mt(),Pt&&Pt.box&&Pt.box.length)break}else Pt=Mt()};if(p.get("text-variable-anchor")){let Mt=p.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ie.crossTileID]){const Wt=this.prevPlacement.variableOffsets[Ie.crossTileID];Mt.indexOf(Wt.anchor)>0&&(Mt=Mt.filter(tr=>tr!==Wt.anchor),Mt.unshift(Wt.anchor))}const pi=(Wt,tr,bn)=>{const pa=Wt.x2-Wt.x1,rs=Wt.y2-Wt.y1,Tl=Ie.textBoxScale,da=me&&re==="never"?tr:null;let sn={box:[],offscreen:!1};const wn=H!=="never"?2*Mt.length:Mt.length;for(let Tn=0;Tn<wn;++Tn){const xo=this.attemptAnchorPlacement(Mt[Tn%Mt.length],Wt,pa,rs,Tl,oe,ne,v,f,U,Tn>=Mt.length?H:"never",Ie,u,bn,da,er);if(xo&&(sn=xo.placedGlyphBoxes,sn&&sn.box&&sn.box.length)){at=!0,zt=xo.shift;break}}return sn};ft(()=>pi(Di,Fe.iconBox,a.WritingMode.horizontal),()=>{const Wt=Fe.verticalTextBox;return u.allowVerticalPlacement&&!(Pt&&Pt.box&&Pt.box.length)&&Ie.numVerticalGlyphVertices>0&&Wt?pi(Wt,Fe.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null}}),Pt&&(at=Pt.box,Xe=Pt.offscreen);const di=oi(Pt&&Pt.box);if(!at&&this.prevPlacement){const Wt=this.prevPlacement.variableOffsets[Ie.crossTileID];Wt&&(this.variableOffsets[Ie.crossTileID]=Wt,this.markUsedJustification(u,Wt.anchor,Ie,di))}}else{const Mt=(pi,di)=>{const Wt=this.collisionIndex.placeCollisionBox(pi,H,v,f,U.predicate,er);return Wt&&Wt.box&&Wt.box.length&&(this.markUsedOrientation(u,di,Ie),this.placedOrientations[Ie.crossTileID]=di),Wt};ft(()=>Mt(Di,a.WritingMode.horizontal),()=>{const pi=Fe.verticalTextBox;return u.allowVerticalPlacement&&Ie.numVerticalGlyphVertices>0&&pi?Mt(pi,a.WritingMode.vertical):{box:null,offscreen:null}}),oi(Pt&&Pt.box&&Pt.box.length)}}if(Tt=Pt,at=Tt&&Tt.box&&Tt.box.length>0,Xe=Tt&&Tt.offscreen,Ie.useRuntimeCollisionCircles){const oi=u.text.placedSymbolArray.get(Ie.centerJustifiedTextSymbolIndex),ft=a.evaluateSizeForFeature(u.textSizeData,M,oi),Mt=p.get("text-padding");Bt=this.collisionIndex.placeCollisionCircles(H,oi,u.lineVertexArray,u.glyphOffsetArray,ft,f,_,y,o,ne,U.predicate,Ie.collisionCircleDiameter,Mt,er),Bt.circles.length&&Bt.collisionDetected&&!o&&a.warnOnce("Collisions detected, but collision boxes are not shown"),at=Q||Bt.circles.length>0&&!Bt.collisionDetected,Xe=Xe&&Bt.offscreen}if(Fe.iconFeatureIndex&&(br=Fe.iconFeatureIndex),Fe.iconBox){const oi=ft=>{const Mt=me&&zt?mn(ft,zt.x,zt.y,oe,ne,this.transform.angle):ft;return this.collisionIndex.placeCollisionBox(Mt,re,v,f,U.predicate,er)};yt&&yt.box&&yt.box.length&&Fe.verticalIconBox?(hi=oi(Fe.verticalIconBox),ht=hi.box.length>0):(hi=oi(Fe.iconBox),ht=hi.box.length>0),Xe=Xe&&hi.offscreen}const Dr=F||Ie.numHorizontalGlyphVertices===0&&Ie.numVerticalGlyphVertices===0,yo=O||Ie.numIconVertices===0;if(Dr||yo?yo?Dr||(ht=ht&&at):at=ht&&at:ht=at=ht&&at,at&&Tt&&Tt.box&&this.collisionIndex.insertCollisionBox(Tt.box,H,p.get("text-ignore-placement"),u.bucketInstanceId,yt&&yt.box&&ur?ur:vr,U.ID),ht&&hi&&this.collisionIndex.insertCollisionBox(hi.box,re,p.get("icon-ignore-placement"),u.bucketInstanceId,br,U.ID),Bt&&(at&&this.collisionIndex.insertCollisionCircles(Bt.circles,H,p.get("text-ignore-placement"),u.bucketInstanceId,vr,U.ID),o)){const oi=u.bucketInstanceId;let ft=this.collisionCircleArrays[oi];ft===void 0&&(ft=this.collisionCircleArrays[oi]=new _r);for(let Mt=0;Mt<Bt.circles.length;Mt+=4)ft.circles.push(Bt.circles[Mt+0]),ft.circles.push(Bt.circles[Mt+1]),ft.circles.push(Bt.circles[Mt+2]),ft.circles.push(Bt.collisionDetected?1:0)}if(Ie.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(u.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ie.crossTileID]=new qn(at||be,ht||he,Xe||u.justReloaded),n[Ie.crossTileID]=!0};if(ge){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ie=u.getSortedSymbolIndexes(this.transform.angle);for(let Fe=Ie.length-1;Fe>=0;--Fe){const at=Ie[Fe];Re(u.symbolInstances.get(at),u.collisionArrays[at])}}else for(let Ie=t.symbolInstanceStart;Ie<t.symbolInstanceEnd;Ie++)Re(u.symbolInstances.get(Ie),u.collisionArrays[Ie]);if(o&&u.bucketInstanceId in this.collisionCircleArrays){const Ie=this.collisionCircleArrays[u.bucketInstanceId];a.invert(Ie.invProjMatrix,f),Ie.viewportMatrix=this.collisionIndex.getViewportMatrix()}u.justReloaded=!1}markUsedJustification(t,n,o,u){let p;p=u===a.WritingMode.vertical?o.verticalPlacedTextSymbolIndex:{left:o.leftJustifiedTextSymbolIndex,center:o.centerJustifiedTextSymbolIndex,right:o.rightJustifiedTextSymbolIndex}[a.getAnchorJustification(n)];const f=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex,o.verticalPlacedTextSymbolIndex];for(const _ of f)_>=0&&(t.text.placedSymbolArray.get(_).crossTileID=p>=0&&_!==p?0:o.crossTileID)}markUsedOrientation(t,n,o){const u=n===a.WritingMode.horizontal||n===a.WritingMode.horizontalOnly?n:0,p=n===a.WritingMode.vertical?n:0,f=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex];for(const _ of f)t.text.placedSymbolArray.get(_).placedOrientation=u;o.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).placedOrientation=p)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let o=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const u=n?n.symbolFadeChange(t):1,p=n?n.opacities:{},f=n?n.variableOffsets:{},_=n?n.placedOrientations:{};for(const y in this.placements){const v=this.placements[y],T=p[y];T?(this.opacities[y]=new Lt(T,u,v.text,v.icon),o=o||v.text!==T.text.placed||v.icon!==T.icon.placed):(this.opacities[y]=new Lt(null,u,v.text,v.icon,v.skipFade),o=o||v.text||v.icon)}for(const y in p){const v=p[y];if(!this.opacities[y]){const T=new Lt(v,u,!1,!1);T.isHidden()||(this.opacities[y]=T,o=o||v.text.placed||v.icon.placed)}}for(const y in f)this.variableOffsets[y]||!this.opacities[y]||this.opacities[y].isHidden()||(this.variableOffsets[y]=f[y]);for(const y in _)this.placedOrientations[y]||!this.opacities[y]||this.opacities[y].isHidden()||(this.placedOrientations[y]=_[y]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");o?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n){const o={};for(const u of n){const p=u.getBucket(t);p&&u.latestFeatureIndex&&t.id===p.layerIds[0]&&this.updateBucketOpacities(p,o,u.collisionBoxArray)}}updateBucketOpacities(t,n,o){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const u=t.layers[0].layout,p=new Lt(null,0,!1,!1,!0),f=u.get("text-allow-overlap"),_=u.get("icon-allow-overlap"),y=u.get("text-variable-anchor"),v=u.get("text-rotation-alignment")==="map",T=u.get("text-pitch-alignment")==="map",I=u.get("icon-text-fit")!=="none",M=new Lt(null,0,f&&(_||!t.hasIconData()||u.get("icon-optional")),_&&(f||!t.hasTextData()||u.get("text-optional")),!0);!t.collisionArrays&&o&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(o);const U=(F,O,H)=>{for(let Q=0;Q<O/4;Q++)F.opacityVertexArray.emplaceBack(H)};for(let F=0;F<t.symbolInstances.length;F++){const O=t.symbolInstances.get(F),{numHorizontalGlyphVertices:H,numVerticalGlyphVertices:Q,crossTileID:re}=O;let V=this.opacities[re];n[re]?V=p:V||(V=M,this.opacities[re]=V),n[re]=!0;const oe=O.numIconVertices>0,ne=this.placedOrientations[O.crossTileID],me=ne===a.WritingMode.vertical,ge=ne===a.WritingMode.horizontal||ne===a.WritingMode.horizontalOnly;if(H>0||Q>0){const be=J(V.text);U(t.text,H,me?ue:be),U(t.text,Q,ge?ue:be);const he=V.text.isHidden();[O.rightJustifiedTextSymbolIndex,O.centerJustifiedTextSymbolIndex,O.leftJustifiedTextSymbolIndex].forEach(Fe=>{Fe>=0&&(t.text.placedSymbolArray.get(Fe).hidden=he||me?1:0)}),O.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(O.verticalPlacedTextSymbolIndex).hidden=he||ge?1:0);const Re=this.variableOffsets[O.crossTileID];Re&&this.markUsedJustification(t,Re.anchor,O,ne);const Ie=this.placedOrientations[O.crossTileID];Ie&&(this.markUsedJustification(t,"left",O,Ie),this.markUsedOrientation(t,Ie,O))}if(oe){const be=J(V.icon),he=!(I&&O.verticalPlacedIconSymbolIndex&&me);O.placedIconSymbolIndex>=0&&(U(t.icon,O.numIconVertices,he?be:ue),t.icon.placedSymbolArray.get(O.placedIconSymbolIndex).hidden=V.icon.isHidden()),O.verticalPlacedIconSymbolIndex>=0&&(U(t.icon,O.numVerticalIconVertices,he?ue:be),t.icon.placedSymbolArray.get(O.verticalPlacedIconSymbolIndex).hidden=V.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const be=t.collisionArrays[F];if(be){let he=new a.pointGeometry(0,0);if(be.textBox||be.verticalTextBox){let Ie=!0;if(y){const Fe=this.variableOffsets[re];Fe?(he=Gn(Fe.anchor,Fe.width,Fe.height,Fe.textOffset,Fe.textBoxScale),v&&he._rotate(T?this.transform.angle:-this.transform.angle)):Ie=!1}be.textBox&&b(t.textCollisionBox.collisionVertexArray,V.text.placed,!Ie||me,he.x,he.y),be.verticalTextBox&&b(t.textCollisionBox.collisionVertexArray,V.text.placed,!Ie||ge,he.x,he.y)}const Re=Boolean(!ge&&be.verticalIconBox);be.iconBox&&b(t.iconCollisionBox.collisionVertexArray,V.icon.placed,Re,I?he.x:0,I?he.y:0),be.verticalIconBox&&b(t.iconCollisionBox.collisionVertexArray,V.icon.placed,!Re,I?he.x:0,I?he.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const F=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=F.invProjMatrix,t.placementViewportMatrix=F.viewportMatrix,t.collisionCircleArray=F.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const o=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*o>t}setStale(){this.stale=!0}}function b(l,t,n,o,u){l.emplaceBack(t?1:0,n?1:0,o||0,u||0),l.emplaceBack(t?1:0,n?1:0,o||0,u||0),l.emplaceBack(t?1:0,n?1:0,o||0,u||0),l.emplaceBack(t?1:0,n?1:0,o||0,u||0)}const S=Math.pow(2,25),D=Math.pow(2,24),L=Math.pow(2,17),G=Math.pow(2,16),K=Math.pow(2,9),W=Math.pow(2,8),Z=Math.pow(2,1);function J(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;const t=l.placed?1:0,n=Math.floor(127*l.opacity);return n*S+t*D+n*L+t*G+n*K+t*W+n*Z+t}const ue=0;class ve{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,n,o,u,p){const f=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(f,u,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,p())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,f.sort((_,y)=>_.sortKey-y.sortKey));this._currentPartIndex<f.length;)if(n.placeLayerBucketPart(f[this._currentPartIndex],this._seenCrossTileIDs,o),this._currentPartIndex++,p())return!0;return!1}}class ce{constructor(t,n,o,u,p,f,_,y){this.placement=new B(t,n,f,_,y),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(t,n,o){const u=a.exported.now(),p=()=>{const f=a.exported.now()-u;return!this._forceFullPlacement&&f>2};for(;this._currentPlacementIndex>=0;){const f=n[t[this._currentPlacementIndex]],_=this.placement.collisionIndex.transform.zoom;if(f.type==="symbol"&&(!f.minzoom||f.minzoom<=_)&&(!f.maxzoom||f.maxzoom>_)){if(this._inProgressLayer||(this._inProgressLayer=new ve(f)),this._inProgressLayer.continuePlacement(o[f.source],this.placement,this._showCollisionBoxes,f,p))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Ve=512/a.EXTENT/2;class $e{constructor(t,n,o){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=o;for(let u=0;u<n.length;u++){const p=n.get(u),f=p.key;this.indexedSymbolInstances[f]||(this.indexedSymbolInstances[f]=[]),this.indexedSymbolInstances[f].push({crossTileID:p.crossTileID,coord:this.getScaledCoordinates(p,t)})}}getScaledCoordinates(t,n){const o=Ve/Math.pow(2,n.canonical.z-this.tileID.canonical.z);return{x:Math.floor((n.canonical.x*a.EXTENT+t.anchorX)*o),y:Math.floor((n.canonical.y*a.EXTENT+t.anchorY)*o)}}findMatches(t,n,o){const u=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let p=0;p<t.length;p++){const f=t.get(p);if(f.crossTileID)continue;const _=this.indexedSymbolInstances[f.key];if(!_)continue;const y=this.getScaledCoordinates(f,n);for(const v of _)if(Math.abs(v.coord.x-y.x)<=u&&Math.abs(v.coord.y-y.y)<=u&&!o[v.crossTileID]){o[v.crossTileID]=!0,f.crossTileID=v.crossTileID;break}}}}class Be{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ye{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const o in this.indexes){const u=this.indexes[o],p={};for(const f in u){const _=u[f];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+n),p[_.tileID.key]=_}this.indexes[o]=p}this.lng=t}addBucket(t,n,o){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let p=0;p<n.symbolInstances.length;p++)n.symbolInstances.get(p).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const u=this.usedCrossTileIDs[t.overscaledZ];for(const p in this.indexes){const f=this.indexes[p];if(Number(p)>t.overscaledZ)for(const _ in f){const y=f[_];y.tileID.isChildOf(t)&&y.findMatches(n.symbolInstances,t,u)}else{const _=f[t.scaledTo(Number(p)).key];_&&_.findMatches(n.symbolInstances,t,u)}}for(let p=0;p<n.symbolInstances.length;p++){const f=n.symbolInstances.get(p);f.crossTileID||(f.crossTileID=o.generate(),u[f.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new $e(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const o in n.indexedSymbolInstances)for(const u of n.indexedSymbolInstances[o])delete this.usedCrossTileIDs[t][u.crossTileID]}removeStaleBuckets(t){let n=!1;for(const o in this.indexes){const u=this.indexes[o];for(const p in u)t[u[p].bucketInstanceId]||(this.removeBucketCrossTileIDs(o,u[p]),delete u[p],n=!0)}return n}}class et{constructor(){this.layerIndexes={},this.crossTileIDs=new Be,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,o){let u=this.layerIndexes[t.id];u===void 0&&(u=this.layerIndexes[t.id]=new Ye);let p=!1;const f={};u.handleWrapJump(o);for(const _ of n){const y=_.getBucket(t);y&&t.id===y.layerIds[0]&&(y.bucketInstanceId||(y.bucketInstanceId=++this.maxBucketInstanceId),u.addBucket(_.tileID,y,this.crossTileIDs)&&(p=!0),f[y.bucketInstanceId]=!0)}return u.removeStaleBuckets(f)&&(p=!0),p}pruneUnusedLayers(t){const n={};t.forEach(o=>{n[o]=!0});for(const o in this.layerIndexes)n[o]||delete this.layerIndexes[o]}}var bt=a.createLayout([{name:"a_pos",type:"Int16",components:2}]);class nt extends a.Evented{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=t._cache.max,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const t in this._tiles){const n=this._tiles[t];n.textures.forEach(o=>o.destroy()),n.textures=[]}}update(t,n){this.sourceCache.update(t,n),this._renderableTilesKeys=[];for(const o of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n}))this._renderableTilesKeys.push(o.key),this._tiles[o.key]||(o.posMatrix=new Float64Array(16),a.ortho(o.posMatrix,0,a.EXTENT,0,a.EXTENT,0,1),this._tiles[o.key]=new qr(o,this.tileSize))}removeOutdated(t){const n={};this.renderHistory=this.renderHistory.filter((o,u)=>this.renderHistory.indexOf(o)===u).slice(0,this.renderHistorySize);for(const o of this._renderableTilesKeys)n[o]=!0;for(const o of this.renderHistory)n[o]=!0;for(const o in this._tiles)n[o]||(this._tiles[o].clearTextures(t),delete this._tiles[o])}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const n={};for(const o of this._renderableTilesKeys){const u=this._tiles[o].tileID;if(u.canonical.equals(t.canonical)){const p=t.clone();p.posMatrix=new Float64Array(16),a.ortho(p.posMatrix,0,a.EXTENT,0,a.EXTENT,0,1),n[o]=p}else if(u.canonical.isChildOf(t.canonical)){const p=t.clone();p.posMatrix=new Float64Array(16);const f=u.canonical.z-t.canonical.z,_=u.canonical.x-(u.canonical.x>>f<<f),y=u.canonical.y-(u.canonical.y>>f<<f),v=a.EXTENT>>f;a.ortho(p.posMatrix,0,v,0,v,0,1),a.translate(p.posMatrix,p.posMatrix,[-_*v,-y*v,0]),n[o]=p}else if(t.canonical.isChildOf(u.canonical)){const p=t.clone();p.posMatrix=new Float64Array(16);const f=t.canonical.z-u.canonical.z,_=t.canonical.x-(t.canonical.x>>f<<f),y=t.canonical.y-(t.canonical.y>>f<<f),v=a.EXTENT>>f;a.ortho(p.posMatrix,0,a.EXTENT,0,a.EXTENT,0,1),a.translate(p.posMatrix,p.posMatrix,[_*v,y*v,0]),a.scale(p.posMatrix,p.posMatrix,[1/2**f,1/2**f,0]),n[o]=p}}return n}getSourceTile(t,n){const o=this.sourceCache._source;let u=t.overscaledZ-this.deltaZoom;if(u>o.maxzoom&&(u=o.maxzoom),u<o.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(u).key);let p=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!p||!p.dem)&&n)for(;u>=o.minzoom&&(!p||!p.dem);)p=this.sourceCache.getTileByID(t.scaledTo(u--).key);return p}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(n=>n.timeLoaded>=t)}}class ut{constructor(t,n,o){this.style=t,this.sourceCache=new nt(n),this.options=o,this.exaggeration=typeof o.exaggeration=="number"?o.exaggeration:1,this.elevationOffset=typeof o.elevationOffset=="number"?o.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(t,n,o,u=a.EXTENT){if(!(n>=0&&n<u&&o>=0&&o<u))return this.elevationOffset;let p=0;const f=this.getTerrainData(t);if(f.tile&&f.tile.dem){const _=a.transformMat4$1([],[n/u*a.EXTENT,o/u*a.EXTENT],f.u_terrain_matrix),y=[_[0]*f.tile.dem.dim,_[1]*f.tile.dem.dim],v=[Math.floor(y[0]),Math.floor(y[1])],T=f.tile.dem.get(v[0],v[1]),I=f.tile.dem.get(v[0],v[1]+1),M=f.tile.dem.get(v[0]+1,v[1]),U=f.tile.dem.get(v[0]+1,v[1]+1);p=a.number(a.number(T,I,y[0]-v[0]),a.number(M,U,y[0]-v[0]),y[1]-v[1])}return p}rememberForRerender(t,n){for(const o in this.sourceCache._tiles){const u=this.sourceCache._tiles[o];(u.tileID.equals(n)||u.tileID.isChildOf(n))&&(t===this.sourceCache.sourceCache.id&&(u.timeLoaded=Date.now()),this._rerender[t]=this._rerender[t]||{},this._rerender[t][u.tileID.key]=!0)}}needsRerender(t,n){return this._rerender[t]&&this._rerender[t][n.key]}clearRerenderCache(){this._rerender={}}getElevation(t,n,o,u=a.EXTENT){return(this.getDEMElevation(t,n,o,u)+this.elevationOffset)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const u=this.style.map.painter.context,p=new a.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Te(u,p,u.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Te(u,new a.RGBAImage({width:1,height:1}),u.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.identity([])}const n=this.sourceCache.getSourceTile(t,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const u=this.style.map.painter.context;n.demTexture=this.style.map.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new Te(u,n.dem.getPixels(),u.gl.RGBA,{premultiply:!1}),n.demTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const o=n&&n+n.tileID.key+t.key;if(o&&!this._demMatrixCache[o]){const u=this.sourceCache.sourceCache._source.maxzoom;let p=t.canonical.z-n.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=u?p=t.canonical.z-u:a.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const f=t.canonical.x-(t.canonical.x>>p<<p),_=t.canonical.y-(t.canonical.y>>p<<p),y=a.fromScaling(new Float64Array(16),[1/(a.EXTENT<<p),1/(a.EXTENT<<p),0]);a.translate(y,y,[f*a.EXTENT,_*a.EXTENT,0]),this._demMatrixCache[t.key]={matrix:y,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:o?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getRTTFramebuffer(){const t=this.style.map.painter;if(!this._rttFramebuffer){const n=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=t.context.createFramebuffer(n,n,!0),this._rttFramebuffer.depthAttachment.set(t.context.createRenderbuffer(t.context.gl.DEPTH_COMPONENT16,n,n))}return this._rttFramebuffer}getFramebuffer(t){const n=this.style.map.painter,o=n.width/devicePixelRatio,u=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===o&&this._fbo.height===u||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Te(n.context,{width:o,height:u,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Te(n.context,{width:o,height:u,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(o,u,!0),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,o,u))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let p=0,f=0;p<this._coordsTextureSize;p++)for(let _=0;_<this._coordsTextureSize;_++,f+=4)n[f+0]=255&_,n[f+1]=255&p,n[f+2]=_>>8<<4|p>>8,n[f+3]=0;const o=new a.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),u=new Te(t,o,t.gl.RGBA,{premultiply:!1});return u.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=u,u}pointCoordinate(t){const n=new Uint8Array(4),o=this.style.map.painter,u=o.context,p=u.gl;u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),p.readPixels(t.x,o.height/devicePixelRatio-t.y-1,1,1,p.RGBA,p.UNSIGNED_BYTE,n),u.bindFramebuffer.set(null);const f=n[0]+(n[2]>>4<<8),_=n[1]+((15&n[2])<<8),y=this.coordsIndex[255-n[3]],v=y&&this.sourceCache.getTileByID(y);if(!v)return null;const T=this._coordsTextureSize,I=(1<<v.tileID.canonical.z)*T;return new a.MercatorCoordinate((v.tileID.canonical.x*T+f)/I,(v.tileID.canonical.y*T+_)/I,this.getElevation(v.tileID,f,_,T))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.style.map.painter.context,n=new a.PosArray,o=new a.TriangleIndexArray,u=this.meshSize,p=a.EXTENT/u,f=u*u;for(let _=0;_<=u;_++)for(let y=0;y<=u;y++)n.emplaceBack(y*p,_*p);for(let _=0;_<f;_+=u+1)for(let y=0;y<u;y++)o.emplaceBack(y+_,u+y+_+1,u+y+_+2),o.emplaceBack(y+_,u+y+_+2,y+_+1);return this._mesh={indexBuffer:t.createIndexBuffer(o),vertexBuffer:t.createVertexBuffer(n,bt.members),segments:a.SegmentVector.simpleSegment(0,0,n.length,o.length)},this._mesh}getMinMaxElevation(t){const n=this.getTerrainData(t).tile,o={minElevation:null,maxElevation:null};return n&&n.dem&&(o.minElevation=(n.dem.min+this.elevationOffset)*this.exaggeration,o.maxElevation=(n.dem.max+this.elevationOffset)*this.exaggeration),o}}const wt=(l,t)=>a.emitValidationErrors(l,t&&t.filter(n=>n.identifier!=="source.canvas")),Ot=a.pick(xt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),ui=a.pick(xt,["setCenter","setZoom","setBearing","setPitch"]),Gt=function(){const l={},t=a.spec.$version;for(const n in a.spec.$root){const o=a.spec.$root[n];if(o.required){let u=null;u=n==="version"?t:o.type==="array"?[]:{},u!=null&&(l[n]=u)}}return l}();class wi extends a.Evented{constructor(t,n={}){super(),this.map=t,this.dispatcher=new Dt(Un(),this),this.imageManager=new Qe,this.imageManager.setEventedParent(this),this.glyphManager=new Ke(t._requestManager,n.localIdeographFontFamily),this.lineAtlas=new Kt(256,512),this.crossTileSymbolIndex=new et,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());const o=this;this._rtlTextPluginCallback=wi.registerForPluginStateChange(u=>{o.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:u.pluginStatus,pluginURL:u.pluginURL},(p,f)=>{if(a.triggerPluginCompletionEvent(p),f&&f.every(_=>_))for(const _ in o.sourceCaches)o.sourceCaches[_].reload()})}),this.on("data",u=>{if(u.dataType!=="source"||u.sourceDataType!=="metadata")return;const p=this.sourceCaches[u.sourceId];if(!p)return;const f=p.getSource();if(f&&f.vectorLayerIds)for(const _ in this._layers){const y=this._layers[_];y.source===f.id&&this._validateLayer(y)}})}loadURL(t,n={}){this.fire(new a.Event("dataloading",{dataType:"style"}));const o=typeof n.validate!="boolean"||n.validate,u=this.map._requestManager.transformRequest(t,a.ResourceType.Style);this._request=a.getJSON(u,(p,f)=>{this._request=null,p?this.fire(new a.ErrorEvent(p)):f&&this._load(f,o)})}loadJSON(t,n={}){this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.exported.frame(()=>{this._request=null,this._load(t,n.validate!==!1)})}loadEmpty(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load(Gt,!1)}_load(t,n){if(n&&wt(this,a.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t;for(const u in t.sources)this.addSource(u,t.sources[u],{validate:!1});t.sprite?this._loadSprite(t.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(t.glyphs);const o=fs(this.stylesheet.layers);this._order=o.map(u=>u.id),this._layers={},this._serializedLayers={};for(let u of o)u=a.createStyleLayer(u),u.setEventedParent(this,{layer:{id:u.id}}),this._layers[u.id]=u,this._serializedLayers[u.id]=u.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new rt(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}_loadSprite(t){this._spriteRequest=function(n,o,u,p){let f,_,y;const v=u>1?"@2x":"";let T=a.getJSON(o.transformRequest(o.normalizeSpriteURL(n,v,".json"),a.ResourceType.SpriteJSON),(U,F)=>{T=null,y||(y=U,f=F,M())}),I=a.getImage(o.transformRequest(o.normalizeSpriteURL(n,v,".png"),a.ResourceType.SpriteImage),(U,F)=>{I=null,y||(y=U,_=F,M())});function M(){if(y)p(y);else if(f&&_){const U=a.exported.getImageData(_),F={};for(const O in f){const{width:H,height:Q,x:re,y:V,sdf:oe,pixelRatio:ne,stretchX:me,stretchY:ge,content:be}=f[O],he=new a.RGBAImage({width:H,height:Q});a.RGBAImage.copy(U,he,{x:re,y:V},{x:0,y:0},{width:H,height:Q}),F[O]={data:he,pixelRatio:ne,sdf:oe,stretchX:me,stretchY:ge,content:be}}p(null,F)}}return{cancel(){T&&(T.cancel(),T=null),I&&(I.cancel(),I=null)}}}(t,this.map._requestManager,this.map.getPixelRatio(),(n,o)=>{if(this._spriteRequest=null,n)this.fire(new a.ErrorEvent(n));else if(o)for(const u in o)this.imageManager.addImage(u,o[u]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))})}_validateLayer(t){const n=this.sourceCaches[t.source];if(!n)return;const o=t.sourceLayer;if(!o)return;const u=n.getSource();(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(o)===-1)&&this.fire(new a.ErrorEvent(new Error(`Source layer "${o}" does not exist on source "${u.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const n=[];for(const o of t){const u=this._layers[o];u.type!=="custom"&&n.push(u.serialize())}return n}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const n=this._changed;if(this._changed){const u=Object.keys(this._updatedLayers),p=Object.keys(this._removedLayers);(u.length||p.length)&&this._updateWorkerLayers(u,p);for(const f in this._updatedSources){const _=this._updatedSources[f];if(_==="reload")this._reloadSource(f);else{if(_!=="clear")throw new Error(`Invalid action ${_}`);this._clearSource(f)}}this._updateTilesForChangedImages();for(const f in this._updatedPaintProps)this._layers[f].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const o={};for(const u in this.sourceCaches){const p=this.sourceCaches[u];o[u]=p.used,p.used=!1}for(const u of this._order){const p=this._layers[u];p.recalculate(t,this._availableImages),!p.isHidden(t.zoom)&&p.source&&(this.sourceCaches[p.source].used=!0)}for(const u in o){const p=this.sourceCaches[u];o[u]!==p.used&&p.fire(new a.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:u}))}this.light.recalculate(t),this.z=t.zoom,n&&this.fire(new a.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,n){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(t){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),t){const n=this.sourceCaches[t.source];if(!n)throw new Error(`cannot load terrain, because there exists no source with ID: ${t.source}`);this.terrain=new ut(this,n,t),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=o=>{o.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=o=>{o.tile&&(o.sourceId===t.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(o.sourceId,o.tile.tileID)):o.source.type==="geojson"&&this.terrain.rememberForRerender(o.sourceId,o.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new a.Event("terrain",{terrain:t}))}setState(t){if(this._checkLoaded(),wt(this,a.validateStyle(t)))return!1;(t=a.clone$1(t)).layers=fs(t.layers);const n=function(u,p){if(!u)return[{command:xt.setStyle,args:[p]}];let f=[];try{if(!fe(u.version,p.version))return[{command:xt.setStyle,args:[p]}];fe(u.center,p.center)||f.push({command:xt.setCenter,args:[p.center]}),fe(u.zoom,p.zoom)||f.push({command:xt.setZoom,args:[p.zoom]}),fe(u.bearing,p.bearing)||f.push({command:xt.setBearing,args:[p.bearing]}),fe(u.pitch,p.pitch)||f.push({command:xt.setPitch,args:[p.pitch]}),fe(u.sprite,p.sprite)||f.push({command:xt.setSprite,args:[p.sprite]}),fe(u.glyphs,p.glyphs)||f.push({command:xt.setGlyphs,args:[p.glyphs]}),fe(u.transition,p.transition)||f.push({command:xt.setTransition,args:[p.transition]}),fe(u.light,p.light)||f.push({command:xt.setLight,args:[p.light]});const _={},y=[];(function(T,I,M,U){let F;for(F in I=I||{},T=T||{})Object.prototype.hasOwnProperty.call(T,F)&&(Object.prototype.hasOwnProperty.call(I,F)||Xr(F,M,U));for(F in I)Object.prototype.hasOwnProperty.call(I,F)&&(Object.prototype.hasOwnProperty.call(T,F)?fe(T[F],I[F])||(T[F].type==="geojson"&&I[F].type==="geojson"&&ms(T,I,F)?M.push({command:xt.setGeoJSONSourceData,args:[F,I[F].data]}):Wr(F,I,M,U)):gr(F,I,M))})(u.sources,p.sources,y,_);const v=[];u.layers&&u.layers.forEach(T=>{_[T.source]?f.push({command:xt.removeLayer,args:[T.id]}):v.push(T)}),f=f.concat(y),function(T,I,M){I=I||[];const U=(T=T||[]).map(Cr),F=I.map(Cr),O=T.reduce(Nn,{}),H=I.reduce(Nn,{}),Q=U.slice(),re=Object.create(null);let V,oe,ne,me,ge,be,he;for(V=0,oe=0;V<U.length;V++)ne=U[V],Object.prototype.hasOwnProperty.call(H,ne)?oe++:(M.push({command:xt.removeLayer,args:[ne]}),Q.splice(Q.indexOf(ne,oe),1));for(V=0,oe=0;V<F.length;V++)ne=F[F.length-1-V],Q[Q.length-1-V]!==ne&&(Object.prototype.hasOwnProperty.call(O,ne)?(M.push({command:xt.removeLayer,args:[ne]}),Q.splice(Q.lastIndexOf(ne,Q.length-oe),1)):oe++,be=Q[Q.length-V],M.push({command:xt.addLayer,args:[H[ne],be]}),Q.splice(Q.length-V,0,ne),re[ne]=!0);for(V=0;V<F.length;V++)if(ne=F[V],me=O[ne],ge=H[ne],!re[ne]&&!fe(me,ge))if(fe(me.source,ge.source)&&fe(me["source-layer"],ge["source-layer"])&&fe(me.type,ge.type)){for(he in Ar(me.layout,ge.layout,M,ne,null,xt.setLayoutProperty),Ar(me.paint,ge.paint,M,ne,null,xt.setPaintProperty),fe(me.filter,ge.filter)||M.push({command:xt.setFilter,args:[ne,ge.filter]}),fe(me.minzoom,ge.minzoom)&&fe(me.maxzoom,ge.maxzoom)||M.push({command:xt.setLayerZoomRange,args:[ne,ge.minzoom,ge.maxzoom]}),me)Object.prototype.hasOwnProperty.call(me,he)&&he!=="layout"&&he!=="paint"&&he!=="filter"&&he!=="metadata"&&he!=="minzoom"&&he!=="maxzoom"&&(he.indexOf("paint.")===0?Ar(me[he],ge[he],M,ne,he.slice(6),xt.setPaintProperty):fe(me[he],ge[he])||M.push({command:xt.setLayerProperty,args:[ne,he,ge[he]]}));for(he in ge)Object.prototype.hasOwnProperty.call(ge,he)&&!Object.prototype.hasOwnProperty.call(me,he)&&he!=="layout"&&he!=="paint"&&he!=="filter"&&he!=="metadata"&&he!=="minzoom"&&he!=="maxzoom"&&(he.indexOf("paint.")===0?Ar(me[he],ge[he],M,ne,he.slice(6),xt.setPaintProperty):fe(me[he],ge[he])||M.push({command:xt.setLayerProperty,args:[ne,he,ge[he]]}))}else M.push({command:xt.removeLayer,args:[ne]}),be=Q[Q.lastIndexOf(ne)+1],M.push({command:xt.addLayer,args:[ge,be]})}(v,p.layers,f)}catch(_){console.warn("Unable to compute style diff:",_),f=[{command:xt.setStyle,args:[p]}]}return f}(this.serialize(),t).filter(u=>!(u.command in ui));if(n.length===0)return!1;const o=n.filter(u=>!(u.command in Ot));if(o.length>0)throw new Error(`Unimplemented: ${o.map(u=>u.command).join(", ")}.`);return n.forEach(u=>{u.command!=="setTransition"&&this[u.command].apply(this,u.args)}),this.stylesheet=t,!0}addImage(t,n){if(this.getImage(t))return this.fire(new a.ErrorEvent(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,n),this._afterImageUpdated(t)}updateImage(t,n){this.imageManager.updateImage(t,n)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new a.ErrorEvent(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,n,o={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(a.validateStyle.source,`sources.${t}`,n,null,o))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const u=this.sourceCaches[t]=new zi(t,n,this.dispatcher);u.style=this,u.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:u.serialize(),sourceId:t})),u.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const o in this._layers)if(this._layers[o].source===t)return this.fire(new a.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${o}" is using it.`)));const n=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],n.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,n){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const o=this.sourceCaches[t].getSource();if(o.type!=="geojson")throw new Error(`geojsonSource.type is ${o.type}, which is !== 'geojson`);o.setData(n),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,n,o={}){this._checkLoaded();const u=t.id;if(this.getLayer(u))return void this.fire(new a.ErrorEvent(new Error(`Layer "${u}" already exists on this map.`)));let p;if(t.type==="custom"){if(wt(this,a.validateCustomStyleLayer(t)))return;p=a.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(u,t.source),t=a.clone$1(t),t=a.extend(t,{source:u})),this._validate(a.validateStyle.layer,`layers.${u}`,t,{arrayIndex:-1},o))return;p=a.createStyleLayer(t),this._validateLayer(p),p.setEventedParent(this,{layer:{id:u}}),this._serializedLayers[p.id]=p.serialize()}const f=n?this._order.indexOf(n):this._order.length;if(n&&f===-1)this.fire(new a.ErrorEvent(new Error(`Cannot add layer "${u}" before non-existing layer "${n}".`)));else{if(this._order.splice(f,0,u),this._layerOrderChanged=!0,this._layers[u]=p,this._removedLayers[u]&&p.source&&p.type!=="custom"){const _=this._removedLayers[u];delete this._removedLayers[u],_.type!==p.type?this._updatedSources[p.source]="clear":(this._updatedSources[p.source]="reload",this.sourceCaches[p.source].pause())}this._updateLayer(p),p.onAdd&&p.onAdd(this.map)}}moveLayer(t,n){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===n)return;const o=this._order.indexOf(t);this._order.splice(o,1);const u=n?this._order.indexOf(n):this._order.length;n&&u===-1?this.fire(new a.ErrorEvent(new Error(`Cannot move layer "${t}" before non-existing layer "${n}".`))):(this._order.splice(u,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const n=this._layers[t];if(!n)return void this.fire(new a.ErrorEvent(new Error(`Cannot remove non-existing layer "${t}".`)));n.setEventedParent(null);const o=this._order.indexOf(t);this._order.splice(o,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=n,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],n.onRemove&&n.onRemove(this.map)}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,n,o){this._checkLoaded();const u=this.getLayer(t);u?u.minzoom===n&&u.maxzoom===o||(n!=null&&(u.minzoom=n),o!=null&&(u.maxzoom=o),this._updateLayer(u)):this.fire(new a.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,n,o={}){this._checkLoaded();const u=this.getLayer(t);if(u){if(!fe(u.filter,n))return n==null?(u.filter=void 0,void this._updateLayer(u)):void(this._validate(a.validateStyle.filter,`layers.${u.id}.filter`,n,null,o)||(u.filter=a.clone$1(n),this._updateLayer(u)))}else this.fire(new a.ErrorEvent(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return a.clone$1(this.getLayer(t).filter)}setLayoutProperty(t,n,o,u={}){this._checkLoaded();const p=this.getLayer(t);p?fe(p.getLayoutProperty(n),o)||(p.setLayoutProperty(n,o,u),this._updateLayer(p)):this.fire(new a.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,n){const o=this.getLayer(t);if(o)return o.getLayoutProperty(n);this.fire(new a.ErrorEvent(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,n,o,u={}){this._checkLoaded();const p=this.getLayer(t);p?fe(p.getPaintProperty(n),o)||(p.setPaintProperty(n,o,u)&&this._updateLayer(p),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new a.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,n){return this.getLayer(t).getPaintProperty(n)}setFeatureState(t,n){this._checkLoaded();const o=t.source,u=t.sourceLayer,p=this.sourceCaches[o];if(p===void 0)return void this.fire(new a.ErrorEvent(new Error(`The source '${o}' does not exist in the map's style.`)));const f=p.getSource().type;f==="geojson"&&u?this.fire(new a.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):f!=="vector"||u?(t.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),p.setFeatureState(u,t.id,n)):this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,n){this._checkLoaded();const o=t.source,u=this.sourceCaches[o];if(u===void 0)return void this.fire(new a.ErrorEvent(new Error(`The source '${o}' does not exist in the map's style.`)));const p=u.getSource().type,f=p==="vector"?t.sourceLayer:void 0;p!=="vector"||f?n&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new a.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):u.removeFeatureState(f,t.id,n):this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const n=t.source,o=t.sourceLayer,u=this.sourceCaches[n];if(u!==void 0)return u.getSource().type!=="vector"||o?(t.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),u.getFeatureState(o,t.id)):void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.ErrorEvent(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return a.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:a.mapObject(this.sourceCaches,t=>t.serialize()),layers:this._serializeLayers(this._order)},t=>t!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(t){const n=f=>this._layers[f].type==="fill-extrusion",o={},u=[];for(let f=this._order.length-1;f>=0;f--){const _=this._order[f];if(n(_)){o[_]=f;for(const y of t){const v=y[_];if(v)for(const T of v)u.push(T)}}}u.sort((f,_)=>_.intersectionZ-f.intersectionZ);const p=[];for(let f=this._order.length-1;f>=0;f--){const _=this._order[f];if(n(_))for(let y=u.length-1;y>=0;y--){const v=u[y].feature;if(o[v.layer.id]<f)break;p.push(v),u.pop()}else for(const y of t){const v=y[_];if(v)for(const T of v)p.push(T.feature)}}return p}queryRenderedFeatures(t,n,o){n&&n.filter&&this._validate(a.validateStyle.filter,"queryRenderedFeatures.filter",n.filter,null,n);const u={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new a.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const f of n.layers){const _=this._layers[f];if(!_)return this.fire(new a.ErrorEvent(new Error(`The layer '${f}' does not exist in the map's style and cannot be queried for features.`))),[];u[_.source]=!0}}const p=[];n.availableImages=this._availableImages;for(const f in this.sourceCaches)n.layers&&!u[f]||p.push(Fn(this.sourceCaches[f],this._layers,this._serializedLayers,t,n,o));return this.placement&&p.push(function(f,_,y,v,T,I,M){const U={},F=I.queryRenderedSymbols(v),O=[];for(const H of Object.keys(F).map(Number))O.push(M[H]);O.sort(mr);for(const H of O){const Q=H.featureIndex.lookupSymbolFeatures(F[H.bucketInstanceId],_,H.bucketIndex,H.sourceLayerIndex,T.filter,T.layers,T.availableImages,f);for(const re in Q){const V=U[re]=U[re]||[],oe=Q[re];oe.sort((ne,me)=>{const ge=H.featureSortOrder;if(ge){const be=ge.indexOf(ne.featureIndex);return ge.indexOf(me.featureIndex)-be}return me.featureIndex-ne.featureIndex});for(const ne of oe)V.push(ne)}}for(const H in U)U[H].forEach(Q=>{const re=Q.feature,V=y[f[H].source].getFeatureState(re.layer["source-layer"],re.id);re.source=re.layer.source,re.layer["source-layer"]&&(re.sourceLayer=re.layer["source-layer"]),re.state=V});return U}(this._layers,this._serializedLayers,this.sourceCaches,t,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(p)}querySourceFeatures(t,n){n&&n.filter&&this._validate(a.validateStyle.filter,"querySourceFeatures.filter",n.filter,null,n);const o=this.sourceCaches[t];return o?function(u,p){const f=u.getRenderableIds().map(v=>u.getTileByID(v)),_=[],y={};for(let v=0;v<f.length;v++){const T=f[v],I=T.tileID.canonical.key;y[I]||(y[I]=!0,T.querySourceFeatures(_,p))}return _}(o,n):[]}addSourceType(t,n,o){return wi.getSourceType(t)?o(new Error(`A source type called "${t}" already exists.`)):(wi.setSourceType(t,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:n.workerSourceURL},o):o(null,null))}getLight(){return this.light.getLight()}setLight(t,n={}){this._checkLoaded();const o=this.light.getLight();let u=!1;for(const f in t)if(!fe(t[f],o[f])){u=!0;break}if(!u)return;const p={now:a.exported.now(),transition:a.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,n),this.light.updateTransitions(p)}_validate(t,n,o,u,p={}){return(!p||p.validate!==!1)&&wt(this,t.call(a.validateStyle,a.extend({key:n,style:this.serialize(),value:o,styleSpec:a.spec},u)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this.sourceCaches){const n=this.sourceCaches[t];n.setEventedParent(null),n.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const n in this.sourceCaches)this.sourceCaches[n].update(t,this.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,n,o,u,p=!1){let f=!1,_=!1;const y={};for(const v of this._order){const T=this._layers[v];if(T.type!=="symbol")continue;if(!y[T.source]){const M=this.sourceCaches[T.source];y[T.source]=M.getRenderableIds(!0).map(U=>M.getTileByID(U)).sort((U,F)=>F.tileID.overscaledZ-U.tileID.overscaledZ||(U.tileID.isLessThan(F.tileID)?-1:1))}const I=this.crossTileSymbolIndex.addLayer(T,y[T.source],t.center.lng);f=f||I}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((p=p||this._layerOrderChanged||o===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.exported.now(),t.zoom))&&(this.pauseablePlacement=new ce(t,this.terrain,this._order,p,n,o,u,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,y),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.exported.now()),_=!0),f&&this.pauseablePlacement.placement.setStale()),_||f)for(const v of this._order){const T=this._layers[v];T.type==="symbol"&&this.placement.updateLayerOpacities(T,y[T.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.exported.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,n,o){this.imageManager.getImages(n.icons,o),this._updateTilesForChangedImages();const u=this.sourceCaches[n.source];u&&u.setDependencies(n.tileID.key,n.type,n.icons)}getGlyphs(t,n,o){this.glyphManager.getGlyphs(n.stacks,o)}getResource(t,n,o){return a.makeRequest(n,o)}}wi.getSourceType=function(l){return Bn[l]},wi.setSourceType=function(l,t){Bn[l]=t},wi.registerForPluginStateChange=a.registerForPluginStateChange;var Zn="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const gs={prelude:Ut(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Ut(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ut(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ut(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ut("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ut(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Ut(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ut("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ut("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ut("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Ut(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Ut(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Ut(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Ut(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ut(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ut(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ut(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ut(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ut(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ut(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ut(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ut(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ut(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ut(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ut(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ut(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ut("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Zn),terrainDepth:Ut("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Zn),terrainCoords:Ut("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Zn)};function Ut(l,t){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,o=t.match(/attribute ([\w]+) ([\w]+)/g),u=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),p=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),f=p?p.concat(u):u,_={};return{fragmentSource:l=l.replace(n,(y,v,T,I,M)=>(_[M]=!0,v==="define"?`
#ifndef HAS_UNIFORM_u_${M}
varying ${T} ${I} ${M};
#else
uniform ${T} ${I} u_${M};
#endif
`:`
#ifdef HAS_UNIFORM_u_${M}
    ${T} ${I} ${M} = u_${M};
#endif
`)),vertexSource:t=t.replace(n,(y,v,T,I,M)=>{const U=I==="float"?"vec2":"vec4",F=M.match(/color/)?"color":U;return _[M]?v==="define"?`
#ifndef HAS_UNIFORM_u_${M}
uniform lowp float u_${M}_t;
attribute ${T} ${U} a_${M};
varying ${T} ${I} ${M};
#else
uniform ${T} ${I} u_${M};
#endif
`:F==="vec4"?`
#ifndef HAS_UNIFORM_u_${M}
    ${M} = a_${M};
#else
    ${T} ${I} ${M} = u_${M};
#endif
`:`
#ifndef HAS_UNIFORM_u_${M}
    ${M} = unpack_mix_${F}(a_${M}, u_${M}_t);
#else
    ${T} ${I} ${M} = u_${M};
#endif
`:v==="define"?`
#ifndef HAS_UNIFORM_u_${M}
uniform lowp float u_${M}_t;
attribute ${T} ${U} a_${M};
#else
uniform ${T} ${I} u_${M};
#endif
`:F==="vec4"?`
#ifndef HAS_UNIFORM_u_${M}
    ${T} ${I} ${M} = a_${M};
#else
    ${T} ${I} ${M} = u_${M};
#endif
`:`
#ifndef HAS_UNIFORM_u_${M}
    ${T} ${I} ${M} = unpack_mix_${F}(a_${M}, u_${M}_t);
#else
    ${T} ${I} ${M} = u_${M};
#endif
`}),staticAttributes:o,staticUniforms:f}}class Lo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,n,o,u,p,f,_,y,v){this.context=t;let T=this.boundPaintVertexBuffers.length!==u.length;for(let I=0;!T&&I<u.length;I++)this.boundPaintVertexBuffers[I]!==u[I]&&(T=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===n&&this.boundLayoutVertexBuffer===o&&!T&&this.boundIndexBuffer===p&&this.boundVertexOffset===f&&this.boundDynamicVertexBuffer===_&&this.boundDynamicVertexBuffer2===y&&this.boundDynamicVertexBuffer3===v?(t.bindVertexArrayOES.set(this.vao),_&&_.bind(),p&&p.dynamicDraw&&p.bind(),y&&y.bind(),v&&v.bind()):this.freshBind(n,o,u,p,f,_,y,v)}freshBind(t,n,o,u,p,f,_,y){let v;const T=t.numAttributes,I=this.context,M=I.gl;if(I.extVertexArrayObject)this.vao&&this.destroy(),this.vao=I.extVertexArrayObject.createVertexArrayOES(),I.bindVertexArrayOES.set(this.vao),v=0,this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=o,this.boundIndexBuffer=u,this.boundVertexOffset=p,this.boundDynamicVertexBuffer=f,this.boundDynamicVertexBuffer2=_,this.boundDynamicVertexBuffer3=y;else{v=I.currentNumAttributes||0;for(let U=T;U<v;U++)M.disableVertexAttribArray(U)}n.enableAttributes(M,t);for(const U of o)U.enableAttributes(M,t);f&&f.enableAttributes(M,t),_&&_.enableAttributes(M,t),y&&y.enableAttributes(M,t),n.bind(),n.setVertexAttribPointers(M,t,p);for(const U of o)U.bind(),U.setVertexAttribPointers(M,t,p);f&&(f.bind(),f.setVertexAttribPointers(M,t,p)),u&&u.bind(),_&&(_.bind(),_.setVertexAttribPointers(M,t,p)),y&&(y.bind(),y.setVertexAttribPointers(M,t,p)),I.currentNumAttributes=T}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Bo(l){const t=[];for(let n=0;n<l.length;n++){if(l[n]===null)continue;const o=l[n].split(" ");t.push(o.pop())}return t}class Ua{constructor(t,n,o,u,p,f,_){const y=t.gl;this.program=y.createProgram();const v=Bo(o.staticAttributes),T=u?u.getBinderAttributes():[],I=v.concat(T),M=gs.prelude.staticUniforms?Bo(gs.prelude.staticUniforms):[],U=o.staticUniforms?Bo(o.staticUniforms):[],F=u?u.getBinderUniforms():[],O=M.concat(U).concat(F),H=[];for(const ge of O)H.indexOf(ge)<0&&H.push(ge);const Q=u?u.defines():[];f&&Q.push("#define OVERDRAW_INSPECTOR;"),_&&Q.push("#define TERRAIN3D;");const re=Q.concat(gs.prelude.fragmentSource,o.fragmentSource).join(`
`),V=Q.concat(gs.prelude.vertexSource,o.vertexSource).join(`
`),oe=y.createShader(y.FRAGMENT_SHADER);if(y.isContextLost())return void(this.failedToCreate=!0);y.shaderSource(oe,re),y.compileShader(oe),y.attachShader(this.program,oe);const ne=y.createShader(y.VERTEX_SHADER);if(y.isContextLost())return void(this.failedToCreate=!0);y.shaderSource(ne,V),y.compileShader(ne),y.attachShader(this.program,ne),this.attributes={};const me={};this.numAttributes=I.length;for(let ge=0;ge<this.numAttributes;ge++)I[ge]&&(y.bindAttribLocation(this.program,ge,I[ge]),this.attributes[I[ge]]=ge);y.linkProgram(this.program),y.deleteShader(ne),y.deleteShader(oe);for(let ge=0;ge<H.length;ge++){const be=H[ge];if(be&&!me[be]){const he=y.getUniformLocation(this.program,be);he&&(me[be]=he)}}this.fixedUniforms=p(t,me),this.terrainUniforms=((ge,be)=>({u_depth:new a.Uniform1i(ge,be.u_depth),u_terrain:new a.Uniform1i(ge,be.u_terrain),u_terrain_dim:new a.Uniform1f(ge,be.u_terrain_dim),u_terrain_matrix:new a.UniformMatrix4f(ge,be.u_terrain_matrix),u_terrain_unpack:new a.Uniform4f(ge,be.u_terrain_unpack),u_terrain_offset:new a.Uniform1f(ge,be.u_terrain_offset),u_terrain_exaggeration:new a.Uniform1f(ge,be.u_terrain_exaggeration)}))(t,me),this.binderUniforms=u?u.getUniforms(t,me):[]}draw(t,n,o,u,p,f,_,y,v,T,I,M,U,F,O,H,Q,re){const V=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(o),t.setStencilMode(u),t.setColorMode(p),t.setCullFace(f),y){t.activeTexture.set(V.TEXTURE2),V.bindTexture(V.TEXTURE_2D,y.depthTexture),t.activeTexture.set(V.TEXTURE3),V.bindTexture(V.TEXTURE_2D,y.texture);for(const ne in this.terrainUniforms)this.terrainUniforms[ne].set(y[ne])}for(const ne in this.fixedUniforms)this.fixedUniforms[ne].set(_[ne]);O&&O.setUniforms(t,this.binderUniforms,U,{zoom:F});let oe=0;switch(n){case V.LINES:oe=2;break;case V.TRIANGLES:oe=3;break;case V.LINE_STRIP:oe=1}for(const ne of M.get()){const me=ne.vaos||(ne.vaos={});(me[v]||(me[v]=new Lo)).bind(t,this,T,O?O.getPaintVertexBuffers():[],I,ne.vertexOffset,H,Q,re),V.drawElements(n,ne.primitiveLength*oe,V.UNSIGNED_SHORT,ne.primitiveOffset*oe*2)}}}function Va(l,t,n){const o=1/ti(n,1,t.transform.tileZoom),u=Math.pow(2,n.tileID.overscaledZ),p=n.tileSize*Math.pow(2,t.transform.tileZoom)/u,f=p*(n.tileID.canonical.x+n.tileID.wrap*u),_=p*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[o,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[f>>16,_>>16],u_pixel_coord_lower:[65535&f,65535&_]}}const Ro=(l,t,n,o)=>{const u=t.style.light,p=u.properties.get("position"),f=[p.x,p.y,p.z],_=a.create$1();u.properties.get("anchor")==="viewport"&&a.fromRotation(_,-t.transform.angle),a.transformMat3(f,f,_);const y=u.properties.get("color");return{u_matrix:l,u_lightpos:f,u_lightintensity:u.properties.get("intensity"),u_lightcolor:[y.r,y.g,y.b],u_vertical_gradient:+n,u_opacity:o}},nc=(l,t,n,o,u,p,f)=>a.extend(Ro(l,t,n,o),Va(p,t,f),{u_height_factor:-Math.pow(2,u.overscaledZ)/f.tileSize/8}),Js=l=>({u_matrix:l}),Fo=(l,t,n,o)=>a.extend(Js(l),Va(n,t,o)),Na=(l,t)=>({u_matrix:l,u_world:t}),$a=(l,t,n,o,u)=>a.extend(Fo(l,t,n,o),{u_world:u}),qa=(l,t,n,o)=>{const u=l.transform;let p,f;if(o.paint.get("circle-pitch-alignment")==="map"){const _=ti(n,1,u.zoom);p=!0,f=[_,_]}else p=!1,f=u.pixelsToGLUnits;return{u_camera_to_center_distance:u.cameraToCenterDistance,u_scale_with_map:+(o.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(t.posMatrix,n,o.paint.get("circle-translate"),o.paint.get("circle-translate-anchor")),u_pitch_with_map:+p,u_device_pixel_ratio:l.pixelRatio,u_extrude_scale:f}},gn=(l,t,n)=>{const o=ti(n,1,t.zoom),u=Math.pow(2,t.zoom-n.tileID.overscaledZ),p=n.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:o,u_extrude_scale:[t.pixelsToGLUnits[0]/(o*u),t.pixelsToGLUnits[1]/(o*u)],u_overscale_factor:p}},_s=(l,t,n=1)=>({u_matrix:l,u_color:t,u_overlay:0,u_overlay_scale:n}),jn=l=>({u_matrix:l}),Qs=(l,t,n,o)=>({u_matrix:l,u_extrude_scale:ti(t,1,n),u_intensity:o});function eo(l,t){const n=Math.pow(2,t.canonical.z),o=t.canonical.y;return[new a.MercatorCoordinate(0,o/n).toLngLat().lat,new a.MercatorCoordinate(0,(o+1)/n).toLngLat().lat]}const Xn=(l,t,n,o)=>{const u=l.transform;return{u_matrix:xs(l,t,n,o),u_ratio:1/ti(t,1,u.zoom),u_device_pixel_ratio:l.pixelRatio,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},Oo=(l,t,n,o,u)=>a.extend(Xn(l,t,n,u),{u_image:0,u_image_height:o}),to=(l,t,n,o,u)=>{const p=l.transform,f=Zt(t,p);return{u_matrix:xs(l,t,n,u),u_texsize:t.imageAtlasTexture.size,u_ratio:1/ti(t,1,p.zoom),u_device_pixel_ratio:l.pixelRatio,u_image:0,u_scale:[f,o.fromScale,o.toScale],u_fade:o.t,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},ys=(l,t,n,o,u,p)=>{const f=l.lineAtlas,_=Zt(t,l.transform),y=n.layout.get("line-cap")==="round",v=f.getDash(o.from,y),T=f.getDash(o.to,y),I=v.width*u.fromScale,M=T.width*u.toScale;return a.extend(Xn(l,t,n,p),{u_patternscale_a:[_/I,-v.height/2],u_patternscale_b:[_/M,-T.height/2],u_sdfgamma:f.width/(256*Math.min(I,M)*l.pixelRatio)/2,u_image:0,u_tex_y_a:v.y,u_tex_y_b:T.y,u_mix:u.t})};function Zt(l,t){return 1/ti(l,1,t.tileZoom)}function xs(l,t,n,o){return l.translatePosMatrix(o?o.posMatrix:t.tileID.posMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Ga=(l,t,n,o,u)=>{return{u_matrix:l,u_tl_parent:t,u_scale_parent:n,u_buffer_scale:1,u_fade_t:o.mix,u_opacity:o.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(f=u.paint.get("raster-saturation"),f>0?1-1/(1.001-f):-f),u_contrast_factor:(p=u.paint.get("raster-contrast"),p>0?1/(1-p):1+p),u_spin_weights:Za(u.paint.get("raster-hue-rotate"))};var p,f};function Za(l){l*=Math.PI/180;const t=Math.sin(l),n=Math.cos(l);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const Uo=(l,t,n,o,u,p,f,_,y,v)=>{const T=u.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:T.cameraToCenterDistance,u_pitch:T.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:T.width/T.height,u_fade_change:u.options.fadeDuration?u.symbolFadeChange:1,u_matrix:p,u_label_plane_matrix:f,u_coord_matrix:_,u_is_text:+y,u_pitch_with_map:+o,u_texsize:v,u_texture:0}},io=(l,t,n,o,u,p,f,_,y,v,T)=>{const I=u.transform;return a.extend(Uo(l,t,n,o,u,p,f,_,y,v),{u_gamma_scale:o?Math.cos(I._pitch)*I.cameraToCenterDistance:1,u_device_pixel_ratio:u.pixelRatio,u_is_halo:+T})},ja=(l,t,n,o,u,p,f,_,y,v)=>a.extend(io(l,t,n,o,u,p,f,_,!0,y,!0),{u_texsize_icon:v,u_texture_icon:1}),sc=(l,t,n)=>({u_matrix:l,u_opacity:t,u_color:n}),oc=(l,t,n,o,u,p)=>a.extend(function(f,_,y,v){const T=y.imageManager.getPattern(f.from.toString()),I=y.imageManager.getPattern(f.to.toString()),{width:M,height:U}=y.imageManager.getPixelSize(),F=Math.pow(2,v.tileID.overscaledZ),O=v.tileSize*Math.pow(2,y.transform.tileZoom)/F,H=O*(v.tileID.canonical.x+v.tileID.wrap*F),Q=O*v.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:T.tl,u_pattern_br_a:T.br,u_pattern_tl_b:I.tl,u_pattern_br_b:I.br,u_texsize:[M,U],u_mix:_.t,u_pattern_size_a:T.displaySize,u_pattern_size_b:I.displaySize,u_scale_a:_.fromScale,u_scale_b:_.toScale,u_tile_units_to_pixels:1/ti(v,1,y.transform.tileZoom),u_pixel_coord_upper:[H>>16,Q>>16],u_pixel_coord_lower:[65535&H,65535&Q]}}(o,p,n,u),{u_matrix:l,u_opacity:t}),Vo={fillExtrusion:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_lightpos:new a.Uniform3f(l,t.u_lightpos),u_lightintensity:new a.Uniform1f(l,t.u_lightintensity),u_lightcolor:new a.Uniform3f(l,t.u_lightcolor),u_vertical_gradient:new a.Uniform1f(l,t.u_vertical_gradient),u_opacity:new a.Uniform1f(l,t.u_opacity)}),fillExtrusionPattern:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_lightpos:new a.Uniform3f(l,t.u_lightpos),u_lightintensity:new a.Uniform1f(l,t.u_lightintensity),u_lightcolor:new a.Uniform3f(l,t.u_lightcolor),u_vertical_gradient:new a.Uniform1f(l,t.u_vertical_gradient),u_height_factor:new a.Uniform1f(l,t.u_height_factor),u_image:new a.Uniform1i(l,t.u_image),u_texsize:new a.Uniform2f(l,t.u_texsize),u_pixel_coord_upper:new a.Uniform2f(l,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(l,t.u_pixel_coord_lower),u_scale:new a.Uniform3f(l,t.u_scale),u_fade:new a.Uniform1f(l,t.u_fade),u_opacity:new a.Uniform1f(l,t.u_opacity)}),fill:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix)}),fillPattern:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_image:new a.Uniform1i(l,t.u_image),u_texsize:new a.Uniform2f(l,t.u_texsize),u_pixel_coord_upper:new a.Uniform2f(l,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(l,t.u_pixel_coord_lower),u_scale:new a.Uniform3f(l,t.u_scale),u_fade:new a.Uniform1f(l,t.u_fade)}),fillOutline:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_world:new a.Uniform2f(l,t.u_world)}),fillOutlinePattern:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_world:new a.Uniform2f(l,t.u_world),u_image:new a.Uniform1i(l,t.u_image),u_texsize:new a.Uniform2f(l,t.u_texsize),u_pixel_coord_upper:new a.Uniform2f(l,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(l,t.u_pixel_coord_lower),u_scale:new a.Uniform3f(l,t.u_scale),u_fade:new a.Uniform1f(l,t.u_fade)}),circle:(l,t)=>({u_camera_to_center_distance:new a.Uniform1f(l,t.u_camera_to_center_distance),u_scale_with_map:new a.Uniform1i(l,t.u_scale_with_map),u_pitch_with_map:new a.Uniform1i(l,t.u_pitch_with_map),u_extrude_scale:new a.Uniform2f(l,t.u_extrude_scale),u_device_pixel_ratio:new a.Uniform1f(l,t.u_device_pixel_ratio),u_matrix:new a.UniformMatrix4f(l,t.u_matrix)}),collisionBox:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_camera_to_center_distance:new a.Uniform1f(l,t.u_camera_to_center_distance),u_pixels_to_tile_units:new a.Uniform1f(l,t.u_pixels_to_tile_units),u_extrude_scale:new a.Uniform2f(l,t.u_extrude_scale),u_overscale_factor:new a.Uniform1f(l,t.u_overscale_factor)}),collisionCircle:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_inv_matrix:new a.UniformMatrix4f(l,t.u_inv_matrix),u_camera_to_center_distance:new a.Uniform1f(l,t.u_camera_to_center_distance),u_viewport_size:new a.Uniform2f(l,t.u_viewport_size)}),debug:(l,t)=>({u_color:new a.UniformColor(l,t.u_color),u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_overlay:new a.Uniform1i(l,t.u_overlay),u_overlay_scale:new a.Uniform1f(l,t.u_overlay_scale)}),clippingMask:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix)}),heatmap:(l,t)=>({u_extrude_scale:new a.Uniform1f(l,t.u_extrude_scale),u_intensity:new a.Uniform1f(l,t.u_intensity),u_matrix:new a.UniformMatrix4f(l,t.u_matrix)}),heatmapTexture:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_world:new a.Uniform2f(l,t.u_world),u_image:new a.Uniform1i(l,t.u_image),u_color_ramp:new a.Uniform1i(l,t.u_color_ramp),u_opacity:new a.Uniform1f(l,t.u_opacity)}),hillshade:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_image:new a.Uniform1i(l,t.u_image),u_latrange:new a.Uniform2f(l,t.u_latrange),u_light:new a.Uniform2f(l,t.u_light),u_shadow:new a.UniformColor(l,t.u_shadow),u_highlight:new a.UniformColor(l,t.u_highlight),u_accent:new a.UniformColor(l,t.u_accent)}),hillshadePrepare:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_image:new a.Uniform1i(l,t.u_image),u_dimension:new a.Uniform2f(l,t.u_dimension),u_zoom:new a.Uniform1f(l,t.u_zoom),u_unpack:new a.Uniform4f(l,t.u_unpack)}),line:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_ratio:new a.Uniform1f(l,t.u_ratio),u_device_pixel_ratio:new a.Uniform1f(l,t.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(l,t.u_units_to_pixels)}),lineGradient:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_ratio:new a.Uniform1f(l,t.u_ratio),u_device_pixel_ratio:new a.Uniform1f(l,t.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(l,t.u_units_to_pixels),u_image:new a.Uniform1i(l,t.u_image),u_image_height:new a.Uniform1f(l,t.u_image_height)}),linePattern:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_texsize:new a.Uniform2f(l,t.u_texsize),u_ratio:new a.Uniform1f(l,t.u_ratio),u_device_pixel_ratio:new a.Uniform1f(l,t.u_device_pixel_ratio),u_image:new a.Uniform1i(l,t.u_image),u_units_to_pixels:new a.Uniform2f(l,t.u_units_to_pixels),u_scale:new a.Uniform3f(l,t.u_scale),u_fade:new a.Uniform1f(l,t.u_fade)}),lineSDF:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_ratio:new a.Uniform1f(l,t.u_ratio),u_device_pixel_ratio:new a.Uniform1f(l,t.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(l,t.u_units_to_pixels),u_patternscale_a:new a.Uniform2f(l,t.u_patternscale_a),u_patternscale_b:new a.Uniform2f(l,t.u_patternscale_b),u_sdfgamma:new a.Uniform1f(l,t.u_sdfgamma),u_image:new a.Uniform1i(l,t.u_image),u_tex_y_a:new a.Uniform1f(l,t.u_tex_y_a),u_tex_y_b:new a.Uniform1f(l,t.u_tex_y_b),u_mix:new a.Uniform1f(l,t.u_mix)}),raster:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_tl_parent:new a.Uniform2f(l,t.u_tl_parent),u_scale_parent:new a.Uniform1f(l,t.u_scale_parent),u_buffer_scale:new a.Uniform1f(l,t.u_buffer_scale),u_fade_t:new a.Uniform1f(l,t.u_fade_t),u_opacity:new a.Uniform1f(l,t.u_opacity),u_image0:new a.Uniform1i(l,t.u_image0),u_image1:new a.Uniform1i(l,t.u_image1),u_brightness_low:new a.Uniform1f(l,t.u_brightness_low),u_brightness_high:new a.Uniform1f(l,t.u_brightness_high),u_saturation_factor:new a.Uniform1f(l,t.u_saturation_factor),u_contrast_factor:new a.Uniform1f(l,t.u_contrast_factor),u_spin_weights:new a.Uniform3f(l,t.u_spin_weights)}),symbolIcon:(l,t)=>({u_is_size_zoom_constant:new a.Uniform1i(l,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(l,t.u_is_size_feature_constant),u_size_t:new a.Uniform1f(l,t.u_size_t),u_size:new a.Uniform1f(l,t.u_size),u_camera_to_center_distance:new a.Uniform1f(l,t.u_camera_to_center_distance),u_pitch:new a.Uniform1f(l,t.u_pitch),u_rotate_symbol:new a.Uniform1i(l,t.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(l,t.u_aspect_ratio),u_fade_change:new a.Uniform1f(l,t.u_fade_change),u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(l,t.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(l,t.u_coord_matrix),u_is_text:new a.Uniform1i(l,t.u_is_text),u_pitch_with_map:new a.Uniform1i(l,t.u_pitch_with_map),u_texsize:new a.Uniform2f(l,t.u_texsize),u_texture:new a.Uniform1i(l,t.u_texture)}),symbolSDF:(l,t)=>({u_is_size_zoom_constant:new a.Uniform1i(l,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(l,t.u_is_size_feature_constant),u_size_t:new a.Uniform1f(l,t.u_size_t),u_size:new a.Uniform1f(l,t.u_size),u_camera_to_center_distance:new a.Uniform1f(l,t.u_camera_to_center_distance),u_pitch:new a.Uniform1f(l,t.u_pitch),u_rotate_symbol:new a.Uniform1i(l,t.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(l,t.u_aspect_ratio),u_fade_change:new a.Uniform1f(l,t.u_fade_change),u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(l,t.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(l,t.u_coord_matrix),u_is_text:new a.Uniform1i(l,t.u_is_text),u_pitch_with_map:new a.Uniform1i(l,t.u_pitch_with_map),u_texsize:new a.Uniform2f(l,t.u_texsize),u_texture:new a.Uniform1i(l,t.u_texture),u_gamma_scale:new a.Uniform1f(l,t.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(l,t.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(l,t.u_is_halo)}),symbolTextAndIcon:(l,t)=>({u_is_size_zoom_constant:new a.Uniform1i(l,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(l,t.u_is_size_feature_constant),u_size_t:new a.Uniform1f(l,t.u_size_t),u_size:new a.Uniform1f(l,t.u_size),u_camera_to_center_distance:new a.Uniform1f(l,t.u_camera_to_center_distance),u_pitch:new a.Uniform1f(l,t.u_pitch),u_rotate_symbol:new a.Uniform1i(l,t.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(l,t.u_aspect_ratio),u_fade_change:new a.Uniform1f(l,t.u_fade_change),u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(l,t.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(l,t.u_coord_matrix),u_is_text:new a.Uniform1i(l,t.u_is_text),u_pitch_with_map:new a.Uniform1i(l,t.u_pitch_with_map),u_texsize:new a.Uniform2f(l,t.u_texsize),u_texsize_icon:new a.Uniform2f(l,t.u_texsize_icon),u_texture:new a.Uniform1i(l,t.u_texture),u_texture_icon:new a.Uniform1i(l,t.u_texture_icon),u_gamma_scale:new a.Uniform1f(l,t.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(l,t.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(l,t.u_is_halo)}),background:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_opacity:new a.Uniform1f(l,t.u_opacity),u_color:new a.UniformColor(l,t.u_color)}),backgroundPattern:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_opacity:new a.Uniform1f(l,t.u_opacity),u_image:new a.Uniform1i(l,t.u_image),u_pattern_tl_a:new a.Uniform2f(l,t.u_pattern_tl_a),u_pattern_br_a:new a.Uniform2f(l,t.u_pattern_br_a),u_pattern_tl_b:new a.Uniform2f(l,t.u_pattern_tl_b),u_pattern_br_b:new a.Uniform2f(l,t.u_pattern_br_b),u_texsize:new a.Uniform2f(l,t.u_texsize),u_mix:new a.Uniform1f(l,t.u_mix),u_pattern_size_a:new a.Uniform2f(l,t.u_pattern_size_a),u_pattern_size_b:new a.Uniform2f(l,t.u_pattern_size_b),u_scale_a:new a.Uniform1f(l,t.u_scale_a),u_scale_b:new a.Uniform1f(l,t.u_scale_b),u_pixel_coord_upper:new a.Uniform2f(l,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(l,t.u_pixel_coord_lower),u_tile_units_to_pixels:new a.Uniform1f(l,t.u_tile_units_to_pixels)}),terrain:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_texture:new a.Uniform1i(l,t.u_texture)}),terrainDepth:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix)}),terrainCoords:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_texture:new a.Uniform1i(l,t.u_texture),u_terrain_coords_id:new a.Uniform1f(l,t.u_terrain_coords_id)})};class No{constructor(t,n,o){this.context=t;const u=t.gl;this.buffer=u.createBuffer(),this.dynamicDraw=Boolean(o),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const $o={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class qo{constructor(t,n,o,u){this.length=n.length,this.attributes=o,this.itemSize=n.bytesPerElement,this.dynamicDraw=u,this.context=t;const p=t.gl;this.buffer=p.createBuffer(),t.bindVertexBuffer.set(this.buffer),p.bufferData(p.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let o=0;o<this.attributes.length;o++){const u=n.attributes[this.attributes[o].name];u!==void 0&&t.enableVertexAttribArray(u)}}setVertexAttribPointers(t,n,o){for(let u=0;u<this.attributes.length;u++){const p=this.attributes[u],f=n.attributes[p.name];f!==void 0&&t.vertexAttribPointer(f,p.components,t[$o[p.type]],!1,this.itemSize,p.offset+this.itemSize*(o||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class At{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Xa extends At{getDefault(){return a.Color.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ac extends At{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class vs extends At{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class bs extends At{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Wa extends At{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Ni extends At{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Go extends At{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class ro extends At{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class no extends At{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class Zo extends At{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class jo extends At{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class so extends At{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Xo extends At{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class Wo extends At{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class oo extends At{getDefault(){return a.Color.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ha extends At{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Ka extends At{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class Wn extends At{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class lc extends At{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class cc extends At{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class uc extends At{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class hc extends At{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class pc extends At{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class dc extends At{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ho extends At{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class ao extends At{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ko extends At{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Yo extends At{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class Hn extends At{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Ya extends At{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Ja extends At{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class lo extends At{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class _n extends lo{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Qa extends lo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Kn{constructor(t,n,o,u){this.context=t,this.width=n,this.height=o;const p=t.gl,f=this.framebuffer=p.createFramebuffer();if(this.colorAttachment=new _n(t,f),u&&(this.depthAttachment=new Qa(t,f)),p.checkFramebufferStatus(p.FRAMEBUFFER)!==p.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,n=this.colorAttachment.get();if(n&&t.deleteTexture(n),this.depthAttachment){const o=this.depthAttachment.get();o&&t.deleteRenderbuffer(o)}t.deleteFramebuffer(this.framebuffer)}}class $t{constructor(t,n,o){this.blendFunction=t,this.blendColor=n,this.mask=o}}$t.Replace=[1,0],$t.disabled=new $t($t.Replace,a.Color.transparent,[!1,!1,!1,!1]),$t.unblended=new $t($t.Replace,a.Color.transparent,[!0,!0,!0,!0]),$t.alphaBlended=new $t([1,771],a.Color.transparent,[!0,!0,!0,!0]);class el{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Xa(this),this.clearDepth=new ac(this),this.clearStencil=new vs(this),this.colorMask=new bs(this),this.depthMask=new Wa(this),this.stencilMask=new Ni(this),this.stencilFunc=new Go(this),this.stencilOp=new ro(this),this.stencilTest=new no(this),this.depthRange=new Zo(this),this.depthTest=new jo(this),this.depthFunc=new so(this),this.blend=new Xo(this),this.blendFunc=new Wo(this),this.blendColor=new oo(this),this.blendEquation=new Ha(this),this.cullFace=new Ka(this),this.cullFaceSide=new Wn(this),this.frontFace=new lc(this),this.program=new cc(this),this.activeTexture=new uc(this),this.viewport=new hc(this),this.bindFramebuffer=new pc(this),this.bindRenderbuffer=new dc(this),this.bindTexture=new Ho(this),this.bindVertexBuffer=new ao(this),this.bindElementBuffer=new Ko(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Yo(this),this.pixelStoreUnpack=new Hn(this),this.pixelStoreUnpackPremultiplyAlpha=new Ya(this),this.pixelStoreUnpackFlipY=new Ja(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n){return new No(this,t,n)}createVertexBuffer(t,n,o){return new qo(this,t,n,o)}createRenderbuffer(t,n,o){const u=this.gl,p=u.createRenderbuffer();return this.bindRenderbuffer.set(p),u.renderbufferStorage(u.RENDERBUFFER,t,n,o),this.bindRenderbuffer.set(null),p}createFramebuffer(t,n,o){return new Kn(this,t,n,o)}clear({color:t,depth:n}){const o=this.gl;let u=0;t&&(u|=o.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(u|=o.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),o.clear(u)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){fe(t.blendFunction,$t.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class _t{constructor(t,n,o){this.func=t,this.mask=n,this.range=o}}_t.ReadOnly=!1,_t.ReadWrite=!0,_t.disabled=new _t(519,_t.ReadOnly,[0,1]);const Ct=7680;class Nt{constructor(t,n,o,u,p,f){this.test=t,this.ref=n,this.mask=o,this.fail=u,this.depthFail=p,this.pass=f}}Nt.disabled=new Nt({func:519,mask:0},0,0,Ct,Ct,Ct);class jt{constructor(t,n,o){this.enable=t,this.mode=n,this.frontFace=o}}let ws;function Yn(l,t,n,o,u,p,f){const _=l.context,y=_.gl,v=l.useProgram("collisionBox"),T=[];let I=0,M=0;for(let V=0;V<o.length;V++){const oe=o[V],ne=t.getTile(oe),me=ne.getBucket(n);if(!me)continue;let ge=oe.posMatrix;u[0]===0&&u[1]===0||(ge=l.translatePosMatrix(oe.posMatrix,ne,u,p));const be=f?me.textCollisionBox:me.iconCollisionBox,he=me.collisionCircleArray;if(he.length>0){const Re=a.create(),Ie=ge;a.mul(Re,me.placementInvProjMatrix,l.transform.glCoordMatrix),a.mul(Re,Re,me.placementViewportMatrix),T.push({circleArray:he,circleOffset:M,transform:Ie,invTransform:Re,coord:oe}),I+=he.length/4,M=I}be&&v.draw(_,y.LINES,_t.disabled,Nt.disabled,l.colorModeForRenderPass(),jt.disabled,gn(ge,l.transform,ne),l.style.terrain&&l.style.terrain.getTerrainData(oe),n.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,null,l.transform.zoom,null,null,be.collisionVertexBuffer)}if(!f||!T.length)return;const U=l.useProgram("collisionCircle"),F=new a.CollisionCircleLayoutArray;F.resize(4*I),F._trim();let O=0;for(const V of T)for(let oe=0;oe<V.circleArray.length/4;oe++){const ne=4*oe,me=V.circleArray[ne+0],ge=V.circleArray[ne+1],be=V.circleArray[ne+2],he=V.circleArray[ne+3];F.emplace(O++,me,ge,be,he,0),F.emplace(O++,me,ge,be,he,1),F.emplace(O++,me,ge,be,he,2),F.emplace(O++,me,ge,be,he,3)}(!ws||ws.length<2*I)&&(ws=function(V){const oe=2*V,ne=new a.QuadTriangleArray;ne.resize(oe),ne._trim();for(let me=0;me<oe;me++){const ge=6*me;ne.uint16[ge+0]=4*me+0,ne.uint16[ge+1]=4*me+1,ne.uint16[ge+2]=4*me+2,ne.uint16[ge+3]=4*me+2,ne.uint16[ge+4]=4*me+3,ne.uint16[ge+5]=4*me+0}return ne}(I));const H=_.createIndexBuffer(ws,!0),Q=_.createVertexBuffer(F,a.collisionCircleLayout.members,!0);for(const V of T){const oe={u_matrix:V.transform,u_inv_matrix:V.invTransform,u_camera_to_center_distance:(re=l.transform).cameraToCenterDistance,u_viewport_size:[re.width,re.height]};U.draw(_,y.TRIANGLES,_t.disabled,Nt.disabled,l.colorModeForRenderPass(),jt.disabled,oe,l.style.terrain&&l.style.terrain.getTerrainData(V.coord),n.id,Q,H,a.SegmentVector.simpleSegment(0,2*V.circleOffset,V.circleArray.length,V.circleArray.length/2),null,l.transform.zoom,null,null,null)}var re;Q.destroy(),H.destroy()}jt.disabled=new jt(!1,1029,2305),jt.backCCW=new jt(!0,1029,2305);const fc=a.identity(new Float32Array(16));function mc(l,t,n,o,u,p){const{horizontalAlign:f,verticalAlign:_}=a.getAnchorAlignment(l),y=-(f-.5)*t,v=-(_-.5)*n,T=a.evaluateVariableOffset(l,o);return new a.pointGeometry((y/u+T[0])*p,(v/u+T[1])*p)}function tl(l,t,n,o,u,p,f,_,y,v,T){const I=l.text.placedSymbolArray,M=l.text.dynamicLayoutVertexArray,U=l.icon.dynamicLayoutVertexArray,F={};M.clear();for(let O=0;O<I.length;O++){const H=I.get(O),Q=l.allowVerticalPlacement&&!H.placedOrientation,re=H.hidden||!H.crossTileID||Q?null:o[H.crossTileID];if(re){const V=new a.pointGeometry(H.anchorX,H.anchorY),oe=vt(V,n?f:p,T),ne=Ji(u.cameraToCenterDistance,oe.signedDistanceFromCamera);let me=a.evaluateSizeForFeature(l.textSizeData,y,H)*ne/a.ONE_EM;n&&(me*=l.tilePixelRatio/_);const{width:ge,height:be,anchor:he,textOffset:Re,textBoxScale:Ie}=re,Fe=mc(he,ge,be,Re,Ie,me),at=n?vt(V.add(Fe),p,T).point:oe.point.add(t?Fe.rotate(-u.angle):Fe),ht=l.allowVerticalPlacement&&H.placedOrientation===a.WritingMode.vertical?Math.PI/2:0;for(let Xe=0;Xe<H.numGlyphs;Xe++)a.addDynamicAttributes(M,at,ht);v&&H.associatedIconIndex>=0&&(F[H.associatedIconIndex]={shiftedAnchor:at,angle:ht})}else st(H.numGlyphs,M)}if(v){U.clear();const O=l.icon.placedSymbolArray;for(let H=0;H<O.length;H++){const Q=O.get(H);if(Q.hidden)st(Q.numGlyphs,U);else{const re=F[H];if(re)for(let V=0;V<Q.numGlyphs;V++)a.addDynamicAttributes(U,re.shiftedAnchor,re.angle);else st(Q.numGlyphs,U)}}l.icon.dynamicLayoutVertexBuffer.updateData(U)}l.text.dynamicLayoutVertexBuffer.updateData(M)}function gc(l,t,n){return n.iconsInText&&t?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function co(l,t,n,o,u,p,f,_,y,v,T,I){const M=l.context,U=M.gl,F=l.transform,O=_==="map",H=y==="map",Q=_!=="viewport"&&n.layout.get("symbol-placement")!=="point",re=O&&!H&&!Q,V=!n.layout.get("symbol-sort-key").isConstant();let oe=!1;const ne=l.depthModeForSublayer(0,_t.ReadOnly),me=n.layout.get("text-variable-anchor"),ge=[];for(const be of o){const he=t.getTile(be),Re=he.getBucket(n);if(!Re)continue;const Ie=u?Re.text:Re.icon;if(!Ie||!Ie.segments.get().length)continue;const Fe=Ie.programConfigurations.get(n.id),at=u||Re.sdfIcons,ht=u?Re.textSizeData:Re.iconSizeData,Xe=H||F.pitch!==0,zt=l.useProgram(gc(at,u,Re),Fe),Pt=a.evaluateSizeForZoom(ht,F.zoom),yt=l.style.terrain&&l.style.terrain.getTerrainData(be);let Tt,Bt,hi,vr,ur=[0,0],br=null;if(u){if(Bt=he.glyphAtlasTexture,hi=U.LINEAR,Tt=he.glyphAtlasTexture.size,Re.iconsInText){ur=he.imageAtlasTexture.size,br=he.imageAtlasTexture;const tr=ht.kind==="composite"||ht.kind==="camera";vr=Xe||l.options.rotating||l.options.zooming||tr?U.LINEAR:U.NEAREST}}else{const tr=n.layout.get("icon-size").constantOr(0)!==1||Re.iconsNeedLinear;Bt=he.imageAtlasTexture,hi=at||l.options.rotating||l.options.zooming||tr||Xe?U.LINEAR:U.NEAREST,Tt=he.imageAtlasTexture.size}const nn=ti(he,1,l.transform.zoom),er=pn(be.posMatrix,H,O,l.transform,nn),Di=lr(be.posMatrix,H,O,l.transform,nn),Dr=me&&Re.hasTextData(),yo=n.layout.get("icon-text-fit")!=="none"&&Dr&&Re.hasIconData();if(Q){const tr=l.style.terrain?(pa,rs)=>l.style.terrain.getElevation(be,pa,rs):null,bn=n.layout.get("text-rotation-alignment")==="map";Vi(Re,be.posMatrix,l,u,er,Di,H,v,bn,tr)}const oi=l.translatePosMatrix(be.posMatrix,he,p,f),ft=Q||u&&me||yo?fc:er,Mt=l.translatePosMatrix(Di,he,p,f,!0),pi=at&&n.paint.get(u?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let di;di=at?Re.iconsInText?ja(ht.kind,Pt,re,H,l,oi,ft,Mt,Tt,ur):io(ht.kind,Pt,re,H,l,oi,ft,Mt,u,Tt,!0):Uo(ht.kind,Pt,re,H,l,oi,ft,Mt,u,Tt);const Wt={program:zt,buffers:Ie,uniformValues:di,atlasTexture:Bt,atlasTextureIcon:br,atlasInterpolation:hi,atlasInterpolationIcon:vr,isSDF:at,hasHalo:pi};if(V&&Re.canOverlap){oe=!0;const tr=Ie.segments.get();for(const bn of tr)ge.push({segments:new a.SegmentVector([bn]),sortKey:bn.sortKey,state:Wt,terrainData:yt})}else ge.push({segments:Ie.segments,sortKey:0,state:Wt,terrainData:yt})}oe&&ge.sort((be,he)=>be.sortKey-he.sortKey);for(const be of ge){const he=be.state;if(M.activeTexture.set(U.TEXTURE0),he.atlasTexture.bind(he.atlasInterpolation,U.CLAMP_TO_EDGE),he.atlasTextureIcon&&(M.activeTexture.set(U.TEXTURE1),he.atlasTextureIcon&&he.atlasTextureIcon.bind(he.atlasInterpolationIcon,U.CLAMP_TO_EDGE)),he.isSDF){const Re=he.uniformValues;he.hasHalo&&(Re.u_is_halo=1,Ts(he.buffers,be.segments,n,l,he.program,ne,T,I,Re,be.terrainData)),Re.u_is_halo=0}Ts(he.buffers,be.segments,n,l,he.program,ne,T,I,he.uniformValues,be.terrainData)}}function Ts(l,t,n,o,u,p,f,_,y,v){const T=o.context;u.draw(T,T.gl.TRIANGLES,p,f,_,jt.disabled,y,v,n.id,l.layoutVertexBuffer,l.indexBuffer,t,n.paint,o.transform.zoom,l.programConfigurations.get(n.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function Es(l,t,n,o,u,p,f){const _=l.context.gl,y=n.paint.get("fill-pattern"),v=y&&y.constantOr(1),T=n.getCrossfadeParameters();let I,M,U,F,O;f?(M=v&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",I=_.LINES):(M=v?"fillPattern":"fill",I=_.TRIANGLES);for(const H of o){const Q=t.getTile(H);if(v&&!Q.patternsLoaded())continue;const re=Q.getBucket(n);if(!re)continue;const V=re.programConfigurations.get(n.id),oe=l.useProgram(M,V),ne=l.style.terrain&&l.style.terrain.getTerrainData(H);v&&(l.context.activeTexture.set(_.TEXTURE0),Q.imageAtlasTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),V.updatePaintBuffers(T));const me=y.constantOr(null);if(me&&Q.imageAtlas){const he=Q.imageAtlas,Re=he.patternPositions[me.to.toString()],Ie=he.patternPositions[me.from.toString()];Re&&Ie&&V.setConstantPatternPositions(Re,Ie)}const ge=ne?H:null,be=l.translatePosMatrix(ge?ge.posMatrix:H.posMatrix,Q,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(f){F=re.indexBuffer2,O=re.segments2;const he=[_.drawingBufferWidth,_.drawingBufferHeight];U=M==="fillOutlinePattern"&&v?$a(be,l,T,Q,he):Na(be,he)}else F=re.indexBuffer,O=re.segments,U=v?Fo(be,l,T,Q):Js(be);oe.draw(l.context,I,u,l.stencilModeForClipping(H),p,jt.disabled,U,ne,n.id,re.layoutVertexBuffer,F,O,n.paint,l.transform.zoom,V)}}function Ss(l,t,n,o,u,p,f){const _=l.context,y=_.gl,v=n.paint.get("fill-extrusion-pattern"),T=v.constantOr(1),I=n.getCrossfadeParameters(),M=n.paint.get("fill-extrusion-opacity");for(const U of o){const F=t.getTile(U),O=F.getBucket(n);if(!O)continue;const H=l.style.terrain&&l.style.terrain.getTerrainData(U),Q=O.programConfigurations.get(n.id),re=l.useProgram(T?"fillExtrusionPattern":"fillExtrusion",Q);T&&(l.context.activeTexture.set(y.TEXTURE0),F.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),Q.updatePaintBuffers(I));const V=v.constantOr(null);if(V&&F.imageAtlas){const ge=F.imageAtlas,be=ge.patternPositions[V.to.toString()],he=ge.patternPositions[V.from.toString()];be&&he&&Q.setConstantPatternPositions(be,he)}const oe=l.translatePosMatrix(U.posMatrix,F,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),ne=n.paint.get("fill-extrusion-vertical-gradient"),me=T?nc(oe,l,ne,M,U,I,F):Ro(oe,l,ne,M);re.draw(_,_.gl.TRIANGLES,u,p,f,jt.backCCW,me,H,n.id,O.layoutVertexBuffer,O.indexBuffer,O.segments,n.paint,l.transform.zoom,Q,l.style.terrain&&O.centroidVertexBuffer)}}function Jo(l,t,n,o,u,p,f){const _=l.context,y=_.gl,v=n.fbo;if(!v)return;const T=l.useProgram("hillshade"),I=l.style.terrain&&l.style.terrain.getTerrainData(t);_.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,v.colorAttachment.get()),T.draw(_,y.TRIANGLES,u,p,f,jt.disabled,((M,U,F,O)=>{const H=F.paint.get("hillshade-shadow-color"),Q=F.paint.get("hillshade-highlight-color"),re=F.paint.get("hillshade-accent-color");let V=F.paint.get("hillshade-illumination-direction")*(Math.PI/180);F.paint.get("hillshade-illumination-anchor")==="viewport"&&(V-=M.transform.angle);const oe=!M.options.moving;return{u_matrix:O?O.posMatrix:M.transform.calculatePosMatrix(U.tileID.toUnwrapped(),oe),u_image:0,u_latrange:eo(0,U.tileID),u_light:[F.paint.get("hillshade-exaggeration"),V],u_shadow:H,u_highlight:Q,u_accent:re}})(l,n,o,I?t:null),I,o.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}function il(l,t,n,o,u,p){const f=l.context,_=f.gl,y=t.dem;if(y&&y.data){const v=y.dim,T=y.stride,I=y.getPixels();if(f.activeTexture.set(_.TEXTURE1),f.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||l.getTileTexture(T),t.demTexture){const U=t.demTexture;U.update(I,{premultiply:!1}),U.bind(_.NEAREST,_.CLAMP_TO_EDGE)}else t.demTexture=new Te(f,I,_.RGBA,{premultiply:!1}),t.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);f.activeTexture.set(_.TEXTURE0);let M=t.fbo;if(!M){const U=new Te(f,{width:v,height:v,data:null},_.RGBA);U.bind(_.LINEAR,_.CLAMP_TO_EDGE),M=t.fbo=f.createFramebuffer(v,v,!0),M.colorAttachment.set(U.texture)}f.bindFramebuffer.set(M.framebuffer),f.viewport.set([0,0,v,v]),l.useProgram("hillshadePrepare").draw(f,_.TRIANGLES,o,u,p,jt.disabled,((U,F)=>{const O=F.stride,H=a.create();return a.ortho(H,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate(H,H,[0,-a.EXTENT,0]),{u_matrix:H,u_image:1,u_dimension:[O,O],u_zoom:U.overscaledZ,u_unpack:F.getUnpackVector()}})(t.tileID,y),null,n.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function uo(l,t,n,o,u,p){const f=o.paint.get("raster-fade-duration");if(!p&&f>0){const _=a.exported.now(),y=(_-l.timeAdded)/f,v=t?(_-t.timeAdded)/f:-1,T=n.getSource(),I=u.coveringZoomLevel({tileSize:T.tileSize,roundZoom:T.roundZoom}),M=!t||Math.abs(t.tileID.overscaledZ-I)>Math.abs(l.tileID.overscaledZ-I),U=M&&l.refreshedUponExpiration?1:a.clamp(M?y:1-v,0,1);return l.refreshedUponExpiration&&y>=1&&(l.refreshedUponExpiration=!1),t?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}const ho=new a.Color(1,0,0,1),cr=new a.Color(0,1,0,1),rl=new a.Color(0,0,1,1),Qo=new a.Color(1,0,1,1),nl=new a.Color(0,1,1,1);function yn(l,t,n,o){Jn(l,0,t+n/2,l.transform.width,n,o)}function Is(l,t,n,o){Jn(l,t-n/2,0,n,l.transform.height,o)}function Jn(l,t,n,o,u,p){const f=l.context,_=f.gl;_.enable(_.SCISSOR_TEST),_.scissor(t*l.pixelRatio,n*l.pixelRatio,o*l.pixelRatio,u*l.pixelRatio),f.clear({color:p}),_.disable(_.SCISSOR_TEST)}function _c(l,t,n){const o=l.context,u=o.gl,p=n.posMatrix,f=l.useProgram("debug"),_=_t.disabled,y=Nt.disabled,v=l.colorModeForRenderPass(),T="$debug",I=l.style.terrain&&l.style.terrain.getTerrainData(n);o.activeTexture.set(u.TEXTURE0),l.emptyTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE);const M=t.getTileByID(n.key).latestRawTileData,U=Math.floor((M&&M.byteLength||0)/1024),F=t.getTile(n).tileSize,O=512/Math.min(F,512)*(n.overscaledZ/l.transform.zoom)*.5;let H=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(H+=` => ${n.overscaledZ}`),function(Q,re){Q.initDebugOverlayCanvas();const V=Q.debugOverlayCanvas,oe=Q.context.gl,ne=Q.debugOverlayCanvas.getContext("2d");ne.clearRect(0,0,V.width,V.height),ne.shadowColor="white",ne.shadowBlur=2,ne.lineWidth=1.5,ne.strokeStyle="white",ne.textBaseline="top",ne.font="bold 36px Open Sans, sans-serif",ne.fillText(re,5,5),ne.strokeText(re,5,5),Q.debugOverlayTexture.update(V),Q.debugOverlayTexture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE)}(l,`${H} ${U}kB`),f.draw(o,u.TRIANGLES,_,y,$t.alphaBlended,jt.disabled,_s(p,a.Color.transparent,O),null,T,l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments),f.draw(o,u.LINE_STRIP,_,y,v,jt.disabled,_s(p,a.Color.red),I,T,l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments)}function po(l,t,n){const o=l.context,u=o.gl,p=l.colorModeForRenderPass(),f=new _t(u.LEQUAL,_t.ReadWrite,l.depthRangeFor3D),_=l.useProgram("terrain"),y=t.getTerrainMesh(),v=t.getTerrainData(n.tileID);o.bindFramebuffer.set(null),o.viewport.set([0,0,l.width,l.height]),o.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,t.getRTTFramebuffer().colorAttachment.get());const T=l.transform.calculatePosMatrix(n.tileID.toUnwrapped());_.draw(o,u.TRIANGLES,f,Nt.disabled,p,jt.backCCW,{u_matrix:T,u_texture:0},v,"terrain",y.vertexBuffer,y.indexBuffer,y.segments)}function sl(l,t,n,o){const u=l.context,p=n.tileSize*t.qualityFactor;n.textures[o]||(n.textures[o]=l.getTileTexture(p)||new Te(u,{width:p,height:p,data:null},u.gl.RGBA),n.textures[o].bind(u.gl.LINEAR,u.gl.CLAMP_TO_EDGE),o===0&&t.sourceCache.renderHistory.unshift(n.tileID.key));const f=t.getRTTFramebuffer();f.colorAttachment.set(n.textures[o].texture),u.bindFramebuffer.set(f.framebuffer),u.viewport.set([0,0,p,p])}class ol{constructor(t){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=t,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=t.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const t=this.painter.style,n=t.terrain;for(const o in t.sourceCaches){this._coordsDescendingInv[o]={};const u=t.sourceCaches[o].getVisibleCoordinates();for(const p of u){const f=n.sourceCache.getTerrainCoords(p);for(const _ in f)this._coordsDescendingInv[o][_]||(this._coordsDescendingInv[o][_]=[]),this._coordsDescendingInv[o][_].push(f[_])}}for(const o of t._order){const u=t._layers[o],p=u.source;if(this._renderToTexture[u.type]&&!this._coordsDescendingInvStr[p]){this._coordsDescendingInvStr[p]={};for(const f in this._coordsDescendingInv[p])this._coordsDescendingInvStr[p][f]=this._coordsDescendingInv[p][f].map(_=>_.key).sort().join()}}return this._renderableTiles.forEach(o=>{for(const u in this._coordsDescendingInvStr){const p=this._coordsDescendingInvStr[u][o.tileID.key];p&&p!==o.textureCoords[u]&&o.clearTextures(this.painter),n.needsRerender(u,o.tileID)&&o.clearTextures(this.painter)}this._rerender[o.tileID.key]=!o.textures.length}),n.clearRerenderCache(),n.sourceCache.removeOutdated(this.painter),this}renderLayer(t){const n=t.type,o=this.painter,u=o.style._order,p=o.currentLayer,f=p+1===u.length;if(this._renderToTexture[n]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=n,this._stacks[this._stacks.length-1].push(u[p]),!f))return!0;if(this._renderToTexture[this._prevType]||n==="hillshade"||this._renderToTexture[n]&&f){this._prevType=n;const _=this._stacks.length-1,y=this._stacks[_]||[];for(const v of this._renderableTiles){if(sl(o,o.style.terrain,v,_),this._rerender[v.tileID.key]){o.context.clear({color:a.Color.transparent});for(let T=0;T<y.length;T++){const I=o.style._layers[y[T]],M=I.source?this._coordsDescendingInv[I.source][v.tileID.key]:[v.tileID];o._renderTileClippingMasks(I,M),o.renderLayer(o,o.style.sourceCaches[I.source],I,M),I.source&&(v.textureCoords[I.source]=this._coordsDescendingInvStr[I.source][v.tileID.key])}}po(o,o.style.terrain,v)}if(n==="hillshade"){this._stacks.push([u[p]]);for(const v of this._renderableTiles){const T=this._coordsDescendingInv[t.source][v.tileID.key];sl(o,o.style.terrain,v,this._stacks.length-1),o.context.clear({color:a.Color.transparent}),o._renderTileClippingMasks(t,T),o.renderLayer(o,o.style.sourceCaches[t.source],t,T),po(o,o.style.terrain,v)}return!0}return this._renderToTexture[n]}return!1}}const As={symbol:function(l,t,n,o,u){if(l.renderPass!=="translucent")return;const p=Nt.disabled,f=l.colorModeForRenderPass();n.layout.get("text-variable-anchor")&&function(_,y,v,T,I,M,U){const F=y.transform,O=I==="map",H=M==="map";for(const Q of _){const re=T.getTile(Q),V=re.getBucket(v);if(!V||!V.text||!V.text.segments.get().length)continue;const oe=a.evaluateSizeForZoom(V.textSizeData,F.zoom),ne=ti(re,1,y.transform.zoom),me=pn(Q.posMatrix,H,O,y.transform,ne),ge=v.layout.get("icon-text-fit")!=="none"&&V.hasIconData();if(oe){const be=Math.pow(2,F.zoom-re.tileID.overscaledZ);tl(V,O,H,U,F,me,Q.posMatrix,be,oe,ge,y.style.terrain?(he,Re)=>y.style.terrain.getElevation(Q,he,Re):null)}}}(o,l,n,t,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),u),n.paint.get("icon-opacity").constantOr(1)!==0&&co(l,t,n,o,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright"),p,f),n.paint.get("text-opacity").constantOr(1)!==0&&co(l,t,n,o,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright"),p,f),t.map.showCollisionBoxes&&(Yn(l,t,n,o,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),Yn(l,t,n,o,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(l,t,n,o){if(l.renderPass!=="translucent")return;const u=n.paint.get("circle-opacity"),p=n.paint.get("circle-stroke-width"),f=n.paint.get("circle-stroke-opacity"),_=!n.layout.get("circle-sort-key").isConstant();if(u.constantOr(1)===0&&(p.constantOr(1)===0||f.constantOr(1)===0))return;const y=l.context,v=y.gl,T=l.depthModeForSublayer(0,_t.ReadOnly),I=Nt.disabled,M=l.colorModeForRenderPass(),U=[];for(let F=0;F<o.length;F++){const O=o[F],H=t.getTile(O),Q=H.getBucket(n);if(!Q)continue;const re=Q.programConfigurations.get(n.id),V=l.useProgram("circle",re),oe=Q.layoutVertexBuffer,ne=Q.indexBuffer,me=l.style.terrain&&l.style.terrain.getTerrainData(O),ge={programConfiguration:re,program:V,layoutVertexBuffer:oe,indexBuffer:ne,uniformValues:qa(l,O,H,n),terrainData:me};if(_){const be=Q.segments.get();for(const he of be)U.push({segments:new a.SegmentVector([he]),sortKey:he.sortKey,state:ge})}else U.push({segments:Q.segments,sortKey:0,state:ge})}_&&U.sort((F,O)=>F.sortKey-O.sortKey);for(const F of U){const{programConfiguration:O,program:H,layoutVertexBuffer:Q,indexBuffer:re,uniformValues:V,terrainData:oe}=F.state;H.draw(y,v.TRIANGLES,T,I,M,jt.disabled,V,oe,n.id,Q,re,F.segments,n.paint,l.transform.zoom,O)}},heatmap:function(l,t,n,o){if(n.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){const u=l.context,p=u.gl,f=Nt.disabled,_=new $t([p.ONE,p.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(y,v,T){const I=y.gl;y.activeTexture.set(I.TEXTURE1),y.viewport.set([0,0,v.width/4,v.height/4]);let M=T.heatmapFbo;if(M)I.bindTexture(I.TEXTURE_2D,M.colorAttachment.get()),y.bindFramebuffer.set(M.framebuffer);else{const U=I.createTexture();I.bindTexture(I.TEXTURE_2D,U),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_S,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_T,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MIN_FILTER,I.LINEAR),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MAG_FILTER,I.LINEAR),M=T.heatmapFbo=y.createFramebuffer(v.width/4,v.height/4,!1),function(F,O,H,Q){const re=F.gl;re.texImage2D(re.TEXTURE_2D,0,re.RGBA,O.width/4,O.height/4,0,re.RGBA,F.extRenderToTextureHalfFloat?F.extTextureHalfFloat.HALF_FLOAT_OES:re.UNSIGNED_BYTE,null),Q.colorAttachment.set(H)}(y,v,U,M)}})(u,l,n),u.clear({color:a.Color.transparent});for(let y=0;y<o.length;y++){const v=o[y];if(t.hasRenderableParent(v))continue;const T=t.getTile(v),I=T.getBucket(n);if(!I)continue;const M=I.programConfigurations.get(n.id),U=l.useProgram("heatmap",M),{zoom:F}=l.transform;U.draw(u,p.TRIANGLES,_t.disabled,f,_,jt.disabled,Qs(v.posMatrix,T,F,n.paint.get("heatmap-intensity")),null,n.id,I.layoutVertexBuffer,I.indexBuffer,I.segments,n.paint,l.transform.zoom,M)}u.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(u,p){const f=u.context,_=f.gl,y=p.heatmapFbo;if(!y)return;f.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,y.colorAttachment.get()),f.activeTexture.set(_.TEXTURE1);let v=p.colorRampTexture;v||(v=p.colorRampTexture=new Te(f,p.colorRamp,_.RGBA)),v.bind(_.LINEAR,_.CLAMP_TO_EDGE),u.useProgram("heatmapTexture").draw(f,_.TRIANGLES,_t.disabled,Nt.disabled,u.colorModeForRenderPass(),jt.disabled,((T,I,M,U)=>{const F=a.create();a.ortho(F,0,T.width,T.height,0,0,1);const O=T.context.gl;return{u_matrix:F,u_world:[O.drawingBufferWidth,O.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:I.paint.get("heatmap-opacity")}})(u,p),null,p.id,u.viewportBuffer,u.quadTriangleIndexBuffer,u.viewportSegments,p.paint,u.transform.zoom)}(l,n))},line:function(l,t,n,o){if(l.renderPass!=="translucent")return;const u=n.paint.get("line-opacity"),p=n.paint.get("line-width");if(u.constantOr(1)===0||p.constantOr(1)===0)return;const f=l.depthModeForSublayer(0,_t.ReadOnly),_=l.colorModeForRenderPass(),y=n.paint.get("line-dasharray"),v=n.paint.get("line-pattern"),T=v.constantOr(1),I=n.paint.get("line-gradient"),M=n.getCrossfadeParameters(),U=T?"linePattern":y?"lineSDF":I?"lineGradient":"line",F=l.context,O=F.gl;let H=!0;for(const Q of o){const re=t.getTile(Q);if(T&&!re.patternsLoaded())continue;const V=re.getBucket(n);if(!V)continue;const oe=V.programConfigurations.get(n.id),ne=l.context.program.get(),me=l.useProgram(U,oe),ge=H||me.program!==ne,be=l.style.terrain&&l.style.terrain.getTerrainData(Q),he=v.constantOr(null);if(he&&re.imageAtlas){const Fe=re.imageAtlas,at=Fe.patternPositions[he.to.toString()],ht=Fe.patternPositions[he.from.toString()];at&&ht&&oe.setConstantPatternPositions(at,ht)}const Re=be?Q:null,Ie=T?to(l,re,n,M,Re):y?ys(l,re,n,y,M,Re):I?Oo(l,re,n,V.lineClipsArray.length,Re):Xn(l,re,n,Re);if(T)F.activeTexture.set(O.TEXTURE0),re.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),oe.updatePaintBuffers(M);else if(y&&(ge||l.lineAtlas.dirty))F.activeTexture.set(O.TEXTURE0),l.lineAtlas.bind(F);else if(I){const Fe=V.gradients[n.id];let at=Fe.texture;if(n.gradientVersion!==Fe.version){let ht=256;if(n.stepInterpolant){const Xe=t.getSource().maxzoom,zt=Q.canonical.z===Xe?Math.ceil(1<<l.transform.maxZoom-Q.canonical.z):1;ht=a.clamp(a.nextPowerOfTwo(V.maxLineLength/a.EXTENT*1024*zt),256,F.maxTextureSize)}Fe.gradient=a.renderColorRamp({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:ht,image:Fe.gradient||void 0,clips:V.lineClipsArray}),Fe.texture?Fe.texture.update(Fe.gradient):Fe.texture=new Te(F,Fe.gradient,O.RGBA),Fe.version=n.gradientVersion,at=Fe.texture}F.activeTexture.set(O.TEXTURE0),at.bind(n.stepInterpolant?O.NEAREST:O.LINEAR,O.CLAMP_TO_EDGE)}me.draw(F,O.TRIANGLES,f,l.stencilModeForClipping(Q),_,jt.disabled,Ie,be,n.id,V.layoutVertexBuffer,V.indexBuffer,V.segments,n.paint,l.transform.zoom,oe,V.layoutVertexBuffer2),H=!1}},fill:function(l,t,n,o){const u=n.paint.get("fill-color"),p=n.paint.get("fill-opacity");if(p.constantOr(1)===0)return;const f=l.colorModeForRenderPass(),_=n.paint.get("fill-pattern"),y=l.opaquePassEnabledForLayer()&&!_.constantOr(1)&&u.constantOr(a.Color.transparent).a===1&&p.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===y){const v=l.depthModeForSublayer(1,l.renderPass==="opaque"?_t.ReadWrite:_t.ReadOnly);Es(l,t,n,o,v,f,!1)}if(l.renderPass==="translucent"&&n.paint.get("fill-antialias")){const v=l.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,_t.ReadOnly);Es(l,t,n,o,v,f,!0)}},"fill-extrusion":function(l,t,n,o){const u=n.paint.get("fill-extrusion-opacity");if(u!==0&&l.renderPass==="translucent"){const p=new _t(l.context.gl.LEQUAL,_t.ReadWrite,l.depthRangeFor3D);if(u!==1||n.paint.get("fill-extrusion-pattern").constantOr(1))Ss(l,t,n,o,p,Nt.disabled,$t.disabled),Ss(l,t,n,o,p,l.stencilModeFor3D(),l.colorModeForRenderPass());else{const f=l.colorModeForRenderPass();Ss(l,t,n,o,p,Nt.disabled,f)}}},hillshade:function(l,t,n,o){if(l.renderPass!=="offscreen"&&l.renderPass!=="translucent")return;const u=l.context,p=l.depthModeForSublayer(0,_t.ReadOnly),f=l.colorModeForRenderPass(),[_,y]=l.renderPass==="translucent"?l.stencilConfigForOverlap(o):[{},o];for(const v of y){const T=t.getTile(v);T.needsHillshadePrepare!==void 0&&T.needsHillshadePrepare&&l.renderPass==="offscreen"?il(l,T,n,p,Nt.disabled,f):l.renderPass==="translucent"&&Jo(l,v,T,n,p,_[v.overscaledZ],f)}u.viewport.set([0,0,l.width,l.height])},raster:function(l,t,n,o){if(l.renderPass!=="translucent"||n.paint.get("raster-opacity")===0||!o.length)return;const u=l.context,p=u.gl,f=t.getSource(),_=l.useProgram("raster"),y=l.colorModeForRenderPass(),[v,T]=f instanceof or?[{},o]:l.stencilConfigForOverlap(o),I=T[T.length-1].overscaledZ,M=!l.options.moving;for(const U of T){const F=l.depthModeForSublayer(U.overscaledZ-I,n.paint.get("raster-opacity")===1?_t.ReadWrite:_t.ReadOnly,p.LESS),O=t.getTile(U);O.registerFadeDuration(n.paint.get("raster-fade-duration"));const H=t.findLoadedParent(U,0),Q=uo(O,H,t,n,l.transform,l.style.terrain);let re,V;const oe=n.paint.get("raster-resampling")==="nearest"?p.NEAREST:p.LINEAR;u.activeTexture.set(p.TEXTURE0),O.texture.bind(oe,p.CLAMP_TO_EDGE,p.LINEAR_MIPMAP_NEAREST),u.activeTexture.set(p.TEXTURE1),H?(H.texture.bind(oe,p.CLAMP_TO_EDGE,p.LINEAR_MIPMAP_NEAREST),re=Math.pow(2,H.tileID.overscaledZ-O.tileID.overscaledZ),V=[O.tileID.canonical.x*re%1,O.tileID.canonical.y*re%1]):O.texture.bind(oe,p.CLAMP_TO_EDGE,p.LINEAR_MIPMAP_NEAREST);const ne=l.style.terrain&&l.style.terrain.getTerrainData(U),me=ne?U:null,ge=me?me.posMatrix:l.transform.calculatePosMatrix(U.toUnwrapped(),M),be=Ga(ge,V||[0,0],re||1,Q,n);f instanceof or?_.draw(u,p.TRIANGLES,F,Nt.disabled,y,jt.disabled,be,ne,n.id,f.boundsBuffer,l.quadTriangleIndexBuffer,f.boundsSegments):_.draw(u,p.TRIANGLES,F,v[U.overscaledZ],y,jt.disabled,be,ne,n.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,t,n,o){const u=n.paint.get("background-color"),p=n.paint.get("background-opacity");if(p===0)return;const f=l.context,_=f.gl,y=l.transform,v=y.tileSize,T=n.paint.get("background-pattern");if(l.isPatternMissing(T))return;const I=!T&&u.a===1&&p===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass!==I)return;const M=Nt.disabled,U=l.depthModeForSublayer(0,I==="opaque"?_t.ReadWrite:_t.ReadOnly),F=l.colorModeForRenderPass(),O=l.useProgram(T?"backgroundPattern":"background"),H=o||y.coveringTiles({tileSize:v,terrain:l.style.terrain});T&&(f.activeTexture.set(_.TEXTURE0),l.imageManager.bind(l.context));const Q=n.getCrossfadeParameters();for(const re of H){const V=o?re.posMatrix:l.transform.calculatePosMatrix(re.toUnwrapped()),oe=T?oc(V,p,l,T,{tileID:re,tileSize:v},Q):sc(V,p,u),ne=l.style.terrain&&l.style.terrain.getTerrainData(re);O.draw(f,_.TRIANGLES,U,M,F,jt.disabled,oe,ne,n.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}},debug:function(l,t,n){for(let o=0;o<n.length;o++)_c(l,t,n[o])},custom:function(l,t,n){const o=l.context,u=n.implementation;if(l.renderPass==="offscreen"){const p=u.prerender;p&&(l.setCustomLayerDefaults(),o.setColorMode(l.colorModeForRenderPass()),p.call(u,o.gl,l.transform.customLayerMatrix()),o.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),o.setColorMode(l.colorModeForRenderPass()),o.setStencilMode(Nt.disabled);const p=u.renderingMode==="3d"?new _t(l.context.gl.LEQUAL,_t.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,_t.ReadOnly);o.setDepthMode(p),u.render(o.gl,l.transform.customLayerMatrix()),o.setDirty(),l.setBaseState(),o.bindFramebuffer.set(null)}}};class ea{constructor(t,n){this.context=new el(t),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.create(),renderTime:0},this.setup(),this.numSublayers=zi.maxUnderzooming+zi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new et,this.gpuTimers={}}resize(t,n,o){if(this.width=t*o,this.height=n*o,this.pixelRatio=o,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style._order)this.style._layers[u].resize()}setup(){const t=this.context,n=new a.PosArray;n.emplaceBack(0,0),n.emplaceBack(a.EXTENT,0),n.emplaceBack(0,a.EXTENT),n.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(n,bt.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);const o=new a.PosArray;o.emplaceBack(0,0),o.emplaceBack(a.EXTENT,0),o.emplaceBack(0,a.EXTENT),o.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=t.createVertexBuffer(o,bt.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);const u=new a.RasterBoundsArray;u.emplaceBack(0,0,0,0),u.emplaceBack(a.EXTENT,0,a.EXTENT,0),u.emplaceBack(0,a.EXTENT,0,a.EXTENT),u.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(u,Sr.members),this.rasterBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);const p=new a.PosArray;p.emplaceBack(0,0),p.emplaceBack(1,0),p.emplaceBack(0,1),p.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(p,bt.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);const f=new a.LineStripIndexArray;f.emplaceBack(0),f.emplaceBack(1),f.emplaceBack(3),f.emplaceBack(2),f.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(f);const _=new a.TriangleIndexArray;_.emplaceBack(0,1,2),_.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(_),this.emptyTexture=new Te(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA);const y=this.context.gl;this.stencilClearMode=new Nt({func:y.ALWAYS,mask:0},0,255,y.ZERO,y.ZERO,y.ZERO)}clearStencil(){const t=this.context,n=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const o=a.create();a.ortho(o,0,this.width,this.height,0,0,1),a.scale(o,o,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,n.TRIANGLES,_t.disabled,this.stencilClearMode,$t.disabled,jt.disabled,jn(o),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,n){if(this.currentStencilSource===t.source||!t.isTileClipped()||!n||!n.length)return;this.currentStencilSource=t.source;const o=this.context,u=o.gl;this.nextStencilID+n.length>256&&this.clearStencil(),o.setColorMode($t.disabled),o.setDepthMode(_t.disabled);const p=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const f of n){const _=this._tileClippingMaskIDs[f.key]=this.nextStencilID++,y=this.style.terrain&&this.style.terrain.getTerrainData(f);p.draw(o,u.TRIANGLES,_t.disabled,new Nt({func:u.ALWAYS,mask:0},_,255,u.KEEP,u.KEEP,u.REPLACE),$t.disabled,jt.disabled,jn(f.posMatrix),y,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new Nt({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){const n=this.context.gl;return new Nt({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,o=t.sort((f,_)=>_.overscaledZ-f.overscaledZ),u=o[o.length-1].overscaledZ,p=o[0].overscaledZ-u+1;if(p>1){this.currentStencilSource=void 0,this.nextStencilID+p>256&&this.clearStencil();const f={};for(let _=0;_<p;_++)f[_+u]=new Nt({func:n.GEQUAL,mask:255},_+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=p,[f,o]}return[{[u]:Nt.disabled},o]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new $t([t.CONSTANT_COLOR,t.ONE],new a.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?$t.unblended:$t.alphaBlended}depthModeForSublayer(t,n,o){if(!this.opaquePassEnabledForLayer())return _t.disabled;const u=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new _t(o||this.context.gl.LEQUAL,n,[u,u])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,n){this.style=t,this.options=n,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(a.exported.now()),this.imageManager.beginFrame();const o=this.style._order,u=this.style.sourceCaches,p=this.style.terrain&&new ol(this);for(const v in u){const T=u[v];T.used&&T.prepare(this.context)}const f={},_={},y={};for(const v in u){const T=u[v];f[v]=T.getVisibleCoordinates(),_[v]=f[v].slice().reverse(),y[v]=T.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let v=0;v<o.length;v++)if(this.style._layers[o[v]].is3D()){this.opaquePassCutoff=v;break}if(p){this.opaquePassCutoff=0;const v=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!a.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||v.length)&&(a.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(T,I){const M=T.context,U=M.gl,F=$t.unblended,O=new _t(U.LEQUAL,_t.ReadWrite,[0,1]),H=I.getTerrainMesh(),Q=I.sourceCache.getRenderableTiles(),re=T.useProgram("terrainDepth");M.bindFramebuffer.set(I.getFramebuffer("depth").framebuffer),M.viewport.set([0,0,T.width/devicePixelRatio,T.height/devicePixelRatio]),M.clear({color:a.Color.transparent,depth:1});for(const V of Q){const oe=I.getTerrainData(V.tileID),ne=T.transform.calculatePosMatrix(V.tileID.toUnwrapped());re.draw(M,U.TRIANGLES,O,Nt.disabled,F,jt.backCCW,{u_matrix:ne},oe,"terrain",H.vertexBuffer,H.indexBuffer,H.segments)}M.bindFramebuffer.set(null),M.viewport.set([0,0,T.width,T.height])}(this,this.style.terrain),function(T,I){const M=T.context,U=M.gl,F=$t.unblended,O=new _t(U.LEQUAL,_t.ReadWrite,[0,1]),H=I.getTerrainMesh(),Q=I.getCoordsTexture(),re=I.sourceCache.getRenderableTiles(),V=T.useProgram("terrainCoords");M.bindFramebuffer.set(I.getFramebuffer("coords").framebuffer),M.viewport.set([0,0,T.width/devicePixelRatio,T.height/devicePixelRatio]),M.clear({color:a.Color.transparent,depth:1}),I.coordsIndex=[];for(const oe of re){const ne=I.getTerrainData(oe.tileID);M.activeTexture.set(U.TEXTURE0),U.bindTexture(U.TEXTURE_2D,Q.texture);const me=T.transform.calculatePosMatrix(oe.tileID.toUnwrapped());V.draw(M,U.TRIANGLES,O,Nt.disabled,F,jt.backCCW,{u_matrix:me,u_terrain_coords_id:(255-I.coordsIndex.length)/255,u_texture:0},ne,"terrain",H.vertexBuffer,H.indexBuffer,H.segments),I.coordsIndex.push(oe.tileID.key)}M.bindFramebuffer.set(null),M.viewport.set([0,0,T.width,T.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const v of o){const T=this.style._layers[v];if(!T.hasOffscreenPass()||T.isHidden(this.transform.zoom))continue;const I=_[T.source];(T.type==="custom"||I.length)&&this.renderLayer(this,u[T.source],T,I)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?a.Color.black:a.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!p)for(this.renderPass="opaque",this.currentLayer=o.length-1;this.currentLayer>=0;this.currentLayer--){const v=this.style._layers[o[this.currentLayer]],T=u[v.source],I=f[v.source];this._renderTileClippingMasks(v,I),this.renderLayer(this,T,v,I)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<o.length;this.currentLayer++){const v=this.style._layers[o[this.currentLayer]],T=u[v.source];if(p&&p.renderLayer(v))continue;const I=(v.type==="symbol"?y:_)[v.source];this._renderTileClippingMasks(v,f[v.source]),this.renderLayer(this,T,v,I)}if(this.options.showTileBoundaries){let v,T;Object.values(this.style._layers).forEach(I=>{I.source&&!I.isHidden(this.transform.zoom)&&(I.source!==(T&&T.id)&&(T=this.style.sourceCaches[I.source]),(!v||v.getSource().maxzoom<T.getSource().maxzoom)&&(v=T))}),v&&As.debug(this,v,v.getVisibleCoordinates())}this.options.showPadding&&function(v){const T=v.transform.padding;yn(v,v.transform.height-(T.top||0),3,ho),yn(v,T.bottom||0,3,cr),Is(v,T.left||0,3,rl),Is(v,v.transform.width-(T.right||0),3,Qo);const I=v.transform.centerPoint;(function(M,U,F,O){Jn(M,U-1,F-10,2,20,O),Jn(M,U-10,F-1,20,2,O)})(v,I.x,v.transform.height-I.y,nl)}(this),this.context.setDefault()}renderLayer(t,n,o,u){o.isHidden(this.transform.zoom)||(o.type==="background"||o.type==="custom"||(u||[]).length)&&(this.id=o.id,this.gpuTimingStart(o),As[o.type](t,n,o,u,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;let o=this.gpuTimers[t.id];o||(o=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:n.createQueryEXT()}),o.calls++,n.beginQueryEXT(n.TIME_ELAPSED_EXT,o.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const n={};for(const o in t){const u=t[o],p=this.context.extTimerQuery,f=p.getQueryObjectEXT(u.query,p.QUERY_RESULT_EXT)/1e6;p.deleteQueryEXT(u.query),n[o]=f}return n}translatePosMatrix(t,n,o,u,p){if(!o[0]&&!o[1])return t;const f=p?u==="map"?this.transform.angle:0:u==="viewport"?-this.transform.angle:0;if(f){const v=Math.sin(f),T=Math.cos(f);o=[o[0]*T-o[1]*v,o[0]*v+o[1]*T]}const _=[p?o[0]:ti(n,o[0],this.transform.zoom),p?o[1]:ti(n,o[1],this.transform.zoom),0],y=new Float32Array(16);return a.translate(y,t,_),y}saveTileTexture(t){const n=this._tileTextures[t.size[0]];n?n.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const n=this.imageManager.getPattern(t.from.toString()),o=this.imageManager.getPattern(t.to.toString());return!n||!o}useProgram(t,n){this.cache=this.cache||{};const o=t+(n?n.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[o]||(this.cache[o]=new Ua(this.context,t,gs[t],n,Vo[t],this._showOverdrawInspector,this.style.terrain)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Te(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class fo{constructor(t,n){this.points=t,this.planes=n}static fromInvProjectionMatrix(t,n,o){const u=Math.pow(2,o),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(_=>{const y=1/(_=a.transformMat4([],_,t))[3]/n*u;return a.mul$1(_,_,[y,y,1/_[3],y])}),f=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(_=>{const y=a.sub([],p[_[0]],p[_[1]]),v=a.sub([],p[_[2]],p[_[1]]),T=a.normalize([],a.cross([],y,v)),I=-a.dot(T,p[_[1]]);return T.concat(I)});return new fo(p,f)}}class Cs{constructor(t,n){this.min=t,this.max=n,this.center=a.scale$1([],a.add([],this.min,this.max),.5)}quadrant(t){const n=[t%2==0,t<2],o=a.clone$2(this.min),u=a.clone$2(this.max);for(let p=0;p<n.length;p++)o[p]=n[p]?this.min[p]:this.center[p],u[p]=n[p]?this.center[p]:this.max[p];return u[2]=this.max[2],new Cs(o,u)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let o=!0;for(let u=0;u<t.planes.length;u++){const p=t.planes[u];let f=0;for(let _=0;_<n.length;_++)a.dot$1(p,n[_])>=0&&f++;if(f===0)return 0;f!==n.length&&(o=!1)}if(o)return 2;for(let u=0;u<3;u++){let p=Number.MAX_VALUE,f=-Number.MAX_VALUE;for(let _=0;_<t.points.length;_++){const y=t.points[_][u]-this.min[u];p=Math.min(p,y),f=Math.max(f,y)}if(f<0||p>this.max[u]-this.min[u])return 0}return 1}}class Qn{constructor(t=0,n=0,o=0,u=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(o)||o<0||isNaN(u)||u<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=o,this.right=u}interpolate(t,n,o){return n.top!=null&&t.top!=null&&(this.top=a.number(t.top,n.top,o)),n.bottom!=null&&t.bottom!=null&&(this.bottom=a.number(t.bottom,n.bottom,o)),n.left!=null&&t.left!=null&&(this.left=a.number(t.left,n.left,o)),n.right!=null&&t.right!=null&&(this.right=a.number(t.right,n.right,o)),this}getCenter(t,n){const o=a.clamp((this.left+t-this.right)/2,0,t),u=a.clamp((this.top+n-this.bottom)/2,0,n);return new a.pointGeometry(o,u)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Qn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class ks{constructor(t,n,o,u,p){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=p===void 0||!!p,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=o==null?0:o,this._maxPitch=u==null?60:u,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Qn,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const t=new ks(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t._elevation=this._elevation,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._calcMatrices(),t}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const n=-a.wrap(t,-180,180)*Math.PI/180;var o;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=(o=new a.ARRAY_TYPE(4),a.ARRAY_TYPE!=Float32Array&&(o[1]=0,o[2]=0),o[0]=1,o[3]=1,o),function(u,p,f){var _=p[0],y=p[1],v=p[2],T=p[3],I=Math.sin(f),M=Math.cos(f);u[0]=_*M+v*I,u[1]=y*M+T*I,u[2]=_*-I+v*M,u[3]=y*-I+T*M}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=a.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const n=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,o){this._unmodified=!1,this._edgeInsets.interpolate(t,n,o),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(t){const n=[new a.UnwrappedTileID(0,t)];if(this._renderWorldCopies){const o=this.pointCoordinate(new a.pointGeometry(0,0)),u=this.pointCoordinate(new a.pointGeometry(this.width,0)),p=this.pointCoordinate(new a.pointGeometry(this.width,this.height)),f=this.pointCoordinate(new a.pointGeometry(0,this.height)),_=Math.floor(Math.min(o.x,u.x,p.x,f.x)),y=Math.floor(Math.max(o.x,u.x,p.x,f.x)),v=1;for(let T=_-v;T<=y+v;T++)T!==0&&n.push(new a.UnwrappedTileID(T,t))}return n}coveringTiles(t){var n,o;let u=this.coveringZoomLevel(t);const p=u;if(t.minzoom!==void 0&&u<t.minzoom)return[];t.maxzoom!==void 0&&u>t.maxzoom&&(u=t.maxzoom);const f=this.pointCoordinate(this.getCameraPoint()),_=a.MercatorCoordinate.fromLngLat(this.center),y=Math.pow(2,u),v=[y*f.x,y*f.y,0],T=[y*_.x,y*_.y,0],I=fo.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u);let M=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(M=u);const U=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,F=V=>({aabb:new Cs([V*y,0,0],[(V+1)*y,y,0]),zoom:0,x:0,y:0,wrap:V,fullyVisible:!1}),O=[],H=[],Q=u,re=t.reparseOverscaled?p:u;if(this._renderWorldCopies)for(let V=1;V<=3;V++)O.push(F(-V)),O.push(F(V));for(O.push(F(0));O.length>0;){const V=O.pop(),oe=V.x,ne=V.y;let me=V.fullyVisible;if(!me){const Fe=V.aabb.intersects(I);if(Fe===0)continue;me=Fe===2}const ge=t.terrain?v:T,be=V.aabb.distanceX(ge),he=V.aabb.distanceY(ge),Re=Math.max(Math.abs(be),Math.abs(he)),Ie=U+(1<<Q-V.zoom)-2;if(V.zoom===Q||Re>Ie&&V.zoom>=M){const Fe=Q-V.zoom,at=v[0]-.5-(oe<<Fe),ht=v[1]-.5-(ne<<Fe);H.push({tileID:new a.OverscaledTileID(V.zoom===Q?re:V.zoom,V.wrap,V.zoom,oe,ne),distanceSq:a.sqrLen([T[0]-.5-oe,T[1]-.5-ne]),tileDistanceToCamera:Math.sqrt(at*at+ht*ht)})}else for(let Fe=0;Fe<4;Fe++){const at=(oe<<1)+Fe%2,ht=(ne<<1)+(Fe>>1),Xe=V.zoom+1;let zt=V.aabb.quadrant(Fe);if(t.terrain){const Pt=new a.OverscaledTileID(Xe,V.wrap,Xe,at,ht),yt=t.terrain.getMinMaxElevation(Pt),Tt=(n=yt.minElevation)!==null&&n!==void 0?n:this.elevation,Bt=(o=yt.maxElevation)!==null&&o!==void 0?o:this.elevation;zt=new Cs([zt.min[0],zt.min[1],Tt],[zt.max[0],zt.max[1],Bt])}O.push({aabb:zt,zoom:Xe,x:at,y:ht,wrap:V.wrap,fullyVisible:me})}}return H.sort((V,oe)=>V.distanceSq-oe.distanceSq).map(V=>V.tileID)}resize(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const n=a.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new a.pointGeometry(a.mercatorXfromLng(t.lng)*this.worldSize,a.mercatorYfromLat(n)*this.worldSize)}unproject(t){return new a.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(t){this.freezeElevation||(this.elevation=t?this.getElevation(this._center,t):0)}getElevation(t,n){const o=a.MercatorCoordinate.fromLngLat(t),u=(1<<this.tileZoom)*a.EXTENT,p=o.x*u,f=o.y*u,_=Math.floor(p/a.EXTENT),y=Math.floor(f/a.EXTENT),v=new a.OverscaledTileID(this.tileZoom,0,this.tileZoom,_,y);return n.getElevation(v,p%a.EXTENT,f%a.EXTENT,a.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const n=this.pointLocation(this.centerPoint,t),o=this.getElevation(n,t);if(!(this.elevation-o))return;const u=this.getCameraPosition(),p=a.MercatorCoordinate.fromLngLat(u.lngLat,u.altitude),f=a.MercatorCoordinate.fromLngLat(n,o),_=p.x-f.x,y=p.y-f.y,v=p.z-f.z,T=Math.sqrt(_*_+y*y+v*v),I=this.scaleZoom(this.cameraToCenterDistance/T/this.tileSize);this._elevation=o,this._center=n,this.zoom=I}setLocationAtPoint(t,n){const o=this.pointCoordinate(n),u=this.pointCoordinate(this.centerPoint),p=this.locationCoordinate(t),f=new a.MercatorCoordinate(p.x-(o.x-u.x),p.y-(o.y-u.y));this.center=this.coordinateLocation(f),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,n){return n?this.coordinatePoint(this.locationCoordinate(t),this.getElevation(t,n),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,n){return this.coordinateLocation(this.pointCoordinate(t,n))}locationCoordinate(t){return a.MercatorCoordinate.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,n){if(n){const M=n.pointCoordinate(t);if(M!=null)return M}const o=[t.x,t.y,0,1],u=[t.x,t.y,1,1];a.transformMat4(o,o,this.pixelMatrixInverse),a.transformMat4(u,u,this.pixelMatrixInverse);const p=o[3],f=u[3],_=o[1]/p,y=u[1]/f,v=o[2]/p,T=u[2]/f,I=v===T?0:(0-v)/(T-v);return new a.MercatorCoordinate(a.number(o[0]/p,u[0]/f,I)/this.worldSize,a.number(_,y,I)/this.worldSize)}coordinatePoint(t,n=0,o=this.pixelMatrix){const u=[t.x*this.worldSize,t.y*this.worldSize,n,1];return a.transformMat4(u,u,o),new a.pointGeometry(u[0]/u[3],u[1]/u[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new a.LngLatBounds().extend(this.pointLocation(new a.pointGeometry(0,t))).extend(this.pointLocation(new a.pointGeometry(this.width,t))).extend(this.pointLocation(new a.pointGeometry(this.width,this.height))).extend(this.pointLocation(new a.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new a.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,n=!1){const o=t.key,u=n?this._alignedPosMatrixCache:this._posMatrixCache;if(u[o])return u[o];const p=t.canonical,f=this.worldSize/this.zoomScale(p.z),_=p.x+Math.pow(2,p.z)*t.wrap,y=a.identity(new Float64Array(16));return a.translate(y,y,[_*f,p.y*f,0]),a.scale(y,y,[f/a.EXTENT,f/a.EXTENT,1]),a.multiply(y,n?this.alignedProjMatrix:this.projMatrix,y),u[o]=new Float32Array(y),u[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,n,o,u,p=-90,f=90,_=-180,y=180;const v=this.size,T=this._unmodified;if(this.latRange){const U=this.latRange;p=a.mercatorYfromLat(U[1])*this.worldSize,f=a.mercatorYfromLat(U[0])*this.worldSize,t=f-p<v.y?v.y/(f-p):0}if(this.lngRange){const U=this.lngRange;_=a.wrap(a.mercatorXfromLng(U[0])*this.worldSize,0,this.worldSize),y=a.wrap(a.mercatorXfromLng(U[1])*this.worldSize,0,this.worldSize),y<_&&(y+=this.worldSize),n=y-_<v.x?v.x/(y-_):0}const I=this.point,M=Math.max(n||0,t||0);if(M)return this.center=this.unproject(new a.pointGeometry(n?(y+_)/2:I.x,t?(f+p)/2:I.y)),this.zoom+=this.scaleZoom(M),this._unmodified=T,void(this._constraining=!1);if(this.latRange){const U=I.y,F=v.y/2;U-F<p&&(u=p+F),U+F>f&&(u=f-F)}if(this.lngRange){const U=(_+y)/2,F=a.wrap(I.x,U-this.worldSize/2,U+this.worldSize/2),O=v.x/2;F-O<_&&(o=_+O),F+O>y&&(o=y-O)}o===void 0&&u===void 0||(this.center=this.unproject(new a.pointGeometry(o!==void 0?o:I.x,u!==void 0?u:I.y)).wrap()),this._unmodified=T,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n=this.point.x,o=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let u=a.identity(new Float64Array(16));a.scale(u,u,[this.width/2,-this.height/2,1]),a.translate(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=a.identity(new Float64Array(16)),a.scale(u,u,[1,-1,1]),a.translate(u,u,[-1,-1,0]),a.scale(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const p=Math.PI/2+this._pitch,f=this._fov*(.5+t.y/this.height),_=Math.sin(f)*this.cameraToSeaLevelDistance/Math.sin(a.clamp(Math.PI-p-f,.01,Math.PI-.01)),y=this.getHorizon(),v=2*Math.atan(y/this.cameraToCenterDistance)*(.5+t.y/(2*y)),T=Math.sin(v)*this.cameraToSeaLevelDistance/Math.sin(a.clamp(Math.PI-p-v,.01,Math.PI-.01)),I=Math.cos(Math.PI/2-this._pitch)*_+this.cameraToSeaLevelDistance,M=Math.cos(Math.PI/2-this._pitch)*T+this.cameraToSeaLevelDistance,U=1.01*Math.min(I,M),F=this.height/50;u=new Float64Array(16),a.perspective(u,this._fov,this.width/this.height,F,U),u[8]=2*-t.x/this.width,u[9]=2*t.y/this.height,a.scale(u,u,[1,-1,1]),a.translate(u,u,[0,0,-this.cameraToCenterDistance]),a.rotateX(u,u,this._pitch),a.rotateZ(u,u,this.angle),a.translate(u,u,[-n,-o,0]),this.mercatorMatrix=a.scale([],u,[this.worldSize,this.worldSize,this.worldSize]),a.scale(u,u,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.multiply(new Float64Array(16),this.labelPlaneMatrix,u),a.translate(u,u,[0,0,-this.elevation]),this.projMatrix=u,this.invProjMatrix=a.invert([],u),this.pixelMatrix3D=a.multiply(new Float64Array(16),this.labelPlaneMatrix,u);const O=this.width%2/2,H=this.height%2/2,Q=Math.cos(this.angle),re=Math.sin(this.angle),V=n-Math.round(n)+Q*O+re*H,oe=o-Math.round(o)+Q*H+re*O,ne=new Float64Array(u);if(a.translate(ne,ne,[V>.5?V-1:V,oe>.5?oe-1:oe,0]),this.alignedProjMatrix=ne,u=a.invert(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");this.pixelMatrixInverse=u,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new a.pointGeometry(0,0)),n=[t.x*this.worldSize,t.y*this.worldSize,0,1];return a.transformMat4(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.pointGeometry(0,t))}getCameraQueryGeometry(t){const n=this.getCameraPoint();if(t.length===1)return[t[0],n];{let o=n.x,u=n.y,p=n.x,f=n.y;for(const _ of t)o=Math.min(o,_.x),u=Math.min(u,_.y),p=Math.max(p,_.x),f=Math.max(f,_.y);return[new a.pointGeometry(o,u),new a.pointGeometry(p,u),new a.pointGeometry(p,f),new a.pointGeometry(o,f),new a.pointGeometry(o,u)]}}}class al{constructor(t){this._hashName=t&&encodeURIComponent(t),a.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(n,o){let u=!1,p=null;const f=()=>{p=null,u&&(n(),p=setTimeout(f,300),u=!1)};return()=>(u=!0,p||f(),p)}(this._updateHashUnthrottled.bind(this))}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const n=this._map.getCenter(),o=Math.round(100*this._map.getZoom())/100,u=Math.ceil((o*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,u),f=Math.round(n.lng*p)/p,_=Math.round(n.lat*p)/p,y=this._map.getBearing(),v=this._map.getPitch();let T="";if(T+=t?`/${f}/${_}/${o}`:`${o}/${_}/${f}`,(y||v)&&(T+="/"+Math.round(10*y)/10),v&&(T+=`/${Math.round(v)}`),this._hashName){const I=this._hashName;let M=!1;const U=window.location.hash.slice(1).split("&").map(F=>{const O=F.split("=")[0];return O===I?(M=!0,`${O}=${T}`):F}).filter(F=>F);return M||U.push(`${I}=${T}`),`#${U.join("&")}`}return`#${T}`}_getCurrentHash(){const t=window.location.hash.replace("#","");if(this._hashName){let n;return t.split("&").map(o=>o.split("=")).forEach(o=>{o[0]===this._hashName&&(n=o)}),(n&&n[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._getCurrentHash();if(t.length>=3&&!t.some(n=>isNaN(n))){const n=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:n,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,t)}catch{}}}const Ms={linearity:.3,easing:a.bezier(0,0,.3,1)},ll=a.extend({deceleration:2500,maxSpeed:1400},Ms),cl=a.extend({deceleration:20,maxSpeed:1400},Ms),ul=a.extend({deceleration:1e3,maxSpeed:360},Ms),es=a.extend({deceleration:1e3,maxSpeed:90},Ms);class hl{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=a.exported.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new a.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:p}of this._inertiaBuffer)n.zoom+=p.zoomDelta||0,n.bearing+=p.bearingDelta||0,n.pitch+=p.pitchDelta||0,p.panDelta&&n.pan._add(p.panDelta),p.around&&(n.around=p.around),p.pinchAround&&(n.pinchAround=p.pinchAround);const o=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,u={};if(n.pan.mag()){const p=Ps(n.pan.mag(),o,a.extend({},ll,t||{}));u.offset=n.pan.mult(p.amount/n.pan.mag()),u.center=this._map.transform.center,zs(u,p)}if(n.zoom){const p=Ps(n.zoom,o,cl);u.zoom=this._map.transform.zoom+p.amount,zs(u,p)}if(n.bearing){const p=Ps(n.bearing,o,ul);u.bearing=this._map.transform.bearing+a.clamp(p.amount,-179,179),zs(u,p)}if(n.pitch){const p=Ps(n.pitch,o,es);u.pitch=this._map.transform.pitch+p.amount,zs(u,p)}if(u.zoom||u.bearing){const p=n.pinchAround===void 0?n.around:n.pinchAround;u.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),a.extend(u,{noMoveStart:!0})}}function zs(l,t){(!l.duration||l.duration<t.duration)&&(l.duration=t.duration,l.easing=t.easing)}function Ps(l,t,n){const{maxSpeed:o,linearity:u,deceleration:p}=n,f=a.clamp(l*u/(t/1e3),-o,o),_=Math.abs(f)/(p*u);return{easing:n.easing,duration:1e3*_,amount:f*(_/2)}}class $i extends a.Event{constructor(t,n,o,u={}){const p=te.mousePos(n.getCanvasContainer(),o),f=n.unproject(p);super(t,a.extend({point:p,lngLat:f,originalEvent:o},u)),this._defaultPrevented=!1,this.target=n}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Ds extends a.Event{constructor(t,n,o){const u=t==="touchend"?o.changedTouches:o.touches,p=te.touchPos(n.getCanvasContainer(),u),f=p.map(y=>n.unproject(y)),_=p.reduce((y,v,T,I)=>y.add(v.div(I.length)),new a.pointGeometry(0,0));super(t,{points:p,point:_,lngLats:f,lngLat:n.unproject(_),originalEvent:o}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class qi extends a.Event{constructor(t,n,o){super(t,{originalEvent:o}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class yc{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new qi(t.type,this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new $i(t.type,this._map,t))}mouseup(t){this._map.fire(new $i(t.type,this._map,t))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new $i(t.type,this._map,t))}dblclick(t){return this._firePreventable(new $i(t.type,this._map,t))}mouseover(t){this._map.fire(new $i(t.type,this._map,t))}mouseout(t){this._map.fire(new $i(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Ds(t.type,this._map,t))}touchmove(t){this._map.fire(new Ds(t.type,this._map,t))}touchend(t){this._map.fire(new Ds(t.type,this._map,t))}touchcancel(t){this._map.fire(new Ds(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Yr{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new $i(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new $i("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new $i(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class pl{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(te.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const o=n;if(this._lastPos.equals(o)||!this._box&&o.dist(this._startPos)<this._clickTolerance)return;const u=this._startPos;this._lastPos=o,this._box||(this._box=te.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const p=Math.min(u.x,o.x),f=Math.max(u.x,o.x),_=Math.min(u.y,o.y),y=Math.max(u.y,o.y);te.setTransform(this._box,`translate(${p}px,${_}px)`),this._box.style.width=f-p+"px",this._box.style.height=y-_+"px"}mouseupWindow(t,n){if(!this._active||t.button!==0)return;const o=this._startPos,u=n;if(this.reset(),te.suppressClick(),o.x!==u.x||o.y!==u.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:p=>p.fitScreenCoordinates(o,u,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(te.remove(this._box),this._box=null),te.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new a.Event(t,{originalEvent:n}))}}function zr(l,t){if(l.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${l.length}, points ${t.length}`);const n={};for(let o=0;o<l.length;o++)n[l[o].identifier]=t[o];return n}class Ls{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,n,o){(this.centroid||o.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),o.length===this.numTouches&&(this.centroid=function(u){const p=new a.pointGeometry(0,0);for(const f of u)p._add(f);return p.div(u.length)}(n),this.touches=zr(o,n)))}touchmove(t,n,o){if(this.aborted||!this.centroid)return;const u=zr(o,n);for(const p in this.touches){const f=this.touches[p],_=u[p];(!_||_.dist(f)>30)&&(this.aborted=!0)}}touchend(t,n,o){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),o.length===0){const u=!this.aborted&&this.centroid;if(this.reset(),u)return u}}}class ta{constructor(t){this.singleTap=new Ls(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,n,o){this.singleTap.touchstart(t,n,o)}touchmove(t,n,o){this.singleTap.touchmove(t,n,o)}touchend(t,n,o){const u=this.singleTap.touchend(t,n,o);if(u){const p=t.timeStamp-this.lastTime<500,f=!this.lastTap||this.lastTap.dist(u)<30;if(p&&f||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=u,this.count===this.numTaps)return this.reset(),u}}}class xc{constructor(){this._zoomIn=new ta({numTouches:1,numTaps:2}),this._zoomOut=new ta({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,o){this._zoomIn.touchstart(t,n,o),this._zoomOut.touchstart(t,n,o)}touchmove(t,n,o){this._zoomIn.touchmove(t,n,o),this._zoomOut.touchmove(t,n,o)}touchend(t,n,o){const u=this._zoomIn.touchend(t,n,o),p=this._zoomOut.touchend(t,n,o);return u?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:f=>f.easeTo({duration:300,zoom:f.getZoom()+1,around:f.unproject(u)},{originalEvent:t})}):p?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:f=>f.easeTo({duration:300,zoom:f.getZoom()-1,around:f.unproject(p)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const vc={0:1,2:2};class mo{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(t,n){return!1}_move(t,n){return{}}mousedown(t,n){if(this._lastPoint)return;const o=te.mouseButton(t);this._correctButton(t,o)&&(this._lastPoint=n,this._eventButton=o)}mousemoveWindow(t,n){const o=this._lastPoint;if(o){if(t.preventDefault(),function(u,p){const f=vc[p];return u.buttons===void 0||(u.buttons&f)!==f}(t,this._eventButton))this.reset();else if(this._moved||!(n.dist(o)<this._clickTolerance))return this._moved=!0,this._lastPoint=n,this._move(o,n)}}mouseupWindow(t){this._lastPoint&&te.mouseButton(t)===this._eventButton&&(this._moved&&te.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bs extends mo{mousedown(t,n){super.mousedown(t,n),this._lastPoint&&(this._active=!0)}_correctButton(t,n){return n===0&&!t.ctrlKey}_move(t,n){return{around:n,panDelta:n.sub(t)}}}class Pr extends mo{_correctButton(t,n){return n===0&&t.ctrlKey||n===2}_move(t,n){const o=.8*(n.x-t.x);if(o)return this._active=!0,{bearingDelta:o}}contextmenu(t){t.preventDefault()}}class Ue extends mo{_correctButton(t,n){return n===0&&t.ctrlKey||n===2}_move(t,n){const o=-.5*(n.y-t.y);if(o)return this._active=!0,{pitchDelta:o}}contextmenu(t){t.preventDefault()}}class dl{constructor(t,n){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,n,o){return this._calculateTransform(t,n,o)}touchmove(t,n,o){if(this._map._cooperativeGestures&&(this._minTouches===2&&o.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,o.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(o.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,n,o)}touchend(t,n,o){this._calculateTransform(t,n,o),this._active&&o.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,o){o.length>0&&(this._active=!0);const u=zr(o,n),p=new a.pointGeometry(0,0),f=new a.pointGeometry(0,0);let _=0;for(const v in u){const T=u[v],I=this._touches[v];I&&(p._add(T),f._add(T.sub(I)),_++,u[v]=T)}if(this._touches=u,_<this._minTouches||!f.mag())return;const y=f.div(_);return this._sum._add(y),this._sum.mag()<this._clickTolerance?void 0:{around:p.div(_),panDelta:y}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xn{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(t){}_move(t,n,o){return{}}touchstart(t,n,o){this._firstTwoTouches||o.length<2||(this._firstTwoTouches=[o[0].identifier,o[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,o){if(!this._firstTwoTouches)return;t.preventDefault();const[u,p]=this._firstTwoTouches,f=Jr(o,n,u),_=Jr(o,n,p);if(!f||!_)return;const y=this._aroundCenter?null:f.add(_).div(2);return this._move([f,_],y,t)}touchend(t,n,o){if(!this._firstTwoTouches)return;const[u,p]=this._firstTwoTouches,f=Jr(o,n,u),_=Jr(o,n,p);f&&_||(this._active&&te.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Jr(l,t,n){for(let o=0;o<l.length;o++)if(l[o].identifier===n)return t[o]}function ia(l,t){return Math.log(l/t)/Math.LN2}class Pe extends xn{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const o=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(ia(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ia(this._distance,o),pinchAround:n}}}function go(l,t){return 180*l.angleWith(t)/Math.PI}class bc extends xn{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n){const o=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:go(this._vector,o),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,o=go(t,this._startVector);return Math.abs(o)<n}}function ra(l){return Math.abs(l.y)>Math.abs(l.x)}class na extends xn{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,n,o){super.touchstart(t,n,o),this._currentTouchCount=o.length}_start(t){this._lastPoints=t,ra(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,o){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const u=t[0].sub(this._lastPoints[0]),p=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(u,p,o.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(u.y+p.y)/2*-.5}):void 0}gestureBeginsVertically(t,n,o){if(this._valid!==void 0)return this._valid;const u=t.mag()>=2,p=n.mag()>=2;if(!u&&!p)return;if(!u||!p)return this._firstMove===void 0&&(this._firstMove=o),o-this._firstMove<100&&void 0;const f=t.y>0==n.y>0;return ra(t)&&ra(n)&&f}}const fl={panStep:100,bearingStep:15,pitchStep:10};class ml{constructor(){const t=fl;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,o=0,u=0,p=0,f=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?o=-1:(t.preventDefault(),p=-1);break;case 39:t.shiftKey?o=1:(t.preventDefault(),p=1);break;case 38:t.shiftKey?u=1:(t.preventDefault(),f=-1);break;case 40:t.shiftKey?u=-1:(t.preventDefault(),f=1);break;default:return}return this._rotationDisabled&&(o=0,u=0),{cameraAnimation:_=>{const y=_.getZoom();_.easeTo({duration:300,easeId:"keyboardHandler",easing:wc,zoom:n?Math.round(y)+n*(t.shiftKey?2:1):y,bearing:_.getBearing()+o*this._bearingStep,pitch:_.getPitch()+u*this._pitchStep,offset:[-p*this._panStep,-f*this._panStep],center:_.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function wc(l){return l*(2-l)}const gl=4.000244140625;class sa{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._handler=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,a.bindAll(["_onTimeout"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;t.preventDefault()}let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const o=a.exported.now(),u=o-(this._lastWheelEventTime||0);this._lastWheelEventTime=o,n!==0&&n%gl==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":u>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(u*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=te.mousePos(this._el,t);this._around=a.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(n)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;if(this._delta!==0){const _=this._type==="wheel"&&Math.abs(this._delta)>gl?this._wheelZoomRate:this._defaultZoomRate;let y=2/(1+Math.exp(-Math.abs(this._delta*_)));this._delta<0&&y!==0&&(y=1/y);const v=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(v*y))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,o=this._startZoom,u=this._easing;let p,f=!1;if(this._type==="wheel"&&o&&u){const _=Math.min((a.exported.now()-this._lastWheelEventTime)/200,1),y=u(_);p=a.number(o,n,y),_<1?this._frameId||(this._frameId=!0):f=!0}else p=n,f=!0;return this._active=!0,f&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!f,zoomDelta:p-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=a.ease;if(this._prevEase){const o=this._prevEase,u=(a.exported.now()-o.start)/o.duration,p=o.easing(u+.01)-o.easing(u),f=.27/Math.sqrt(p*p+1e-4)*.01,_=Math.sqrt(.0729-f*f);n=a.bezier(f,_,.25,1)}return this._prevEase={start:a.exported.now(),duration:t,easing:n},n}reset(){this._active=!1}}class oa{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class aa{constructor(){this.reset()}reset(){this._active=!1}dblclick(t,n){return t.preventDefault(),{cameraAnimation:o=>{o.easeTo({duration:300,zoom:o.getZoom()+(t.shiftKey?-1:1),around:o.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class la{constructor(){this._tap=new ta({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(t,n,o){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?o.length>0&&(this._swipePoint=n[0],this._swipeTouch=o[0].identifier):this._tap.touchstart(t,n,o))}touchmove(t,n,o){if(this._tapTime){if(this._swipePoint){if(o[0].identifier!==this._swipeTouch)return;const u=n[0],p=u.y-this._swipePoint.y;return this._swipePoint=u,t.preventDefault(),this._active=!0,{zoomDelta:p/128}}}else this._tap.touchmove(t,n,o)}touchend(t,n,o){this._tapTime?this._swipePoint&&o.length===0&&this.reset():this._tap.touchend(t,n,o)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pi{constructor(t,n,o){this._el=t,this._mousePan=n,this._touchPan=o}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Qr{constructor(t,n,o){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=o}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class _l{constructor(t,n,o,u){this._el=t,this._touchZoom=n,this._touchRotate=o,this._tapDragZoom=u,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ts=l=>l.zoom||l.drag||l.pitch||l.rotate;class ca extends a.Event{}function Rs(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}class yl{constructor(t,n){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new hl(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n),a.bindAll(["handleEvent","handleWindowEvent"],this);const o=this._el;this._listeners=[[o,"touchstart",{passive:!0}],[o,"touchmove",{passive:!1}],[o,"touchend",void 0],[o,"touchcancel",void 0],[o,"mousedown",void 0],[o,"mousemove",void 0],[o,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[o,"mouseover",void 0],[o,"mouseout",void 0],[o,"dblclick",void 0],[o,"click",void 0],[o,"keydown",{capture:!1}],[o,"keyup",void 0],[o,"wheel",{passive:!1}],[o,"contextmenu",void 0],[window,"blur",void 0]];for(const[u,p,f]of this._listeners)te.addEventListener(u,p,u===document?this.handleWindowEvent:this.handleEvent,f)}destroy(){for(const[t,n,o]of this._listeners)te.removeEventListener(t,n,t===document?this.handleWindowEvent:this.handleEvent,o)}_addDefaultHandlers(t){const n=this._map,o=n.getCanvasContainer();this._add("mapEvent",new yc(n,t));const u=n.boxZoom=new pl(n,t);this._add("boxZoom",u);const p=new xc,f=new aa;n.doubleClickZoom=new oa(f,p),this._add("tapZoom",p),this._add("clickZoom",f);const _=new la;this._add("tapDragZoom",_);const y=n.touchPitch=new na(n);this._add("touchPitch",y);const v=new Pr(t),T=new Ue(t);n.dragRotate=new Qr(t,v,T),this._add("mouseRotate",v,["mousePitch"]),this._add("mousePitch",T,["mouseRotate"]);const I=new Bs(t),M=new dl(t,n);n.dragPan=new Pi(o,I,M),this._add("mousePan",I),this._add("touchPan",M,["touchZoom","touchRotate"]);const U=new bc,F=new Pe;n.touchZoomRotate=new _l(o,F,U,_),this._add("touchRotate",U,["touchPan","touchZoom"]),this._add("touchZoom",F,["touchPan","touchRotate"]);const O=n.scrollZoom=new sa(n,this);this._add("scrollZoom",O,["mousePan"]);const H=n.keyboard=new ml;this._add("keyboard",H),this._add("blockableMapEvent",new Yr(n));for(const Q of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[Q]&&n[Q].enable(t[Q])}_add(t,n,o){this._handlers.push({handlerName:t,handler:n,allowed:o}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(ts(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,n,o){for(const u in t)if(u!==o&&(!n||n.indexOf(u)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const n=[];for(const o of t)this._el.contains(o.target)&&n.push(o);return n}handleEvent(t,n){if(t.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const o=t.type==="renderFrame"?void 0:t,u={needsRenderFrame:!1},p={},f={},_=t.touches,y=_?this._getMapTouches(_):void 0,v=y?te.touchPos(this._el,y):te.mousePos(this._el,t);for(const{handlerName:M,handler:U,allowed:F}of this._handlers){if(!U.isEnabled())continue;let O;this._blockedByActive(f,F,M)?U.reset():U[n||t.type]&&(O=U[n||t.type](t,v,y),this.mergeHandlerResult(u,p,O,M,o),O&&O.needsRenderFrame&&this._triggerRenderFrame()),(O||U.isActive())&&(f[M]=U)}const T={};for(const M in this._previousActiveHandlers)f[M]||(T[M]=o);this._previousActiveHandlers=f,(Object.keys(T).length||Rs(u))&&(this._changes.push([u,p,T]),this._triggerRenderFrame()),(Object.keys(f).length||Rs(u))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:I}=u;I&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],I(this._map))}mergeHandlerResult(t,n,o,u,p){if(!o)return;a.extend(t,o);const f={handlerName:u,originalEvent:o.originalEvent||p};o.zoomDelta!==void 0&&(n.zoom=f),o.panDelta!==void 0&&(n.drag=f),o.pitchDelta!==void 0&&(n.pitch=f),o.bearingDelta!==void 0&&(n.rotate=f)}_applyChanges(){const t={},n={},o={};for(const[u,p,f]of this._changes)u.panDelta&&(t.panDelta=(t.panDelta||new a.pointGeometry(0,0))._add(u.panDelta)),u.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+u.zoomDelta),u.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+u.bearingDelta),u.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+u.pitchDelta),u.around!==void 0&&(t.around=u.around),u.pinchAround!==void 0&&(t.pinchAround=u.pinchAround),u.noInertia&&(t.noInertia=u.noInertia),a.extend(n,p),a.extend(o,f);this._updateMapTransform(t,n,o),this._changes=[]}_updateMapTransform(t,n,o){const u=this._map,p=u.transform,f=u.style&&u.style.terrain;if(!(Rs(t)||f&&this._drag))return this._fireEvents(n,o,!0);let{panDelta:_,zoomDelta:y,bearingDelta:v,pitchDelta:T,around:I,pinchAround:M}=t;M!==void 0&&(I=M),u._stop(!0),I=I||u.transform.centerPoint;const U=p.pointLocation(_?I.sub(_):I);v&&(p.bearing+=v),T&&(p.pitch+=T),y&&(p.zoom+=y),f?n.drag&&!this._drag?(this._drag={center:p.centerPoint,lngLat:p.pointLocation(I),point:I,handlerName:n.drag.handlerName},u.fire(new a.Event("freezeElevation",{freeze:!0}))):this._drag&&o[this._drag.handlerName]?(u.fire(new a.Event("freezeElevation",{freeze:!1})),this._drag=null):n.drag&&this._drag&&(p.center=p.pointLocation(p.centerPoint.sub(_))):p.setLocationAtPoint(U,I),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,o,!0)}_fireEvents(t,n,o){const u=ts(this._eventsInProgress),p=ts(t),f={};for(const T in t){const{originalEvent:I}=t[T];this._eventsInProgress[T]||(f[`${T}start`]=I),this._eventsInProgress[T]=t[T]}!u&&p&&this._fireEvent("movestart",p.originalEvent);for(const T in f)this._fireEvent(T,f[T]);p&&this._fireEvent("move",p.originalEvent);for(const T in t){const{originalEvent:I}=t[T];this._fireEvent(T,I)}const _={};let y;for(const T in this._eventsInProgress){const{handlerName:I,originalEvent:M}=this._eventsInProgress[T];this._handlersById[I].isActive()||(delete this._eventsInProgress[T],y=n[I]||M,_[`${T}end`]=y)}for(const T in _)this._fireEvent(T,_[T]);const v=ts(this._eventsInProgress);if(o&&(u||p)&&!v){this._updatingCamera=!0;const T=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),I=M=>M!==0&&-this._bearingSnap<M&&M<this._bearingSnap;T?(I(T.bearing||this._map.getBearing())&&(T.bearing=0),this._map.easeTo(T,{originalEvent:y})):(this._map.fire(new a.Event("moveend",{originalEvent:y})),I(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new a.Event(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new ca("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Qi={extend:(l,...t)=>a.extend(l,...t),run(l){l()},logToElement(l,t=!1,n="log"){const o=window.document.getElementById(n);o&&(t&&(o.innerHTML=""),o.innerHTML+=`<br>${l}`)}};class Xt extends a.Evented{constructor(t,n){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,a.bindAll(["_renderFrameCallback"],this)}getCenter(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}panBy(t,n,o){return t=a.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,a.extend({offset:t},n),o)}panTo(t,n,o){return this.easeTo(a.extend({center:t},n),o)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,o){return this.easeTo(a.extend({zoom:t},n),o)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,o){return this.easeTo(a.extend({bearing:t},n),o)}resetNorth(t,n){return this.rotateTo(0,a.extend({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}cameraForBounds(t,n){t=a.LngLatBounds.convert(t);const o=n&&n.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),o,n)}_cameraForBoxAndBearing(t,n,o,u){const p={top:0,bottom:0,right:0,left:0};if(typeof(u=a.extend({padding:p,offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=="number"){const ne=u.padding;u.padding={top:ne,bottom:ne,right:ne,left:ne}}u.padding=a.extend(p,u.padding);const f=this.transform,_=f.padding,y=f.project(a.LngLat.convert(t)),v=f.project(a.LngLat.convert(n)),T=y.rotate(-o*Math.PI/180),I=v.rotate(-o*Math.PI/180),M=new a.pointGeometry(Math.max(T.x,I.x),Math.max(T.y,I.y)),U=new a.pointGeometry(Math.min(T.x,I.x),Math.min(T.y,I.y)),F=M.sub(U),O=(f.width-(_.left+_.right+u.padding.left+u.padding.right))/F.x,H=(f.height-(_.top+_.bottom+u.padding.top+u.padding.bottom))/F.y;if(H<0||O<0)return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Q=Math.min(f.scaleZoom(f.scale*Math.min(O,H)),u.maxZoom),re=a.pointGeometry.convert(u.offset),V=new a.pointGeometry((u.padding.left-u.padding.right)/2,(u.padding.top-u.padding.bottom)/2).rotate(o*Math.PI/180),oe=re.add(V).mult(f.scale/f.zoomScale(Q));return{center:f.unproject(y.add(v).div(2).sub(oe)),zoom:Q,bearing:o}}fitBounds(t,n,o){return this._fitInternal(this.cameraForBounds(t,n),n,o)}fitScreenCoordinates(t,n,o,u,p){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.pointGeometry.convert(t)),this.transform.pointLocation(a.pointGeometry.convert(n)),o,u),u,p)}_fitInternal(t,n,o){return t?(delete(n=a.extend(t,n)).padding,n.linear?this.easeTo(n,o):this.flyTo(n,o)):this}jumpTo(t,n){this.stop();const o=this.transform;let u=!1,p=!1,f=!1;return"zoom"in t&&o.zoom!==+t.zoom&&(u=!0,o.zoom=+t.zoom),t.center!==void 0&&(o.center=a.LngLat.convert(t.center)),"bearing"in t&&o.bearing!==+t.bearing&&(p=!0,o.bearing=+t.bearing),"pitch"in t&&o.pitch!==+t.pitch&&(f=!0,o.pitch=+t.pitch),t.padding==null||o.isPaddingEqual(t.padding)||(o.padding=t.padding),this.fire(new a.Event("movestart",n)).fire(new a.Event("move",n)),u&&this.fire(new a.Event("zoomstart",n)).fire(new a.Event("zoom",n)).fire(new a.Event("zoomend",n)),p&&this.fire(new a.Event("rotatestart",n)).fire(new a.Event("rotate",n)).fire(new a.Event("rotateend",n)),f&&this.fire(new a.Event("pitchstart",n)).fire(new a.Event("pitch",n)).fire(new a.Event("pitchend",n)),this.fire(new a.Event("moveend",n))}calculateCameraOptionsFromTo(t,n,o,u=0){const p=a.MercatorCoordinate.fromLngLat(t,n),f=a.MercatorCoordinate.fromLngLat(o,u),_=f.x-p.x,y=f.y-p.y,v=f.z-p.z,T=Math.hypot(_,y,v);if(T===0)throw new Error("Can't calculate camera options with same From and To");const I=Math.hypot(_,y),M=this.transform.scaleZoom(this.transform.cameraToCenterDistance/T/this.transform.tileSize),U=180*Math.atan2(_,-y)/Math.PI;let F=180*Math.acos(I/T)/Math.PI;return F=v<0?90-F:90+F,{center:f.toLngLat(),zoom:M,pitch:F,bearing:U}}easeTo(t,n){this._stop(!1,t.easeId),((t=a.extend({offset:[0,0],duration:500,easing:a.ease},t)).animate===!1||!t.essential&&a.exported.prefersReducedMotion)&&(t.duration=0);const o=this.transform,u=this.getZoom(),p=this.getBearing(),f=this.getPitch(),_=this.getPadding(),y="zoom"in t?+t.zoom:u,v="bearing"in t?this._normalizeBearing(t.bearing,p):p,T="pitch"in t?+t.pitch:f,I="padding"in t?t.padding:o.padding,M=a.pointGeometry.convert(t.offset);let U=o.centerPoint.add(M);const F=o.pointLocation(U),O=a.LngLat.convert(t.center||F);this._normalizeCenter(O);const H=o.project(F),Q=o.project(O).sub(H),re=o.zoomScale(y-u);let V,oe;t.around&&(V=a.LngLat.convert(t.around),oe=o.locationPoint(V));const ne={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||y!==u,this._rotating=this._rotating||p!==v,this._pitching=this._pitching||T!==f,this._padding=!o.isPaddingEqual(I),this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,ne),this._ease(me=>{if(this._zooming&&(o.zoom=a.number(u,y,me)),this._rotating&&(o.bearing=a.number(p,v,me)),this._pitching&&(o.pitch=a.number(f,T,me)),this._padding&&(o.interpolatePadding(_,I,me),U=o.centerPoint.add(M)),V)o.setLocationAtPoint(V,oe);else{const ge=o.zoomScale(o.zoom-u),be=y>u?Math.min(2,re):Math.max(.5,re),he=Math.pow(be,1-me),Re=o.unproject(H.add(Q.mult(me*he)).mult(ge));o.setLocationAtPoint(o.renderWorldCopies?Re.wrap():Re,U)}this._fireMoveEvents(n)},me=>{this._afterEase(n,me)},t),this}_prepareEase(t,n,o={}){this._moving=!0,this.fire(new a.Event("freezeElevation",{freeze:!0})),n||o.moving||this.fire(new a.Event("movestart",t)),this._zooming&&!o.zooming&&this.fire(new a.Event("zoomstart",t)),this._rotating&&!o.rotating&&this.fire(new a.Event("rotatestart",t)),this._pitching&&!o.pitching&&this.fire(new a.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new a.Event("move",t)),this._zooming&&this.fire(new a.Event("zoom",t)),this._rotating&&this.fire(new a.Event("rotate",t)),this._pitching&&this.fire(new a.Event("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId,this.fire(new a.Event("freezeElevation",{freeze:!1}));const o=this._zooming,u=this._rotating,p=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,o&&this.fire(new a.Event("zoomend",t)),u&&this.fire(new a.Event("rotateend",t)),p&&this.fire(new a.Event("pitchend",t)),this.fire(new a.Event("moveend",t))}flyTo(t,n){if(!t.essential&&a.exported.prefersReducedMotion){const Xe=a.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Xe,n)}this.stop(),t=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.ease},t);const o=this.transform,u=this.getZoom(),p=this.getBearing(),f=this.getPitch(),_=this.getPadding(),y="zoom"in t?a.clamp(+t.zoom,o.minZoom,o.maxZoom):u,v="bearing"in t?this._normalizeBearing(t.bearing,p):p,T="pitch"in t?+t.pitch:f,I="padding"in t?t.padding:o.padding,M=o.zoomScale(y-u),U=a.pointGeometry.convert(t.offset);let F=o.centerPoint.add(U);const O=o.pointLocation(F),H=a.LngLat.convert(t.center||O);this._normalizeCenter(H);const Q=o.project(O),re=o.project(H).sub(Q);let V=t.curve;const oe=Math.max(o.width,o.height),ne=oe/M,me=re.mag();if("minZoom"in t){const Xe=a.clamp(Math.min(t.minZoom,u,y),o.minZoom,o.maxZoom),zt=oe/o.zoomScale(Xe-u);V=Math.sqrt(zt/me*2)}const ge=V*V;function be(Xe){const zt=(ne*ne-oe*oe+(Xe?-1:1)*ge*ge*me*me)/(2*(Xe?ne:oe)*ge*me);return Math.log(Math.sqrt(zt*zt+1)-zt)}function he(Xe){return(Math.exp(Xe)-Math.exp(-Xe))/2}function Re(Xe){return(Math.exp(Xe)+Math.exp(-Xe))/2}const Ie=be(0);let Fe=function(Xe){return Re(Ie)/Re(Ie+V*Xe)},at=function(Xe){return oe*((Re(Ie)*(he(zt=Ie+V*Xe)/Re(zt))-he(Ie))/ge)/me;var zt},ht=(be(1)-Ie)/V;if(Math.abs(me)<1e-6||!isFinite(ht)){if(Math.abs(oe-ne)<1e-6)return this.easeTo(t,n);const Xe=ne<oe?-1:1;ht=Math.abs(Math.log(ne/oe))/V,at=function(){return 0},Fe=function(zt){return Math.exp(Xe*V*zt)}}return t.duration="duration"in t?+t.duration:1e3*ht/("screenSpeed"in t?+t.screenSpeed/V:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=p!==v,this._pitching=T!==f,this._padding=!o.isPaddingEqual(I),this._prepareEase(n,!1),this._ease(Xe=>{const zt=Xe*ht,Pt=1/Fe(zt);o.zoom=Xe===1?y:u+o.scaleZoom(Pt),this._rotating&&(o.bearing=a.number(p,v,Xe)),this._pitching&&(o.pitch=a.number(f,T,Xe)),this._padding&&(o.interpolatePadding(_,I,Xe),F=o.centerPoint.add(U));const yt=Xe===1?H:o.unproject(Q.add(re.mult(at(zt))).mult(Pt));o.setLocationAtPoint(o.renderWorldCopies?yt.wrap():yt,F),this._fireMoveEvents(n)},()=>this._afterEase(n),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const o=this._onEaseEnd;delete this._onEaseEnd,o.call(this,n)}if(!t){const o=this.handlers;o&&o.stop(!1)}return this}_ease(t,n,o){o.animate===!1||o.duration===0?(t(1),n()):(this._easeStart=a.exported.now(),this._easeOptions=o,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((a.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,n){t=a.wrap(t,-180,180);const o=Math.abs(t-n);return Math.abs(t-360-n)<o&&(t-=360),Math.abs(t+360-n)<o&&(t+=360),t}_normalizeCenter(t){const n=this.transform;if(!n.renderWorldCopies||n.lngRange)return;const o=t.lng-n.center.lng;t.lng+=o>180?-360:o<-180?360:0}}class Fs{constructor(t={}){this.options=t,a.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=te.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=te.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=te.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){te.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,n){const o=this._map._getUIString(`AttributionControl.${n}`);t.title=o,t.setAttribute("aria-label",o)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"&&t.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(u=>typeof u!="string"?"":u)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}const n=this._map.style.sourceCaches;for(const u in n){const p=n[u];if(p.used||p.usedForTerrain){const f=p.getSource();f.attribution&&t.indexOf(f.attribution)<0&&t.push(f.attribution)}}t=t.filter(u=>String(u).trim()),t.sort((u,p)=>u.length-p.length),t=t.filter((u,p)=>{for(let f=p+1;f<t.length;f++)if(t[f].indexOf(u)>=0)return!1;return!0});const o=t.join(" | ");o!==this._attribHTML&&(this._attribHTML=o,t.length?(this._innerContainer.innerHTML=o,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class _o{constructor(t={}){this.options=t,a.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=te.create("div","maplibregl-ctrl mapboxgl-ctrl");const n=te.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){te.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const t=this._container.children;if(t.length){const n=t[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&n.classList.add("maplibregl-compact","mapboxgl-compact"):n.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class xl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,o=n?this._queue.concat(n):this._queue;for(const u of o)if(u.id===t)return void(u.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const o of n)if(!o.cancelled&&(o.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const vl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},bl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},Tc={showCompass:!0,showZoom:!0,visualizePitch:!1};class yr{constructor(t,n,o=!1){this._clickTolerance=10,this.element=n,this.mouseRotate=new Pr({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,o&&(this.mousePitch=new Ue({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),a.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),te.addEventListener(n,"mousedown",this.mousedown),te.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),te.addEventListener(n,"touchmove",this.touchmove),te.addEventListener(n,"touchend",this.touchend),te.addEventListener(n,"touchcancel",this.reset)}down(t,n){this.mouseRotate.mousedown(t,n),this.mousePitch&&this.mousePitch.mousedown(t,n),te.disableDrag()}move(t,n){const o=this.map,u=this.mouseRotate.mousemoveWindow(t,n);if(u&&u.bearingDelta&&o.setBearing(o.getBearing()+u.bearingDelta),this.mousePitch){const p=this.mousePitch.mousemoveWindow(t,n);p&&p.pitchDelta&&o.setPitch(o.getPitch()+p.pitchDelta)}}off(){const t=this.element;te.removeEventListener(t,"mousedown",this.mousedown),te.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),te.removeEventListener(t,"touchmove",this.touchmove),te.removeEventListener(t,"touchend",this.touchend),te.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){te.enableDrag(),te.removeEventListener(window,"mousemove",this.mousemove),te.removeEventListener(window,"mouseup",this.mouseup)}mousedown(t){this.down(a.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),te.mousePos(this.element,t)),te.addEventListener(window,"mousemove",this.mousemove),te.addEventListener(window,"mouseup",this.mouseup)}mousemove(t){this.move(t,te.mousePos(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=te.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=te.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Os(l,t,n){if(l=new a.LngLat(l.lng,l.lat),t){const o=new a.LngLat(l.lng-360,l.lat),u=new a.LngLat(l.lng+360,l.lat),p=n.locationPoint(l).distSqr(t);n.locationPoint(o).distSqr(t)<p?l=o:n.locationPoint(u).distSqr(t)<p&&(l=u)}for(;Math.abs(l.lng-n.center.lng)>180;){const o=n.locationPoint(l);if(o.x>=0&&o.y>=0&&o.x<=n.width&&o.y<=n.height)break;l.lng>n.center.lng?l.lng-=360:l.lng+=360}return l}const qe={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Je(l,t,n){const o=l.classList;for(const u in qe)o.remove(`maplibregl-${n}-anchor-${u}`,`mapboxgl-${n}-anchor-${u}`);o.add(`maplibregl-${n}-anchor-${t}`,`mapboxgl-${n}-anchor-${t}`)}class is extends a.Evented{constructor(t,n){if(super(),(t instanceof HTMLElement||n)&&(t=a.extend({element:t},n)),a.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=a.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=te.create("div"),this._element.setAttribute("aria-label","Map marker");const o=te.createNS("http://www.w3.org/2000/svg","svg"),u=41,p=27;o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height",`${u}px`),o.setAttributeNS(null,"width",`${p}px`),o.setAttributeNS(null,"viewBox",`0 0 ${p} ${u}`);const f=te.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"stroke","none"),f.setAttributeNS(null,"stroke-width","1"),f.setAttributeNS(null,"fill","none"),f.setAttributeNS(null,"fill-rule","evenodd");const _=te.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"fill-rule","nonzero");const y=te.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"transform","translate(3.0, 29.0)"),y.setAttributeNS(null,"fill","#000000");const v=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const re of v){const V=te.createNS("http://www.w3.org/2000/svg","ellipse");V.setAttributeNS(null,"opacity","0.04"),V.setAttributeNS(null,"cx","10.5"),V.setAttributeNS(null,"cy","5.80029008"),V.setAttributeNS(null,"rx",re.rx),V.setAttributeNS(null,"ry",re.ry),y.appendChild(V)}const T=te.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill",this._color);const I=te.createNS("http://www.w3.org/2000/svg","path");I.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),T.appendChild(I);const M=te.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"opacity","0.25"),M.setAttributeNS(null,"fill","#000000");const U=te.createNS("http://www.w3.org/2000/svg","path");U.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),M.appendChild(U);const F=te.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"transform","translate(6.0, 7.0)"),F.setAttributeNS(null,"fill","#FFFFFF");const O=te.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"transform","translate(8.0, 8.0)");const H=te.createNS("http://www.w3.org/2000/svg","circle");H.setAttributeNS(null,"fill","#000000"),H.setAttributeNS(null,"opacity","0.25"),H.setAttributeNS(null,"cx","5.5"),H.setAttributeNS(null,"cy","5.5"),H.setAttributeNS(null,"r","5.4999962");const Q=te.createNS("http://www.w3.org/2000/svg","circle");Q.setAttributeNS(null,"fill","#FFFFFF"),Q.setAttributeNS(null,"cx","5.5"),Q.setAttributeNS(null,"cy","5.5"),Q.setAttributeNS(null,"r","5.4999962"),O.appendChild(H),O.appendChild(Q),_.appendChild(y),_.appendChild(T),_.appendChild(M),_.appendChild(F),_.appendChild(O),o.appendChild(_),o.setAttributeNS(null,"height",u*this._scale+"px"),o.setAttributeNS(null,"width",p*this._scale+"px"),this._element.appendChild(o),this._offset=a.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",o=>{o.preventDefault()}),this._element.addEventListener("mousedown",o=>{o.preventDefault()}),Je(this._element,this._anchor,"marker"),this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),te.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=a.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const u=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[u,-1*(38.1-13.5+u)],"bottom-right":[-u,-1*(38.1-13.5+u)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(t){const n=t.code,o=t.charCode||t.keyCode;n!=="Space"&&n!=="Enter"&&o!==32&&o!==13||this.togglePopup()}_onMapClick(t){const n=t.originalEvent.target,o=this._element;this._popup&&(n===o||o.contains(n))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}_update(t){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Os(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let n="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?n=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(n=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let o="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?o="rotateX(0deg)":this._pitchAlignment==="map"&&(o=`rotateX(${this._map.getPitch()}deg)`),t&&t.type!=="moveend"||(this._pos=this._pos.round()),te.setTransform(this._element,`${qe[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${o} ${n}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const u=this._map.unproject(this._pos),p=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=u.distanceTo(this._lngLat)>20*p?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(t){return this._offset=a.pointGeometry.convert(t),this._update(),this}_onMove(t){if(!this._isDragging){const n=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=n}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.Event("dragend")),this._state="inactive"}_addDragHandler(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const ua={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let en,yi=0,tn=!1;const xr={maxWidth:100,unit:"metric"};function wl(l,t,n){const o=n&&n.maxWidth||100,u=l._container.clientHeight/2,p=l.unproject([0,u]),f=l.unproject([o,u]),_=p.distanceTo(f);if(n&&n.unit==="imperial"){const y=3.2808*_;y>5280?rn(t,o,y/5280,l._getUIString("ScaleControl.Miles")):rn(t,o,y,l._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?rn(t,o,_/1852,l._getUIString("ScaleControl.NauticalMiles")):_>=1e3?rn(t,o,_/1e3,l._getUIString("ScaleControl.Kilometers")):rn(t,o,_,l._getUIString("ScaleControl.Meters"))}function rn(l,t,n,o){const u=function(p){const f=Math.pow(10,`${Math.floor(p)}`.length-1);let _=p/f;return _=_>=10?10:_>=5?5:_>=3?3:_>=2?2:_>=1?1:function(y){const v=Math.pow(10,Math.ceil(-Math.log(y)/Math.LN10));return Math.round(y*v)/v}(_),f*_}(n);l.style.width=t*(u/n)+"px",l.innerHTML=`${u}&nbsp;${o}`}const Jt={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ii=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ha(l){if(l){if(typeof l=="number"){const t=Math.round(Math.sqrt(.5*Math.pow(l,2)));return{center:new a.pointGeometry(0,0),top:new a.pointGeometry(0,l),"top-left":new a.pointGeometry(t,t),"top-right":new a.pointGeometry(-t,t),bottom:new a.pointGeometry(0,-l),"bottom-left":new a.pointGeometry(t,-t),"bottom-right":new a.pointGeometry(-t,-t),left:new a.pointGeometry(l,0),right:new a.pointGeometry(-l,0)}}if(l instanceof a.pointGeometry||Array.isArray(l)){const t=a.pointGeometry.convert(l);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:a.pointGeometry.convert(l.center||[0,0]),top:a.pointGeometry.convert(l.top||[0,0]),"top-left":a.pointGeometry.convert(l["top-left"]||[0,0]),"top-right":a.pointGeometry.convert(l["top-right"]||[0,0]),bottom:a.pointGeometry.convert(l.bottom||[0,0]),"bottom-left":a.pointGeometry.convert(l["bottom-left"]||[0,0]),"bottom-right":a.pointGeometry.convert(l["bottom-right"]||[0,0]),left:a.pointGeometry.convert(l.left||[0,0]),right:a.pointGeometry.convert(l.right||[0,0])}}return ha(new a.pointGeometry(0,0))}const vn={supported:de,setRTLTextPlugin:a.setRTLTextPlugin,getRTLTextPluginStatus:a.getRTLTextPluginStatus,Map:class extends Xt{constructor(l){var t;if(a.PerformanceUtils.mark(a.PerformanceMarkers.create),(l=a.extend({},bl,l)).minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ks(l.minZoom,l.maxZoom,l.minPitch,l.maxPitch,l.renderWorldCopies),{bearingSnap:l.bearingSnap}),this._interactive=l.interactive,this._cooperativeGestures=l.cooperativeGestures,this._maxTileCacheSize=l.maxTileCacheSize,this._failIfMajorPerformanceCaveat=l.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=l.preserveDrawingBuffer,this._antialias=l.antialias,this._trackResize=l.trackResize,this._bearingSnap=l.bearingSnap,this._refreshExpiredTiles=l.refreshExpiredTiles,this._fadeDuration=l.fadeDuration,this._crossSourceCollisions=l.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=l.collectResourceTiming,this._renderTaskQueue=new xl,this._controls=[],this._mapId=a.uniqueId(),this._locale=a.extend({},vl,l.locale),this._clickTolerance=l.clickTolerance,this._pixelRatio=(t=l.pixelRatio)!==null&&t!==void 0?t:devicePixelRatio,this._requestManager=new Ce(l.transformRequest),typeof l.container=="string"){if(this._container=document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(l.maxBounds&&this.setMaxBounds(l.maxBounds),a.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new yl(this,l),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=l.hash&&new al(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,a.extend({},l.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=l.localIdeographFontFamily,l.style&&this.setStyle(l.style,{localIdeographFontFamily:l.localIdeographFontFamily}),l.attributionControl&&this.addControl(new Fs({customAttribution:l.customAttribution})),l.maplibreLogo&&this.addControl(new _o,l.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new a.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new a.Event(`${n.dataType}dataloading`,n))}),this.on("dataabort",n=>{this.fire(new a.Event("sourcedataabort",n))})}_getMapId(){return this._mapId}addControl(l,t){if(t===void 0&&(t=l.getDefaultPosition?l.getDefaultPosition():"top-right"),!l||!l.onAdd)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=l.onAdd(this);this._controls.push(l);const o=this._controlPositions[t];return t.indexOf("bottom")!==-1?o.insertBefore(n,o.firstChild):o.appendChild(n),this}removeControl(l){if(!l||!l.onRemove)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(l);return t>-1&&this._controls.splice(t,1),l.onRemove(this),this}hasControl(l){return this._controls.indexOf(l)>-1}calculateCameraOptionsFromTo(l,t,n,o){return o==null&&this.style.terrain&&(o=this.transform.getElevation(n,this.style.terrain)),super.calculateCameraOptionsFromTo(l,t,n,o)}resize(l){const t=this._containerDimensions(),n=t[0],o=t[1];this._resizeCanvas(n,o,this.getPixelRatio()),this.transform.resize(n,o),this.painter.resize(n,o,this.getPixelRatio());const u=!this._moving;return u&&(this.stop(),this.fire(new a.Event("movestart",l)).fire(new a.Event("move",l))),this.fire(new a.Event("resize",l)),u&&this.fire(new a.Event("moveend",l)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(l){const[t,n]=this._containerDimensions();this._pixelRatio=l,this._resizeCanvas(t,n,l),this.painter.resize(t,n,l)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(l){return this.transform.setMaxBounds(a.LngLatBounds.convert(l)),this._update()}setMinZoom(l){if((l=l==null?-2:l)>=-2&&l<=this.transform.maxZoom)return this.transform.minZoom=l,this._update(),this.getZoom()<l&&this.setZoom(l),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(l){if((l=l==null?22:l)>=this.transform.minZoom)return this.transform.maxZoom=l,this._update(),this.getZoom()>l&&this.setZoom(l),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(l){if((l=l==null?0:l)<0)throw new Error("minPitch must be greater than or equal to 0");if(l>=0&&l<=this.transform.maxPitch)return this.transform.minPitch=l,this._update(),this.getPitch()<l&&this.setPitch(l),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(l){if((l=l==null?60:l)>85)throw new Error("maxPitch must be less than or equal to 85");if(l>=this.transform.minPitch)return this.transform.maxPitch=l,this._update(),this.getPitch()>l&&this.setPitch(l),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(l){return this.transform.renderWorldCopies=l,this._update()}project(l){return this.transform.locationPoint(a.LngLat.convert(l),this.style&&this.style.terrain)}unproject(l){return this.transform.pointLocation(a.pointGeometry.convert(l),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(l,t,n){if(l==="mouseenter"||l==="mouseover"){let o=!1;return{layer:t,listener:n,delegates:{mousemove:p=>{const f=this.getLayer(t)?this.queryRenderedFeatures(p.point,{layers:[t]}):[];f.length?o||(o=!0,n.call(this,new $i(l,this,p.originalEvent,{features:f}))):o=!1},mouseout:()=>{o=!1}}}}if(l==="mouseleave"||l==="mouseout"){let o=!1;return{layer:t,listener:n,delegates:{mousemove:f=>{(this.getLayer(t)?this.queryRenderedFeatures(f.point,{layers:[t]}):[]).length?o=!0:o&&(o=!1,n.call(this,new $i(l,this,f.originalEvent)))},mouseout:f=>{o&&(o=!1,n.call(this,new $i(l,this,f.originalEvent)))}}}}{const o=u=>{const p=this.getLayer(t)?this.queryRenderedFeatures(u.point,{layers:[t]}):[];p.length&&(u.features=p,n.call(this,u),delete u.features)};return{layer:t,listener:n,delegates:{[l]:o}}}}on(l,t,n){if(n===void 0)return super.on(l,t);const o=this._createDelegatedListener(l,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[l]=this._delegatedListeners[l]||[],this._delegatedListeners[l].push(o);for(const u in o.delegates)this.on(u,o.delegates[u]);return this}once(l,t,n){if(n===void 0)return super.once(l,t);const o=this._createDelegatedListener(l,t,n);for(const u in o.delegates)this.once(u,o.delegates[u]);return this}off(l,t,n){return n===void 0?super.off(l,t):(this._delegatedListeners&&this._delegatedListeners[l]&&(o=>{const u=this._delegatedListeners[l];for(let p=0;p<u.length;p++){const f=u[p];if(f.layer===t&&f.listener===n){for(const _ in f.delegates)this.off(_,f.delegates[_]);return u.splice(p,1),this}}})(),this)}queryRenderedFeatures(l,t){if(!this.style)return[];let n;if(t!==void 0||l===void 0||l instanceof a.pointGeometry||Array.isArray(l)||(t=l,l=void 0),t=t||{},(l=l||[[0,0],[this.transform.width,this.transform.height]])instanceof a.pointGeometry||typeof l[0]=="number")n=[a.pointGeometry.convert(l)];else{const o=a.pointGeometry.convert(l[0]),u=a.pointGeometry.convert(l[1]);n=[o,new a.pointGeometry(u.x,o.y),u,new a.pointGeometry(o.x,u.y),o]}return this.style.queryRenderedFeatures(n,t,this.transform)}querySourceFeatures(l,t){return this.style.querySourceFeatures(l,t)}setStyle(l,t){return(t=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&l?(this._diffStyle(l,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(l,t))}setTransformRequest(l){return this._requestManager.setTransformRequest(l),this}_getUIString(l){const t=this._locale[l];if(t==null)throw new Error(`Missing UI string '${l}'`);return t}_updateStyle(l,t){return this.style&&(this.style.setEventedParent(null),this.style._remove()),l?(this.style=new wi(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof l=="string"?this.style.loadURL(l):this.style.loadJSON(l),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new wi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(l,t){if(typeof l=="string"){const n=this._requestManager.transformRequest(l,a.ResourceType.Style);a.getJSON(n,(o,u)=>{o?this.fire(new a.ErrorEvent(o)):u&&this._updateDiff(u,t)})}else typeof l=="object"&&this._updateDiff(l,t)}_updateDiff(l,t){try{this.style.setState(l)&&this._update(!0)}catch(n){a.warnOnce(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(l,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.warnOnce("There is no style added to the map.")}addSource(l,t){return this._lazyInitEmptyStyle(),this.style.addSource(l,t),this._update(!0)}isSourceLoaded(l){const t=this.style&&this.style.sourceCaches[l];if(t!==void 0)return t.loaded();this.fire(new a.ErrorEvent(new Error(`There is no source with ID '${l}'`)))}setTerrain(l){return this.style.setTerrain(l),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const l=this.style&&this.style.sourceCaches;for(const t in l){const n=l[t]._tiles;for(const o in n){const u=n[o];if(u.state!=="loaded"&&u.state!=="errored")return!1}}return!0}addSourceType(l,t,n){return this._lazyInitEmptyStyle(),this.style.addSourceType(l,t,n)}removeSource(l){return this.style.removeSource(l),this._update(!0)}getSource(l){return this.style.getSource(l)}addImage(l,t,{pixelRatio:n=1,sdf:o=!1,stretchX:u,stretchY:p,content:f}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||a.isImageBitmap(t)){const{width:_,height:y,data:v}=a.exported.getImageData(t);this.style.addImage(l,{data:new a.RGBAImage({width:_,height:y},v),pixelRatio:n,stretchX:u,stretchY:p,content:f,sdf:o,version:0})}else{if(t.width===void 0||t.height===void 0)return this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:_,height:y,data:v}=t,T=t;this.style.addImage(l,{data:new a.RGBAImage({width:_,height:y},new Uint8Array(v)),pixelRatio:n,stretchX:u,stretchY:p,content:f,sdf:o,version:0,userImage:T}),T.onAdd&&T.onAdd(this,l)}}}updateImage(l,t){const n=this.style.getImage(l);if(!n)return this.fire(new a.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const o=t instanceof HTMLImageElement||a.isImageBitmap(t)?a.exported.getImageData(t):t,{width:u,height:p,data:f}=o;if(u===void 0||p===void 0)return this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(u!==n.data.width||p!==n.data.height)return this.fire(new a.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const _=!(t instanceof HTMLImageElement||a.isImageBitmap(t));n.data.replace(f,_),this.style.updateImage(l,n)}hasImage(l){return l?!!this.style.getImage(l):(this.fire(new a.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(l){this.style.removeImage(l)}loadImage(l,t){a.getImage(this._requestManager.transformRequest(l,a.ResourceType.Image),t)}listImages(){return this.style.listImages()}addLayer(l,t){return this._lazyInitEmptyStyle(),this.style.addLayer(l,t),this._update(!0)}moveLayer(l,t){return this.style.moveLayer(l,t),this._update(!0)}removeLayer(l){return this.style.removeLayer(l),this._update(!0)}getLayer(l){return this.style.getLayer(l)}setLayerZoomRange(l,t,n){return this.style.setLayerZoomRange(l,t,n),this._update(!0)}setFilter(l,t,n={}){return this.style.setFilter(l,t,n),this._update(!0)}getFilter(l){return this.style.getFilter(l)}setPaintProperty(l,t,n,o={}){return this.style.setPaintProperty(l,t,n,o),this._update(!0)}getPaintProperty(l,t){return this.style.getPaintProperty(l,t)}setLayoutProperty(l,t,n,o={}){return this.style.setLayoutProperty(l,t,n,o),this._update(!0)}getLayoutProperty(l,t){return this.style.getLayoutProperty(l,t)}setLight(l,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(l,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(l,t){return this.style.setFeatureState(l,t),this._update()}removeFeatureState(l,t){return this.style.removeFeatureState(l,t),this._update()}getFeatureState(l){return this.style.getFeatureState(l)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let l=0,t=0;return this._container&&(l=this._container.clientWidth||400,t=this._container.clientHeight||300),[l,t]}_setupContainer(){const l=this._container;l.classList.add("maplibregl-map","mapboxgl-map");const t=this._canvasContainer=te.create("div","maplibregl-canvas-container mapboxgl-canvas-container",l);this._interactive&&t.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=te.create("canvas","maplibregl-canvas mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const n=this._containerDimensions();this._resizeCanvas(n[0],n[1],this.getPixelRatio());const o=this._controlContainer=te.create("div","maplibregl-control-container mapboxgl-control-container",l),u=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(p=>{u[p]=te.create("div",`maplibregl-ctrl-${p} mapboxgl-ctrl-${p}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const l=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=te.create("div","maplibregl-cooperative-gesture-screen",l);let t="Control",n=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(n=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use \u2318 + scroll to zoom the map",t="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${n}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",o=>{o.key===t&&(this._metaPress=!0)}),document.addEventListener("keyup",o=>{o.key===t&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",o=>{this._onCooperativeGesture(o,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(l,t,n){this._canvas.width=n*l,this._canvas.height=n*t,this._canvas.style.width=`${l}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const l=a.extend({},de.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",l)||this._canvas.getContext("experimental-webgl",l);t?(this.painter=new ea(t,this.transform),a.exported$1.testSupport(t)):this.fire(new a.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(l){l.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:l}))}_contextRestored(l){this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:l}))}_onMapScroll(l){if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(l,t,n){return!t&&n<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(l){return this.style?(this._styleDirty=this._styleDirty||l,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(l){return this._update(),this._renderTaskQueue.add(l)}_cancelRenderFrame(l){this._renderTaskQueue.remove(l)}_render(l){let t,n=0;const o=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(t=o.createQueryEXT(),o.beginQueryEXT(o.TIME_ELAPSED_EXT,t),n=a.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(l),this._removed)return;let u=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const f=this.transform.zoom,_=a.exported.now();this.style.zoomHistory.update(f,_);const y=new a.EvaluationParameters(f,{now:_,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),v=y.crossFadingFactor();v===1&&v===this._crossFadingFactor||(u=!0,this._crossFadingFactor=v),this.style.update(y)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.PerformanceUtils.mark(a.PerformanceMarkers.load),this.fire(new a.Event("load"))),this.style&&(this.style.hasTransitions()||u)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const f=a.exported.now()-n;o.endQueryEXT(o.TIME_ELAPSED_EXT,t),setTimeout(()=>{const _=o.getQueryObjectEXT(t,o.QUERY_RESULT_EXT)/1e6;o.deleteQueryEXT(t),this.fire(new a.Event("gpu-timing-frame",{cpuTime:f,gpuTime:_}))},50)}if(this.listens("gpu-timing-layer")){const f=this.painter.collectGpuTimers();setTimeout(()=>{const _=this.painter.queryGpuTimers(f);this.fire(new a.Event("gpu-timing-layer",{layerTimes:_}))},50)}const p=this._sourcesDirty||this._styleDirty||this._placementDirty;return p||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.Event("idle")),!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0,a.PerformanceUtils.mark(a.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),te.remove(this._canvasContainer),te.remove(this._controlContainer),this._cooperativeGestures&&te.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),a.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new a.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=a.exported.frame(l=>{a.PerformanceUtils.frame(l),this._frame=null,this._render(l)}))}_onWindowOnline(){this._update()}_onWindowResize(l){this._trackResize&&this.resize({originalEvent:l})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(l){this._showTileBoundaries!==l&&(this._showTileBoundaries=l,this._update())}get showPadding(){return!!this._showPadding}set showPadding(l){this._showPadding!==l&&(this._showPadding=l,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(l){this._showCollisionBoxes!==l&&(this._showCollisionBoxes=l,l?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(l){this._showOverdrawInspector!==l&&(this._showOverdrawInspector=l,this._update())}get repaint(){return!!this._repaint}set repaint(l){this._repaint!==l&&(this._repaint=l,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(l){this._vertices=l,this._update()}_setCacheLimits(l,t){a.setCacheLimits(l,t)}get version(){return"2.4.0"}},NavigationControl:class{constructor(l){this.options=a.extend({},Tc,l),this._container=te.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(a.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),te.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),te.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=te.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const l=this._map.getZoom(),t=l===this._map.getMaxZoom(),n=l===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())}_rotateCompassArrow(){const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=l}onAdd(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new yr(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){te.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(l,t){const n=te.create("button",l,this._container);return n.type="button",n.addEventListener("click",t),n}_setButtonTitle(l,t){const n=this._map._getUIString(`NavigationControl.${t}`);l.title=n,l.setAttribute("aria-label",n)}},GeolocateControl:class extends a.Evented{constructor(l){super(),this.options=a.extend({},ua,l),a.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(l){var t;return this._map=l,this._container=te.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),t=this._setupUI,en!==void 0?t(en):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(n=>{en=n.state!=="denied",t(en)}):(en=!!window.navigator.geolocation,t(en)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),te.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,yi=0,tn=!1}_isOutOfMapMaxBounds(l){const t=this._map.getMaxBounds(),n=l.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(l){if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new a.Event("geolocate",l)),this._finish()}}_updateCamera(l){const t=new a.LngLat(l.coords.longitude,l.coords.latitude),n=l.coords.accuracy,o=this._map.getBearing(),u=a.extend({bearing:o},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(n),u,{geolocateSource:!0})}_updateMarker(l){if(l){const t=new a.LngLat(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const l=this._map._container.clientHeight/2,t=this._map.unproject([0,l]),n=this._map.unproject([1,l]),o=t.distanceTo(n),u=Math.ceil(2*this._accuracy/o);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(l){if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&tn)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new a.Event("error",l)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(l){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=te.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),te.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=te.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new is(this._dotElement),this._circleElement=te.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new is({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new a.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":yi--,tn=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let l;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),yi++,yi>1?(l={maximumAge:6e5,timeout:0},tn=!0):(l=this.options.positionOptions,tn=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,l)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Fs,LogoControl:_o,ScaleControl:class{constructor(l){this.options=a.extend({},xr,l),a.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){wl(this._map,this._container,this.options)}onAdd(l){return this._map=l,this._container=te.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){te.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(l){this.options.unit=l,wl(this._map,this._container,this.options)}},FullscreenControl:class{constructor(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof HTMLElement?this._container=l.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),a.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=te.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){te.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const l=this._fullscreenButton=te.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);te.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",l).setAttribute("aria-hidden","true"),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(l){this.options=l,a.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(l){return this._map=l,this._container=te.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=te.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),te.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){te.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends a.Evented{constructor(l){super(),this.options=a.extend(Object.create(Jt),l),a.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(l){return this._map&&this.remove(),this._map=l,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new a.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&te.remove(this._content),this._container&&(te.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new a.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=a.LngLat.convert(l),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(l){return this.setDOMContent(document.createTextNode(l))}setHTML(l){const t=document.createDocumentFragment(),n=document.createElement("body");let o;for(n.innerHTML=l;o=n.firstChild,o;)t.appendChild(o);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(l){return this.options.maxWidth=l,this._update(),this}setDOMContent(l){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=te.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(l),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(l){this._container&&this._container.classList.add(l)}removeClassName(l){this._container&&this._container.classList.remove(l)}setOffset(l){return this.options.offset=l,this._update(),this}toggleClassName(l){if(this._container)return this._container.classList.toggle(l)}_createCloseButton(){this.options.closeButton&&(this._closeButton=te.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(l){this._update(l.point)}_onMouseMove(l){this._update(l.point)}_onDrag(l){this._update(l.point)}_update(l){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=te.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=te.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(p=>this._container.classList.add(p)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Os(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!l))return;const t=this._pos=this._trackPointer&&l?l:this._map.project(this._lngLat);let n=this.options.anchor;const o=ha(this.options.offset);if(!n){const p=this._container.offsetWidth,f=this._container.offsetHeight;let _;_=t.y+o.bottom.y<f?["top"]:t.y>this._map.transform.height-f?["bottom"]:[],t.x<p/2?_.push("left"):t.x>this._map.transform.width-p/2&&_.push("right"),n=_.length===0?"bottom":_.join("-")}const u=t.add(o[n]).round();te.setTransform(this._container,`${qe[n]} translate(${u.x}px,${u.y}px)`),Je(this._container,n,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const l=this._container.querySelector(ii);l&&l.focus()}_onClose(){this.remove()}},Marker:is,Style:wi,LngLat:a.LngLat,LngLatBounds:a.LngLatBounds,Point:a.pointGeometry,MercatorCoordinate:a.MercatorCoordinate,Evented:a.Evented,AJAXError:a.AJAXError,config:a.config,CanvasSource:hn,GeoJSONSource:Er,ImageSource:or,RasterDEMTileSource:tt,RasterTileSource:Fi,VectorTileSource:bi,VideoSource:ar,prewarm:function(){Un().acquire(Ir)},clearPrewarmedResources:function(){const l=jr;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(Ir),jr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return Oi.workerCount},set workerCount(l){Oi.workerCount=l},get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){a.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage(l){a.clearTileCache(l)},workerUrl:"",addProtocol(l,t){a.config.REGISTERED_PROTOCOLS[l]=t},removeProtocol(l){delete a.config.REGISTERED_PROTOCOLS[l]}};return Qi.extend(vn,{isSafari:a.isSafari,getPerformanceMetrics:a.PerformanceUtils.getPerformanceMetrics}),vn});var Y=j;return Y})})(Do);function hs(A){const k=A-1;return k*k*k+1}function Su(A,{delay:k=0,duration:R=400,easing:q=Or}={}){const j=+getComputedStyle(A).opacity;return{delay:k,duration:R,easing:q,css:X=>`opacity: ${X*j}`}}function Ys(A,{delay:k=0,duration:R=400,easing:q=hs,x:j=0,y:X=0,opacity:Y=0}={}){const a=getComputedStyle(A),de=+a.opacity,ae=a.transform==="none"?"":a.transform,pe=de*(1-Y),[fe,te]=du(j),[Ce,ze]=du(X);return{delay:k,duration:R,easing:q,css:(Te,je)=>`
			transform: ${ae} translate(${(1-Te)*fe}${te}, ${(1-Te)*Ce}${ze});
			opacity: ${de-pe*je}`}}function qp(A){let k,R=[{width:A[1]},{height:A[1]},{"stroke-width":"0"},{class:A[2]},A[0].a,A[4],{xmlns:"http://www.w3.org/2000/svg"}],q={};for(let j=0;j<R.length;j+=1)q=cu(q,R[j]);return{c(){k=Cp("svg"),yu(k,q)},m(j,X){gi(j,k,X),k.innerHTML=A[3]},p(j,[X]){X&8&&(k.innerHTML=j[3]),yu(k,q=Eu(R,[X&2&&{width:j[1]},X&2&&{height:j[1]},{"stroke-width":"0"},X&4&&{class:j[2]},X&1&&j[0].a,X&16&&j[4],{xmlns:"http://www.w3.org/2000/svg"}]))},i:Rt,o:Rt,d(j){j&&si(k)}}}function Gp(A,k,R){let{src:q}=k,{size:j="1em"}=k,{color:X=void 0}=k,{title:Y=void 0}=k,{className:a=""}=k,de,ae;return A.$$set=pe=>{"src"in pe&&R(0,q=pe.src),"size"in pe&&R(1,j=pe.size),"color"in pe&&R(5,X=pe.color),"title"in pe&&R(6,Y=pe.title),"className"in pe&&R(2,a=pe.className)},A.$$.update=()=>{A.$$.dirty&33&&(R(4,ae={}),X&&(q.a.stroke!=="none"&&R(4,ae.stroke=X,ae),q.a.fill!=="none"&&R(4,ae.fill=X,ae))),A.$$.dirty&65&&R(3,de=(Y?`<title>${Y}</title>`:"")+q.c)},[q,j,a,de,ae,X,Y]}class Dn extends Pn{constructor(k){super(),zn(this,k,Gp,qp,Ur,{src:0,size:1,color:5,title:6,className:2})}}const Iu={a:{viewBox:"0 0 24 24",fill:"none"},c:'<path d="M6.2253 4.81108C5.83477 4.42056 5.20161 4.42056 4.81108 4.81108C4.42056 5.20161 4.42056 5.83477 4.81108 6.2253L10.5858 12L4.81114 17.7747C4.42062 18.1652 4.42062 18.7984 4.81114 19.1889C5.20167 19.5794 5.83483 19.5794 6.22535 19.1889L12 13.4142L17.7747 19.1889C18.1652 19.5794 18.7984 19.5794 19.1889 19.1889C19.5794 18.7984 19.5794 18.1652 19.1889 17.7747L13.4142 12L19.189 6.2253C19.5795 5.83477 19.5795 5.20161 19.189 4.81108C18.7985 4.42056 18.1653 4.42056 17.7748 4.81108L12 10.5858L6.2253 4.81108Z" fill="currentColor"></path>'},Zp={a:{viewBox:"0 0 24 24",fill:"none"},c:'<path d="M6.34317 7.75732L4.92896 9.17154L12 16.2426L19.0711 9.17157L17.6569 7.75735L12 13.4142L6.34317 7.75732Z" fill="currentColor"></path>'},jp={a:{viewBox:"0 0 24 24",fill:"none"},c:'<path d="M17.6569 16.2427L19.0711 14.8285L12.0001 7.75739L4.92896 14.8285L6.34317 16.2427L12.0001 10.5858L17.6569 16.2427Z" fill="currentColor"></path>'},Xp={a:{fill:"currentColor",viewBox:"0 0 16 16"},c:'<path fill-rule="evenodd" d="M0 .5A.5.5 0 0 1 .5 0h4a.5.5 0 0 1 0 1h-4A.5.5 0 0 1 0 .5Zm0 2A.5.5 0 0 1 .5 2h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5Zm9 0a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5Zm-9 2A.5.5 0 0 1 .5 4h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5Zm5 0a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5Zm7 0a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5Zm-12 2A.5.5 0 0 1 .5 6h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5Zm8 0a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5Zm-8 2A.5.5 0 0 1 .5 8h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5Zm7 0a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5Zm-7 2a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 0 1h-8a.5.5 0 0 1-.5-.5Zm0 2a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1h-4a.5.5 0 0 1-.5-.5Zm0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Z"></path>'},bm="";function Wp(A){let k,R;return k=new Dn({props:{src:Xp}}),{c(){sr(k.$$.fragment)},m(q,j){Ki(k,q,j),R=!0},p:Rt,i(q){R||(Et(k.$$.fragment,q),R=!0)},o(q){Ft(k.$$.fragment,q),R=!1},d(q){Yi(k,q)}}}function Hp(A){let k,R,q;return{c(){k=kt("img"),pu(k.src,R=A[1].thumbnail_url)||lt(k,"src",R),lt(k,"alt",q=`${A[1].title} preview`),lt(k,"class","svelte-x6a7qx")},m(j,X){gi(j,k,X)},p(j,X){X&2&&!pu(k.src,R=j[1].thumbnail_url)&&lt(k,"src",R),X&2&&q!==(q=`${j[1].title} preview`)&&lt(k,"alt",q)},i:Rt,o:Rt,d(j){j&&si(k)}}}function Kp(A){let k,R,q,j,X,Y,a,de=A[1].title+"",ae,pe,fe,te=A[1].text+"",Ce,ze,Te,je=A[1].long_id+"",Qe,Ze,He,it,Ke;const It=[Hp,Wp],gt=[];function rt(Kt,Dt){return Kt[1].thumbnail_url?0:1}return q=rt(A),j=gt[q]=It[q](A),{c(){k=kt("div"),R=kt("aside"),j.c(),X=nr(),Y=kt("section"),a=kt("h1"),ae=Hi(de),pe=nr(),fe=kt("p"),Ce=Hi(te),ze=nr(),Te=kt("a"),Qe=Hi(je),lt(R,"class","thumbnail svelte-x6a7qx"),lt(a,"class","svelte-x6a7qx"),lt(fe,"class","text svelte-x6a7qx"),lt(Te,"href",Ze=A[1].item_url),lt(Te,"target","_blank"),lt(Te,"rel","noreferrer"),lt(Te,"class","svelte-x6a7qx"),lt(Y,"class","svelte-x6a7qx"),lt(k,"class","mappola-popup-card svelte-x6a7qx"),js(k,"selected",A[2])},m(Kt,Dt){gi(Kt,k,Dt),dt(k,R),gt[q].m(R,null),dt(k,X),dt(k,Y),dt(Y,a),dt(a,ae),dt(Y,pe),dt(Y,fe),dt(fe,Ce),dt(Y,ze),dt(Y,Te),dt(Te,Qe),A[4](k),Ke=!0},p(Kt,[Dt]){A=Kt;let vi=q;q=rt(A),q===vi?gt[q].p(A,Dt):(cn(),Ft(gt[vi],1,1,()=>{gt[vi]=null}),un(),j=gt[q],j?j.p(A,Dt):(j=gt[q]=It[q](A),j.c()),Et(j,1),j.m(R,null)),(!Ke||Dt&2)&&de!==(de=A[1].title+"")&&cs(ae,de),(!Ke||Dt&2)&&te!==(te=A[1].text+"")&&cs(Ce,te),(!Ke||Dt&2)&&je!==(je=A[1].long_id+"")&&cs(Qe,je),(!Ke||Dt&2&&Ze!==(Ze=A[1].item_url))&&lt(Te,"href",Ze),(!Ke||Dt&4)&&js(k,"selected",A[2])},i(Kt){Ke||(Et(j),Vr(()=>{!Ke||(it&&it.end(1),He=wu(k,Ys,{y:50,duration:120,easing:hs,delay:A[0]}),He.start())}),Ke=!0)},o(Kt){Ft(j),He&&He.invalidate(),Kt&&(it=Tu(k,Ys,{y:50,duration:120,easing:hs,delay:A[0]?120-A[0]:0})),Ke=!1},d(Kt){Kt&&si(k),gt[q].d(),A[4](null),Kt&&it&&it.end()}}}function Yp(A,k,R){let q,{delay:j=0}=k,{item:X}=k,{isSelected:Y}=k;Xs(()=>{Y&&q.scrollIntoView({block:"start"})});function a(de){Mn[de?"unshift":"push"](()=>{q=de,R(3,q)})}return A.$$set=de=>{"delay"in de&&R(0,j=de.delay),"item"in de&&R(1,X=de.item),"isSelected"in de&&R(2,Y=de.isSelected)},[j,X,Y,q,a]}class Au extends Pn{constructor(k){super(),zn(this,k,Yp,Kp,Ur,{delay:0,item:1,isSelected:2})}}const wm="";function Cu(A,k,R){const q=A.slice();return q[11]=k[R],q[13]=R,q}function ku(A){let k,R,q,j,X,Y;return R=new Au({props:{item:A[11],delay:A[13]<A[3]?0:120-50*(A[13]-A[3]),isSelected:A[11].long_id===A[1]}}),{c(){k=kt("div"),sr(R.$$.fragment),q=nr(),lt(k,"class","endless-list-item svelte-ity95o"),lt(k,"data-idx",A[13])},m(a,de){gi(a,k,de),Ki(R,k,null),dt(k,q),j=!0,X||(Y=ln(k,"pointerdown",A[5]),X=!0)},p(a,de){const ae={};de&1&&(ae.item=a[11]),de&8&&(ae.delay=a[13]<a[3]?0:120-50*(a[13]-a[3])),de&3&&(ae.isSelected=a[11].long_id===a[1]),R.$set(ae)},i(a){j||(Et(R.$$.fragment,a),j=!0)},o(a){Ft(R.$$.fragment,a),j=!1},d(a){a&&si(k),Yi(R),X=!1,Y()}}}function Jp(A){let k,R,q,j,X=A[0],Y=[];for(let de=0;de<X.length;de+=1)Y[de]=ku(Cu(A,X,de));const a=de=>Ft(Y[de],1,1,()=>{Y[de]=null});return{c(){k=kt("div");for(let de=0;de<Y.length;de+=1)Y[de].c();lt(k,"class","endless-list-container svelte-ity95o")},m(de,ae){gi(de,k,ae);for(let pe=0;pe<Y.length;pe+=1)Y[pe]&&Y[pe].m(k,null);A[7](k),R=!0,q||(j=ln(k,"pointerdown",A[4]),q=!0)},p(de,[ae]){if(ae&43){X=de[0];let pe;for(pe=0;pe<X.length;pe+=1){const fe=Cu(de,X,pe);Y[pe]?(Y[pe].p(fe,ae),Et(Y[pe],1)):(Y[pe]=ku(fe),Y[pe].c(),Et(Y[pe],1),Y[pe].m(k,null))}for(cn(),pe=X.length;pe<Y.length;pe+=1)a(pe);un()}},i(de){if(!R){for(let ae=0;ae<X.length;ae+=1)Et(Y[ae]);R=!0}},o(de){Y=Y.filter(Boolean);for(let ae=0;ae<Y.length;ae+=1)Ft(Y[ae]);R=!1},d(de){de&&si(k),_u(Y,de),A[7](null),q=!1,j()}}}const Mu=.88,zu=50,Qp=90;function ed(A,k,R){let{items:q}=k,{selected:j}=k,X;const Y=Yl();let a=0;const de=/firefox/i.test(navigator.userAgent),ae=ze=>{const Te=document.querySelector(".endless-list-container");Te.scrollTo({top:Te.scrollTop+Qp*ze,behavior:"smooth"})},pe=ze=>{ze.forEach(Qe=>{const{style:Ze}=Qe.target;if(Qe.isIntersecting){const He=Qe.boundingClientRect.top<=Qe.rootBounds.top,it=He?Qe.rootBounds.top-Qe.boundingClientRect.top:Qe.boundingClientRect.bottom-Qe.rootBounds.bottom,Ke=Math.min(1,1-it/Qe.boundingClientRect.height);He&&Ke<.9&&R(3,a=parseInt(Qe.target.dataset.idx)),Ze.opacity=Ke;const It=Ke*(1-Mu)+Mu,gt=He?5*(1-Ke):-5*(1-Ke),rt=zu-Math.sqrt(Ke)*zu;Ze.transform=`scale(${It}) perspective(500px) rotateX(${gt}deg) translateY(${He?rt:-rt}px)`,Ke>.9?Ze.zIndex=1:Ze.zIndex=0}else Ze.opacity=0});const Te=Math.round(100*X.scrollTop/X.scrollHeight),je=Math.round(100*(X.scrollTop+X.offsetHeight)/X.scrollHeight);Y("scroll",{from:Te,to:je})},fe=ze=>{ze.target===X&&Y("close")},te=ze=>{const Te=ze.target.closest(".endless-list-item"),{opacity:je}=Te.style;if(je<.99){const Qe=Te.getBoundingClientRect(),Ze=Te.offsetTop-Te.parentElement.scrollTop>Qe.height;ae(Ze?2:-2)}};Xs(()=>{const ze={root:X,rootMargin:de?"-110px":"0px",threshold:Array.from({length:51},(je,Qe)=>Qe*.02)},Te=new IntersectionObserver(pe,ze);return X.childNodes.forEach(je=>Te.observe(je)),()=>{Te.disconnect()}});function Ce(ze){Mn[ze?"unshift":"push"](()=>{X=ze,R(2,X)})}return A.$$set=ze=>{"items"in ze&&R(0,q=ze.items),"selected"in ze&&R(1,j=ze.selected)},[q,j,X,a,fe,te,ae,Ce]}class td extends Pn{constructor(k){super(),zn(this,k,ed,Jp,Ur,{items:0,selected:1,scrollBy:6})}get scrollBy(){return this.$$.ctx[6]}}const Ln=40,Pu=(A,k)=>{const R=A.getCanvasContainer().querySelector("canvas").getBoundingClientRect();let q=0,j=0;k.left-Ln<R.left?q=k.left-R.left-Ln:k.right+Ln>R.right&&(q=k.right-R.right+Ln),k.top-Ln<R.top?j=k.top-R.top-Ln:k.bottom+Ln>R.bottom&&(j=k.bottom+Ln-R.bottom),(q!==0||j!==0)&&A.panBy([q,j])},Tm="";function Du(A,k,R){const q=A.slice();return q[21]=k[R],q[23]=R,q}function id(A){let k,R,q,j,X,Y,a,de,ae,pe=Math.round(A[1].length*(A[7]-1)/100)+"",fe,te,Ce=A[1].length+"",ze,Te,je,Qe,Ze,He,it,Ke,It,gt,rt,Kt;function Dt(St){A[14](St)}let vi={items:A[1],selected:A[2]};return A[6]!==void 0&&(vi.scrollBy=A[6]),R=new td({props:vi}),Mn.push(()=>Vp(R,"scrollBy",Dt)),R.$on("close",A[15]),R.$on("scroll",A[11]),a=new Dn({props:{src:Iu}}),Qe=new Dn({props:{src:jp}}),it=new Dn({props:{src:Zp}}),{c(){k=kt("div"),sr(R.$$.fragment),j=nr(),X=kt("div"),Y=kt("button"),sr(a.$$.fragment),de=nr(),ae=kt("span"),fe=Hi(pe),te=Hi("/"),ze=Hi(Ce),Te=nr(),je=kt("button"),sr(Qe.$$.fragment),Ze=nr(),He=kt("button"),sr(it.$$.fragment),lt(Y,"class","svelte-tw82ee"),lt(ae,"class","scroll-position svelte-tw82ee"),je.disabled=A[8],lt(je,"class","svelte-tw82ee"),He.disabled=A[9],lt(He,"class","svelte-tw82ee"),lt(X,"class","mappola-popup-controls right svelte-tw82ee"),lt(k,"class","wrapper svelte-tw82ee")},m(St,bi){gi(St,k,bi),Ki(R,k,null),dt(k,j),dt(k,X),dt(X,Y),Ki(a,Y,null),dt(X,de),dt(X,ae),dt(ae,fe),dt(ae,te),dt(ae,ze),dt(X,Te),dt(X,je),Ki(Qe,je,null),dt(X,Ze),dt(X,He),Ki(it,He,null),gt=!0,rt||(Kt=[ln(Y,"click",A[16]),ln(je,"click",A[17]),ln(He,"click",A[18])],rt=!0)},p(St,bi){const Fi={};bi&2&&(Fi.items=St[1]),bi&4&&(Fi.selected=St[2]),!q&&bi&64&&(q=!0,Fi.scrollBy=St[6],Rp(()=>q=!1)),R.$set(Fi),(!gt||bi&130)&&pe!==(pe=Math.round(St[1].length*(St[7]-1)/100)+"")&&cs(fe,pe),(!gt||bi&2)&&Ce!==(Ce=St[1].length+"")&&cs(ze,Ce),(!gt||bi&256)&&(je.disabled=St[8]),(!gt||bi&512)&&(He.disabled=St[9])},i(St){gt||(Et(R.$$.fragment,St),Et(a.$$.fragment,St),Et(Qe.$$.fragment,St),Et(it.$$.fragment,St),Vr(()=>{!gt||(It&&It.end(1),Ke=wu(X,Su,{duration:200,delay:170}),Ke.start())}),gt=!0)},o(St){Ft(R.$$.fragment,St),Ft(a.$$.fragment,St),Ft(Qe.$$.fragment,St),Ft(it.$$.fragment,St),Ke&&Ke.invalidate(),It=Tu(X,Su,{duration:120}),gt=!1},d(St){St&&si(k),Yi(R),Yi(a),Yi(Qe),Yi(it),St&&It&&It.end(),rt=!1,an(Kt)}}}function rd(A){let k,R,q,j,X,Y,a,de,ae,pe=A[1],fe=[];for(let Ce=0;Ce<pe.length;Ce+=1)fe[Ce]=Lu(Du(A,pe,Ce));const te=Ce=>Ft(fe[Ce],1,1,()=>{fe[Ce]=null});return X=new Dn({props:{src:Iu}}),{c(){k=kt("div");for(let Ce=0;Ce<fe.length;Ce+=1)fe[Ce].c();R=nr(),q=kt("div"),j=kt("button"),sr(X.$$.fragment),lt(j,"class","svelte-tw82ee"),lt(q,"class","mappola-popup-controls single svelte-tw82ee"),lt(k,"class","wrapper svelte-tw82ee")},m(Ce,ze){gi(Ce,k,ze);for(let Te=0;Te<fe.length;Te+=1)fe[Te]&&fe[Te].m(k,null);dt(k,R),dt(k,q),dt(q,j),Ki(X,j,null),a=!0,de||(ae=ln(j,"click",A[13]),de=!0)},p(Ce,ze){if(A=Ce,ze&6){pe=A[1];let Te;for(Te=0;Te<pe.length;Te+=1){const je=Du(A,pe,Te);fe[Te]?(fe[Te].p(je,ze),Et(fe[Te],1)):(fe[Te]=Lu(je),fe[Te].c(),Et(fe[Te],1),fe[Te].m(k,R))}for(cn(),Te=pe.length;Te<fe.length;Te+=1)te(Te);un()}},i(Ce){if(!a){for(let ze=0;ze<pe.length;ze+=1)Et(fe[ze]);Et(X.$$.fragment,Ce),Vr(()=>{!a||(Y||(Y=Fa(q,Ys,{y:50,duration:120,delay:(A[1].length-1)*50,easing:hs},!0)),Y.run(1))}),a=!0}},o(Ce){fe=fe.filter(Boolean);for(let ze=0;ze<fe.length;ze+=1)Ft(fe[ze]);Ft(X.$$.fragment,Ce),Y||(Y=Fa(q,Ys,{y:50,duration:120,delay:(A[1].length-1)*50,easing:hs},!1)),Y.run(0),a=!1},d(Ce){Ce&&si(k),_u(fe,Ce),Yi(X),Ce&&Y&&Y.end(),de=!1,ae()}}}function Lu(A){let k,R,q;return R=new Au({props:{item:A[21],isSelected:A[21].long_id===A[2]&&A[1].length>1,delay:A[1].length===1?0:150-50*A[23]}}),{c(){k=kt("div"),sr(R.$$.fragment),lt(k,"class","no-scroll svelte-tw82ee")},m(j,X){gi(j,k,X),Ki(R,k,null),q=!0},p(j,X){const Y={};X&2&&(Y.item=j[21]),X&6&&(Y.isSelected=j[21].long_id===j[2]&&j[1].length>1),X&2&&(Y.delay=j[1].length===1?0:150-50*j[23]),R.$set(Y)},i(j){q||(Et(R.$$.fragment,j),q=!0)},o(j){Ft(R.$$.fragment,j),q=!1},d(j){j&&si(k),Yi(R)}}}function Bu(A){let k,R,q,j,X;const Y=[rd,id],a=[];function de(ae,pe){return ae[1].length<4?0:1}return R=de(A),q=a[R]=Y[R](A),{c(){k=kt("div"),q.c(),lt(k,"class","mappola-popup-container svelte-tw82ee"),lt(k,"style",j=`bottom: ${A[5]+20}px; left: ${A[4]-160}px;`)},m(ae,pe){gi(ae,k,pe),a[R].m(k,null),A[19](k),X=!0},p(ae,pe){let fe=R;R=de(ae),R===fe?a[R].p(ae,pe):(cn(),Ft(a[fe],1,1,()=>{a[fe]=null}),un(),q=a[R],q?q.p(ae,pe):(q=a[R]=Y[R](ae),q.c()),Et(q,1),q.m(k,null)),(!X||pe&48&&j!==(j=`bottom: ${ae[5]+20}px; left: ${ae[4]-160}px;`))&&lt(k,"style",j)},i(ae){X||(Et(q),X=!0)},o(ae){Ft(q),X=!1},d(ae){ae&&si(k),a[R].d(),A[19](null)}}}function nd(A){let k=A[0].properties.results,R,q,j=Bu(A);return{c(){j.c(),R=Hl()},m(X,Y){j.m(X,Y),gi(X,R,Y),q=!0},p(X,[Y]){Y&1&&Ur(k,k=X[0].properties.results)?(cn(),Ft(j,1,1,Rt),un(),j=Bu(X),j.c(),Et(j,1),j.m(R.parentNode,R)):j.p(X,Y)},i(X){q||(Et(j),q=!0)},o(X){Ft(j),q=!1},d(X){X&&si(R),j.d(X)}}}function sd(A,k,R){let{map:q}=k,{feature:j}=k,{items:X}=k,{selected:Y}=k,a,de,ae,pe,fe=3,te=!0,Ce=!1;const ze=Yl(),Te=rt=>{const{coordinates:Kt}=rt.geometry,Dt=q.project(Kt),{height:vi}=q._container.getBoundingClientRect();R(4,de=Dt.x),R(5,ae=vi-Dt.y)},je=rt=>{const{from:Kt,to:Dt}=rt.detail;R(7,fe=Dt),R(8,te=Kt===0),R(9,Ce=Dt===100)};Xs(()=>{const rt=()=>Te(j);return q.on("move",rt),Pu(q,a.getBoundingClientRect()),()=>{q.off("move",rt)}});const Qe=()=>ze("close");function Ze(rt){pe=rt,R(6,pe)}function He(rt){Dp.call(this,A,rt)}const it=()=>ze("close"),Ke=()=>pe(-2),It=()=>pe(2);function gt(rt){Mn[rt?"unshift":"push"](()=>{a=rt,R(3,a)})}return A.$$set=rt=>{"map"in rt&&R(12,q=rt.map),"feature"in rt&&R(0,j=rt.feature),"items"in rt&&R(1,X=rt.items),"selected"in rt&&R(2,Y=rt.selected)},A.$$.update=()=>{A.$$.dirty&4105&&(Te(j),a&&Pu(q,a.getBoundingClientRect()))},[j,X,Y,a,de,ae,pe,fe,te,Ce,ze,je,q,Qe,Ze,He,it,Ke,It,gt]}class od extends Pn{constructor(k){super(),zn(this,k,sd,nd,Ur,{map:12,feature:0,items:1,selected:2})}}const ad=A=>({type:"Feature",properties:{...A},geometry:{type:"Point",coordinates:A.coords.slice().reverse()}}),Ru={type:"FeatureCollection",features:[]},Fu=(A,k,R=10)=>({type:"FeatureCollection",features:A.map(ad)}),ld=A=>{if(!A||A.length===0)return;let k=1/0,R=1/0,q=-1/0,j=-1/0;return A.forEach(({coords:X})=>{const[Y,a]=X;a<R&&(R=a),a>j&&(j=a),Y<k&&(k=Y),Y>q&&(q=Y)}),[[R,k],[j,q]]},Ou={type:"circle",paint:{"circle-radius":["interpolate",["linear"],["number",["get","point_count"],1],0,4,10,18],"circle-color":"#eb585b","circle-stroke-color":"#472a2d","circle-stroke-width":1}},Uu={type:"circle",paint:{"circle-radius":["interpolate",["linear"],["number",["get","point_count"],1],0,20,10,38],"circle-color":"#eb585b","circle-opacity":.35,"circle-stroke-color":"#eb585b","circle-stroke-width":1,"circle-stroke-opacity":.6}},cd=(Yu=document.querySelector('meta[name="map.style"]'))==null?void 0:Yu.getAttribute("content"),ud=((Ju=document.querySelector('meta[name="default.lon"]'))==null?void 0:Ju.getAttribute("content"))||17,hd=((Qu=document.querySelector('meta[name="default.lat"]'))==null?void 0:Qu.getAttribute("content"))||41.5,Vu=((eh=document.querySelector('meta[name="default.zoom"]'))==null?void 0:eh.getAttribute("content"))||6,pd=((th=document.querySelector('meta[name="max.zoom"]'))==null?void 0:th.getAttribute("content"))||12,Oa=8,dd={maptiler:cd,dare:{version:8,sources:{dare:{type:"raster",tiles:["https://dh.gu.se/tiles/imperium/{z}/{x}/{y}.png"],tileSize:256,attribution:"Digital Atlas of the Roman Empire \xA9 2020 Johan \xC5hlfeldt, Centre for Digital Humanities, University of Gothenburg, Sweden"}},layers:[{id:"dare-tiles",type:"raster",source:"dare"}]}},rc=A=>dd[A],fd={a:{viewBox:"0 0 512 512"},c:'<title></title><path d="M256,256c-13.47,0-26.94-2.39-37.44-7.17l-148-67.49C63.79,178.26,48,169.25,48,152.24s15.79-26,22.58-29.12L219.86,55.05c20.57-9.4,51.61-9.4,72.19,0l149.37,68.07c6.79,3.09,22.58,12.1,22.58,29.12s-15.79,26-22.58,29.11l-148,67.48C282.94,253.61,269.47,256,256,256ZM432.76,155.14h0Z"></path><path d="M441.36,226.81,426.27,220,387.5,237.74l-94,43c-10.5,4.8-24,7.19-37.44,7.19s-26.93-2.39-37.42-7.19l-94.07-43L85.79,220l-15.22,6.84C63.79,229.93,48,239,48,256s15.79,26.08,22.56,29.17l148,67.63C229,357.6,242.49,360,256,360s26.94-2.4,37.44-7.19L441.31,285.2C448.12,282.11,464,273.09,464,256S448.23,229.93,441.36,226.81Z"></path><path d="M441.36,330.8,426.27,324,387.5,341.73l-94,42.95c-10.5,4.78-24,7.18-37.44,7.18s-26.93-2.39-37.42-7.18l-94.07-43L85.79,324l-15.22,6.84C63.79,333.93,48,343,48,360s15.79,26.07,22.56,29.15l148,67.59C229,461.52,242.54,464,256,464s26.88-2.48,37.38-7.27l147.92-67.57C448.12,386.08,464,377.06,464,360S448.23,333.93,441.36,330.8Z"></path>'},Nu={a:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},c:'<polyline points="20 6 9 17 4 12"></polyline>'},Em="";function $u(A){let k,R,q,j,X,Y,a,de,ae,pe,fe,te,Ce,ze,Te;return X=new Dn({props:{src:Nu}}),pe=new Dn({props:{src:Nu}}),{c(){k=kt("div"),R=kt("ul"),q=kt("li"),j=kt("button"),sr(X.$$.fragment),Y=Hi(" OpenStreetMap"),a=nr(),de=kt("li"),ae=kt("button"),sr(pe.$$.fragment),fe=Hi(" Digital Atlas of the Roman Empire"),lt(j,"class","svelte-2qii39"),lt(q,"class","svelte-2qii39"),js(q,"selected",A[1]==="maptiler"),lt(ae,"class","svelte-2qii39"),lt(de,"class","svelte-2qii39"),js(de,"selected",A[1]==="dare"),lt(R,"class","svelte-2qii39"),lt(k,"class","mappola-layer-dropdown svelte-2qii39")},m(je,Qe){gi(je,k,Qe),dt(k,R),dt(R,q),dt(q,j),Ki(X,j,null),dt(j,Y),dt(R,a),dt(R,de),dt(de,ae),Ki(pe,ae,null),dt(ae,fe),Ce=!0,ze||(Te=[ln(j,"click",A[2]("maptiler")),ln(ae,"click",A[2]("dare"))],ze=!0)},p(je,Qe){A=je,(!Ce||Qe&2)&&js(q,"selected",A[1]==="maptiler"),(!Ce||Qe&2)&&js(de,"selected",A[1]==="dare")},i(je){Ce||(Et(X.$$.fragment,je),Et(pe.$$.fragment,je),Vr(()=>{!Ce||(te||(te=Fa(k,Ys,{x:50,duration:120,easing:hs},!0)),te.run(1))}),Ce=!0)},o(je){Ft(X.$$.fragment,je),Ft(pe.$$.fragment,je),te||(te=Fa(k,Ys,{x:50,duration:120,easing:hs},!1)),te.run(0),Ce=!1},d(je){je&&si(k),Yi(X),Yi(pe),je&&te&&te.end(),ze=!1,an(Te)}}}function md(A){let k,R,q,j,X,Y,a,de;q=new Dn({props:{src:fd}});let ae=A[0]&&$u(A);return{c(){k=kt("div"),R=kt("button"),sr(q.$$.fragment),j=nr(),ae&&ae.c(),X=Hl(),lt(R,"class","svelte-2qii39"),lt(k,"class","mappola-layer-switcher svelte-2qii39")},m(pe,fe){gi(pe,k,fe),dt(k,R),Ki(q,R,null),gi(pe,j,fe),ae&&ae.m(pe,fe),gi(pe,X,fe),Y=!0,a||(de=ln(R,"click",A[4]),a=!0)},p(pe,[fe]){pe[0]?ae?(ae.p(pe,fe),fe&1&&Et(ae,1)):(ae=$u(pe),ae.c(),Et(ae,1),ae.m(X.parentNode,X)):ae&&(cn(),Ft(ae,1,1,()=>{ae=null}),un())},i(pe){Y||(Et(q.$$.fragment,pe),Et(ae),Y=!0)},o(pe){Ft(q.$$.fragment,pe),Ft(ae),Y=!1},d(pe){pe&&si(k),Yi(q),pe&&si(j),ae&&ae.d(pe),pe&&si(X),a=!1,de()}}}function gd(A,k,R){const q=Yl();let{map:j}=k,X=!1,Y="maptiler";const a=ae=>()=>{R(1,Y=ae),R(0,X=!1),j.once("styledata",()=>q("change")),j.setStyle(rc(ae))};Xs(()=>{var ae;try{R(1,Y=(ae=j==null?void 0:j.getStyle())!=null&&ae.sources.dare?"dare":"maptiler")}catch{}});const de=()=>R(0,X=!X);return A.$$set=ae=>{"map"in ae&&R(3,j=ae.map)},[X,Y,a,j,de]}class _d extends Pn{constructor(k){super(),zn(this,k,gd,md,Ur,{map:3})}}class yd{constructor(k){this.callbacks=k||{}}onAdd(k){return this._map=k,this._container=document.createElement("div"),this._container.className="maplibregl-ctrl",this.control=new _d({target:this._container,props:{map:k}}),this.control.$on("change",()=>this.callbacks.onChange&&this.callbacks.onChange()),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}const Sm="";function qu(A){let k;return{c(){k=Hi("s")},m(R,q){gi(R,k,q)},d(R){R&&si(k)}}}function xd(A){let k,R,q,j,X,Y=A[2].length+"",a,de,ae,pe=A[2].length>1&&qu();return{c(){k=kt("div"),R=kt("span"),q=Hi(A[3]),j=nr(),X=kt("span"),a=Hi(Y),de=Hi(" Result"),pe&&pe.c(),lt(R,"class","placename svelte-129aez3"),lt(X,"class","count svelte-129aez3"),lt(k,"class","mappola-hover-tooltip svelte-129aez3"),lt(k,"style",ae=`top: ${A[1]+Zu}px; left: ${A[0]+Gu}px;`)},m(fe,te){gi(fe,k,te),dt(k,R),dt(R,q),dt(k,j),dt(k,X),dt(X,a),dt(X,de),pe&&pe.m(X,null)},p(fe,[te]){te&8&&cs(q,fe[3]),te&4&&Y!==(Y=fe[2].length+"")&&cs(a,Y),fe[2].length>1?pe||(pe=qu(),pe.c(),pe.m(X,null)):pe&&(pe.d(1),pe=null),te&3&&ae!==(ae=`top: ${fe[1]+Zu}px; left: ${fe[0]+Gu}px;`)&&lt(k,"style",ae)},i:Rt,o:Rt,d(fe){fe&&si(k),pe&&pe.d()}}}const Gu=14,Zu=10;function vd(A,k,R){let q,{offsetX:j}=k,{offsetY:X}=k,{results:Y}=k;const a=de=>{const pe=de.map(fe=>fe.place).reduce((fe,te)=>(fe[te]=(fe[te]||0)+1,fe),{});return Object.keys(pe).reduce((fe,te)=>pe[te]>pe[fe]?te:fe)};return A.$$set=de=>{"offsetX"in de&&R(0,j=de.offsetX),"offsetY"in de&&R(1,X=de.offsetY),"results"in de&&R(2,Y=de.results)},A.$$.update=()=>{A.$$.dirty&4&&R(3,q=a(Y))},[j,X,Y,q]}class bd extends Pn{constructor(k){super(),zn(this,k,vd,xd,Ur,{offsetX:0,offsetY:1,results:2})}}const Im="",Am="";function ju(A){let k=A[3],R,q,j=Xu(A);return{c(){j.c(),R=Hl()},m(X,Y){j.m(X,Y),gi(X,R,Y),q=!0},p(X,Y){Y&8&&Ur(k,k=X[3])?(cn(),Ft(j,1,1,Rt),un(),j=Xu(X),j.c(),Et(j,1),j.m(R.parentNode,R)):j.p(X,Y)},i(X){q||(Et(j),q=!0)},o(X){Ft(j),q=!1},d(X){X&&si(R),j.d(X)}}}function Xu(A){let k,R;return k=new od({props:{map:A[1],feature:A[3].feature,items:A[3].results,selected:A[0]}}),k.$on("close",A[5]),{c(){sr(k.$$.fragment)},m(q,j){Ki(k,q,j),R=!0},p(q,j){const X={};j&2&&(X.map=q[1]),j&8&&(X.feature=q[3].feature),j&8&&(X.items=q[3].results),j&1&&(X.selected=q[0]),k.$set(X)},i(q){R||(Et(k.$$.fragment,q),R=!0)},o(q){Ft(k.$$.fragment,q),R=!1},d(q){Yi(k,q)}}}function Wu(A){let k,R;const q=[A[4]];let j={};for(let X=0;X<q.length;X+=1)j=cu(j,q[X]);return k=new bd({props:j}),{c(){sr(k.$$.fragment)},m(X,Y){Ki(k,X,Y),R=!0},p(X,Y){const a=Y&16?Eu(q,[Up(X[4])]):{};k.$set(a)},i(X){R||(Et(k.$$.fragment,X),R=!0)},o(X){Ft(k.$$.fragment,X),R=!1},d(X){Yi(k,X)}}}function wd(A){let k,R,q,j=A[3]&&ju(A),X=A[4]&&Wu(A);return{c(){k=kt("div"),j&&j.c(),R=nr(),X&&X.c(),lt(k,"class","map svelte-1uxdzvo")},m(Y,a){gi(Y,k,a),j&&j.m(k,null),dt(k,R),X&&X.m(k,null),A[7](k),q=!0},p(Y,[a]){Y[3]?j?(j.p(Y,a),a&8&&Et(j,1)):(j=ju(Y),j.c(),Et(j,1),j.m(k,R)):j&&(cn(),Ft(j,1,1,()=>{j=null}),un()),Y[4]?X?(X.p(Y,a),a&16&&Et(X,1)):(X=Wu(Y),X.c(),Et(X,1),X.m(k,null)):X&&(cn(),Ft(X,1,1,()=>{X=null}),un())},i(Y){q||(Et(j),Et(X),q=!0)},o(Y){Ft(j),Ft(X),q=!1},d(Y){Y&&si(k),j&&j.d(),X&&X.d(),A[7](null)}}}function Td(A,k,R){let{results:q}=k,{selected:j=void 0}=k,X,Y,a=null,de=null;const ae=()=>{const Ze=Y.queryRenderedFeatures(void 0,{layers:["results"]});let He;Ze.reduce((it,Ke)=>He?it:it.then(()=>pe(Ke).then(It=>{It.find(rt=>rt.long_id===j)&&(He=Ke)})),Promise.resolve()).then(()=>{He&&fe(He)})},pe=Ze=>new Promise(He=>{const it=Ze.properties.cluster_id;it?Y.getSource("results-source").getClusterLeaves(it,1/0,0,(It,gt)=>{He(gt.map(rt=>rt.properties))}):He([Ze.properties])}),fe=Ze=>{const He=it=>Y.getSource("selection-source").setData({type:"FeatureCollection",features:[it]});pe(Ze).then(it=>{He(Ze),R(3,a={feature:Ze,results:it})})},te=Ze=>{const{offsetX:He,offsetY:it}=Ze.originalEvent;if(!Y.getSource("results-source"))return;const It=Y.queryRenderedFeatures(Ze.point,{layers:["results"]});It.length>0?pe(It[0]).then(gt=>R(4,de={offsetX:He,offsetY:it,results:gt})):R(4,de=null)},Ce=()=>{if(a){const Ze=Y.queryRenderedFeatures(void 0,{layers:["results"]});if(!Ze.find(it=>it.properties.cluster_id?it.properties.cluster_id===a.feature.properties.cluster_id:it.properties.long_id===a.feature.properties.long_id)){const it=j&&a.results.find(It=>It.long_id===j)?j:a.results[0].long_id;let Ke;Ze.reduce((It,gt)=>It.then(()=>pe(gt).then(rt=>{rt.find(Dt=>Dt.long_id===it)&&(Ke=gt)})),Promise.resolve()).then(()=>{Ke&&fe(Ke)})}}},ze=Ze=>{const He=[[Ze.point.x-Oa,Ze.point.y-Oa],[Ze.point.x+Oa,Ze.point.y+Oa]],it=Y.queryRenderedFeatures(He,{layers:["results"]});it.length===0?(R(3,a=null),Y.getSource("selection-source").setData({type:"FeatureCollection",features:[]})):(R(4,de=null),fe(it[0]))},Te=()=>{R(3,a=null),Y.getSource("selection-source").setData(Ru)},je=()=>{Y.addSource("selection-source",{type:"geojson",data:(a==null?void 0:a.feature)||Ru}),Y.addLayer({...Uu,id:"selection",source:"selection-source"}),Y.addSource("results-source",{type:"geojson",data:Fu(q),cluster:!0,clusterRadius:10}),Y.addLayer({...Ou,id:"results",source:"results-source"})};Xs(()=>{R(1,Y=new Do.exports.Map({container:X,style:rc("maptiler"),center:[ud,hd],zoom:Vu,bounds:ld(q),fitBoundsOptions:{maxZoom:pd,padding:50}})),Y.addControl(new Do.exports.NavigationControl,"top-right"),Y.addControl(new yd({onChange:je}),"top-right"),Y.on("mousemove",te),Y.on("zoomend",Ce),Y.on("click",ze),Y.on("load",je)}),vu(()=>Y.remove());function Qe(Ze){Mn[Ze?"unshift":"push"](()=>{X=Ze,R(2,X)})}return A.$$set=Ze=>{"results"in Ze&&R(6,q=Ze.results),"selected"in Ze&&R(0,j=Ze.selected)},A.$$.update=()=>{var Ze;A.$$.dirty&3&&j&&(Y.getSource("results-source")&&Y.isSourceLoaded("results-source")?ae():Y.once("idle",ae)),A.$$.dirty&66&&((Ze=Y==null?void 0:Y.getSource("results-source"))==null||Ze.setData(Fu(q)))},[j,Y,X,a,de,Te,q,Qe]}class Ed extends Pn{constructor(k){super(),zn(this,k,Td,wd,Ur,{results:6,selected:0})}}const Cm="";function Sd(A){let k;return{c(){k=kt("div"),lt(k,"class","map svelte-16jw124")},m(R,q){gi(R,k,q),A[3](k)},p:Rt,i:Rt,o:Rt,d(R){R&&si(k),A[3](null)}}}function Id(A,k,R){let q,{lonlat:j=[0,0]}=k,{zoom:X=Vu}=k,Y,a;Xs(()=>{a=new Do.exports.Map({container:Y,style:rc("dare"),center:j,attributionControl:!1,zoom:X}),a.addControl(new Do.exports.NavigationControl,"top-right"),a.on("load",()=>{a.addSource("halo-source",{type:"geojson",data:q}),a.addLayer({...Uu,id:"halo",source:"halo-source"}),a.addSource("marker-source",{type:"geojson",data:q}),a.addLayer({...Ou,id:"marker",source:"marker-source"})})}),vu(()=>a.remove());function de(ae){Mn[ae?"unshift":"push"](()=>{Y=ae,R(0,Y)})}return A.$$set=ae=>{"lonlat"in ae&&R(1,j=ae.lonlat),"zoom"in ae&&R(2,X=ae.zoom)},A.$$.update=()=>{A.$$.dirty&2&&(q={type:"Feature",properties:{},geometry:{type:"Point",coordinates:[...j]}})},[Y,j,X,de]}class Ad extends Pn{constructor(k){super(),zn(this,k,Id,Sd,Ur,{lonlat:1,zoom:2})}}const Hu=A=>{var k;return A.parent||console.error("Missing property 'parent' in ProfileMap config"),A.parent.nodeType||console.error("ProfileMap parent must be a DOM node"),Boolean((k=A==null?void 0:A.parent)==null?void 0:k.nodeType)},Ku=A=>A.filter(k=>{var R;return((R=k.coords)==null?void 0:R.length)===2&&k.coords[0]&&k.coords[1]});class Cd{constructor(k){lu(this,"setResults",k=>this.map.$set({results:Ku(k)}));lu(this,"setSelected",k=>this.map.$set({selected:k}));if(Hu(k)){const{parent:R,results:q,...j}=k,X=q?Ku(q):null;this.map=new Ed({target:k.parent,props:{results:X,...j}})}}}class kd{constructor(k){if(Hu(k)){const{parent:R,...q}=k;this.map=new Ad({target:k.parent,props:{...q}})}}}rr.ProfileMap=kd,rr.SearchResultMap=Cd,Object.defineProperties(rr,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=mappola-maps.js.map
