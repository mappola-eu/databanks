(function(rr,Dt){typeof exports=="object"&&typeof module<"u"?Dt(exports):typeof define=="function"&&define.amd?define(["exports"],Dt):(rr=typeof globalThis<"u"?globalThis:rr||self,Dt(rr.Mappola={}))})(this,function(rr){"use strict";var pm=Object.defineProperty;var dm=(rr,Dt,Or)=>Dt in rr?pm(rr,Dt,{enumerable:!0,configurable:!0,writable:!0,value:Or}):rr[Dt]=Or;var _p=(rr,Dt,Or)=>(dm(rr,typeof Dt!="symbol"?Dt+"":Dt,Or),Or);function Dt(){}const Or=C=>C;function lu(C,k){for(const F in k)C[F]=k[F];return C}function cu(C){return C()}function uu(){return Object.create(null)}function an(C){C.forEach(cu)}function Eo(C){return typeof C=="function"}function Ur(C,k){return C!=C?k==k:C!==k||C&&typeof C=="object"||typeof C=="function"}let Ca;function hu(C,k){return Ca||(Ca=document.createElement("a")),Ca.href=k,C===Ca.href}function xp(C){return Object.keys(C).length===0}const pu=typeof window<"u";let jl=pu?()=>window.performance.now():()=>Date.now(),Xl=pu?C=>requestAnimationFrame(C):Dt;const Zs=new Set;function du(C){Zs.forEach(k=>{k.c(C)||(Zs.delete(k),k.f())}),Zs.size!==0&&Xl(du)}function Wl(C){let k;return Zs.size===0&&Xl(du),{promise:new Promise(F=>{Zs.add(k={c:C,f:F})}),abort(){Zs.delete(k)}}}function ut(C,k){C.appendChild(k)}function fu(C){if(!C)return document;const k=C.getRootNode?C.getRootNode():C.ownerDocument;return k&&k.host?k:C.ownerDocument}function vp(C){const k=It("style");return bp(fu(C),k),k.sheet}function bp(C,k){return ut(C.head||C,k),k.sheet}function gi(C,k,F){C.insertBefore(k,F||null)}function si(C){C.parentNode&&C.parentNode.removeChild(C)}function mu(C,k){for(let F=0;F<C.length;F+=1)C[F]&&C[F].d(k)}function It(C){return document.createElement(C)}function wp(C){return document.createElementNS("http://www.w3.org/2000/svg",C)}function Wi(C){return document.createTextNode(C)}function nr(){return Wi(" ")}function Hl(){return Wi("")}function ln(C,k,F,X){return C.addEventListener(k,F,X),()=>C.removeEventListener(k,F,X)}function nt(C,k,F){F==null?C.removeAttribute(k):C.getAttribute(k)!==F&&C.setAttribute(k,F)}function gu(C,k){for(const F in k)nt(C,F,k[F])}function Tp(C){return Array.from(C.childNodes)}function ls(C,k){k=""+k,C.wholeText!==k&&(C.data=k)}function ka(C,k,F){C.classList[F?"add":"remove"](k)}function _u(C,k,{bubbles:F=!1,cancelable:X=!1}={}){const q=document.createEvent("CustomEvent");return q.initCustomEvent(C,F,X,k),q}const Ma=new Map;let za=0;function Ep(C){let k=5381,F=C.length;for(;F--;)k=(k<<5)-k^C.charCodeAt(F);return k>>>0}function Sp(C,k){const F={stylesheet:vp(k),rules:{}};return Ma.set(C,F),F}function Pa(C,k,F,X,q,G,ie,a=0){const _e=16.666/X;let le=`{
`;for(let Ne=0;Ne<=1;Ne+=_e){const We=k+(F-k)*G(Ne);le+=Ne*100+`%{${ie(We,1-We)}}
`}const me=le+`100% {${ie(F,1-F)}}
}`,pe=`__svelte_${Ep(me)}_${a}`,Y=fu(C),{stylesheet:Ee,rules:qe}=Ma.get(Y)||Sp(Y,C);qe[pe]||(qe[pe]=!0,Ee.insertRule(`@keyframes ${pe} ${me}`,Ee.cssRules.length));const be=C.style.animation||"";return C.style.animation=`${be?`${be}, `:""}${pe} ${X}ms linear ${q}ms 1 both`,za+=1,pe}function Da(C,k){const F=(C.style.animation||"").split(", "),X=F.filter(k?G=>G.indexOf(k)<0:G=>G.indexOf("__svelte")===-1),q=F.length-X.length;q&&(C.style.animation=X.join(", "),za-=q,za||Ip())}function Ip(){Xl(()=>{za||(Ma.forEach(C=>{const{ownerNode:k}=C.stylesheet;k&&si(k)}),Ma.clear())})}let So;function Io(C){So=C}function Kl(){if(!So)throw new Error("Function called outside component initialization");return So}function Ao(C){Kl().$$.on_mount.push(C)}function yu(C){Kl().$$.on_destroy.push(C)}function Yl(){const C=Kl();return(k,F,{cancelable:X=!1}={})=>{const q=C.$$.callbacks[k];if(q){const G=_u(k,F,{cancelable:X});return q.slice().forEach(ie=>{ie.call(C,G)}),!G.defaultPrevented}return!0}}function Ap(C,k){const F=C.$$.callbacks[k.type];F&&F.slice().forEach(X=>X.call(this,k))}const Co=[],cs=[],La=[],Jl=[],Cp=Promise.resolve();let Ql=!1;function kp(){Ql||(Ql=!0,Cp.then(xu))}function Vr(C){La.push(C)}function Mp(C){Jl.push(C)}const ec=new Set;let Ba=0;function xu(){const C=So;do{for(;Ba<Co.length;){const k=Co[Ba];Ba++,Io(k),zp(k.$$)}for(Io(null),Co.length=0,Ba=0;cs.length;)cs.pop()();for(let k=0;k<La.length;k+=1){const F=La[k];ec.has(F)||(ec.add(F),F())}La.length=0}while(Co.length);for(;Jl.length;)Jl.pop()();Ql=!1,ec.clear(),Io(C)}function zp(C){if(C.fragment!==null){C.update(),an(C.before_update);const k=C.dirty;C.dirty=[-1],C.fragment&&C.fragment.p(C.ctx,k),C.after_update.forEach(Vr)}}let ko;function tc(){return ko||(ko=Promise.resolve(),ko.then(()=>{ko=null})),ko}function us(C,k,F){C.dispatchEvent(_u(`${k?"intro":"outro"}${F}`))}const Ra=new Set;let Nr;function cn(){Nr={r:0,c:[],p:Nr}}function un(){Nr.r||an(Nr.c),Nr=Nr.p}function bt(C,k){C&&C.i&&(Ra.delete(C),C.i(k))}function Lt(C,k,F,X){if(C&&C.o){if(Ra.has(C))return;Ra.add(C),Nr.c.push(()=>{Ra.delete(C),X&&(F&&C.d(1),X())}),C.o(k)}else X&&X()}const ic={duration:0};function vu(C,k,F){const X={direction:"in"};let q=k(C,F,X),G=!1,ie,a,_e=0;function le(){ie&&Da(C,ie)}function me(){const{delay:Y=0,duration:Ee=300,easing:qe=Or,tick:be=Dt,css:Ne}=q||ic;Ne&&(ie=Pa(C,0,1,Ee,Y,qe,Ne,_e++)),be(0,1);const We=jl()+Y,Tt=We+Ee;a&&a.abort(),G=!0,Vr(()=>us(C,!0,"start")),a=Wl(ht=>{if(G){if(ht>=Tt)return be(1,0),us(C,!0,"end"),le(),G=!1;if(ht>=We){const At=qe((ht-We)/Ee);be(At,1-At)}}return G})}let pe=!1;return{start(){pe||(pe=!0,Da(C),Eo(q)?(q=q(X),tc().then(me)):me())},invalidate(){pe=!1},end(){G&&(le(),G=!1)}}}function bu(C,k,F){const X={direction:"out"};let q=k(C,F,X),G=!0,ie;const a=Nr;a.r+=1;function _e(){const{delay:le=0,duration:me=300,easing:pe=Or,tick:Y=Dt,css:Ee}=q||ic;Ee&&(ie=Pa(C,1,0,me,le,pe,Ee));const qe=jl()+le,be=qe+me;Vr(()=>us(C,!1,"start")),Wl(Ne=>{if(G){if(Ne>=be)return Y(0,1),us(C,!1,"end"),--a.r||an(a.c),!1;if(Ne>=qe){const We=pe((Ne-qe)/me);Y(1-We,We)}}return G})}return Eo(q)?tc().then(()=>{q=q(X),_e()}):_e(),{end(le){le&&q.tick&&q.tick(1,0),G&&(ie&&Da(C,ie),G=!1)}}}function Fa(C,k,F,X){const q={direction:"both"};let G=k(C,F,q),ie=X?0:1,a=null,_e=null,le=null;function me(){le&&Da(C,le)}function pe(Ee,qe){const be=Ee.b-ie;return qe*=Math.abs(be),{a:ie,b:Ee.b,d:be,duration:qe,start:Ee.start,end:Ee.start+qe,group:Ee.group}}function Y(Ee){const{delay:qe=0,duration:be=300,easing:Ne=Or,tick:We=Dt,css:Tt}=G||ic,ht={start:jl()+qe,b:Ee};Ee||(ht.group=Nr,Nr.r+=1),a||_e?_e=ht:(Tt&&(me(),le=Pa(C,ie,Ee,be,qe,Ne,Tt)),Ee&&We(0,1),a=pe(ht,be),Vr(()=>us(C,Ee,"start")),Wl(At=>{if(_e&&At>_e.start&&(a=pe(_e,be),_e=null,us(C,a.b,"start"),Tt&&(me(),le=Pa(C,ie,a.b,a.duration,0,Ne,G.css))),a){if(At>=a.end)We(ie=a.b,1-ie),us(C,a.b,"end"),_e||(a.b?me():--a.group.r||an(a.group.c)),a=null;else if(At>=a.start){const st=At-a.start;ie=a.a+a.d*Ne(st/a.duration),We(ie,1-ie)}}return!!(a||_e)}))}return{run(Ee){Eo(G)?tc().then(()=>{G=G(q),Y(Ee)}):Y(Ee)},end(){me(),a=_e=null}}}function wu(C,k){const F={},X={},q={$$scope:1};let G=C.length;for(;G--;){const ie=C[G],a=k[G];if(a){for(const _e in ie)_e in a||(X[_e]=1);for(const _e in a)q[_e]||(F[_e]=a[_e],q[_e]=1);C[G]=a}else for(const _e in ie)q[_e]=1}for(const ie in X)ie in F||(F[ie]=void 0);return F}function Pp(C){return typeof C=="object"&&C!==null?C:{}}function Dp(C,k,F,X){const q=C.$$.props[k];q!==void 0&&(C.$$.bound[q]=F,X===void 0&&F(C.$$.ctx[q]))}function sr(C){C&&C.c()}function Hi(C,k,F,X){const{fragment:q,after_update:G}=C.$$;q&&q.m(k,F),X||Vr(()=>{const ie=C.$$.on_mount.map(cu).filter(Eo);C.$$.on_destroy?C.$$.on_destroy.push(...ie):an(ie),C.$$.on_mount=[]}),G.forEach(Vr)}function Ki(C,k){const F=C.$$;F.fragment!==null&&(an(F.on_destroy),F.fragment&&F.fragment.d(k),F.on_destroy=F.fragment=null,F.ctx=[])}function Lp(C,k){C.$$.dirty[0]===-1&&(Co.push(C),kp(),C.$$.dirty.fill(0)),C.$$.dirty[k/31|0]|=1<<k%31}function Mn(C,k,F,X,q,G,ie,a=[-1]){const _e=So;Io(C);const le=C.$$={fragment:null,ctx:[],props:G,update:Dt,not_equal:q,bound:uu(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(k.context||(_e?_e.$$.context:[])),callbacks:uu(),dirty:a,skip_bound:!1,root:k.target||_e.$$.root};ie&&ie(le.root);let me=!1;if(le.ctx=F?F(C,k.props||{},(pe,Y,...Ee)=>{const qe=Ee.length?Ee[0]:Y;return le.ctx&&q(le.ctx[pe],le.ctx[pe]=qe)&&(!le.skip_bound&&le.bound[pe]&&le.bound[pe](qe),me&&Lp(C,pe)),Y}):[],le.update(),me=!0,an(le.before_update),le.fragment=X?X(le.ctx):!1,k.target){if(k.hydrate){const pe=Tp(k.target);le.fragment&&le.fragment.l(pe),pe.forEach(si)}else le.fragment&&le.fragment.c();k.intro&&bt(C.$$.fragment),Hi(C,k.target,k.anchor,k.customElement),xu()}Io(_e)}class zn{$destroy(){Ki(this,1),this.$destroy=Dt}$on(k,F){if(!Eo(F))return Dt;const X=this.$$.callbacks[k]||(this.$$.callbacks[k]=[]);return X.push(F),()=>{const q=X.indexOf(F);q!==-1&&X.splice(q,1)}}$set(k){this.$$set&&!xp(k)&&(this.$$.skip_bound=!0,this.$$set(k),this.$$.skip_bound=!1)}}var Bp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Mo={exports:{}};(function(C,k){(function(F,X){C.exports=X()})(Bp,function(){var F,X,q;function G(a,_e){if(!F)F=_e;else if(!X)X=_e;else{var le="var sharedChunk = {}; ("+F+")(sharedChunk); ("+X+")(sharedChunk);",me={};F(me),q=_e(me),typeof window<"u"&&(q.workerUrl=window.URL.createObjectURL(new Blob([le],{type:"text/javascript"})))}}G(["exports"],function(a){var _e=le;function le(i,e,r,s){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=s}function me(i,e,r,s){const c=new _e(i,e,r,s);return function(h){return c.solve(h)}}le.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,s=0;s<8;s++){var c=this.sampleCurveX(r)-i;if(Math.abs(c)<e)return r;var h=this.sampleCurveDerivativeX(r);if(Math.abs(h)<1e-6)break;r-=c/h}var d=0,m=1;for(r=i,s=0;s<20&&(c=this.sampleCurveX(r),!(Math.abs(c-i)<e));s++)i>c?d=r:m=r,r=.5*(m-d)+d;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};const pe=me(.25,.1,.25,1);function Y(i,e,r){return Math.min(r,Math.max(e,i))}function Ee(i,e,r){const s=r-e,c=((i-e)%s+s)%s+e;return c===e?r:c}function qe(i,...e){for(const r of e)for(const s in r)i[s]=r[s];return i}let be=1;function Ne(i,e){i.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function We(i,e,r){const s={};for(const c in i)s[c]=e.call(r||this,i[c],c,i);return s}function Tt(i,e,r){const s={};for(const c in i)e.call(r||this,i[c],c,i)&&(s[c]=i[c]);return s}function ht(i){return Array.isArray(i)?i.map(ht):typeof i=="object"&&i?We(i,ht):i}const At={};function st(i){At[i]||(typeof console<"u"&&console.warn(i),At[i]=!0)}function Qt(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function tt(i){let e=0;for(let r,s,c=0,h=i.length,d=h-1;c<h;d=c++)r=i[c],s=i[d],e+=(s.x-r.x)*(r.y+s.y);return e}function Ht(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Xt(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,s,c,h)=>{const d=c||h;return e[s]=!d||d.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let Kt,Mi,wt=null;function Si(i){if(wt==null){const e=i.navigator?i.navigator.userAgent:null;wt=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return wt}function Yi(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const $r={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){const r=window.document.createElement("canvas"),s=r.getContext("2d");if(!s)throw new Error("failed to create canvas 2d context");return r.width=i.width,r.height=i.height,s.drawImage(i,0,0,i.width,i.height),s.getImageData(-e,-e,i.width+2*e,i.height+2*e)},resolveURL:i=>(Kt||(Kt=document.createElement("a")),Kt.href=i,Kt.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Mi==null&&(Mi=matchMedia("(prefers-reduced-motion: reduce)")),Mi.matches)}};var Je=Er;function Er(i,e){this.x=i,this.y=e}Er.prototype={clone:function(){return new Er(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),s=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=s,this},_rotateAround:function(i,e){var r=Math.cos(i),s=Math.sin(i),c=e.y+s*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-s*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Er.convert=function(i){return i instanceof Er?i:Array.isArray(i)?new Er(i[0],i[1]):i};const Sr={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},or="mapbox-tiles";let ar,hn,Ln=500,Bn=50;function Rn(){typeof caches>"u"||ar||(ar=caches.open(or))}let mr=1/0;const qr={supported:!1,testSupport:function(i){!zi&&Zr&&(Fn?ps(i):Gr=i)}};let Gr,Zr,zi=!1,Fn=!1;function ps(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,Zr),i.isContextLost())return;qr.supported=!0}catch{}i.deleteTexture(e),zi=!0}typeof document<"u"&&(Zr=document.createElement("img"),Zr.onload=function(){Gr&&ps(Gr),Gr=null,Fn=!0},Zr.onerror=function(){zi=!0,Gr=null},Zr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ir={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Ir);class Fi extends Error{constructor(e,r,s,c){super(`AJAXError: ${r} (${e}): ${s}`),this.status=e,this.statusText=r,this.url=s,this.body=c}}const ds=Ht()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function jr(i,e){const r=new AbortController,s=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:ds(),signal:r.signal});let c=!1,h=!1;return i.type==="json"&&s.headers.set("Accept","application/json"),((d,m,g)=>{if(h)return;const x=Date.now();fetch(s).then(w=>w.ok?((E,A,z)=>{(i.type==="arrayBuffer"?E.arrayBuffer():i.type==="json"?E.json():E.text()).then(P=>{h||(A&&z&&function($,N,te){if(Rn(),!ar)return;const ae={status:N.status,statusText:N.statusText,headers:new Headers};N.headers.forEach((se,xe)=>ae.headers.set(xe,se));const ee=Xt(N.headers.get("Cache-Control")||"");ee["no-store"]||(ee["max-age"]&&ae.headers.set("Expires",new Date(te+1e3*ee["max-age"]).toUTCString()),new Date(ae.headers.get("Expires")).getTime()-te<42e4||function(se,xe){if(hn===void 0)try{new Response(new ReadableStream),hn=!0}catch{hn=!1}hn?xe(se.body):se.blob().then(xe)}(N,se=>{const xe=new Response(se,ae);Rn(),ar&&ar.then(ye=>ye.put(function(Fe){const Ve=Fe.indexOf("?");return Ve<0?Fe:Fe.slice(0,Ve)}($.url),xe)).catch(ye=>st(ye.message))}))}(s,A,z),c=!0,e(null,P,E.headers.get("Cache-Control"),E.headers.get("Expires")))}).catch(P=>{h||e(new Error(P.message))})})(w,null,x):w.blob().then(E=>e(new Fi(w.status,w.statusText,i.url,E)))).catch(w=>{w.code!==20&&e(new Error(w.message))})})(),{cancel:()=>{h=!0,c||r.abort()}}}const On=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(Ht()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!Ht()){const s=i.url.substring(0,i.url.indexOf("://"));return(Sr.REGISTERED_PROTOCOLS[s]||jr)(i,e)}}if(!(/^file:/.test(r=i.url)||/^file:/.test(ds())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return jr(i,e);if(Ht()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(s,c){const h=new XMLHttpRequest;h.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(const d in s.headers)h.setRequestHeader(d,s.headers[d]);return s.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=s.credentials==="include",h.onerror=()=>{c(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let d=h.response;if(s.type==="json")try{d=JSON.parse(h.response)}catch(m){return c(m)}c(null,d,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else{const d=new Blob([h.response],{type:h.getResponseHeader("Content-Type")});c(new Fi(h.status,h.statusText,s.url,d))}},h.send(s.body),{cancel:()=>h.abort()}}(i,e)},Un=function(i,e){return On(qe(i,{type:"arrayBuffer"}),e)};function fs(i){const e=window.document.createElement("a");return e.href=i,e.protocol===window.document.location.protocol&&e.host===window.document.location.host}const gt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let gr,Xr;gr=[],Xr=0;const Wr=function(i,e){if(qr.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),Xr>=Sr.MAX_PARALLEL_IMAGE_REQUESTS){const h={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return gr.push(h),h}Xr++;let r=!1;const s=()=>{if(!r)for(r=!0,Xr--;gr.length&&Xr<Sr.MAX_PARALLEL_IMAGE_REQUESTS;){const h=gr.shift(),{requestParameters:d,callback:m,cancelled:g}=h;g||(h.cancel=Wr(d,m).cancel)}},c=Un(i,(h,d,m,g)=>{s(),h?e(h):d&&function(x,w){typeof createImageBitmap=="function"?function(E,A){const z=new Blob([new Uint8Array(E)],{type:"image/png"});createImageBitmap(z).then(P=>{A(null,P)}).catch(P=>{A(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(x,w):function(E,A){const z=new Image;z.onload=()=>{A(null,z),URL.revokeObjectURL(z.src),z.onload=null,window.requestAnimationFrame(()=>{z.src=gt})},z.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new Blob([new Uint8Array(E)],{type:"image/png"});z.src=E.byteLength?URL.createObjectURL(P):gt}(x,w)}(d,(x,w)=>{x!=null?e(x):w!=null&&e(null,w,{cacheControl:m,expires:g})})});return{cancel:()=>{c.cancel(),s()}}};function ms(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function Ar(i,e,r){if(r&&r[i]){const s=r[i].indexOf(e);s!==-1&&r[i].splice(s,1)}}class Cr{constructor(e,r={}){qe(this,r),this.type=e}}class Vn extends Cr{constructor(e,r={}){super("error",qe({error:e},r))}}class kr{on(e,r){return this._listeners=this._listeners||{},ms(e,r,this._listeners),this}off(e,r){return Ar(e,r,this._listeners),Ar(e,r,this._oneTimeListeners),this}once(e,r){return this._oneTimeListeners=this._oneTimeListeners||{},ms(e,r,this._oneTimeListeners),this}fire(e,r){typeof e=="string"&&(e=new Cr(e,r||{}));const s=e.type;if(this.listens(s)){e.target=this;const c=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const m of c)m.call(this,e);const h=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const m of h)Ar(s,m,this._oneTimeListeners),m.call(this,e);const d=this._eventedParent;d&&(qe(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),d.fire(e))}else e instanceof Vn&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var ge={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class ke{constructor(e,r,s,c){this.message=(e?`${e}: `:"")+s,c&&(this.identifier=c),r!=null&&r.__line__&&(this.line=r.__line__)}}function pn(i){const e=i.value;return e?[new ke(i.key,e,"constants have been deprecated as of v8")]:[]}function lr(i,...e){for(const r of e)for(const s in r)i[s]=r[s];return i}function _t(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Ji(i){if(Array.isArray(i))return i.map(Ji);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=Ji(i[r]);return e}return _t(i)}class Oi extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Ui{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[s,c]of r)this.bindings[s]=c}concat(e){return new Ui(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Hr={kind:"null"},Ie={kind:"number"},ot={kind:"string"},it={kind:"boolean"},_i={kind:"color"},Kr={kind:"object"},et={kind:"value"},Mr={kind:"collator"},ci={kind:"formatted"},Nn={kind:"padding"},ti={kind:"resolvedImage"};function Ii(i,e){return{kind:"array",itemType:i,N:e}}function zt(i){if(i.kind==="array"){const e=zt(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const $n=[Hr,Ie,ot,it,_i,ci,Kr,Ii(et),Nn,ti];function _r(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!_r(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of $n)if(!_r(r,e))return null}}return`Expected ${zt(i)} but found ${zt(e)} instead.`}function dn(i,e){return e.some(r=>r.kind===i.kind)}function fn(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}var qn,mn={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function B(i){return(i=Math.round(i))<0?0:i>255?255:i}function b(i){return B(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function S(i){return(e=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:e>1?1:e;var e}function D(i,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?i+(e-i)*r*6:2*r<1?e:3*r<2?i+(e-i)*(2/3-r)*6:i}try{qn={}.parseCSSColor=function(i){var e,r=i.replace(/ /g,"").toLowerCase();if(r in mn)return mn[r].slice();if(r[0]==="#")return r.length===4?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:r.length===7&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var s=r.indexOf("("),c=r.indexOf(")");if(s!==-1&&c+1===r.length){var h=r.substr(0,s),d=r.substr(s+1,c-(s+1)).split(","),m=1;switch(h){case"rgba":if(d.length!==4)return null;m=S(d.pop());case"rgb":return d.length!==3?null:[b(d[0]),b(d[1]),b(d[2]),m];case"hsla":if(d.length!==4)return null;m=S(d.pop());case"hsl":if(d.length!==3)return null;var g=(parseFloat(d[0])%360+360)%360/360,x=S(d[1]),w=S(d[2]),E=w<=.5?w*(x+1):w+x-w*x,A=2*w-E;return[B(255*D(A,E,g+1/3)),B(255*D(A,E,g)),B(255*D(A,E,g-1/3)),m];default:return null}}return null}}catch{}class L{constructor(e,r,s,c=1){this.r=e,this.g=r,this.b=s,this.a=c}static parse(e){if(!e)return;if(e instanceof L)return e;if(typeof e!="string")return;const r=qn(e);return r?new L(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,s,c]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(s)},${c})`}toArray(){const{r:e,g:r,b:s,a:c}=this;return c===0?[0,0,0,0]:[255*e/c,255*r/c,255*s/c,c]}}L.black=new L(0,0,0,1),L.white=new L(1,1,1,1),L.transparent=new L(0,0,0,0),L.red=new L(1,0,0,1);class Z{constructor(e,r,s){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class K{constructor(e,r,s,c,h){this.text=e,this.image=r,this.scale=s,this.fontStack=c,this.textColor=h}}class W{constructor(e){this.sections=e}static fromString(e){return new W([new K(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof W?e:W.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class j{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof j)return e;if(typeof e=="number")return new j([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new j(e)}}toString(){return JSON.stringify(this.values)}}class J{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new J({name:e,available:!1}):null}}function ue(i,e,r,s){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[i,e,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[i,e,r,s]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ve(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof L||i instanceof Z||i instanceof W||i instanceof j||i instanceof J)return!0;if(Array.isArray(i)){for(const e of i)if(!ve(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!ve(i[e]))return!1;return!0}return!1}function ce(i){if(i===null)return Hr;if(typeof i=="string")return ot;if(typeof i=="boolean")return it;if(typeof i=="number")return Ie;if(i instanceof L)return _i;if(i instanceof Z)return Mr;if(i instanceof W)return ci;if(i instanceof j)return Nn;if(i instanceof J)return ti;if(Array.isArray(i)){const e=i.length;let r;for(const s of i){const c=ce(s);if(r){if(r===c)continue;r=et;break}r=c}return Ii(r||et,e)}return Kr}function Ue(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof L||i instanceof W||i instanceof j||i instanceof J?i.toString():JSON.stringify(i)}class $e{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ve(e[1]))return r.error("invalid value");const s=e[1];let c=ce(s);const h=r.expectedType;return c.kind!=="array"||c.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(c=h),new $e(c,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Le{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const He={string:ot,number:Ie,boolean:it,object:Kr};class Ye{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let s,c=1;const h=e[0];if(h==="array"){let m,g;if(e.length>2){const x=e[1];if(typeof x!="string"||!(x in He)||x==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);m=He[x],c++}else m=et;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);g=e[2],c++}s=Ii(m,g)}else{if(!He[h])throw new Error(`Types doesn't contain name = ${h}`);s=He[h]}const d=[];for(;c<e.length;c++){const m=r.parse(e[c],c,et);if(!m)return null;d.push(m)}return new Ye(s,d)}evaluate(e){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(e);if(!_r(this.type,ce(s)))return s;if(r===this.args.length-1)throw new Le(`Expected value to be of type ${zt(this.type)}, but found ${zt(ce(s))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const yt={"to-boolean":it,"to-color":_i,"to-number":Ie,"to-string":ot};class Qe{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[0];if(!yt[s])throw new Error(`Can't parse ${s} as it is not part of the known types`);if((s==="to-boolean"||s==="to-string")&&e.length!==2)return r.error("Expected one argument.");const c=yt[s],h=[];for(let d=1;d<e.length;d++){const m=r.parse(e[d],d,et);if(!m)return null;h.push(m)}return new Qe(c,h)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let r,s;for(const c of this.args){if(r=c.evaluate(e),s=null,r instanceof L)return r;if(typeof r=="string"){const h=e.parseColor(r);if(h)return h}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:ue(r[0],r[1],r[2],r[3]),!s))return new L(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Le(s||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}if(this.type.kind==="padding"){let r;for(const s of this.args){r=s.evaluate(e);const c=j.parse(r);if(c)return c}throw new Le(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}if(this.type.kind==="number"){let r=null;for(const s of this.args){if(r=s.evaluate(e),r===null)return 0;const c=Number(r);if(!isNaN(c))return c}throw new Le(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?W.fromString(Ue(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?J.fromString(Ue(this.args[0].evaluate(e))):Ue(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const at=["Unknown","Point","LineString","Polygon"];class xt{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?at[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=L.parse(e)),r}}class Bt{constructor(e,r,s,c){this.name=e,this.type=r,this._evaluate=s,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const s=e[0],c=Bt.definitions[s];if(!c)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(c)?c[0]:c.type,d=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,m=d.filter(([x])=>!Array.isArray(x)||x.length===e.length-1);let g=null;for(const[x,w]of m){g=new jn(r.registry,r.path,null,r.scope);const E=[];let A=!1;for(let z=1;z<e.length;z++){const P=e[z],$=Array.isArray(x)?x[z-1]:x.type,N=g.parse(P,1+E.length,$);if(!N){A=!0;break}E.push(N)}if(!A)if(Array.isArray(x)&&x.length!==E.length)g.error(`Expected ${x.length} arguments, but found ${E.length} instead.`);else{for(let z=0;z<E.length;z++){const P=Array.isArray(x)?x[z]:x.type,$=E[z];g.concat(z+1).checkSubtype(P,$.type)}if(g.errors.length===0)return new Bt(s,h,w,E)}}if(m.length===1)r.errors.push(...g.errors);else{const x=(m.length?m:d).map(([E])=>{return A=E,Array.isArray(A)?`(${A.map(zt).join(", ")})`:`(${zt(A.type)}...)`;var A}).join(" | "),w=[];for(let E=1;E<e.length;E++){const A=r.parse(e[E],1+w.length);if(!A)return null;w.push(zt(A.type))}r.error(`Expected arguments of type ${x}, but found (${w.join(", ")}) instead.`)}return null}static register(e,r){Bt.definitions=r;for(const s in r)e[s]=Bt}}class ui{constructor(e,r,s){this.type=Mr,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return r.error("Collator options argument must be an object.");const c=r.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,it);if(!c)return null;const h=r.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,it);if(!h)return null;let d=null;return s.locale&&(d=r.parse(s.locale,1,ot),!d)?null:new ui(c,h,d)}evaluate(e){return new Z(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const Nt=8192;function vi(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Gn(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function gs(i,e){const r=(180+i[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(r*c*Nt),Math.round(s*c*Nt)]}function Rt(i,e,r){const s=i[0]-e[0],c=i[1]-e[1],h=i[0]-r[0],d=i[1]-r[1];return s*d-h*c==0&&s*h<=0&&c*d<=0}function zo(i,e){let r=!1;for(let d=0,m=e.length;d<m;d++){const g=e[d];for(let x=0,w=g.length;x<w-1;x++){if(Rt(i,g[x],g[x+1]))return!1;(c=g[x])[1]>(s=i)[1]!=(h=g[x+1])[1]>s[1]&&s[0]<(h[0]-c[0])*(s[1]-c[1])/(h[1]-c[1])+c[0]&&(r=!r)}}var s,c,h;return r}function Po(i,e){for(let r=0;r<e.length;r++)if(zo(i,e[r]))return!0;return!1}function Ua(i,e,r,s){const c=s[0]-r[0],h=s[1]-r[1],d=(i[0]-r[0])*h-c*(i[1]-r[1]),m=(e[0]-r[0])*h-c*(e[1]-r[1]);return d>0&&m<0||d<0&&m>0}function Va(i,e,r){for(const x of r)for(let w=0;w<x.length-1;++w)if((m=[(d=x[w+1])[0]-(h=x[w])[0],d[1]-h[1]])[0]*(g=[(c=e)[0]-(s=i)[0],c[1]-s[1]])[1]-m[1]*g[0]!=0&&Ua(s,c,h,d)&&Ua(h,d,s,c))return!0;var s,c,h,d,m,g;return!1}function Do(i,e){for(let r=0;r<i.length;++r)if(!zo(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(Va(i[r],i[r+1],e))return!1;return!0}function nc(i,e){for(let r=0;r<e.length;r++)if(Do(i,e[r]))return!0;return!1}function Xs(i,e,r){const s=[];for(let c=0;c<i.length;c++){const h=[];for(let d=0;d<i[c].length;d++){const m=gs(i[c][d],r);vi(e,m),h.push(m)}s.push(h)}return s}function Lo(i,e,r){const s=[];for(let c=0;c<i.length;c++){const h=Xs(i[c],e,r);s.push(h)}return s}function Na(i,e,r,s){if(i[0]<r[0]||i[0]>r[2]){const c=.5*s;let h=i[0]-r[0]>c?-s:r[0]-i[0]>c?s:0;h===0&&(h=i[0]-r[2]>c?-s:r[2]-i[0]>c?s:0),i[0]+=h}vi(e,i)}function $a(i,e,r,s){const c=Math.pow(2,s.z)*Nt,h=[s.x*Nt,s.y*Nt],d=[];for(const m of i)for(const g of m){const x=[g.x+h[0],g.y+h[1]];Na(x,e,r,c),d.push(x)}return d}function qa(i,e,r,s){const c=Math.pow(2,s.z)*Nt,h=[s.x*Nt,s.y*Nt],d=[];for(const g of i){const x=[];for(const w of g){const E=[w.x+h[0],w.y+h[1]];vi(e,E),x.push(E)}d.push(x)}if(e[2]-e[0]<=c/2){(m=e)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(const g of d)for(const x of g)Na(x,e,r,c)}var m;return d}class gn{constructor(e,r){this.type=it,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ve(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let c=0;c<s.features.length;++c){const h=s.features[c].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new gn(s,s.features[c].geometry)}else if(s.type==="Feature"){const c=s.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new gn(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new gn(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,s){const c=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],d=r.canonicalID();if(s.type==="Polygon"){const m=Xs(s.coordinates,h,d),g=$a(r.geometry(),c,h,d);if(!Gn(c,h))return!1;for(const x of g)if(!zo(x,m))return!1}if(s.type==="MultiPolygon"){const m=Lo(s.coordinates,h,d),g=$a(r.geometry(),c,h,d);if(!Gn(c,h))return!1;for(const x of g)if(!Po(x,m))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,s){const c=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],d=r.canonicalID();if(s.type==="Polygon"){const m=Xs(s.coordinates,h,d),g=qa(r.geometry(),c,h,d);if(!Gn(c,h))return!1;for(const x of g)if(!Do(x,m))return!1}if(s.type==="MultiPolygon"){const m=Lo(s.coordinates,h,d),g=qa(r.geometry(),c,h,d);if(!Gn(c,h))return!1;for(const x of g)if(!nc(x,m))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function _s(i){if(i instanceof Bt&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof gn)return!1;let e=!0;return i.eachChild(r=>{e&&!_s(r)&&(e=!1)}),e}function Zn(i){if(i instanceof Bt&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!Zn(r)&&(e=!1)}),e}function Ws(i,e){if(i instanceof Bt&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(s=>{r&&!Ws(s,e)&&(r=!1)}),r}class Hs{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const s=e[1];return r.scope.has(s)?new Hs(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class jn{constructor(e,r=[],s,c=new Ui,h=[]){this.registry=e,this.path=r,this.key=r.map(d=>`[${d}]`).join(""),this.scope=c,this.errors=h,this.expectedType=s}parse(e,r,s,c,h={}){return r?this.concat(r,s,c)._parse(e,h):this._parse(e,h)}_parse(e,r){function s(c,h,d){return d==="assert"?new Ye(h,[c]):d==="coerce"?new Qe(h,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const h=this.registry[c];if(h){let d=h.parse(e,this);if(!d)return null;if(this.expectedType){const m=this.expectedType,g=d.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||g.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||g.kind!=="value"&&g.kind!=="string")if(m.kind!=="padding"||g.kind!=="value"&&g.kind!=="number"&&g.kind!=="array"){if(this.checkSubtype(m,g))return null}else d=s(d,m,r.typeAnnotation||"coerce");else d=s(d,m,r.typeAnnotation||"coerce");else d=s(d,m,r.typeAnnotation||"assert")}if(!(d instanceof $e)&&d.type.kind!=="resolvedImage"&&Bo(d)){const m=new xt;try{d=new $e(d.type,d.evaluate(m))}catch(g){return this.error(g.message),null}}return d}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,s){const c=typeof e=="number"?this.path.concat(e):this.path,h=s?this.scope.concat(s):this.scope;return new jn(this.registry,c,r||null,h,this.errors)}error(e,...r){const s=`${this.key}${r.map(c=>`[${c}]`).join("")}`;this.errors.push(new Oi(s,e))}checkSubtype(e,r){const s=_r(e,r);return s&&this.error(s),s}}function Bo(i){if(i instanceof Hs)return Bo(i.boundExpression);if(i instanceof Bt&&i.name==="error"||i instanceof ui||i instanceof gn)return!1;const e=i instanceof Qe||i instanceof Ye;let r=!0;return i.eachChild(s=>{r=e?r&&Bo(s):r&&s instanceof $e}),!!r&&_s(i)&&Ws(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ks(i,e){const r=i.length-1;let s,c,h=0,d=r,m=0;for(;h<=d;)if(m=Math.floor((h+d)/2),s=i[m],c=i[m+1],s<=e){if(m===r||e<c)return m;h=m+1}else{if(!(s>e))throw new Le("Input is not a number.");d=m-1}return 0}class ys{constructor(e,r,s){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[c,h]of s)this.labels.push(c),this.outputs.push(h)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(e[1],1,Ie);if(!s)return null;const c=[];let h=null;r.expectedType&&r.expectedType.kind!=="value"&&(h=r.expectedType);for(let d=1;d<e.length;d+=2){const m=d===1?-1/0:e[d],g=e[d+1],x=d,w=d+1;if(typeof m!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',x);if(c.length&&c[c.length-1][0]>=m)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',x);const E=r.parse(g,w,h);if(!E)return null;h=h||E.type,c.push([m,E])}return new ys(h,s,c)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=r[0])return s[0].evaluate(e);const h=r.length;return c>=r[h-1]?s[h-1].evaluate(e):s[Ks(r,c)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function $t(i,e,r){return i*(1-r)+e*r}var xs=Object.freeze({__proto__:null,number:$t,color:function(i,e,r){return new L($t(i.r,e.r,r),$t(i.g,e.g,r),$t(i.b,e.b,r),$t(i.a,e.a,r))},array:function(i,e,r){return i.map((s,c)=>$t(s,e[c],r))},padding:function(i,e,r){const s=i.values,c=e.values;return new j([$t(s[0],c[0],r),$t(s[1],c[1],r),$t(s[2],c[2],r),$t(s[3],c[3],r)])}});const Ga=.95047,Za=1.08883,Ro=4/29,Ys=6/29,ja=3*Ys*Ys,sc=Math.PI/180,oc=180/Math.PI;function Fo(i){return i>.008856451679035631?Math.pow(i,1/3):i/ja+Ro}function Oo(i){return i>Ys?i*i*i:ja*(i-Ro)}function Uo(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function Vo(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Et(i){const e=Vo(i.r),r=Vo(i.g),s=Vo(i.b),c=Fo((.4124564*e+.3575761*r+.1804375*s)/Ga),h=Fo((.2126729*e+.7151522*r+.072175*s)/1);return{l:116*h-16,a:500*(c-h),b:200*(h-Fo((.0193339*e+.119192*r+.9503041*s)/Za)),alpha:i.a}}function Xa(i){let e=(i.l+16)/116,r=isNaN(i.a)?e:e+i.a/500,s=isNaN(i.b)?e:e-i.b/200;return e=1*Oo(e),r=Ga*Oo(r),s=Za*Oo(s),new L(Uo(3.2404542*r-1.5371385*e-.4985314*s),Uo(-.969266*r+1.8760108*e+.041556*s),Uo(.0556434*r-.2040259*e+1.0572252*s),i.alpha)}function ac(i,e,r){const s=e-i;return i+r*(s>180||s<-180?s-360*Math.round(s/360):s)}const vs={forward:Et,reverse:Xa,interpolate:function(i,e,r){return{l:$t(i.l,e.l,r),a:$t(i.a,e.a,r),b:$t(i.b,e.b,r),alpha:$t(i.alpha,e.alpha,r)}}},bs={forward:function(i){const{l:e,a:r,b:s}=Et(i),c=Math.atan2(s,r)*oc;return{h:c<0?c+360:c,c:Math.sqrt(r*r+s*s),l:e,alpha:i.a}},reverse:function(i){const e=i.h*sc,r=i.c;return Xa({l:i.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:i.alpha})},interpolate:function(i,e,r){return{h:ac(i.h,e.h,r),c:$t(i.c,e.c,r),l:$t(i.l,e.l,r),alpha:$t(i.alpha,e.alpha,r)}}};var Wa=Object.freeze({__proto__:null,lab:vs,hcl:bs});class Vi{constructor(e,r,s,c,h){this.type=e,this.operator=r,this.interpolation=s,this.input=c,this.labels=[],this.outputs=[];for(const[d,m]of h)this.labels.push(d),this.outputs.push(m)}static interpolationFactor(e,r,s,c){let h=0;if(e.name==="exponential")h=No(r,e.base,s,c);else if(e.name==="linear")h=No(r,1,s,c);else if(e.name==="cubic-bezier"){const d=e.controlPoints;h=new _e(d[0],d[1],d[2],d[3]).solve(No(r,1,s,c))}return h}static parse(e,r){let[s,c,h,...d]=e;if(!Array.isArray(c)||c.length===0)return r.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const x=c[1];if(typeof x!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:x}}else{if(c[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const x=c.slice(1);if(x.length!==4||x.some(w=>typeof w!="number"||w<0||w>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:x}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(h=r.parse(h,2,Ie),!h)return null;const m=[];let g=null;s==="interpolate-hcl"||s==="interpolate-lab"?g=_i:r.expectedType&&r.expectedType.kind!=="value"&&(g=r.expectedType);for(let x=0;x<d.length;x+=2){const w=d[x],E=d[x+1],A=x+3,z=x+4;if(typeof w!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(m.length&&m[m.length-1][0]>=w)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',A);const P=r.parse(E,z,g);if(!P)return null;g=g||P.type,m.push([w,P])}return g.kind==="number"||g.kind==="color"||g.kind==="padding"||g.kind==="array"&&g.itemType.kind==="number"&&typeof g.N=="number"?new Vi(g,s,c,h,m):r.error(`Type ${zt(g)} is not interpolatable.`)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=r[0])return s[0].evaluate(e);const h=r.length;if(c>=r[h-1])return s[h-1].evaluate(e);const d=Ks(r,c),m=Vi.interpolationFactor(this.interpolation,c,r[d],r[d+1]),g=s[d].evaluate(e),x=s[d+1].evaluate(e);return this.operator==="interpolate"?xs[this.type.kind.toLowerCase()](g,x,m):this.operator==="interpolate-hcl"?bs.reverse(bs.interpolate(bs.forward(g),bs.forward(x),m)):vs.reverse(vs.interpolate(vs.forward(g),vs.forward(x),m))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function No(i,e,r,s){const c=s-r,h=i-r;return c===0?0:e===1?h/c:(Math.pow(e,h)-1)/(Math.pow(e,c)-1)}class Js{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let s=null;const c=r.expectedType;c&&c.kind!=="value"&&(s=c);const h=[];for(const m of e.slice(1)){const g=r.parse(m,1+h.length,s,void 0,{typeAnnotation:"omit"});if(!g)return null;s=s||g.type,h.push(g)}if(!s)throw new Error("No output type");const d=c&&h.some(m=>_r(c,m.type));return new Js(d?et:s,h)}evaluate(e){let r,s=null,c=0;for(const h of this.args)if(c++,s=h.evaluate(e),s&&s instanceof J&&!s.available&&(r||(r=s.name),s=null,c===this.args.length&&(s=r)),s!==null)break;return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class Qs{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let h=1;h<e.length-1;h+=2){const d=e[h];if(typeof d!="string")return r.error(`Expected string, but found ${typeof d} instead.`,h);if(/[^a-zA-Z0-9_]/.test(d))return r.error("Variable names must contain only alphanumeric characters or '_'.",h);const m=r.parse(e[h+1],h+1);if(!m)return null;s.push([d,m])}const c=r.parse(e[e.length-1],e.length-1,r.expectedType,s);return c?new Qs(s,c):null}outputDefined(){return this.result.outputDefined()}}class $o{constructor(e,r,s){this.type=e,this.index=r,this.input=s}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Ie),c=r.parse(e[2],2,Ii(r.expectedType||et));return s&&c?new $o(c.type.itemType,s,c):null}evaluate(e){const r=this.index.evaluate(e),s=this.input.evaluate(e);if(r<0)throw new Le(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new Le(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new Le(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class qo{constructor(e,r){this.type=it,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,et),c=r.parse(e[2],2,et);return s&&c?dn(s.type,[it,ot,Ie,Hr,et])?new qo(s,c):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${zt(s.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!s)return!1;if(!fn(r,["boolean","string","number","null"]))throw new Le(`Expected first argument to be of type boolean, string, number or null, but found ${zt(ce(r))} instead.`);if(!fn(s,["string","array"]))throw new Le(`Expected second argument to be of type array or string, but found ${zt(ce(s))} instead.`);return s.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class eo{constructor(e,r,s){this.type=Ie,this.needle=e,this.haystack=r,this.fromIndex=s}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,et),c=r.parse(e[2],2,et);if(!s||!c)return null;if(!dn(s.type,[it,ot,Ie,Hr,et]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${zt(s.type)} instead`);if(e.length===4){const h=r.parse(e[3],3,Ie);return h?new eo(s,c,h):null}return new eo(s,c)}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!fn(r,["boolean","string","number","null"]))throw new Le(`Expected first argument to be of type boolean, string, number or null, but found ${zt(ce(r))} instead.`);if(!fn(s,["string","array"]))throw new Le(`Expected second argument to be of type array or string, but found ${zt(ce(s))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return s.indexOf(r,c)}return s.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Go{constructor(e,r,s,c,h,d){this.inputType=e,this.type=r,this.input=s,this.cases=c,this.outputs=h,this.otherwise=d}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let s,c;r.expectedType&&r.expectedType.kind!=="value"&&(c=r.expectedType);const h={},d=[];for(let x=2;x<e.length-1;x+=2){let w=e[x];const E=e[x+1];Array.isArray(w)||(w=[w]);const A=r.concat(x);if(w.length===0)return A.error("Expected at least one branch label.");for(const P of w){if(typeof P!="number"&&typeof P!="string")return A.error("Branch labels must be numbers or strings.");if(typeof P=="number"&&Math.abs(P)>Number.MAX_SAFE_INTEGER)return A.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof P=="number"&&Math.floor(P)!==P)return A.error("Numeric branch labels must be integer values.");if(s){if(A.checkSubtype(s,ce(P)))return null}else s=ce(P);if(h[String(P)]!==void 0)return A.error("Branch labels must be unique.");h[String(P)]=d.length}const z=r.parse(E,x,c);if(!z)return null;c=c||z.type,d.push(z)}const m=r.parse(e[1],1,et);if(!m)return null;const g=r.parse(e[e.length-1],e.length-1,c);return g?m.type.kind!=="value"&&r.concat(1).checkSubtype(s,m.type)?null:new Go(s,c,m,h,d,g):null}evaluate(e){const r=this.input.evaluate(e);return(ce(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class Zo{constructor(e,r,s){this.type=e,this.branches=r,this.otherwise=s}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const c=[];for(let d=1;d<e.length-1;d+=2){const m=r.parse(e[d],d,it);if(!m)return null;const g=r.parse(e[d+1],d+1,s);if(!g)return null;c.push([m,g]),s=s||g.type}const h=r.parse(e[e.length-1],e.length-1,s);if(!h)return null;if(!s)throw new Error("Can't infer output type");return new Zo(s,c,h)}evaluate(e){for(const[r,s]of this.branches)if(r.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,s]of this.branches)e(r),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class to{constructor(e,r,s,c){this.type=e,this.input=r,this.beginIndex=s,this.endIndex=c}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,et),c=r.parse(e[2],2,Ie);if(!s||!c)return null;if(!dn(s.type,[Ii(et),ot,et]))return r.error(`Expected first argument to be of type array or string, but found ${zt(s.type)} instead`);if(e.length===4){const h=r.parse(e[3],3,Ie);return h?new to(s.type,s,c,h):null}return new to(s.type,s,c)}evaluate(e){const r=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!fn(r,["string","array"]))throw new Le(`Expected first argument to be of type array or string, but found ${zt(ce(r))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return r.slice(s,c)}return r.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Ha(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Ka(i,e,r,s){return s.compare(e,r)===0}function Xn(i,e,r){const s=i!=="=="&&i!=="!=";return class yp{constructor(h,d,m){this.type=it,this.lhs=h,this.rhs=d,this.collator=m,this.hasUntypedArgument=h.type.kind==="value"||d.type.kind==="value"}static parse(h,d){if(h.length!==3&&h.length!==4)return d.error("Expected two or three arguments.");const m=h[0];let g=d.parse(h[1],1,et);if(!g)return null;if(!Ha(m,g.type))return d.concat(1).error(`"${m}" comparisons are not supported for type '${zt(g.type)}'.`);let x=d.parse(h[2],2,et);if(!x)return null;if(!Ha(m,x.type))return d.concat(2).error(`"${m}" comparisons are not supported for type '${zt(x.type)}'.`);if(g.type.kind!==x.type.kind&&g.type.kind!=="value"&&x.type.kind!=="value")return d.error(`Cannot compare types '${zt(g.type)}' and '${zt(x.type)}'.`);s&&(g.type.kind==="value"&&x.type.kind!=="value"?g=new Ye(x.type,[g]):g.type.kind!=="value"&&x.type.kind==="value"&&(x=new Ye(g.type,[x])));let w=null;if(h.length===4){if(g.type.kind!=="string"&&x.type.kind!=="string"&&g.type.kind!=="value"&&x.type.kind!=="value")return d.error("Cannot use collator to compare non-string types.");if(w=d.parse(h[3],3,Mr),!w)return null}return new yp(g,x,w)}evaluate(h){const d=this.lhs.evaluate(h),m=this.rhs.evaluate(h);if(s&&this.hasUntypedArgument){const g=ce(d),x=ce(m);if(g.kind!==x.kind||g.kind!=="string"&&g.kind!=="number")throw new Le(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${g.kind}, ${x.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const g=ce(d),x=ce(m);if(g.kind!=="string"||x.kind!=="string")return e(h,d,m)}return this.collator?r(h,d,m,this.collator.evaluate(h)):e(h,d,m)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}}}const lc=Xn("==",function(i,e,r){return e===r},Ka),cc=Xn("!=",function(i,e,r){return e!==r},function(i,e,r,s){return!Ka(0,e,r,s)}),uc=Xn("<",function(i,e,r){return e<r},function(i,e,r,s){return s.compare(e,r)<0}),hc=Xn(">",function(i,e,r){return e>r},function(i,e,r,s){return s.compare(e,r)>0}),pc=Xn("<=",function(i,e,r){return e<=r},function(i,e,r,s){return s.compare(e,r)<=0}),dc=Xn(">=",function(i,e,r){return e>=r},function(i,e,r,s){return s.compare(e,r)>=0});class jo{constructor(e,r,s,c,h){this.type=ot,this.number=e,this.locale=r,this.currency=s,this.minFractionDigits=c,this.maxFractionDigits=h}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const s=r.parse(e[1],1,Ie);if(!s)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return r.error("NumberFormat options argument must be an object.");let h=null;if(c.locale&&(h=r.parse(c.locale,1,ot),!h))return null;let d=null;if(c.currency&&(d=r.parse(c.currency,1,ot),!d))return null;let m=null;if(c["min-fraction-digits"]&&(m=r.parse(c["min-fraction-digits"],1,Ie),!m))return null;let g=null;return c["max-fraction-digits"]&&(g=r.parse(c["max-fraction-digits"],1,Ie),!g)?null:new jo(s,h,d,m,g)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class io{constructor(e){this.type=ci,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return r.error("First argument must be an image or text section.");const c=[];let h=!1;for(let d=1;d<=e.length-1;++d){const m=e[d];if(h&&typeof m=="object"&&!Array.isArray(m)){h=!1;let g=null;if(m["font-scale"]&&(g=r.parse(m["font-scale"],1,Ie),!g))return null;let x=null;if(m["text-font"]&&(x=r.parse(m["text-font"],1,Ii(ot)),!x))return null;let w=null;if(m["text-color"]&&(w=r.parse(m["text-color"],1,_i),!w))return null;const E=c[c.length-1];E.scale=g,E.font=x,E.textColor=w}else{const g=r.parse(e[d],1,et);if(!g)return null;const x=g.type.kind;if(x!=="string"&&x!=="value"&&x!=="null"&&x!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,c.push({content:g,scale:null,font:null,textColor:null})}}return new io(c)}evaluate(e){return new W(this.sections.map(r=>{const s=r.content.evaluate(e);return ce(s)===ti?new K("",s,null,null,null):new K(Ue(s),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}}class Xo{constructor(e){this.type=ti,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const s=r.parse(e[1],1,ot);return s?new Xo(s):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),s=J.fromString(r);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(r)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}}class Wo{constructor(e){this.type=Ie,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=r.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${zt(s.type)} instead.`):new Wo(s):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Le(`Expected value to be of type string or array, but found ${zt(ce(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Wn={"==":lc,"!=":cc,">":hc,"<":uc,">=":dc,"<=":pc,array:Ye,at:$o,boolean:Ye,case:Zo,coalesce:Js,collator:ui,format:io,image:Xo,in:qo,"index-of":eo,interpolate:Vi,"interpolate-hcl":Vi,"interpolate-lab":Vi,length:Wo,let:Qs,literal:$e,match:Go,number:Ye,"number-format":jo,object:Ye,slice:to,step:ys,string:Ye,"to-boolean":Qe,"to-color":Qe,"to-number":Qe,"to-string":Qe,var:Hs,within:gn};function Ya(i,[e,r,s,c]){e=e.evaluate(i),r=r.evaluate(i),s=s.evaluate(i);const h=c?c.evaluate(i):1,d=ue(e,r,s,h);if(d)throw new Le(d);return new L(e/255*h,r/255*h,s/255*h,h)}function Ja(i,e){return i in e}function ro(i,e){const r=e[i];return r===void 0?null:r}function _n(i){return{type:i}}function Qa(i){return{result:"success",value:i}}function Hn(i){return{result:"error",value:i}}function Ut(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function el(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function ft(i){return!!i.expression&&i.expression.interpolated}function St(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Ot(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function qt(i){return i}function ws(i,e){const r=e.type==="color",s=i.stops&&typeof i.stops[0][0]=="object",c=s||!(s||i.property!==void 0),h=i.type||(ft(e)?"exponential":"interval");if(r||e.type==="padding"){const x=r?L.parse:j.parse;(i=lr({},i)).stops&&(i.stops=i.stops.map(w=>[w[0],x(w[1])])),i.default=x(i.default?i.default:e.default)}if(i.colorSpace&&i.colorSpace!=="rgb"&&!Wa[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let d,m,g;if(h==="exponential")d=tl;else if(h==="interval")d=mc;else if(h==="categorical"){d=fc,m=Object.create(null);for(const x of i.stops)m[x[0]]=x[1];g=typeof i.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);d=gc}if(s){const x={},w=[];for(let z=0;z<i.stops.length;z++){const P=i.stops[z],$=P[0].zoom;x[$]===void 0&&(x[$]={zoom:$,type:i.type,property:i.property,default:i.default,stops:[]},w.push($)),x[$].stops.push([P[0].value,P[1]])}const E=[];for(const z of w)E.push([x[z].zoom,ws(x[z],e)]);const A={name:"linear"};return{kind:"composite",interpolationType:A,interpolationFactor:Vi.interpolationFactor.bind(void 0,A),zoomStops:E.map(z=>z[0]),evaluate:({zoom:z},P)=>tl({stops:E,base:i.base},e,z).evaluate(z,P)}}if(c){const x=h==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:x,interpolationFactor:Vi.interpolationFactor.bind(void 0,x),zoomStops:i.stops.map(w=>w[0]),evaluate:({zoom:w})=>d(i,e,w,m,g)}}return{kind:"source",evaluate(x,w){const E=w&&w.properties?w.properties[i.property]:void 0;return E===void 0?Kn(i.default,e.default):d(i,e,E,m,g)}}}function Kn(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function fc(i,e,r,s,c){return Kn(typeof r===c?s[r]:void 0,i.default,e.default)}function mc(i,e,r){if(St(r)!=="number")return Kn(i.default,e.default);const s=i.stops.length;if(s===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[s-1][0])return i.stops[s-1][1];const c=Ks(i.stops.map(h=>h[0]),r);return i.stops[c][1]}function tl(i,e,r){const s=i.base!==void 0?i.base:1;if(St(r)!=="number")return Kn(i.default,e.default);const c=i.stops.length;if(c===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[c-1][0])return i.stops[c-1][1];const h=Ks(i.stops.map(w=>w[0]),r),d=function(w,E,A,z){const P=z-A,$=w-A;return P===0?0:E===1?$/P:(Math.pow(E,$)-1)/(Math.pow(E,P)-1)}(r,s,i.stops[h][0],i.stops[h+1][0]),m=i.stops[h][1],g=i.stops[h+1][1];let x=xs[e.type]||qt;if(i.colorSpace&&i.colorSpace!=="rgb"){const w=Wa[i.colorSpace];x=(E,A)=>w.reverse(w.interpolate(w.forward(E),w.forward(A),d))}return typeof m.evaluate=="function"?{evaluate(...w){const E=m.evaluate.apply(void 0,w),A=g.evaluate.apply(void 0,w);if(E!==void 0&&A!==void 0)return x(E,A,d)}}:x(m,g,d)}function gc(i,e,r){switch(e.type){case"color":r=L.parse(r);break;case"formatted":r=W.fromString(r.toString());break;case"resolvedImage":r=J.fromString(r.toString());break;case"padding":r=j.parse(r);break;default:St(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return Kn(r,i.default,e.default)}Bt.register(Wn,{error:[{kind:"error"},[ot],(i,[e])=>{throw new Le(e.evaluate(i))}],typeof:[ot,[et],(i,[e])=>zt(ce(e.evaluate(i)))],"to-rgba":[Ii(Ie,4),[_i],(i,[e])=>e.evaluate(i).toArray()],rgb:[_i,[Ie,Ie,Ie],Ya],rgba:[_i,[Ie,Ie,Ie,Ie],Ya],has:{type:it,overloads:[[[ot],(i,[e])=>Ja(e.evaluate(i),i.properties())],[[ot,Kr],(i,[e,r])=>Ja(e.evaluate(i),r.evaluate(i))]]},get:{type:et,overloads:[[[ot],(i,[e])=>ro(e.evaluate(i),i.properties())],[[ot,Kr],(i,[e,r])=>ro(e.evaluate(i),r.evaluate(i))]]},"feature-state":[et,[ot],(i,[e])=>ro(e.evaluate(i),i.featureState||{})],properties:[Kr,[],i=>i.properties()],"geometry-type":[ot,[],i=>i.geometryType()],id:[et,[],i=>i.id()],zoom:[Ie,[],i=>i.globals.zoom],"heatmap-density":[Ie,[],i=>i.globals.heatmapDensity||0],"line-progress":[Ie,[],i=>i.globals.lineProgress||0],accumulated:[et,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Ie,_n(Ie),(i,e)=>{let r=0;for(const s of e)r+=s.evaluate(i);return r}],"*":[Ie,_n(Ie),(i,e)=>{let r=1;for(const s of e)r*=s.evaluate(i);return r}],"-":{type:Ie,overloads:[[[Ie,Ie],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[Ie],(i,[e])=>-e.evaluate(i)]]},"/":[Ie,[Ie,Ie],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[Ie,[Ie,Ie],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[Ie,[],()=>Math.LN2],pi:[Ie,[],()=>Math.PI],e:[Ie,[],()=>Math.E],"^":[Ie,[Ie,Ie],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[Ie,[Ie],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Ie,[Ie],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Ie,[Ie],(i,[e])=>Math.log(e.evaluate(i))],log2:[Ie,[Ie],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Ie,[Ie],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Ie,[Ie],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Ie,[Ie],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Ie,[Ie],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Ie,[Ie],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Ie,[Ie],(i,[e])=>Math.atan(e.evaluate(i))],min:[Ie,_n(Ie),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[Ie,_n(Ie),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[Ie,[Ie],(i,[e])=>Math.abs(e.evaluate(i))],round:[Ie,[Ie],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[Ie,[Ie],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Ie,[Ie],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[it,[ot,et],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[it,[et],(i,[e])=>i.id()===e.value],"filter-type-==":[it,[ot],(i,[e])=>i.geometryType()===e.value],"filter-<":[it,[ot,et],(i,[e,r])=>{const s=i.properties()[e.value],c=r.value;return typeof s==typeof c&&s<c}],"filter-id-<":[it,[et],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r<s}],"filter->":[it,[ot,et],(i,[e,r])=>{const s=i.properties()[e.value],c=r.value;return typeof s==typeof c&&s>c}],"filter-id->":[it,[et],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r>s}],"filter-<=":[it,[ot,et],(i,[e,r])=>{const s=i.properties()[e.value],c=r.value;return typeof s==typeof c&&s<=c}],"filter-id-<=":[it,[et],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r<=s}],"filter->=":[it,[ot,et],(i,[e,r])=>{const s=i.properties()[e.value],c=r.value;return typeof s==typeof c&&s>=c}],"filter-id->=":[it,[et],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r>=s}],"filter-has":[it,[et],(i,[e])=>e.value in i.properties()],"filter-has-id":[it,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[it,[Ii(ot)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[it,[Ii(et)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[it,[ot,Ii(et)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[it,[ot,Ii(et)],(i,[e,r])=>function(s,c,h,d){for(;h<=d;){const m=h+d>>1;if(c[m]===s)return!0;c[m]>s?d=m-1:h=m+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:it,overloads:[[[it,it],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[_n(it),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:it,overloads:[[[it,it],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[_n(it),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[it,[it],(i,[e])=>!e.evaluate(i)],"is-supported-script":[it,[ot],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[ot,[ot],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[ot,[ot],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[ot,_n(et),(i,e)=>e.map(r=>Ue(r.evaluate(i))).join("")],"resolved-locale":[ot,[Mr],(i,[e])=>e.evaluate(i).resolvedLocale()]});class no{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new xt,this._defaultValue=r?function(s){return s.type==="color"&&Ot(s.default)?new L(0,0,0,0):s.type==="color"?L.parse(s.default)||null:s.type==="padding"?j.parse(s.default)||null:s.default===void 0?null:s.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,s,c,h,d){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=c,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=d,this.expression.evaluate(this._evaluator)}evaluate(e,r,s,c,h,d){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=c,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=d||null;try{const m=this.expression.evaluate(this._evaluator);if(m==null||typeof m=="number"&&m!=m)return this._defaultValue;if(this._enumValues&&!(m in this._enumValues))throw new Le(`Expected value to be one of ${Object.keys(this._enumValues).map(g=>JSON.stringify(g)).join(", ")}, but found ${JSON.stringify(m)} instead.`);return m}catch(m){return this._warningHistory[m.message]||(this._warningHistory[m.message]=!0,typeof console<"u"&&console.warn(m.message)),this._defaultValue}}}function Ts(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Wn}function Es(i,e){const r=new jn(Wn,[],e?function(c){const h={color:_i,string:ot,number:Ie,enum:ot,boolean:it,formatted:ci,padding:Nn,resolvedImage:ti};return c.type==="array"?Ii(h[c.value]||et,c.length):h[c.type]}(e):void 0),s=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?Qa(new no(s,e)):Hn(r.errors)}class Ss{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!Zn(r.expression)}evaluateWithoutErrorHandling(e,r,s,c,h,d){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,c,h,d)}evaluate(e,r,s,c,h,d){return this._styleExpression.evaluate(e,r,s,c,h,d)}}class Ho{constructor(e,r,s,c){this.kind=e,this.zoomStops=s,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Zn(r.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,r,s,c,h,d){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,c,h,d)}evaluate(e,r,s,c,h,d){return this._styleExpression.evaluate(e,r,s,c,h,d)}interpolationFactor(e,r,s){return this.interpolationType?Vi.interpolationFactor(this.interpolationType,e,r,s):0}}function il(i,e){const r=Es(i,e);if(r.result==="error")return r;const s=r.value.expression,c=_s(s);if(!c&&!Ut(e))return Hn([new Oi("","data expressions not supported")]);const h=Ws(s,["zoom"]);if(!h&&!el(e))return Hn([new Oi("","zoom expressions not supported")]);const d=oo(s);return d||h?d instanceof Oi?Hn([d]):d instanceof Vi&&!ft(e)?Hn([new Oi("",'"interpolate" expressions cannot be used with this property')]):Qa(d?new Ho(c?"camera":"composite",r.value,d.labels,d instanceof Vi?d.interpolation:void 0):new Ss(c?"constant":"source",r.value)):Hn([new Oi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class so{constructor(e,r){this._parameters=e,this._specification=r,lr(this,ws(this._parameters,this._specification))}static deserialize(e){return new so(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function oo(i){let e=null;if(i instanceof Qs)e=oo(i.result);else if(i instanceof Js){for(const r of i.args)if(e=oo(r),e)break}else(i instanceof ys||i instanceof Vi)&&i.input instanceof Bt&&i.input.name==="zoom"&&(e=i);return e instanceof Oi||i.eachChild(r=>{const s=oo(r);s instanceof Oi?e=s:!e&&s?e=new Oi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new Oi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function cr(i){const e=i.key,r=i.value,s=i.valueSpec||{},c=i.objectElementValidators||{},h=i.style,d=i.styleSpec;let m=[];const g=St(r);if(g!=="object")return[new ke(e,r,`object expected, ${g} found`)];for(const x in r){const w=x.split(".")[0],E=s[w]||s["*"];let A;if(c[w])A=c[w];else if(s[w])A=$i;else if(c["*"])A=c["*"];else{if(!s["*"]){m.push(new ke(e,r[x],`unknown property "${x}"`));continue}A=$i}m=m.concat(A({key:(e&&`${e}.`)+x,value:r[x],valueSpec:E,style:h,styleSpec:d,object:r,objectKey:x},r))}for(const x in s)c[x]||s[x].required&&s[x].default===void 0&&r[x]===void 0&&m.push(new ke(e,r,`missing required property "${x}"`));return m}function rl(i){const e=i.value,r=i.valueSpec,s=i.style,c=i.styleSpec,h=i.key,d=i.arrayElementValidator||$i;if(St(e)!=="array")return[new ke(h,e,`array expected, ${St(e)} found`)];if(r.length&&e.length!==r.length)return[new ke(h,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new ke(h,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let m={type:r.value,values:r.values};c.$version<7&&(m.function=r.function),St(r.value)==="object"&&(m=r.value);let g=[];for(let x=0;x<e.length;x++)g=g.concat(d({array:e,arrayIndex:x,value:e[x],valueSpec:m,style:s,styleSpec:c,key:`${h}[${x}]`}));return g}function Ko(i){const e=i.key,r=i.value,s=i.valueSpec;let c=St(r);return c==="number"&&r!=r&&(c="NaN"),c!=="number"?[new ke(e,r,`number expected, ${c} found`)]:"minimum"in s&&r<s.minimum?[new ke(e,r,`${r} is less than the minimum value ${s.minimum}`)]:"maximum"in s&&r>s.maximum?[new ke(e,r,`${r} is greater than the maximum value ${s.maximum}`)]:[]}function nl(i){const e=i.valueSpec,r=_t(i.value.type);let s,c,h,d={};const m=r!=="categorical"&&i.value.property===void 0,g=!m,x=St(i.value.stops)==="array"&&St(i.value.stops[0])==="array"&&St(i.value.stops[0][0])==="object",w=cr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(z){if(r==="identity")return[new ke(z.key,z.value,'identity function may not have a "stops" property')];let P=[];const $=z.value;return P=P.concat(rl({key:z.key,value:$,valueSpec:z.valueSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:E})),St($)==="array"&&$.length===0&&P.push(new ke(z.key,$,"array must have at least one stop")),P},default:function(z){return $i({key:z.key,value:z.value,valueSpec:e,style:z.style,styleSpec:z.styleSpec})}}});return r==="identity"&&m&&w.push(new ke(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||w.push(new ke(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!ft(i.valueSpec)&&w.push(new ke(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(g&&!Ut(i.valueSpec)?w.push(new ke(i.key,i.value,"property functions not supported")):m&&!el(i.valueSpec)&&w.push(new ke(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!x||i.value.property!==void 0||w.push(new ke(i.key,i.value,'"property" property is required')),w;function E(z){let P=[];const $=z.value,N=z.key;if(St($)!=="array")return[new ke(N,$,`array expected, ${St($)} found`)];if($.length!==2)return[new ke(N,$,`array length 2 expected, length ${$.length} found`)];if(x){if(St($[0])!=="object")return[new ke(N,$,`object expected, ${St($[0])} found`)];if($[0].zoom===void 0)return[new ke(N,$,"object stop key must have zoom")];if($[0].value===void 0)return[new ke(N,$,"object stop key must have value")];if(h&&h>_t($[0].zoom))return[new ke(N,$[0].zoom,"stop zoom values must appear in ascending order")];_t($[0].zoom)!==h&&(h=_t($[0].zoom),c=void 0,d={}),P=P.concat(cr({key:`${N}[0]`,value:$[0],valueSpec:{zoom:{}},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{zoom:Ko,value:A}}))}else P=P.concat(A({key:`${N}[0]`,value:$[0],valueSpec:{},style:z.style,styleSpec:z.styleSpec},$));return Ts(Ji($[1]))?P.concat([new ke(`${N}[1]`,$[1],"expressions are not allowed in function stops.")]):P.concat($i({key:`${N}[1]`,value:$[1],valueSpec:e,style:z.style,styleSpec:z.styleSpec}))}function A(z,P){const $=St(z.value),N=_t(z.value),te=z.value!==null?z.value:P;if(s){if($!==s)return[new ke(z.key,te,`${$} stop domain type must match previous stop domain type ${s}`)]}else s=$;if($!=="number"&&$!=="string"&&$!=="boolean")return[new ke(z.key,te,"stop domain value must be a number, string, or boolean")];if($!=="number"&&r!=="categorical"){let ae=`number expected, ${$} found`;return Ut(e)&&r===void 0&&(ae+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ke(z.key,te,ae)]}return r!=="categorical"||$!=="number"||isFinite(N)&&Math.floor(N)===N?r!=="categorical"&&$==="number"&&c!==void 0&&N<c?[new ke(z.key,te,"stop domain values must appear in ascending order")]:(c=N,r==="categorical"&&N in d?[new ke(z.key,te,"stop domain values must be unique")]:(d[N]=!0,[])):[new ke(z.key,te,`integer expected, found ${N}`)]}}function yn(i){const e=(i.expressionContext==="property"?il:Es)(Ji(i.value),i.valueSpec);if(e.result==="error")return e.value.map(s=>new ke(`${i.key}${s.key}`,i.value,s.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new ke(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Zn(r))return[new ke(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Zn(r))return[new ke(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Ws(r,["zoom","feature-state"]))return[new ke(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!_s(r))return[new ke(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Is(i){const e=i.key,r=i.value,s=i.valueSpec,c=[];return Array.isArray(s.values)?s.values.indexOf(_t(r))===-1&&c.push(new ke(e,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(s.values).indexOf(_t(r))===-1&&c.push(new ke(e,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),c}function Yn(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Yn(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const _c={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ao(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Yn(i)||(i=As(i));const e=Es(i,_c);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,s,c)=>e.value.evaluate(r,s,{},c),needGeometry:ol(i)}}function sl(i,e){return i<e?-1:i>e?1:0}function ol(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(ol(i[e]))return!0;return!1}function As(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?Yo(i[1],i[2],"=="):e==="!="?Jn(Yo(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Yo(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(As))):e==="all"?["all"].concat(i.slice(1).map(As)):e==="none"?["all"].concat(i.slice(1).map(As).map(Jn)):e==="in"?lo(i[1],i.slice(2)):e==="!in"?Jn(lo(i[1],i.slice(2))):e==="has"?Cs(i[1]):e==="!has"?Jn(Cs(i[1])):e!=="within"||i;var r}function Yo(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function lo(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(sl)]]:["filter-in-small",i,["literal",e]]}}function Cs(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Jn(i){return["!",i]}function ks(i){return Yn(Ji(i.value))?yn(lr({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):al(i)}function al(i){const e=i.value,r=i.key;if(St(e)!=="array")return[new ke(r,e,`array expected, ${St(e)} found`)];const s=i.styleSpec;let c,h=[];if(e.length<1)return[new ke(r,e,"filter array must have at least 1 element")];switch(h=h.concat(Is({key:`${r}[0]`,value:e[0],valueSpec:s.filter_operator,style:i.style,styleSpec:i.styleSpec})),_t(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&_t(e[1])==="$type"&&h.push(new ke(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&h.push(new ke(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=St(e[1]),c!=="string"&&h.push(new ke(`${r}[1]`,e[1],`string expected, ${c} found`)));for(let d=2;d<e.length;d++)c=St(e[d]),_t(e[1])==="$type"?h=h.concat(Is({key:`${r}[${d}]`,value:e[d],valueSpec:s.geometry_type,style:i.style,styleSpec:i.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&h.push(new ke(`${r}[${d}]`,e[d],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let d=1;d<e.length;d++)h=h.concat(al({key:`${r}[${d}]`,value:e[d],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":c=St(e[1]),e.length!==2?h.push(new ke(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&h.push(new ke(`${r}[1]`,e[1],`string expected, ${c} found`));break;case"within":c=St(e[1]),e.length!==2?h.push(new ke(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="object"&&h.push(new ke(`${r}[1]`,e[1],`object expected, ${c} found`))}return h}function Ms(i,e){const r=i.key,s=i.style,c=i.styleSpec,h=i.value,d=i.objectKey,m=c[`${e}_${i.layerType}`];if(!m)return[];const g=d.match(/^(.*)-transition$/);if(e==="paint"&&g&&m[g[1]]&&m[g[1]].transition)return $i({key:r,value:h,valueSpec:c.transition,style:s,styleSpec:c});const x=i.valueSpec||m[d];if(!x)return[new ke(r,h,`unknown property "${d}"`)];let w;if(St(h)==="string"&&Ut(x)&&!x.tokens&&(w=/^{([^}]+)}$/.exec(h)))return[new ke(r,h,`"${d}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(w[1])} }\`.`)];const E=[];return i.layerType==="symbol"&&(d==="text-field"&&s&&!s.glyphs&&E.push(new ke(r,h,'use of "text-field" requires a style "glyphs" property')),d==="text-font"&&Ot(Ji(h))&&_t(h.type)==="identity"&&E.push(new ke(r,h,'"text-font" does not support identity functions'))),E.concat($i({key:i.key,value:h,valueSpec:x,style:s,styleSpec:c,expressionContext:"property",propertyType:e,propertyKey:d}))}function ll(i){return Ms(i,"paint")}function cl(i){return Ms(i,"layout")}function ul(i){let e=[];const r=i.value,s=i.key,c=i.style,h=i.styleSpec;r.type||r.ref||e.push(new ke(s,r,'either "type" or "ref" is required'));let d=_t(r.type);const m=_t(r.ref);if(r.id){const g=_t(r.id);for(let x=0;x<i.arrayIndex;x++){const w=c.layers[x];_t(w.id)===g&&e.push(new ke(s,r.id,`duplicate layer id "${r.id}", previously used at line ${w.id.__line__}`))}}if("ref"in r){let g;["type","source","source-layer","filter","layout"].forEach(x=>{x in r&&e.push(new ke(s,r[x],`"${x}" is prohibited for ref layers`))}),c.layers.forEach(x=>{_t(x.id)===m&&(g=x)}),g?g.ref?e.push(new ke(s,r.ref,"ref cannot reference another ref layer")):d=_t(g.type):e.push(new ke(s,r.ref,`ref layer "${m}" not found`))}else if(d!=="background")if(r.source){const g=c.sources&&c.sources[r.source],x=g&&_t(g.type);g?x==="vector"&&d==="raster"?e.push(new ke(s,r.source,`layer "${r.id}" requires a raster source`)):x==="raster"&&d!=="raster"?e.push(new ke(s,r.source,`layer "${r.id}" requires a vector source`)):x!=="vector"||r["source-layer"]?x==="raster-dem"&&d!=="hillshade"?e.push(new ke(s,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):d!=="line"||!r.paint||!r.paint["line-gradient"]||x==="geojson"&&g.lineMetrics||e.push(new ke(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new ke(s,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new ke(s,r.source,`source "${r.source}" not found`))}else e.push(new ke(s,r,'missing required property "source"'));return e=e.concat(cr({key:s,value:r,valueSpec:h.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>$i({key:`${s}.type`,value:r.type,valueSpec:h.layer.type,style:i.style,styleSpec:i.styleSpec,object:r,objectKey:"type"}),filter:ks,layout:g=>cr({layer:r,key:g.key,value:g.value,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":x=>cl(lr({layerType:d},x))}}),paint:g=>cr({layer:r,key:g.key,value:g.value,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":x=>ll(lr({layerType:d},x))}})}})),e}function Qn(i){const e=i.value,r=i.key,s=St(e);return s!=="string"?[new ke(r,e,`string expected, ${s} found`)]:[]}const hl={promoteId:function({key:i,value:e}){if(St(e)==="string")return Qn({key:i,value:e});{const r=[];for(const s in e)r.push(...Qn({key:`${i}.${s}`,value:e[s]}));return r}}};function zs(i){const e=i.value,r=i.key,s=i.styleSpec,c=i.style;if(!e.type)return[new ke(r,e,'"type" is required')];const h=_t(e.type);let d;switch(h){case"vector":case"raster":case"raster-dem":return d=cr({key:r,value:e,valueSpec:s[`source_${h.replace("-","_")}`],style:i.style,styleSpec:s,objectElementValidators:hl}),d;case"geojson":if(d=cr({key:r,value:e,valueSpec:s.source_geojson,style:c,styleSpec:s,objectElementValidators:hl}),e.cluster)for(const m in e.clusterProperties){const[g,x]=e.clusterProperties[m],w=typeof g=="string"?[g,["accumulated"],["get",m]]:g;d.push(...yn({key:`${r}.${m}.map`,value:x,expressionContext:"cluster-map"})),d.push(...yn({key:`${r}.${m}.reduce`,value:w,expressionContext:"cluster-reduce"}))}return d;case"video":return cr({key:r,value:e,valueSpec:s.source_video,style:c,styleSpec:s});case"image":return cr({key:r,value:e,valueSpec:s.source_image,style:c,styleSpec:s});case"canvas":return[new ke(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Is({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:c,styleSpec:s})}}function Ps(i){const e=i.value,r=i.styleSpec,s=r.light,c=i.style;let h=[];const d=St(e);if(e===void 0)return h;if(d!=="object")return h=h.concat([new ke("light",e,`object expected, ${d} found`)]),h;for(const m in e){const g=m.match(/^(.*)-transition$/);h=h.concat(g&&s[g[1]]&&s[g[1]].transition?$i({key:m,value:e[m],valueSpec:r.transition,style:c,styleSpec:r}):s[m]?$i({key:m,value:e[m],valueSpec:s[m],style:c,styleSpec:r}):[new ke(m,e[m],`unknown property "${m}"`)])}return h}function Ni(i){const e=i.value,r=i.styleSpec,s=r.terrain,c=i.style;let h=[];const d=St(e);if(e===void 0)return h;if(d!=="object")return h=h.concat([new ke("terrain",e,`object expected, ${d} found`)]),h;for(const m in e)h=h.concat(s[m]?$i({key:m,value:e[m],valueSpec:s[m],style:c,styleSpec:r}):[new ke(m,e[m],`unknown property "${m}"`)]);return h}const Ds={"*":()=>[],array:rl,boolean:function(i){const e=i.value,r=i.key,s=St(e);return s!=="boolean"?[new ke(r,e,`boolean expected, ${s} found`)]:[]},number:Ko,color:function(i){const e=i.key,r=i.value,s=St(r);return s!=="string"?[new ke(e,r,`color expected, ${s} found`)]:qn(r)===null?[new ke(e,r,`color expected, "${r}" found`)]:[]},constants:pn,enum:Is,filter:ks,function:nl,layer:ul,object:cr,source:zs,light:Ps,terrain:Ni,string:Qn,formatted:function(i){return Qn(i).length===0?[]:yn(i)},resolvedImage:function(i){return Qn(i).length===0?[]:yn(i)},padding:function(i){const e=i.key,r=i.value;if(St(r)==="array"){if(r.length<1||r.length>4)return[new ke(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const s={type:"number"};let c=[];for(let h=0;h<r.length;h++)c=c.concat($i({key:`${e}[${h}]`,value:r[h],valueSpec:s}));return c}return Ko({key:e,value:r,valueSpec:{}})}};function $i(i){const e=i.value,r=i.valueSpec,s=i.styleSpec;return r.expression&&Ot(_t(e))?nl(i):r.expression&&Ts(Ji(e))?yn(i):r.type&&Ds[r.type]?Ds[r.type](i):cr(lr({},i,{valueSpec:r.type?s[r.type]:r}))}function yc(i){const e=i.value,r=i.key,s=Qn(i);return s.length||(e.indexOf("{fontstack}")===-1&&s.push(new ke(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&s.push(new ke(r,e,'"glyphs" url must include a "{range}" token'))),s}function Yr(i,e=ge){let r=[];return r=r.concat($i({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:yc,"*":()=>[]}})),i.constants&&(r=r.concat(pn({key:"constants",value:i.constants,style:i,styleSpec:e}))),pl(r)}function pl(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function zr(i){return function(...e){return pl(i.apply(this,e))}}Yr.source=zr(zs),Yr.light=zr(Ps),Yr.terrain=zr(Ni),Yr.layer=zr(ul),Yr.filter=zr(ks),Yr.paintProperty=zr(ll),Yr.layoutProperty=zr(cl);const Ls=Yr,Jo=Ls.light,xc=Ls.paintProperty,vc=Ls.layoutProperty;function co(i,e){let r=!1;if(e&&e.length)for(const s of e)i.fire(new Vn(new Error(s.message))),r=!0;return r}class Bs{constructor(e,r,s){const c=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const d=new Int32Array(this.arrayBuffer);e=d[0],this.d=(r=d[1])+2*(s=d[2]);for(let g=0;g<this.d*this.d;g++){const x=d[3+g],w=d[3+g+1];c.push(x===w?null:d.subarray(x,w))}const m=d[3+c.length+1];this.keys=d.subarray(d[3+c.length],m),this.bboxes=d.subarray(m),this.insert=this._insertReadonly}else{this.d=r+2*s;for(let d=0;d<this.d*this.d;d++)c.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=s,this.scale=r/e,this.uid=0;const h=s/r*e;this.min=-h,this.max=e+h}insert(e,r,s,c,h){this._forEachCell(r,s,c,h,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(h)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,s,c,h,d){this.cells[h].push(d)}query(e,r,s,c,h){const d=this.min,m=this.max;if(e<=d&&r<=d&&m<=s&&m<=c&&!h)return Array.prototype.slice.call(this.keys);{const g=[];return this._forEachCell(e,r,s,c,this._queryCell,g,{},h),g}}_queryCell(e,r,s,c,h,d,m,g){const x=this.cells[h];if(x!==null){const w=this.keys,E=this.bboxes;for(let A=0;A<x.length;A++){const z=x[A];if(m[z]===void 0){const P=4*z;(g?g(E[P+0],E[P+1],E[P+2],E[P+3]):e<=E[P+2]&&r<=E[P+3]&&s>=E[P+0]&&c>=E[P+1])?(m[z]=!0,d.push(w[z])):m[z]=!1}}}}_forEachCell(e,r,s,c,h,d,m,g){const x=this._convertToCellCoord(e),w=this._convertToCellCoord(r),E=this._convertToCellCoord(s),A=this._convertToCellCoord(c);for(let z=x;z<=E;z++)for(let P=w;P<=A;P++){const $=this.d*P+z;if((!g||g(this._convertFromCellCoord(z),this._convertFromCellCoord(P),this._convertFromCellCoord(z+1),this._convertFromCellCoord(P+1)))&&h.call(this,e,r,s,c,$,d,m,g))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let s=0;for(let d=0;d<this.cells.length;d++)s+=this.cells[d].length;const c=new Int32Array(r+s+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;let h=r;for(let d=0;d<e.length;d++){const m=e[d];c[3+d]=h,c.set(m,h),h+=m.length}return c[3+e.length]=h,c.set(this.keys,h),h+=this.keys.length,c[3+e.length+1]=h,c.set(this.bboxes,h),h+=this.bboxes.length,c.buffer}static serialize(e,r){const s=e.toArrayBuffer();return r&&r.push(s),{buffer:s}}static deserialize(e){return new Bs(e.buffer)}}const Pr={};function Oe(i,e,r={}){if(Pr[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),Pr[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}Oe("Object",Object),Oe("TransferableGridIndex",Bs),Oe("Color",L),Oe("Error",Error),Oe("AJAXError",Fi),Oe("ResolvedImage",J),Oe("StylePropertyFunction",so),Oe("StyleExpression",no,{omit:["_evaluator"]}),Oe("ZoomDependentExpression",Ho),Oe("ZoomConstantExpression",Ss),Oe("CompoundExpression",Bt,{omit:["_evaluate"]});for(const i in Wn)Wn[i]._classRegistryKey||Oe(`Expression_${i}`,Wn[i]);function dl(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function xn(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(dl(i)||Yi(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const s of i)r.push(xn(s,e));return r}if(typeof i=="object"){const r=i.constructor,s=r._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");if(!Pr[s])throw new Error(`${s} is not registered.`);const c=r.serialize?r.serialize(i,e):{};if(r.serialize){if(e&&c===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const h in i){if(!i.hasOwnProperty(h)||Pr[s].omit.indexOf(h)>=0)continue;const d=i[h];c[h]=Pr[s].shallow.indexOf(h)>=0?d:xn(d,e)}i instanceof Error&&(c.message=i.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(c.$name=s),c}throw new Error("can't serialize object of type "+typeof i)}function Jr(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||dl(i)||Yi(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(Jr);if(typeof i=="object"){const e=i.$name||"Object";if(!Pr[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=Pr[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const s=Object.create(r.prototype);for(const c of Object.keys(i)){if(c==="$name")continue;const h=i[c];s[c]=Pr[e].shallow.indexOf(c)>=0?h:Jr(h)}return s}throw new Error("can't deserialize object of type "+typeof i)}class Qo{constructor(){this.first=!0}update(e,r){const s=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=s,!0))}}const ze={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function uo(i){for(const e of i)if(ta(e.charCodeAt(0)))return!0;return!1}function bc(i){for(const e of i)if(!ea(e.charCodeAt(0)))return!1;return!0}function ea(i){return!(ze.Arabic(i)||ze["Arabic Supplement"](i)||ze["Arabic Extended-A"](i)||ze["Arabic Presentation Forms-A"](i)||ze["Arabic Presentation Forms-B"](i))}function ta(i){return!(i!==746&&i!==747&&(i<4352||!(ze["Bopomofo Extended"](i)||ze.Bopomofo(i)||ze["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||ze["CJK Compatibility Ideographs"](i)||ze["CJK Compatibility"](i)||ze["CJK Radicals Supplement"](i)||ze["CJK Strokes"](i)||!(!ze["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||ze["CJK Unified Ideographs Extension A"](i)||ze["CJK Unified Ideographs"](i)||ze["Enclosed CJK Letters and Months"](i)||ze["Hangul Compatibility Jamo"](i)||ze["Hangul Jamo Extended-A"](i)||ze["Hangul Jamo Extended-B"](i)||ze["Hangul Jamo"](i)||ze["Hangul Syllables"](i)||ze.Hiragana(i)||ze["Ideographic Description Characters"](i)||ze.Kanbun(i)||ze["Kangxi Radicals"](i)||ze["Katakana Phonetic Extensions"](i)||ze.Katakana(i)&&i!==12540||!(!ze["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!ze["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||ze["Unified Canadian Aboriginal Syllabics"](i)||ze["Unified Canadian Aboriginal Syllabics Extended"](i)||ze["Vertical Forms"](i)||ze["Yijing Hexagram Symbols"](i)||ze["Yi Syllables"](i)||ze["Yi Radicals"](i))))}function fl(i){return!(ta(i)||function(e){return!!(ze["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||ze["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||ze["Letterlike Symbols"](e)||ze["Number Forms"](e)||ze["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||ze["Control Pictures"](e)&&e!==9251||ze["Optical Character Recognition"](e)||ze["Enclosed Alphanumerics"](e)||ze["Geometric Shapes"](e)||ze["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ze["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ze["CJK Symbols and Punctuation"](e)||ze.Katakana(e)||ze["Private Use Area"](e)||ze["CJK Compatibility Forms"](e)||ze["Small Form Variants"](e)||ze["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function ml(i){return i>=1424&&i<=2303||ze["Arabic Presentation Forms-A"](i)||ze["Arabic Presentation Forms-B"](i)}function wc(i,e){return!(!e&&ml(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||ze.Khmer(i))}function gl(i){for(const e of i)if(ml(e.charCodeAt(0)))return!0;return!1}const ia="deferred",ra="loading",na="loaded";let sa=null,Pi="unavailable",Qr=null;const _l=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(Pi="error"),sa&&sa(i)};function es(){oa.fire(new Cr("pluginStateChange",{pluginStatus:Pi,pluginURL:Qr}))}const oa=new kr,Rs=function(){return Pi},yl=function(){if(Pi!==ia||!Qr)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Pi=ra,es(),Qr&&Un({url:Qr},i=>{i?_l(i):(Pi=na,es())})},Qi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Pi===na||Qi.applyArabicShaping!=null,isLoading:()=>Pi===ra,setState(i){if(!Ht())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Pi=i.pluginStatus,Qr=i.pluginURL},isParsed(){if(!Ht())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Qi.applyArabicShaping!=null&&Qi.processBidirectionalText!=null&&Qi.processStyledBidirectionalText!=null},getPluginURL(){if(!Ht())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Qr}};class Gt{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Qo,this.transition={})}isSupportedScript(e){return function(r,s){for(const c of r)if(!wc(c.charCodeAt(0),s))return!1;return!0}(e,Qi.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),s=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*r}}}class Fs{constructor(e,r){this.property=e,this.value=r,this.expression=function(s,c){if(Ot(s))return new so(s,c);if(Ts(s)){const h=il(s,c);if(h.result==="error")throw new Error(h.value.map(d=>`${d.key}: ${d.message}`).join(", "));return h.value}{let h=s;return c.type==="color"&&typeof s=="string"?h=L.parse(s):c.type!=="padding"||typeof s!="number"&&!Array.isArray(s)||(h=j.parse(s)),{kind:"constant",evaluate:()=>h}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,s){return this.property.possiblyEvaluate(this,e,r,s)}}class ho{constructor(e){this.property=e,this.value=new Fs(e,void 0)}transitioned(e,r){return new vl(this.property,this.value,r,qe({},e.transition,this.transition),e.now)}untransitioned(){return new vl(this.property,this.value,null,{},0)}}class xl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return ht(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new ho(this._values[e].property)),this._values[e].value=new Fs(this._values[e].property,r===null?void 0:ht(r))}getTransition(e){return ht(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new ho(this._values[e].property)),this._values[e].transition=ht(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s);const c=this.getTransition(r);c!==void 0&&(e[`${r}-transition`]=c)}return e}transitioned(e,r){const s=new bl(this._properties);for(const c of Object.keys(this._values))s._values[c]=this._values[c].transitioned(e,r._values[c]);return s}untransitioned(){const e=new bl(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class vl{constructor(e,r,s,c,h){this.property=e,this.value=r,this.begin=h+c.delay||0,this.end=this.begin+c.duration||0,e.specification.transition&&(c.delay||c.duration)&&(this.prior=s)}possiblyEvaluate(e,r,s){const c=e.now||0,h=this.value.possiblyEvaluate(e,r,s),d=this.prior;if(d){if(c>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(c<this.begin)return d.possiblyEvaluate(e,r,s);{const m=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(d.possiblyEvaluate(e,r,s),h,function(g){if(g<=0)return 0;if(g>=1)return 1;const x=g*g,w=x*g;return 4*(g<.5?w:3*(g-x)+w-.75)}(m))}}return h}}class bl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,s){const c=new Os(this._properties);for(const h of Object.keys(this._values))c._values[h]=this._values[h].possiblyEvaluate(e,r,s);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Tc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return ht(this._values[e].value)}setValue(e,r){this._values[e]=new Fs(this._values[e].property,r===null?void 0:ht(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s)}return e}possiblyEvaluate(e,r,s){const c=new Os(this._properties);for(const h of Object.keys(this._values))c._values[h]=this._values[h].possiblyEvaluate(e,r,s);return c}}class yr{constructor(e,r,s){this.property=e,this.value=r,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,s,c){return this.property.evaluate(this.value,this.parameters,e,r,s,c)}}class Os{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ge{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,s){const c=xs[this.specification.type];return c?c(e,r,s):e}}class Ke{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,s,c){return new yr(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},s,c)}:e.expression,r)}interpolate(e,r,s){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new yr(this,{kind:"constant",value:void 0},e.parameters);const c=xs[this.specification.type];return c?new yr(this,{kind:"constant",value:c(e.value.value,r.value.value,s)},e.parameters):e}evaluate(e,r,s,c,h,d){return e.kind==="constant"?e.value:e.evaluate(r,s,c,h,d)}}class ts extends Ke{possiblyEvaluate(e,r,s,c){if(e.value===void 0)return new yr(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const h=e.expression.evaluate(r,null,{},s,c),d=e.property.specification.type==="resolvedImage"&&typeof h!="string"?h.name:h,m=this._calculate(d,d,d,r);return new yr(this,{kind:"constant",value:m},r)}if(e.expression.kind==="camera"){const h=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new yr(this,{kind:"constant",value:h},r)}return new yr(this,e.expression,r)}evaluate(e,r,s,c,h,d){if(e.kind==="source"){const m=e.evaluate(r,s,c,h,d);return this._calculate(m,m,m,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},s,c),e.evaluate({zoom:Math.floor(r.zoom)},s,c),e.evaluate({zoom:Math.floor(r.zoom)+1},s,c),r):e.value}_calculate(e,r,s,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class aa{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,c){if(e.value!==void 0){if(e.expression.kind==="constant"){const h=e.expression.evaluate(r,null,{},s,c);return this._calculate(h,h,h,r)}return this._calculate(e.expression.evaluate(new Gt(Math.floor(r.zoom-1),r)),e.expression.evaluate(new Gt(Math.floor(r.zoom),r)),e.expression.evaluate(new Gt(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,s,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class en{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,c){return!!e.expression.evaluate(r,null,{},s,c)}interpolate(){return!1}}class yi{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const s=e[r];s.specification.overridable&&this.overridableProperties.push(r);const c=this.defaultPropertyValues[r]=new Fs(s,void 0),h=this.defaultTransitionablePropertyValues[r]=new ho(s);this.defaultTransitioningPropertyValues[r]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=c.possiblyEvaluate({})}}}Oe("DataDrivenProperty",Ke),Oe("DataConstantProperty",Ge),Oe("CrossFadedDataDrivenProperty",ts),Oe("CrossFadedProperty",aa),Oe("ColorRampProperty",en);const tn="-transition";class xr extends kr{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new Tc(r.layout)),r.paint)){this._transitionablePaint=new xl(r.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Os(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,s={}){r!=null&&this._validate(vc,`layers.${this.id}.layout.${e}`,e,r,s)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(tn)?this._transitionablePaint.getTransition(e.slice(0,-tn.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,s={}){if(r!=null&&this._validate(xc,`layers.${this.id}.paint.${e}`,e,r,s))return!1;if(e.endsWith(tn))return this._transitionablePaint.setTransition(e.slice(0,-tn.length),r||void 0),!1;{const c=this._transitionablePaint._values[e],h=c.property.specification["property-type"]==="cross-faded-data-driven",d=c.value.isDataDriven(),m=c.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const g=this._transitionablePaint._values[e].value;return g.isDataDriven()||d||h||this._handleOverridablePaintPropertyUpdate(e,m,g)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Tt(e,(r,s)=>!(r===void 0||s==="layout"&&!Object.keys(r).length||s==="paint"&&!Object.keys(r).length))}_validate(e,r,s,c,h={}){return(!h||h.validate!==!1)&&co(this,e.call(Ls,{key:r,layerType:this.type,objectKey:s,value:c,styleSpec:ge,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof yr&&Ut(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const wl={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class rn{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Yt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ii(i,e=1){let r=0,s=0;return{members:i.map(c=>{const h=wl[c.type].BYTES_PER_ELEMENT,d=r=la(r,Math.max(e,h)),m=c.components||1;return s=Math.max(s,h),r+=h*m,{name:c.name,type:c.type,components:m,offset:d}}),size:la(r,Math.max(s,e)),alignment:e}}function la(i,e){return Math.ceil(i/e)*e}class vn extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const c=2*e;return this.int16[c+0]=r,this.int16[c+1]=s,e}}vn.prototype.bytesPerElement=4,Oe("StructArrayLayout2i4",vn);class l extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,s,c)}emplace(e,r,s,c,h){const d=4*e;return this.int16[d+0]=r,this.int16[d+1]=s,this.int16[d+2]=c,this.int16[d+3]=h,e}}l.prototype.bytesPerElement=8,Oe("StructArrayLayout4i8",l);class t extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,h,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,s,c,h,d)}emplace(e,r,s,c,h,d,m){const g=6*e;return this.int16[g+0]=r,this.int16[g+1]=s,this.int16[g+2]=c,this.int16[g+3]=h,this.int16[g+4]=d,this.int16[g+5]=m,e}}t.prototype.bytesPerElement=12,Oe("StructArrayLayout2i4i12",t);class n extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,h,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,s,c,h,d)}emplace(e,r,s,c,h,d,m){const g=4*e,x=8*e;return this.int16[g+0]=r,this.int16[g+1]=s,this.uint8[x+4]=c,this.uint8[x+5]=h,this.uint8[x+6]=d,this.uint8[x+7]=m,e}}n.prototype.bytesPerElement=8,Oe("StructArrayLayout2i4ub8",n);class o extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const c=2*e;return this.float32[c+0]=r,this.float32[c+1]=s,e}}o.prototype.bytesPerElement=8,Oe("StructArrayLayout2f8",o);class u extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,h,d,m,g,x,w){const E=this.length;return this.resize(E+1),this.emplace(E,e,r,s,c,h,d,m,g,x,w)}emplace(e,r,s,c,h,d,m,g,x,w,E){const A=10*e;return this.uint16[A+0]=r,this.uint16[A+1]=s,this.uint16[A+2]=c,this.uint16[A+3]=h,this.uint16[A+4]=d,this.uint16[A+5]=m,this.uint16[A+6]=g,this.uint16[A+7]=x,this.uint16[A+8]=w,this.uint16[A+9]=E,e}}u.prototype.bytesPerElement=20,Oe("StructArrayLayout10ui20",u);class p extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,h,d,m,g,x,w,E,A){const z=this.length;return this.resize(z+1),this.emplace(z,e,r,s,c,h,d,m,g,x,w,E,A)}emplace(e,r,s,c,h,d,m,g,x,w,E,A,z){const P=12*e;return this.int16[P+0]=r,this.int16[P+1]=s,this.int16[P+2]=c,this.int16[P+3]=h,this.uint16[P+4]=d,this.uint16[P+5]=m,this.uint16[P+6]=g,this.uint16[P+7]=x,this.int16[P+8]=w,this.int16[P+9]=E,this.int16[P+10]=A,this.int16[P+11]=z,e}}p.prototype.bytesPerElement=24,Oe("StructArrayLayout4i4ui4i24",p);class f extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const h=3*e;return this.float32[h+0]=r,this.float32[h+1]=s,this.float32[h+2]=c,e}}f.prototype.bytesPerElement=12,Oe("StructArrayLayout3f12",f);class _ extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}_.prototype.bytesPerElement=4,Oe("StructArrayLayout1ul4",_);class y extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,h,d,m,g,x){const w=this.length;return this.resize(w+1),this.emplace(w,e,r,s,c,h,d,m,g,x)}emplace(e,r,s,c,h,d,m,g,x,w){const E=10*e,A=5*e;return this.int16[E+0]=r,this.int16[E+1]=s,this.int16[E+2]=c,this.int16[E+3]=h,this.int16[E+4]=d,this.int16[E+5]=m,this.uint32[A+3]=g,this.uint16[E+8]=x,this.uint16[E+9]=w,e}}y.prototype.bytesPerElement=20,Oe("StructArrayLayout6i1ul2ui20",y);class v extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,h,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,s,c,h,d)}emplace(e,r,s,c,h,d,m){const g=6*e;return this.int16[g+0]=r,this.int16[g+1]=s,this.int16[g+2]=c,this.int16[g+3]=h,this.int16[g+4]=d,this.int16[g+5]=m,e}}v.prototype.bytesPerElement=12,Oe("StructArrayLayout2i2i2i12",v);class T extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,s,c,h)}emplace(e,r,s,c,h,d){const m=4*e,g=8*e;return this.float32[m+0]=r,this.float32[m+1]=s,this.float32[m+2]=c,this.int16[g+6]=h,this.int16[g+7]=d,e}}T.prototype.bytesPerElement=16,Oe("StructArrayLayout2f1f2i16",T);class I extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,s,c)}emplace(e,r,s,c,h){const d=12*e,m=3*e;return this.uint8[d+0]=r,this.uint8[d+1]=s,this.float32[m+1]=c,this.float32[m+2]=h,e}}I.prototype.bytesPerElement=12,Oe("StructArrayLayout2ub2f12",I);class M extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const h=3*e;return this.uint16[h+0]=r,this.uint16[h+1]=s,this.uint16[h+2]=c,e}}M.prototype.bytesPerElement=6,Oe("StructArrayLayout3ui6",M);class U extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,h,d,m,g,x,w,E,A,z,P,$,N,te){const ae=this.length;return this.resize(ae+1),this.emplace(ae,e,r,s,c,h,d,m,g,x,w,E,A,z,P,$,N,te)}emplace(e,r,s,c,h,d,m,g,x,w,E,A,z,P,$,N,te,ae){const ee=24*e,se=12*e,xe=48*e;return this.int16[ee+0]=r,this.int16[ee+1]=s,this.uint16[ee+2]=c,this.uint16[ee+3]=h,this.uint32[se+2]=d,this.uint32[se+3]=m,this.uint32[se+4]=g,this.uint16[ee+10]=x,this.uint16[ee+11]=w,this.uint16[ee+12]=E,this.float32[se+7]=A,this.float32[se+8]=z,this.uint8[xe+36]=P,this.uint8[xe+37]=$,this.uint8[xe+38]=N,this.uint32[se+10]=te,this.int16[ee+22]=ae,e}}U.prototype.bytesPerElement=48,Oe("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",U);class R extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,h,d,m,g,x,w,E,A,z,P,$,N,te,ae,ee,se,xe,ye,Fe,Ve,Pe,Ce,Se,De){const Me=this.length;return this.resize(Me+1),this.emplace(Me,e,r,s,c,h,d,m,g,x,w,E,A,z,P,$,N,te,ae,ee,se,xe,ye,Fe,Ve,Pe,Ce,Se,De)}emplace(e,r,s,c,h,d,m,g,x,w,E,A,z,P,$,N,te,ae,ee,se,xe,ye,Fe,Ve,Pe,Ce,Se,De,Me){const Te=34*e,Xe=17*e;return this.int16[Te+0]=r,this.int16[Te+1]=s,this.int16[Te+2]=c,this.int16[Te+3]=h,this.int16[Te+4]=d,this.int16[Te+5]=m,this.int16[Te+6]=g,this.int16[Te+7]=x,this.uint16[Te+8]=w,this.uint16[Te+9]=E,this.uint16[Te+10]=A,this.uint16[Te+11]=z,this.uint16[Te+12]=P,this.uint16[Te+13]=$,this.uint16[Te+14]=N,this.uint16[Te+15]=te,this.uint16[Te+16]=ae,this.uint16[Te+17]=ee,this.uint16[Te+18]=se,this.uint16[Te+19]=xe,this.uint16[Te+20]=ye,this.uint16[Te+21]=Fe,this.uint16[Te+22]=Ve,this.uint32[Xe+12]=Pe,this.float32[Xe+13]=Ce,this.float32[Xe+14]=Se,this.float32[Xe+15]=De,this.float32[Xe+16]=Me,e}}R.prototype.bytesPerElement=68,Oe("StructArrayLayout8i15ui1ul4f68",R);class O extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}O.prototype.bytesPerElement=4,Oe("StructArrayLayout1f4",O);class H extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const h=3*e;return this.int16[h+0]=r,this.int16[h+1]=s,this.int16[h+2]=c,e}}H.prototype.bytesPerElement=6,Oe("StructArrayLayout3i6",H);class Q extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const h=4*e;return this.uint32[2*e+0]=r,this.uint16[h+2]=s,this.uint16[h+3]=c,e}}Q.prototype.bytesPerElement=8,Oe("StructArrayLayout1ul2ui8",Q);class re extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const c=2*e;return this.uint16[c+0]=r,this.uint16[c+1]=s,e}}re.prototype.bytesPerElement=4,Oe("StructArrayLayout2ui4",re);class V extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}V.prototype.bytesPerElement=2,Oe("StructArrayLayout1ui2",V);class oe extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,s,c)}emplace(e,r,s,c,h){const d=4*e;return this.float32[d+0]=r,this.float32[d+1]=s,this.float32[d+2]=c,this.float32[d+3]=h,e}}oe.prototype.bytesPerElement=16,Oe("StructArrayLayout4f16",oe);class ne extends rn{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Je(this.anchorPointX,this.anchorPointY)}}ne.prototype.size=20;class de extends y{get(e){return new ne(this,e)}}Oe("CollisionBoxArray",de);class fe extends rn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}fe.prototype.size=48;class we extends U{get(e){return new fe(this,e)}}Oe("PlacedSymbolArray",we);class he extends rn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}he.prototype.size=68;class Be extends R{get(e){return new he(this,e)}}Oe("SymbolInstanceArray",Be);class Ae extends O{getoffsetX(e){return this.float32[1*e+0]}}Oe("GlyphOffsetArray",Ae);class Re extends H{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Oe("SymbolLineVertexArray",Re);class rt extends rn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}rt.prototype.size=8;class lt extends Q{get(e){return new rt(this,e)}}Oe("FeatureIndexArray",lt);class je extends vn{}class kt extends vn{}class Mt extends vn{}class mt extends t{}class vt extends n{}class Pt extends o{}class hi extends u{}class vr extends p{}class ur extends f{}class br extends _{}class nn extends v{}class er extends I{}class Di extends M{}class Dr extends re{}const po=ii([{name:"a_pos",components:2,type:"Int16"}],4),{members:oi}=po;class pt{constructor(e=[]){this.segments=e}prepareSegment(e,r,s,c){let h=this.segments[this.segments.length-1];return e>pt.MAX_VERTEX_ARRAY_LENGTH&&st(`Max vertices per segment is ${pt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!h||h.vertexLength+e>pt.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==c)&&(h={vertexOffset:r.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},c!==void 0&&(h.sortKey=c),this.segments.push(h)),h}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,s,c){return new pt([{vertexOffset:e,primitiveOffset:r,vertexLength:s,primitiveLength:c,vaos:{},sortKey:0}])}}function Ct(i,e){return 256*(i=Y(Math.floor(i),0,255))+Y(Math.floor(e),0,255)}pt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Oe("SegmentVector",pt);const pi=ii([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var di={exports:{}},Zt={exports:{}};Zt.exports=function(i,e){var r,s,c,h,d,m,g,x;for(s=i.length-(r=3&i.length),c=e,d=3432918353,m=461845907,x=0;x<s;)g=255&i.charCodeAt(x)|(255&i.charCodeAt(++x))<<8|(255&i.charCodeAt(++x))<<16|(255&i.charCodeAt(++x))<<24,++x,c=27492+(65535&(h=5*(65535&(c=(c^=g=(65535&(g=(g=(65535&g)*d+(((g>>>16)*d&65535)<<16)&4294967295)<<15|g>>>17))*m+(((g>>>16)*m&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(h>>>16)&65535)<<16);switch(g=0,r){case 3:g^=(255&i.charCodeAt(x+2))<<16;case 2:g^=(255&i.charCodeAt(x+1))<<8;case 1:c^=g=(65535&(g=(g=(65535&(g^=255&i.charCodeAt(x)))*d+(((g>>>16)*d&65535)<<16)&4294967295)<<15|g>>>17))*m+(((g>>>16)*m&65535)<<16)&4294967295}return c^=i.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var tr={exports:{}};tr.exports=function(i,e){for(var r,s=i.length,c=e^s,h=0;s>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(h)|(255&i.charCodeAt(++h))<<8|(255&i.charCodeAt(++h))<<16|(255&i.charCodeAt(++h))<<24))+((1540483477*(r>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),s-=4,++h;switch(s){case 3:c^=(255&i.charCodeAt(h+2))<<16;case 2:c^=(255&i.charCodeAt(h+1))<<8;case 1:c=1540483477*(65535&(c^=255&i.charCodeAt(h)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var bn=Zt.exports,ca=tr.exports;di.exports=bn,di.exports.murmur3=bn,di.exports.murmur2=ca;class is{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,s,c){this.ids.push(Tl(e)),this.positions.push(r,s,c)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Tl(e);let s=0,c=this.ids.length-1;for(;s<c;){const d=s+c>>1;this.ids[d]>=r?c=d:s=d+1}const h=[];for(;this.ids[s]===r;)h.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return h}static serialize(e,r){const s=new Float64Array(e.ids),c=new Uint32Array(e.positions);return ua(s,c,0,s.length-1),r&&r.push(s.buffer,c.buffer),{ids:s,positions:c}}static deserialize(e){const r=new is;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Tl(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:di.exports(String(i))}function ua(i,e,r,s){for(;r<s;){const c=i[r+s>>1];let h=r-1,d=s+1;for(;;){do h++;while(i[h]<c);do d--;while(i[d]>c);if(h>=d)break;sn(i,h,d),sn(e,3*h,3*d),sn(e,3*h+1,3*d+1),sn(e,3*h+2,3*d+2)}d-r<s-d?(ua(i,e,r,d),r=d+1):(ua(i,e,d+1,s),s=d)}}function sn(i,e,r){const s=i[e];i[e]=i[r],i[r]=s}Oe("FeaturePositionMap",is);class wn{constructor(e,r){this.gl=e.gl,this.location=r}}class Tn extends wn{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class fo extends wn{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Hu extends wn{constructor(e,r){super(e,r),this.current=L.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Td=new Float32Array(16);function Ec(i){return[Ct(255*i.r,255*i.g),Ct(255*i.b,255*i.a)]}class ha{constructor(e,r,s){this.value=e,this.uniformNames=r.map(c=>`u_${c}`),this.type=s}setUniform(e,r,s){e.set(s.constantOr(this.value))}getBinding(e,r,s){return this.type==="color"?new Hu(e,r):new Tn(e,r)}}class mo{constructor(e,r){this.uniformNames=r.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,s,c){const h=c==="u_pattern_to"?this.patternTo:c==="u_pattern_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;h&&e.set(h)}getBinding(e,r,s){return s.substr(0,9)==="u_pattern"?new fo(e,r):new Tn(e,r)}}class En{constructor(e,r,s,c){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map(h=>({name:`a_${h}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,r,s,c,h){const d=this.paintVertexArray.length,m=this.expression.evaluate(new Gt(0),r,{},c,[],h);this.paintVertexArray.resize(e),this._setPaintValue(d,e,m)}updatePaintArray(e,r,s,c){const h=this.expression.evaluate({zoom:0},s,c);this._setPaintValue(e,r,h)}_setPaintValue(e,r,s){if(this.type==="color"){const c=Ec(s);for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,c[0],c[1])}else{for(let c=e;c<r;c++)this.paintVertexArray.emplace(c,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Lr{constructor(e,r,s,c,h,d){this.expression=e,this.uniformNames=r.map(m=>`u_${m}_t`),this.type=s,this.useIntegerZoom=c,this.zoom=h,this.maxValue=0,this.paintVertexAttributes=r.map(m=>({name:`a_${m}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,r,s,c,h){const d=this.expression.evaluate(new Gt(this.zoom),r,{},c,[],h),m=this.expression.evaluate(new Gt(this.zoom+1),r,{},c,[],h),g=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(g,e,d,m)}updatePaintArray(e,r,s,c){const h=this.expression.evaluate({zoom:this.zoom},s,c),d=this.expression.evaluate({zoom:this.zoom+1},s,c);this._setPaintValue(e,r,h,d)}_setPaintValue(e,r,s,c){if(this.type==="color"){const h=Ec(s),d=Ec(c);for(let m=e;m<r;m++)this.paintVertexArray.emplace(m,h[0],h[1],d[0],d[1])}else{for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,s,c);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,c=Y(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);e.set(c)}getBinding(e,r,s){return new Tn(e,r)}}class rs{constructor(e,r,s,c,h,d){this.expression=e,this.type=r,this.useIntegerZoom=s,this.zoom=c,this.layerId=d,this.zoomInPaintVertexArray=new h,this.zoomOutPaintVertexArray=new h}populatePaintArray(e,r,s){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(e,r,s,c,h){this._setPaintValues(e,r,s.patterns&&s.patterns[this.layerId],h)}_setPaintValues(e,r,s,c){if(!c||!s)return;const{min:h,mid:d,max:m}=s,g=c[h],x=c[d],w=c[m];if(g&&x&&w)for(let E=e;E<r;E++)this.zoomInPaintVertexArray.emplace(E,x.tl[0],x.tl[1],x.br[0],x.br[1],g.tl[0],g.tl[1],g.br[0],g.br[1],x.pixelRatio,g.pixelRatio),this.zoomOutPaintVertexArray.emplace(E,x.tl[0],x.tl[1],x.br[0],x.br[1],w.tl[0],w.tl[1],w.br[0],w.br[1],x.pixelRatio,w.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,pi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,pi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ku{constructor(e,r,s){this.binders={},this._buffers=[];const c=[];for(const h in e.paint._values){if(!s(h))continue;const d=e.paint.get(h);if(!(d instanceof yr&&Ut(d.property.specification)))continue;const m=Ed(h,e.type),g=d.value,x=d.property.specification.type,w=d.property.useIntegerZoom,E=d.property.specification["property-type"],A=E==="cross-faded"||E==="cross-faded-data-driven";if(g.kind==="constant")this.binders[h]=A?new mo(g.value,m):new ha(g.value,m,x),c.push(`/u_${h}`);else if(g.kind==="source"||A){const z=Yu(h,x,"source");this.binders[h]=A?new rs(g,x,w,r,z,e.id):new En(g,m,x,z),c.push(`/a_${h}`)}else{const z=Yu(h,x,"composite");this.binders[h]=new Lr(g,m,x,w,r,z),c.push(`/z_${h}`)}}this.cacheKey=c.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof En||r instanceof Lr?r.maxValue:0}populatePaintArrays(e,r,s,c,h){for(const d in this.binders){const m=this.binders[d];(m instanceof En||m instanceof Lr||m instanceof rs)&&m.populatePaintArray(e,r,s,c,h)}}setConstantPatternPositions(e,r){for(const s in this.binders){const c=this.binders[s];c instanceof mo&&c.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,s,c,h){let d=!1;for(const m in e){const g=r.getPositions(m);for(const x of g){const w=s.feature(x.index);for(const E in this.binders){const A=this.binders[E];if((A instanceof En||A instanceof Lr||A instanceof rs)&&A.expression.isStateDependent===!0){const z=c.paint.get(E);A.expression=z.value,A.updatePaintArray(x.start,x.end,w,e[m],h),d=!0}}}}return d}defines(){const e=[];for(const r in this.binders){const s=this.binders[r];(s instanceof ha||s instanceof mo)&&e.push(...s.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof En||s instanceof Lr)for(let c=0;c<s.paintVertexAttributes.length;c++)e.push(s.paintVertexAttributes[c].name);else if(s instanceof rs)for(let c=0;c<pi.members.length;c++)e.push(pi.members[c].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof ha||s instanceof mo||s instanceof Lr)for(const c of s.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const s=[];for(const c in this.binders){const h=this.binders[c];if(h instanceof ha||h instanceof mo||h instanceof Lr){for(const d of h.uniformNames)if(r[d]){const m=h.getBinding(e,r[d],d);s.push({name:d,property:c,binding:m})}}}return s}setUniforms(e,r,s,c){for(const{name:h,property:d,binding:m}of r)this.binders[d].setUniform(m,c,s.get(d),h)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const s=this.binders[r];if(e&&s instanceof rs){const c=e.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(s instanceof En||s instanceof Lr)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const r in this.binders){const s=this.binders[r];(s instanceof En||s instanceof Lr||s instanceof rs)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof En||r instanceof Lr||r instanceof rs)&&r.destroy()}}}class Us{constructor(e,r,s=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new Ku(c,r,s);this.needsUpload=!1,this._featureMap=new is,this._bufferOffset=0}populatePaintArrays(e,r,s,c,h,d){for(const m in this.programConfigurations)this.programConfigurations[m].populatePaintArrays(e,r,c,h,d);r.id!==void 0&&this._featureMap.add(r.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,s,c){for(const h of s)this.needsUpload=this.programConfigurations[h.id].updatePaintArrays(e,this._featureMap,r,h,c)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Ed(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function Yu(i,e,r){const s={color:{source:o,composite:oe},number:{source:O,composite:o}},c=function(h){return{"line-pattern":{source:hi,composite:hi},"fill-pattern":{source:hi,composite:hi},"fill-extrusion-pattern":{source:hi,composite:hi}}[h]}(i);return c&&c[r]||s[e][r]}Oe("ConstantBinder",ha),Oe("CrossFadedConstantBinder",mo),Oe("SourceExpressionBinder",En),Oe("CrossFadedCompositeBinder",rs),Oe("CompositeExpressionBinder",Lr),Oe("ProgramConfiguration",Ku,{omit:["_buffers"]}),Oe("ProgramConfigurationSet",Us);var ai=8192;const Sc=Math.pow(2,14)-1,Ju=-Sc-1;function Vs(i){const e=ai/i.extent,r=i.loadGeometry();for(let s=0;s<r.length;s++){const c=r[s];for(let h=0;h<c.length;h++){const d=c[h],m=Math.round(d.x*e),g=Math.round(d.y*e);d.x=Y(m,Ju,Sc),d.y=Y(g,Ju,Sc),(m<d.x||m>d.x+1||g<d.y||g>d.y+1)&&st("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Ns(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Vs(i):[]}}function El(i,e,r,s,c){i.emplaceBack(2*e+(s+1)/2,2*r+(c+1)/2)}class Ic{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new kt,this.indexArray=new Di,this.segments=new pt,this.programConfigurations=new Us(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){const c=this.layers[0],h=[];let d=null,m=!1;c.type==="circle"&&(d=c.layout.get("circle-sort-key"),m=!d.isConstant());for(const{feature:g,id:x,index:w,sourceLayerIndex:E}of e){const A=this.layers[0]._featureFilter.needGeometry,z=Ns(g,A);if(!this.layers[0]._featureFilter.filter(new Gt(this.zoom),z,s))continue;const P=m?d.evaluate(z,{},s):void 0,$={id:x,properties:g.properties,type:g.type,sourceLayerIndex:E,index:w,geometry:A?z.geometry:Vs(g),patterns:{},sortKey:P};h.push($)}m&&h.sort((g,x)=>g.sortKey-x.sortKey);for(const g of h){const{geometry:x,index:w,sourceLayerIndex:E}=g,A=e[w].feature;this.addFeature(g,x,w,s),r.featureIndex.insert(A,x,w,E,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,oi),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,s,c){for(const h of r)for(const d of h){const m=d.x,g=d.y;if(m<0||m>=ai||g<0||g>=ai)continue;const x=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),w=x.vertexLength;El(this.layoutVertexArray,m,g,-1,-1),El(this.layoutVertexArray,m,g,1,-1),El(this.layoutVertexArray,m,g,1,1),El(this.layoutVertexArray,m,g,-1,1),this.indexArray.emplaceBack(w,w+1,w+2),this.indexArray.emplaceBack(w,w+3,w+2),x.vertexLength+=4,x.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},c)}}function Qu(i,e){for(let r=0;r<i.length;r++)if(go(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(go(i,e[r]))return!0;return!!Ac(i,e)}function Sd(i,e,r){return!!go(i,e)||!!Cc(e,i,r)}function eh(i,e){if(i.length===1)return ih(e,i[0]);for(let r=0;r<e.length;r++){const s=e[r];for(let c=0;c<s.length;c++)if(go(i,s[c]))return!0}for(let r=0;r<i.length;r++)if(ih(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Ac(i,e[r]))return!0;return!1}function Id(i,e,r){if(i.length>1){if(Ac(i,e))return!0;for(let s=0;s<e.length;s++)if(Cc(e[s],i,r))return!0}for(let s=0;s<i.length;s++)if(Cc(i[s],e,r))return!0;return!1}function Ac(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const s=i[r],c=i[r+1];for(let h=0;h<e.length-1;h++)if(Ad(s,c,e[h],e[h+1]))return!0}return!1}function Ad(i,e,r,s){return Qt(i,r,s)!==Qt(e,r,s)&&Qt(i,e,r)!==Qt(i,e,s)}function Cc(i,e,r){const s=r*r;if(e.length===1)return i.distSqr(e[0])<s;for(let c=1;c<e.length;c++)if(th(i,e[c-1],e[c])<s)return!0;return!1}function th(i,e,r){const s=e.distSqr(r);if(s===0)return i.distSqr(e);const c=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/s;return i.distSqr(c<0?e:c>1?r:r.sub(e)._mult(c)._add(e))}function ih(i,e){let r,s,c,h=!1;for(let d=0;d<i.length;d++){r=i[d];for(let m=0,g=r.length-1;m<r.length;g=m++)s=r[m],c=r[g],s.y>e.y!=c.y>e.y&&e.x<(c.x-s.x)*(e.y-s.y)/(c.y-s.y)+s.x&&(h=!h)}return h}function go(i,e){let r=!1;for(let s=0,c=i.length-1;s<i.length;c=s++){const h=i[s],d=i[c];h.y>e.y!=d.y>e.y&&e.x<(d.x-h.x)*(e.y-h.y)/(d.y-h.y)+h.x&&(r=!r)}return r}function Cd(i,e,r){const s=r[0],c=r[2];if(i.x<s.x&&e.x<s.x||i.x>c.x&&e.x>c.x||i.y<s.y&&e.y<s.y||i.y>c.y&&e.y>c.y)return!1;const h=Qt(i,e,r[0]);return h!==Qt(i,e,r[1])||h!==Qt(i,e,r[2])||h!==Qt(i,e,r[3])}function pa(i,e,r){const s=e.paint.get(i).value;return s.kind==="constant"?s.value:r.programConfigurations.get(e.id).getMaxValue(i)}function Sl(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Il(i,e,r,s,c){if(!e[0]&&!e[1])return i;const h=Je.convert(e)._mult(c);r==="viewport"&&h._rotate(-s);const d=[];for(let m=0;m<i.length;m++)d.push(i[m].sub(h));return d}Oe("CircleBucket",Ic,{omit:["layers"]});const kd=new yi({"circle-sort-key":new Ke(ge.layout_circle["circle-sort-key"])});var Md={paint:new yi({"circle-radius":new Ke(ge.paint_circle["circle-radius"]),"circle-color":new Ke(ge.paint_circle["circle-color"]),"circle-blur":new Ke(ge.paint_circle["circle-blur"]),"circle-opacity":new Ke(ge.paint_circle["circle-opacity"]),"circle-translate":new Ge(ge.paint_circle["circle-translate"]),"circle-translate-anchor":new Ge(ge.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ge(ge.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ge(ge.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ke(ge.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ke(ge.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ke(ge.paint_circle["circle-stroke-opacity"])}),layout:kd},Li=1e-6,Bi=typeof Float32Array<"u"?Float32Array:Array;function rh(){var i=new Bi(9);return Bi!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function kc(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function nh(i,e,r){var s=e[0],c=e[1],h=e[2],d=e[3],m=e[4],g=e[5],x=e[6],w=e[7],E=e[8],A=e[9],z=e[10],P=e[11],$=e[12],N=e[13],te=e[14],ae=e[15],ee=r[0],se=r[1],xe=r[2],ye=r[3];return i[0]=ee*s+se*m+xe*E+ye*$,i[1]=ee*c+se*g+xe*A+ye*N,i[2]=ee*h+se*x+xe*z+ye*te,i[3]=ee*d+se*w+xe*P+ye*ae,i[4]=(ee=r[4])*s+(se=r[5])*m+(xe=r[6])*E+(ye=r[7])*$,i[5]=ee*c+se*g+xe*A+ye*N,i[6]=ee*h+se*x+xe*z+ye*te,i[7]=ee*d+se*w+xe*P+ye*ae,i[8]=(ee=r[8])*s+(se=r[9])*m+(xe=r[10])*E+(ye=r[11])*$,i[9]=ee*c+se*g+xe*A+ye*N,i[10]=ee*h+se*x+xe*z+ye*te,i[11]=ee*d+se*w+xe*P+ye*ae,i[12]=(ee=r[12])*s+(se=r[13])*m+(xe=r[14])*E+(ye=r[15])*$,i[13]=ee*c+se*g+xe*A+ye*N,i[14]=ee*h+se*x+xe*z+ye*te,i[15]=ee*d+se*w+xe*P+ye*ae,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var da,zd=nh;function sh(){var i=new Bi(3);return Bi!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function oh(i,e,r){var s=new Bi(3);return s[0]=i,s[1]=e,s[2]=r,s}function Al(i,e,r){var s=e[0],c=e[1],h=e[2],d=e[3];return i[0]=r[0]*s+r[4]*c+r[8]*h+r[12]*d,i[1]=r[1]*s+r[5]*c+r[9]*h+r[13]*d,i[2]=r[2]*s+r[6]*c+r[10]*h+r[14]*d,i[3]=r[3]*s+r[7]*c+r[11]*h+r[15]*d,i}function ah(){var i=new Bi(4);return Bi!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function lh(i,e){const r=Al([],[i.x,i.y,0,1],e);return new Je(r[0]/r[3],r[1]/r[3])}sh(),da=new Bi(4),Bi!=Float32Array&&(da[0]=0,da[1]=0,da[2]=0,da[3]=0),sh(),oh(1,0,0),oh(0,1,0),ah(),ah(),rh(),function(){var i;i=new Bi(2),Bi!=Float32Array&&(i[0]=0,i[1]=0)}();class ch extends Ic{}Oe("HeatmapBucket",ch,{omit:["layers"]});var Pd={paint:new yi({"heatmap-radius":new Ke(ge.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ke(ge.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ge(ge.paint_heatmap["heatmap-intensity"]),"heatmap-color":new en(ge.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ge(ge.paint_heatmap["heatmap-opacity"])})};function Mc(i,{width:e,height:r},s,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*r*s)throw new RangeError(`mismatched image size. expected: ${c.length} but got: ${e*r*s}`)}else c=new Uint8Array(e*r*s);return i.width=e,i.height=r,i.data=c,i}function uh(i,{width:e,height:r},s){if(e===i.width&&r===i.height)return;const c=Mc({},{width:e,height:r},s);zc(i,c,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},s),i.width=e,i.height=r,i.data=c.data}function zc(i,e,r,s,c,h){if(c.width===0||c.height===0)return e;if(c.width>i.width||c.height>i.height||r.x>i.width-c.width||r.y>i.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||s.x>e.width-c.width||s.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const d=i.data,m=e.data;if(d===m)throw new Error("srcData equals dstData, so image is already copied");for(let g=0;g<c.height;g++){const x=((r.y+g)*i.width+r.x)*h,w=((s.y+g)*e.width+s.x)*h;for(let E=0;E<c.width*h;E++)m[w+E]=d[x+E]}return e}class fa{constructor(e,r){Mc(this,e,1,r)}resize(e){uh(this,e,1)}clone(){return new fa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,c,h){zc(e,r,s,c,h,1)}}class hr{constructor(e,r){Mc(this,e,4,r)}resize(e){uh(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new hr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,c,h){zc(e,r,s,c,h,4)}}function hh(i){const e={},r=i.resolution||256,s=i.clips?i.clips.length:1,c=i.image||new hr({width:r,height:s});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const h=(d,m,g)=>{e[i.evaluationKey]=g;const x=i.expression.evaluate(e);c.data[d+m+0]=Math.floor(255*x.r/x.a),c.data[d+m+1]=Math.floor(255*x.g/x.a),c.data[d+m+2]=Math.floor(255*x.b/x.a),c.data[d+m+3]=Math.floor(255*x.a)};if(i.clips)for(let d=0,m=0;d<s;++d,m+=4*r)for(let g=0,x=0;g<r;g++,x+=4){const w=g/(r-1),{start:E,end:A}=i.clips[d];h(m,x,E*(1-w)+A*w)}else for(let d=0,m=0;d<r;d++,m+=4)h(0,m,d/(r-1));return c}Oe("AlphaImage",fa),Oe("RGBAImage",hr);var Dd={paint:new yi({"hillshade-illumination-direction":new Ge(ge.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ge(ge.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ge(ge.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ge(ge.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ge(ge.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ge(ge.paint_hillshade["hillshade-accent-color"])})};const Ld=ii([{name:"a_pos",components:2,type:"Int16"}],4),{members:Bd}=Ld;var Cl={exports:{}};function kl(i,e,r){r=r||2;var s,c,h,d,m,g,x,w=e&&e.length,E=w?e[0]*r:i.length,A=ph(i,0,E,r,!0),z=[];if(!A||A.next===A.prev)return z;if(w&&(A=function($,N,te,ae){var ee,se,xe,ye=[];for(ee=0,se=N.length;ee<se;ee++)(xe=ph($,N[ee]*ae,ee<se-1?N[ee+1]*ae:$.length,ae,!1))===xe.next&&(xe.steiner=!0),ye.push(qd(xe));for(ye.sort(Vd),ee=0;ee<ye.length;ee++)te=Nd(ye[ee],te);return te}(i,e,A,r)),i.length>80*r){s=h=i[0],c=d=i[1];for(var P=r;P<E;P+=r)(m=i[P])<s&&(s=m),(g=i[P+1])<c&&(c=g),m>h&&(h=m),g>d&&(d=g);x=(x=Math.max(h-s,d-c))!==0?32767/x:0}return ma(A,z,r,s,c,x,0),z}function ph(i,e,r,s,c){var h,d;if(c===Lc(i,e,r,s)>0)for(h=e;h<r;h+=s)d=mh(h,i[h],i[h+1],d);else for(h=r-s;h>=e;h-=s)d=mh(h,i[h],i[h+1],d);return d&&Ml(d,d.next)&&(_a(d),d=d.next),d}function $s(i,e){if(!i)return i;e||(e=i);var r,s=i;do if(r=!1,s.steiner||!Ml(s,s.next)&&ei(s.prev,s,s.next)!==0)s=s.next;else{if(_a(s),(s=e=s.prev)===s.next)break;r=!0}while(r||s!==e);return e}function ma(i,e,r,s,c,h,d){if(i){!d&&h&&function(w,E,A,z){var P=w;do P.z===0&&(P.z=Pc(P.x,P.y,E,A,z)),P.prevZ=P.prev,P.nextZ=P.next,P=P.next;while(P!==w);P.prevZ.nextZ=null,P.prevZ=null,function($){var N,te,ae,ee,se,xe,ye,Fe,Ve=1;do{for(te=$,$=null,se=null,xe=0;te;){for(xe++,ae=te,ye=0,N=0;N<Ve&&(ye++,ae=ae.nextZ);N++);for(Fe=Ve;ye>0||Fe>0&&ae;)ye!==0&&(Fe===0||!ae||te.z<=ae.z)?(ee=te,te=te.nextZ,ye--):(ee=ae,ae=ae.nextZ,Fe--),se?se.nextZ=ee:$=ee,ee.prevZ=se,se=ee;te=ae}se.nextZ=null,Ve*=2}while(xe>1)}(P)}(i,s,c,h);for(var m,g,x=i;i.prev!==i.next;)if(m=i.prev,g=i.next,h?Fd(i,s,c,h):Rd(i))e.push(m.i/r|0),e.push(i.i/r|0),e.push(g.i/r|0),_a(i),i=g.next,x=g.next;else if((i=g)===x){d?d===1?ma(i=Od($s(i),e,r),e,r,s,c,h,2):d===2&&Ud(i,e,r,s,c,h):ma($s(i),e,r,s,c,h,1);break}}}function Rd(i){var e=i.prev,r=i,s=i.next;if(ei(e,r,s)>=0)return!1;for(var c=e.x,h=r.x,d=s.x,m=e.y,g=r.y,x=s.y,w=c<h?c<d?c:d:h<d?h:d,E=m<g?m<x?m:x:g<x?g:x,A=c>h?c>d?c:d:h>d?h:d,z=m>g?m>x?m:x:g>x?g:x,P=s.next;P!==e;){if(P.x>=w&&P.x<=A&&P.y>=E&&P.y<=z&&_o(c,m,h,g,d,x,P.x,P.y)&&ei(P.prev,P,P.next)>=0)return!1;P=P.next}return!0}function Fd(i,e,r,s){var c=i.prev,h=i,d=i.next;if(ei(c,h,d)>=0)return!1;for(var m=c.x,g=h.x,x=d.x,w=c.y,E=h.y,A=d.y,z=m<g?m<x?m:x:g<x?g:x,P=w<E?w<A?w:A:E<A?E:A,$=m>g?m>x?m:x:g>x?g:x,N=w>E?w>A?w:A:E>A?E:A,te=Pc(z,P,e,r,s),ae=Pc($,N,e,r,s),ee=i.prevZ,se=i.nextZ;ee&&ee.z>=te&&se&&se.z<=ae;){if(ee.x>=z&&ee.x<=$&&ee.y>=P&&ee.y<=N&&ee!==c&&ee!==d&&_o(m,w,g,E,x,A,ee.x,ee.y)&&ei(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,se.x>=z&&se.x<=$&&se.y>=P&&se.y<=N&&se!==c&&se!==d&&_o(m,w,g,E,x,A,se.x,se.y)&&ei(se.prev,se,se.next)>=0))return!1;se=se.nextZ}for(;ee&&ee.z>=te;){if(ee.x>=z&&ee.x<=$&&ee.y>=P&&ee.y<=N&&ee!==c&&ee!==d&&_o(m,w,g,E,x,A,ee.x,ee.y)&&ei(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;se&&se.z<=ae;){if(se.x>=z&&se.x<=$&&se.y>=P&&se.y<=N&&se!==c&&se!==d&&_o(m,w,g,E,x,A,se.x,se.y)&&ei(se.prev,se,se.next)>=0)return!1;se=se.nextZ}return!0}function Od(i,e,r){var s=i;do{var c=s.prev,h=s.next.next;!Ml(c,h)&&dh(c,s,s.next,h)&&ga(c,h)&&ga(h,c)&&(e.push(c.i/r|0),e.push(s.i/r|0),e.push(h.i/r|0),_a(s),_a(s.next),s=i=h),s=s.next}while(s!==i);return $s(s)}function Ud(i,e,r,s,c,h){var d=i;do{for(var m=d.next.next;m!==d.prev;){if(d.i!==m.i&&Gd(d,m)){var g=fh(d,m);return d=$s(d,d.next),g=$s(g,g.next),ma(d,e,r,s,c,h,0),void ma(g,e,r,s,c,h,0)}m=m.next}d=d.next}while(d!==i)}function Vd(i,e){return i.x-e.x}function Nd(i,e){var r=function(c,h){var d,m=h,g=c.x,x=c.y,w=-1/0;do{if(x<=m.y&&x>=m.next.y&&m.next.y!==m.y){var E=m.x+(x-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(E<=g&&E>w&&(w=E,d=m.x<m.next.x?m:m.next,E===g))return d}m=m.next}while(m!==h);if(!d)return null;var A,z=d,P=d.x,$=d.y,N=1/0;m=d;do g>=m.x&&m.x>=P&&g!==m.x&&_o(x<$?g:w,x,P,$,x<$?w:g,x,m.x,m.y)&&(A=Math.abs(x-m.y)/(g-m.x),ga(m,c)&&(A<N||A===N&&(m.x>d.x||m.x===d.x&&$d(d,m)))&&(d=m,N=A)),m=m.next;while(m!==z);return d}(i,e);if(!r)return e;var s=fh(r,i);return $s(s,s.next),$s(r,r.next)}function $d(i,e){return ei(i.prev,i,e.prev)<0&&ei(e.next,i,i.next)<0}function Pc(i,e,r,s,c){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*c|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function qd(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function _o(i,e,r,s,c,h,d,m){return(c-d)*(e-m)>=(i-d)*(h-m)&&(i-d)*(s-m)>=(r-d)*(e-m)&&(r-d)*(h-m)>=(c-d)*(s-m)}function Gd(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,s){var c=r;do{if(c.i!==r.i&&c.next.i!==r.i&&c.i!==s.i&&c.next.i!==s.i&&dh(c,c.next,r,s))return!0;c=c.next}while(c!==r);return!1}(i,e)&&(ga(i,e)&&ga(e,i)&&function(r,s){var c=r,h=!1,d=(r.x+s.x)/2,m=(r.y+s.y)/2;do c.y>m!=c.next.y>m&&c.next.y!==c.y&&d<(c.next.x-c.x)*(m-c.y)/(c.next.y-c.y)+c.x&&(h=!h),c=c.next;while(c!==r);return h}(i,e)&&(ei(i.prev,i,e.prev)||ei(i,e.prev,e))||Ml(i,e)&&ei(i.prev,i,i.next)>0&&ei(e.prev,e,e.next)>0)}function ei(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function Ml(i,e){return i.x===e.x&&i.y===e.y}function dh(i,e,r,s){var c=Pl(ei(i,e,r)),h=Pl(ei(i,e,s)),d=Pl(ei(r,s,i)),m=Pl(ei(r,s,e));return c!==h&&d!==m||!(c!==0||!zl(i,r,e))||!(h!==0||!zl(i,s,e))||!(d!==0||!zl(r,i,s))||!(m!==0||!zl(r,e,s))}function zl(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function Pl(i){return i>0?1:i<0?-1:0}function ga(i,e){return ei(i.prev,i,i.next)<0?ei(i,e,i.next)>=0&&ei(i,i.prev,e)>=0:ei(i,e,i.prev)<0||ei(i,i.next,e)<0}function fh(i,e){var r=new Dc(i.i,i.x,i.y),s=new Dc(e.i,e.x,e.y),c=i.next,h=e.prev;return i.next=e,e.prev=i,r.next=c,c.prev=r,s.next=r,r.prev=s,h.next=s,s.prev=h,s}function mh(i,e,r,s){var c=new Dc(i,e,r);return s?(c.next=s.next,c.prev=s,s.next.prev=c,s.next=c):(c.prev=c,c.next=c),c}function _a(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Dc(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Lc(i,e,r,s){for(var c=0,h=e,d=r-s;h<r;h+=s)c+=(i[d]-i[h])*(i[h+1]+i[d+1]),d=h;return c}function Zd(i,e,r,s,c){gh(i,e,r||0,s||i.length-1,c||jd)}function gh(i,e,r,s,c){for(;s>r;){if(s-r>600){var h=s-r+1,d=e-r+1,m=Math.log(h),g=.5*Math.exp(2*m/3),x=.5*Math.sqrt(m*g*(h-g)/h)*(d-h/2<0?-1:1);gh(i,e,Math.max(r,Math.floor(e-d*g/h+x)),Math.min(s,Math.floor(e+(h-d)*g/h+x)),c)}var w=i[e],E=r,A=s;for(ya(i,r,e),c(i[s],w)>0&&ya(i,r,s);E<A;){for(ya(i,E,A),E++,A--;c(i[E],w)<0;)E++;for(;c(i[A],w)>0;)A--}c(i[r],w)===0?ya(i,r,A):ya(i,++A,s),A<=e&&(r=A+1),e<=A&&(s=A-1)}}function ya(i,e,r){var s=i[e];i[e]=i[r],i[r]=s}function jd(i,e){return i<e?-1:i>e?1:0}function Bc(i,e){const r=i.length;if(r<=1)return[i];const s=[];let c,h;for(let d=0;d<r;d++){const m=tt(i[d]);m!==0&&(i[d].area=Math.abs(m),h===void 0&&(h=m<0),h===m<0?(c&&s.push(c),c=[i[d]]):c.push(i[d]))}if(c&&s.push(c),e>1)for(let d=0;d<s.length;d++)s[d].length<=e||(Zd(s[d],e,1,s[d].length-1,Xd),s[d]=s[d].slice(0,e));return s}function Xd(i,e){return e.area-i.area}function Rc(i,e,r){const s=r.patternDependencies;let c=!1;for(const h of e){const d=h.paint.get(`${i}-pattern`);d.isConstant()||(c=!0);const m=d.constantOr(null);m&&(c=!0,s[m.to]=!0,s[m.from]=!0)}return c}function Fc(i,e,r,s,c){const h=c.patternDependencies;for(const d of e){const m=d.paint.get(`${i}-pattern`).value;if(m.kind!=="constant"){let g=m.evaluate({zoom:s-1},r,{},c.availableImages),x=m.evaluate({zoom:s},r,{},c.availableImages),w=m.evaluate({zoom:s+1},r,{},c.availableImages);g=g&&g.name?g.name:g,x=x&&x.name?x.name:x,w=w&&w.name?w.name:w,h[g]=!0,h[x]=!0,h[w]=!0,r.patterns[d.id]={min:g,mid:x,max:w}}}return r}Cl.exports=kl,Cl.exports.default=kl,kl.deviation=function(i,e,r,s){var c=e&&e.length,h=Math.abs(Lc(i,0,c?e[0]*r:i.length,r));if(c)for(var d=0,m=e.length;d<m;d++)h-=Math.abs(Lc(i,e[d]*r,d<m-1?e[d+1]*r:i.length,r));var g=0;for(d=0;d<s.length;d+=3){var x=s[d]*r,w=s[d+1]*r,E=s[d+2]*r;g+=Math.abs((i[x]-i[E])*(i[w+1]-i[x+1])-(i[x]-i[w])*(i[E+1]-i[x+1]))}return h===0&&g===0?0:Math.abs((g-h)/h)},kl.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},s=0,c=0;c<i.length;c++){for(var h=0;h<i[c].length;h++)for(var d=0;d<e;d++)r.vertices.push(i[c][h][d]);c>0&&r.holes.push(s+=i[c-1].length)}return r};class Oc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Mt,this.indexArray=new Di,this.indexArray2=new Dr,this.programConfigurations=new Us(e.layers,e.zoom),this.segments=new pt,this.segments2=new pt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.hasPattern=Rc("fill",this.layers,r);const c=this.layers[0].layout.get("fill-sort-key"),h=!c.isConstant(),d=[];for(const{feature:m,id:g,index:x,sourceLayerIndex:w}of e){const E=this.layers[0]._featureFilter.needGeometry,A=Ns(m,E);if(!this.layers[0]._featureFilter.filter(new Gt(this.zoom),A,s))continue;const z=h?c.evaluate(A,{},s,r.availableImages):void 0,P={id:g,properties:m.properties,type:m.type,sourceLayerIndex:w,index:x,geometry:E?A.geometry:Vs(m),patterns:{},sortKey:z};d.push(P)}h&&d.sort((m,g)=>m.sortKey-g.sortKey);for(const m of d){const{geometry:g,index:x,sourceLayerIndex:w}=m;if(this.hasPattern){const E=Fc("fill",this.layers,m,this.zoom,r);this.patternFeatures.push(E)}else this.addFeature(m,g,x,s,{});r.featureIndex.insert(e[x].feature,g,x,w,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}addFeatures(e,r,s){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Bd),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,s,c,h){for(const d of Bc(r,500)){let m=0;for(const z of d)m+=z.length;const g=this.segments.prepareSegment(m,this.layoutVertexArray,this.indexArray),x=g.vertexLength,w=[],E=[];for(const z of d){if(z.length===0)continue;z!==d[0]&&E.push(w.length/2);const P=this.segments2.prepareSegment(z.length,this.layoutVertexArray,this.indexArray2),$=P.vertexLength;this.layoutVertexArray.emplaceBack(z[0].x,z[0].y),this.indexArray2.emplaceBack($+z.length-1,$),w.push(z[0].x),w.push(z[0].y);for(let N=1;N<z.length;N++)this.layoutVertexArray.emplaceBack(z[N].x,z[N].y),this.indexArray2.emplaceBack($+N-1,$+N),w.push(z[N].x),w.push(z[N].y);P.vertexLength+=z.length,P.primitiveLength+=z.length}const A=Cl.exports(w,E);for(let z=0;z<A.length;z+=3)this.indexArray.emplaceBack(x+A[z],x+A[z+1],x+A[z+2]);g.vertexLength+=m,g.primitiveLength+=A.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,c)}}Oe("FillBucket",Oc,{omit:["layers","patternFeatures"]});const Wd=new yi({"fill-sort-key":new Ke(ge.layout_fill["fill-sort-key"])});var Hd={paint:new yi({"fill-antialias":new Ge(ge.paint_fill["fill-antialias"]),"fill-opacity":new Ke(ge.paint_fill["fill-opacity"]),"fill-color":new Ke(ge.paint_fill["fill-color"]),"fill-outline-color":new Ke(ge.paint_fill["fill-outline-color"]),"fill-translate":new Ge(ge.paint_fill["fill-translate"]),"fill-translate-anchor":new Ge(ge.paint_fill["fill-translate-anchor"]),"fill-pattern":new ts(ge.paint_fill["fill-pattern"])}),layout:Wd};const Kd=ii([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Yd=ii([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Jd}=Kd;var ns={},Qd=Je,_h=yo;function yo(i,e,r,s,c){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=s,this._values=c,i.readFields(ef,this,e)}function ef(i,e,r){i==1?e.id=r.readVarint():i==2?function(s,c){for(var h=s.readVarint()+s.pos;s.pos<h;){var d=c._keys[s.readVarint()],m=c._values[s.readVarint()];c.properties[d]=m}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function tf(i){for(var e,r,s=0,c=0,h=i.length,d=h-1;c<h;d=c++)s+=((r=i[d]).x-(e=i[c]).x)*(e.y+r.y);return s}yo.types=["Unknown","Point","LineString","Polygon"],yo.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,s=1,c=0,h=0,d=0,m=[];i.pos<r;){if(c<=0){var g=i.readVarint();s=7&g,c=g>>3}if(c--,s===1||s===2)h+=i.readSVarint(),d+=i.readSVarint(),s===1&&(e&&m.push(e),e=[]),e.push(new Qd(h,d));else{if(s!==7)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&m.push(e),m},yo.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,s=0,c=0,h=0,d=1/0,m=-1/0,g=1/0,x=-1/0;i.pos<e;){if(s<=0){var w=i.readVarint();r=7&w,s=w>>3}if(s--,r===1||r===2)(c+=i.readSVarint())<d&&(d=c),c>m&&(m=c),(h+=i.readSVarint())<g&&(g=h),h>x&&(x=h);else if(r!==7)throw new Error("unknown command "+r)}return[d,g,m,x]},yo.prototype.toGeoJSON=function(i,e,r){var s,c,h=this.extent*Math.pow(2,r),d=this.extent*i,m=this.extent*e,g=this.loadGeometry(),x=yo.types[this.type];function w(z){for(var P=0;P<z.length;P++){var $=z[P];z[P]=[360*($.x+d)/h-180,360/Math.PI*Math.atan(Math.exp((180-360*($.y+m)/h)*Math.PI/180))-90]}}switch(this.type){case 1:var E=[];for(s=0;s<g.length;s++)E[s]=g[s][0];w(g=E);break;case 2:for(s=0;s<g.length;s++)w(g[s]);break;case 3:for(g=function(z){var P=z.length;if(P<=1)return[z];for(var $,N,te=[],ae=0;ae<P;ae++){var ee=tf(z[ae]);ee!==0&&(N===void 0&&(N=ee<0),N===ee<0?($&&te.push($),$=[z[ae]]):$.push(z[ae]))}return $&&te.push($),te}(g),s=0;s<g.length;s++)for(c=0;c<g[s].length;c++)w(g[s][c])}g.length===1?g=g[0]:x="Multi"+x;var A={type:"Feature",geometry:{type:x,coordinates:g},properties:this.properties};return"id"in this&&(A.id=this.id),A};var rf=_h,yh=xh;function xh(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(nf,this,e),this.length=this._features.length}function nf(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(s){for(var c=null,h=s.readVarint()+s.pos;s.pos<h;){var d=s.readVarint()>>3;c=d===1?s.readString():d===2?s.readFloat():d===3?s.readDouble():d===4?s.readVarint64():d===5?s.readVarint():d===6?s.readSVarint():d===7?s.readBoolean():null}return c}(r))}xh.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new rf(this._pbf,e,this.extent,this._keys,this._values)};var sf=yh;function of(i,e,r){if(i===3){var s=new sf(r,r.readVarint()+r.pos);s.length&&(e[s.name]=s)}}ns.VectorTile=function(i,e){this.layers=i.readFields(of,{},e)},ns.VectorTileFeature=_h,ns.VectorTileLayer=yh;const af=ns.VectorTileFeature.types,Uc=Math.pow(2,13);function xa(i,e,r,s,c,h,d,m){i.emplaceBack(e,r,2*Math.floor(s*Uc)+d,c*Uc*2,h*Uc*2,Math.round(m))}class Vc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new mt,this.centroidVertexArray=new je,this.indexArray=new Di,this.programConfigurations=new Us(e.layers,e.zoom),this.segments=new pt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.features=[],this.hasPattern=Rc("fill-extrusion",this.layers,r);for(const{feature:c,id:h,index:d,sourceLayerIndex:m}of e){const g=this.layers[0]._featureFilter.needGeometry,x=Ns(c,g);if(!this.layers[0]._featureFilter.filter(new Gt(this.zoom),x,s))continue;const w={id:h,sourceLayerIndex:m,index:d,geometry:g?x.geometry:Vs(c),properties:c.properties,type:c.type,patterns:{}};this.hasPattern?this.features.push(Fc("fill-extrusion",this.layers,w,this.zoom,r)):this.addFeature(w,w.geometry,d,s,{}),r.featureIndex.insert(c,w.geometry,d,m,this.index,!0)}}addFeatures(e,r,s){for(const c of this.features){const{geometry:h}=c;this.addFeature(c,h,c.index,r,s)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Jd),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Yd.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,s,c,h){const d={x:0,y:0,vertexCount:0};for(const m of Bc(r,500)){let g=0;for(const P of m)g+=P.length;let x=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const P of m){if(P.length===0||cf(P))continue;let $=0;for(let N=0;N<P.length;N++){const te=P[N];if(N>=1){const ae=P[N-1];if(!lf(te,ae)){x.vertexLength+4>pt.MAX_VERTEX_ARRAY_LENGTH&&(x=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ee=te.sub(ae)._perp()._unit(),se=ae.dist(te);$+se>32768&&($=0),xa(this.layoutVertexArray,te.x,te.y,ee.x,ee.y,0,0,$),xa(this.layoutVertexArray,te.x,te.y,ee.x,ee.y,0,1,$),d.x+=2*te.x,d.y+=2*te.y,d.vertexCount+=2,$+=se,xa(this.layoutVertexArray,ae.x,ae.y,ee.x,ee.y,0,0,$),xa(this.layoutVertexArray,ae.x,ae.y,ee.x,ee.y,0,1,$),d.x+=2*ae.x,d.y+=2*ae.y,d.vertexCount+=2;const xe=x.vertexLength;this.indexArray.emplaceBack(xe,xe+2,xe+1),this.indexArray.emplaceBack(xe+1,xe+2,xe+3),x.vertexLength+=4,x.primitiveLength+=2}}}}if(x.vertexLength+g>pt.MAX_VERTEX_ARRAY_LENGTH&&(x=this.segments.prepareSegment(g,this.layoutVertexArray,this.indexArray)),af[e.type]!=="Polygon")continue;const w=[],E=[],A=x.vertexLength;for(const P of m)if(P.length!==0){P!==m[0]&&E.push(w.length/2);for(let $=0;$<P.length;$++){const N=P[$];xa(this.layoutVertexArray,N.x,N.y,0,0,1,1,0),d.x+=N.x,d.y+=N.y,d.vertexCount+=1,w.push(N.x),w.push(N.y)}}const z=Cl.exports(w,E);for(let P=0;P<z.length;P+=3)this.indexArray.emplaceBack(A+z[P],A+z[P+2],A+z[P+1]);x.primitiveLength+=z.length/3,x.vertexLength+=g}for(let m=0;m<d.vertexCount;m++)this.centroidVertexArray.emplaceBack(Math.floor(d.x/d.vertexCount),Math.floor(d.y/d.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,c)}}function lf(i,e){return i.x===e.x&&(i.x<0||i.x>ai)||i.y===e.y&&(i.y<0||i.y>ai)}function cf(i){return i.every(e=>e.x<0)||i.every(e=>e.x>ai)||i.every(e=>e.y<0)||i.every(e=>e.y>ai)}Oe("FillExtrusionBucket",Vc,{omit:["layers","features"]});var uf={paint:new yi({"fill-extrusion-opacity":new Ge(ge["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ke(ge["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ge(ge["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ge(ge["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ts(ge["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ke(ge["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ke(ge["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ge(ge["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function va(i,e){return i.x*e.x+i.y*e.y}function vh(i,e){if(i.length===1){let r=0;const s=e[r++];let c;for(;!c||s.equals(c);)if(c=e[r++],!c)return 1/0;for(;r<e.length;r++){const h=e[r],d=i[0],m=c.sub(s),g=h.sub(s),x=d.sub(s),w=va(m,m),E=va(m,g),A=va(g,g),z=va(x,m),P=va(x,g),$=w*A-E*E,N=(A*z-E*P)/$,te=(w*P-E*z)/$,ae=s.z*(1-N-te)+c.z*N+h.z*te;if(isFinite(ae))return ae}return 1/0}{let r=1/0;for(const s of e)r=Math.min(r,s.z);return r}}const hf=ii([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:pf}=hf,df=ii([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:ff}=df,mf=ns.VectorTileFeature.types,gf=Math.cos(Math.PI/180*37.5),bh=Math.pow(2,14)/.5;class Nc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new vt,this.layoutVertexArray2=new Pt,this.indexArray=new Di,this.programConfigurations=new Us(e.layers,e.zoom),this.segments=new pt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.hasPattern=Rc("line",this.layers,r);const c=this.layers[0].layout.get("line-sort-key"),h=!c.isConstant(),d=[];for(const{feature:m,id:g,index:x,sourceLayerIndex:w}of e){const E=this.layers[0]._featureFilter.needGeometry,A=Ns(m,E);if(!this.layers[0]._featureFilter.filter(new Gt(this.zoom),A,s))continue;const z=h?c.evaluate(A,{},s):void 0,P={id:g,properties:m.properties,type:m.type,sourceLayerIndex:w,index:x,geometry:E?A.geometry:Vs(m),patterns:{},sortKey:z};d.push(P)}h&&d.sort((m,g)=>m.sortKey-g.sortKey);for(const m of d){const{geometry:g,index:x,sourceLayerIndex:w}=m;if(this.hasPattern){const E=Fc("line",this.layers,m,this.zoom,r);this.patternFeatures.push(E)}else this.addFeature(m,g,x,s,{});r.featureIndex.insert(e[x].feature,g,x,w,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}addFeatures(e,r,s){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,ff)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,pf),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,s,c,h){const d=this.layers[0].layout,m=d.get("line-join").evaluate(e,{}),g=d.get("line-cap"),x=d.get("line-miter-limit"),w=d.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const E of r)this.addLine(E,e,m,g,x,w);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,c)}addLine(e,r,s,c,h,d){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let te=0;te<e.length-1;te++)this.totalDistance+=e[te].dist(e[te+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const m=mf[r.type]==="Polygon";let g=e.length;for(;g>=2&&e[g-1].equals(e[g-2]);)g--;let x=0;for(;x<g-1&&e[x].equals(e[x+1]);)x++;if(g<(m?3:2))return;s==="bevel"&&(h=1.05);const w=this.overscaling<=16?122880/(512*this.overscaling):0,E=this.segments.prepareSegment(10*g,this.layoutVertexArray,this.indexArray);let A,z,P,$,N;this.e1=this.e2=-1,m&&(A=e[g-2],N=e[x].sub(A)._unit()._perp());for(let te=x;te<g;te++){if(P=te===g-1?m?e[x+1]:void 0:e[te+1],P&&e[te].equals(P))continue;N&&($=N),A&&(z=A),A=e[te],N=P?P.sub(A)._unit()._perp():$,$=$||N;let ae=$.add(N);ae.x===0&&ae.y===0||ae._unit();const ee=$.x*N.x+$.y*N.y,se=ae.x*N.x+ae.y*N.y,xe=se!==0?1/se:1/0,ye=2*Math.sqrt(2-2*se),Fe=se<gf&&z&&P,Ve=$.x*N.y-$.y*N.x>0;if(Fe&&te>x){const Se=A.dist(z);if(Se>2*w){const De=A.sub(A.sub(z)._mult(w/Se)._round());this.updateDistance(z,De),this.addCurrentVertex(De,$,0,0,E),z=De}}const Pe=z&&P;let Ce=Pe?s:m?"butt":c;if(Pe&&Ce==="round"&&(xe<d?Ce="miter":xe<=2&&(Ce="fakeround")),Ce==="miter"&&xe>h&&(Ce="bevel"),Ce==="bevel"&&(xe>2&&(Ce="flipbevel"),xe<h&&(Ce="miter")),z&&this.updateDistance(z,A),Ce==="miter")ae._mult(xe),this.addCurrentVertex(A,ae,0,0,E);else if(Ce==="flipbevel"){if(xe>100)ae=N.mult(-1);else{const Se=xe*$.add(N).mag()/$.sub(N).mag();ae._perp()._mult(Se*(Ve?-1:1))}this.addCurrentVertex(A,ae,0,0,E),this.addCurrentVertex(A,ae.mult(-1),0,0,E)}else if(Ce==="bevel"||Ce==="fakeround"){const Se=-Math.sqrt(xe*xe-1),De=Ve?Se:0,Me=Ve?0:Se;if(z&&this.addCurrentVertex(A,$,De,Me,E),Ce==="fakeround"){const Te=Math.round(180*ye/Math.PI/20);for(let Xe=1;Xe<Te;Xe++){let Ze=Xe/Te;if(Ze!==.5){const Vt=Ze-.5;Ze+=Ze*Vt*(Ze-1)*((1.0904+ee*(ee*(3.55645-1.43519*ee)-3.2452))*Vt*Vt+(.848013+ee*(.215638*ee-1.06021)))}const ct=N.sub($)._mult(Ze)._add($)._unit()._mult(Ve?-1:1);this.addHalfVertex(A,ct.x,ct.y,!1,Ve,0,E)}}P&&this.addCurrentVertex(A,N,-De,-Me,E)}else if(Ce==="butt")this.addCurrentVertex(A,ae,0,0,E);else if(Ce==="square"){const Se=z?1:-1;this.addCurrentVertex(A,ae,Se,Se,E)}else Ce==="round"&&(z&&(this.addCurrentVertex(A,$,0,0,E),this.addCurrentVertex(A,$,1,1,E,!0)),P&&(this.addCurrentVertex(A,N,-1,-1,E,!0),this.addCurrentVertex(A,N,0,0,E)));if(Fe&&te<g-1){const Se=A.dist(P);if(Se>2*w){const De=A.add(P.sub(A)._mult(w/Se)._round());this.updateDistance(A,De),this.addCurrentVertex(De,N,0,0,E),A=De}}}}addCurrentVertex(e,r,s,c,h,d=!1){const m=r.y*c-r.x,g=-r.y-r.x*c;this.addHalfVertex(e,r.x+r.y*s,r.y-r.x*s,d,!1,s,h),this.addHalfVertex(e,m,g,d,!0,-c,h),this.distance>bh/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,r,s,c,h,d))}addHalfVertex({x:e,y:r},s,c,h,d,m,g){const x=.5*(this.lineClips?this.scaledDistance*(bh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(h?1:0),(r<<1)+(d?1:0),Math.round(63*s)+128,Math.round(63*c)+128,1+(m===0?0:m<0?-1:1)|(63&x)<<2,x>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const w=g.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),g.primitiveLength++),d?this.e2=w:this.e1=w}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}Oe("LineBucket",Nc,{omit:["layers","patternFeatures"]});const _f=new yi({"line-cap":new Ge(ge.layout_line["line-cap"]),"line-join":new Ke(ge.layout_line["line-join"]),"line-miter-limit":new Ge(ge.layout_line["line-miter-limit"]),"line-round-limit":new Ge(ge.layout_line["line-round-limit"]),"line-sort-key":new Ke(ge.layout_line["line-sort-key"])});var wh={paint:new yi({"line-opacity":new Ke(ge.paint_line["line-opacity"]),"line-color":new Ke(ge.paint_line["line-color"]),"line-translate":new Ge(ge.paint_line["line-translate"]),"line-translate-anchor":new Ge(ge.paint_line["line-translate-anchor"]),"line-width":new Ke(ge.paint_line["line-width"]),"line-gap-width":new Ke(ge.paint_line["line-gap-width"]),"line-offset":new Ke(ge.paint_line["line-offset"]),"line-blur":new Ke(ge.paint_line["line-blur"]),"line-dasharray":new aa(ge.paint_line["line-dasharray"]),"line-pattern":new ts(ge.paint_line["line-pattern"]),"line-gradient":new en(ge.paint_line["line-gradient"])}),layout:_f};const Th=new class extends Ke{possiblyEvaluate(i,e){return e=new Gt(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,r,s){return e=qe({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,r,s)}}(wh.paint.properties["line-width"].specification);function Eh(i,e){return e>0?e+2*i:i}Th.useIntegerZoom=!0;const yf=ii([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),xf=ii([{name:"a_projected_pos",components:3,type:"Float32"}],4);ii([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const vf=ii([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);ii([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Sh=ii([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),bf=ii([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function wf(i,e,r){return i.sections.forEach(s=>{s.text=function(c,h,d){const m=h.layout.get("text-transform").evaluate(d,{});return m==="uppercase"?c=c.toLocaleUpperCase():m==="lowercase"&&(c=c.toLocaleLowerCase()),Qi.applyArabicShaping&&(c=Qi.applyArabicShaping(c)),c}(s.text,e,r)}),i}ii([{name:"triangle",components:3,type:"Uint16"}]),ii([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ii([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ii([{type:"Float32",name:"offsetX"}]),ii([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const ba={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var xi=24,$c=Ft,Ih=function(i,e,r,s,c){var h,d,m=8*c-s-1,g=(1<<m)-1,x=g>>1,w=-7,E=r?c-1:0,A=r?-1:1,z=i[e+E];for(E+=A,h=z&(1<<-w)-1,z>>=-w,w+=m;w>0;h=256*h+i[e+E],E+=A,w-=8);for(d=h&(1<<-w)-1,h>>=-w,w+=s;w>0;d=256*d+i[e+E],E+=A,w-=8);if(h===0)h=1-x;else{if(h===g)return d?NaN:1/0*(z?-1:1);d+=Math.pow(2,s),h-=x}return(z?-1:1)*d*Math.pow(2,h-s)},Ah=function(i,e,r,s,c,h){var d,m,g,x=8*h-c-1,w=(1<<x)-1,E=w>>1,A=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,z=s?0:h-1,P=s?1:-1,$=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(m=isNaN(e)?1:0,d=w):(d=Math.floor(Math.log(e)/Math.LN2),e*(g=Math.pow(2,-d))<1&&(d--,g*=2),(e+=d+E>=1?A/g:A*Math.pow(2,1-E))*g>=2&&(d++,g/=2),d+E>=w?(m=0,d=w):d+E>=1?(m=(e*g-1)*Math.pow(2,c),d+=E):(m=e*Math.pow(2,E-1)*Math.pow(2,c),d=0));c>=8;i[r+z]=255&m,z+=P,m/=256,c-=8);for(d=d<<c|m,x+=c;x>0;i[r+z]=255&d,z+=P,d/=256,x-=8);i[r+z-P]|=128*$};function Ft(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Ft.Varint=0,Ft.Fixed64=1,Ft.Bytes=2,Ft.Fixed32=5;var ss,qc=4294967296,Ch=1/qc,kh=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Sn(i){return i.type===Ft.Bytes?i.readVarint()+i.pos:i.pos+1}function xo(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Mh(i,e,r){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(s);for(var c=r.pos-1;c>=i;c--)r.buf[c+s]=r.buf[c]}function Tf(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function Ef(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function Sf(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function If(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function Af(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function Cf(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function kf(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function Mf(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function zf(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function Dl(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function vo(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function zh(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function Pf(i,e,r){i===1&&r.readMessage(Df,e)}function Df(i,e,r){if(i===3){const{id:s,bitmap:c,width:h,height:d,left:m,top:g,advance:x}=r.readMessage(Lf,{});e.push({id:s,bitmap:new fa({width:h+6,height:d+6},c),metrics:{width:h,height:d,left:m,top:g,advance:x}})}}function Lf(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}function Ph(i){let e=0,r=0;for(const d of i)e+=d.w*d.h,r=Math.max(r,d.w);i.sort((d,m)=>m.h-d.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let c=0,h=0;for(const d of i)for(let m=s.length-1;m>=0;m--){const g=s[m];if(!(d.w>g.w||d.h>g.h)){if(d.x=g.x,d.y=g.y,h=Math.max(h,d.y+d.h),c=Math.max(c,d.x+d.w),d.w===g.w&&d.h===g.h){const x=s.pop();m<s.length&&(s[m]=x)}else d.h===g.h?(g.x+=d.w,g.w-=d.w):d.w===g.w?(g.y+=d.h,g.h-=d.h):(s.push({x:g.x+d.w,y:g.y,w:g.w-d.w,h:d.h}),g.y+=d.h,g.h-=d.h);break}}return{w:c,h,fill:e/(c*h)||0}}Ft.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var s=this.readVarint(),c=s>>3,h=this.pos;this.type=7&s,i(c,e,this),this.pos===h&&this.skip(s)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Dl(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=zh(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Dl(this.buf,this.pos)+Dl(this.buf,this.pos+4)*qc;return this.pos+=8,i},readSFixed64:function(){var i=Dl(this.buf,this.pos)+zh(this.buf,this.pos+4)*qc;return this.pos+=8,i},readFloat:function(){var i=Ih(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Ih(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,s=this.buf;return e=127&(r=s[this.pos++]),r<128?e:(e|=(127&(r=s[this.pos++]))<<7,r<128?e:(e|=(127&(r=s[this.pos++]))<<14,r<128?e:(e|=(127&(r=s[this.pos++]))<<21,r<128?e:function(c,h,d){var m,g,x=d.buf;if(m=(112&(g=x[d.pos++]))>>4,g<128||(m|=(127&(g=x[d.pos++]))<<3,g<128)||(m|=(127&(g=x[d.pos++]))<<10,g<128)||(m|=(127&(g=x[d.pos++]))<<17,g<128)||(m|=(127&(g=x[d.pos++]))<<24,g<128)||(m|=(1&(g=x[d.pos++]))<<31,g<128))return xo(c,m,h);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=s[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&kh?function(r,s,c){return kh.decode(r.subarray(s,c))}(this.buf,e,i):function(r,s,c){for(var h="",d=s;d<c;){var m,g,x,w=r[d],E=null,A=w>239?4:w>223?3:w>191?2:1;if(d+A>c)break;A===1?w<128&&(E=w):A===2?(192&(m=r[d+1]))==128&&(E=(31&w)<<6|63&m)<=127&&(E=null):A===3?(g=r[d+2],(192&(m=r[d+1]))==128&&(192&g)==128&&((E=(15&w)<<12|(63&m)<<6|63&g)<=2047||E>=55296&&E<=57343)&&(E=null)):A===4&&(g=r[d+2],x=r[d+3],(192&(m=r[d+1]))==128&&(192&g)==128&&(192&x)==128&&((E=(15&w)<<18|(63&m)<<12|(63&g)<<6|63&x)<=65535||E>=1114112)&&(E=null)),E===null?(E=65533,A=1):E>65535&&(E-=65536,h+=String.fromCharCode(E>>>10&1023|55296),E=56320|1023&E),h+=String.fromCharCode(E),d+=A}return h}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Ft.Bytes)return i.push(this.readVarint(e));var r=Sn(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Ft.Bytes)return i.push(this.readSVarint());var e=Sn(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Ft.Bytes)return i.push(this.readBoolean());var e=Sn(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Ft.Bytes)return i.push(this.readFloat());var e=Sn(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Ft.Bytes)return i.push(this.readDouble());var e=Sn(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Ft.Bytes)return i.push(this.readFixed32());var e=Sn(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Ft.Bytes)return i.push(this.readSFixed32());var e=Sn(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Ft.Bytes)return i.push(this.readFixed64());var e=Sn(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Ft.Bytes)return i.push(this.readSFixed64());var e=Sn(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Ft.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ft.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ft.Fixed32)this.pos+=4;else{if(e!==Ft.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),vo(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),vo(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),vo(this.buf,-1&i,this.pos),vo(this.buf,Math.floor(i*Ch),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),vo(this.buf,-1&i,this.pos),vo(this.buf,Math.floor(i*Ch),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var s,c;if(e>=0?(s=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(h,d,m){m.buf[m.pos++]=127&h|128,h>>>=7,m.buf[m.pos++]=127&h|128,h>>>=7,m.buf[m.pos++]=127&h|128,h>>>=7,m.buf[m.pos++]=127&h|128,m.buf[m.pos]=127&(h>>>=7)}(s,0,r),function(h,d){var m=(7&h)<<4;d.buf[d.pos++]|=m|((h>>>=3)?128:0),h&&(d.buf[d.pos++]=127&h|((h>>>=7)?128:0),h&&(d.buf[d.pos++]=127&h|((h>>>=7)?128:0),h&&(d.buf[d.pos++]=127&h|((h>>>=7)?128:0),h&&(d.buf[d.pos++]=127&h|((h>>>=7)?128:0),h&&(d.buf[d.pos++]=127&h)))))}(c,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(s,c,h){for(var d,m,g=0;g<c.length;g++){if((d=c.charCodeAt(g))>55295&&d<57344){if(!m){d>56319||g+1===c.length?(s[h++]=239,s[h++]=191,s[h++]=189):m=d;continue}if(d<56320){s[h++]=239,s[h++]=191,s[h++]=189,m=d;continue}d=m-55296<<10|d-56320|65536,m=null}else m&&(s[h++]=239,s[h++]=191,s[h++]=189,m=null);d<128?s[h++]=d:(d<2048?s[h++]=d>>6|192:(d<65536?s[h++]=d>>12|224:(s[h++]=d>>18|240,s[h++]=d>>12&63|128),s[h++]=d>>6&63|128),s[h++]=63&d|128)}return h}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&Mh(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),Ah(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Ah(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var s=this.pos-r;s>=128&&Mh(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeMessage:function(i,e,r){this.writeTag(i,Ft.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,Tf,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Ef,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,Af,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,Sf,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,If,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,Cf,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,kf,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,Mf,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,zf,e)},writeBytesField:function(i,e){this.writeTag(i,Ft.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Ft.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Ft.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Ft.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Ft.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Ft.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Ft.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Ft.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Ft.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Ft.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,Boolean(e))}};class Gc{constructor(e,{pixelRatio:r,version:s,stretchX:c,stretchY:h,content:d}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=c,this.stretchY=h,this.content=d,this.version=s}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Dh{constructor(e,r){const s={},c={};this.haveRenderCallbacks=[];const h=[];this.addImages(e,s,h),this.addImages(r,c,h);const{w:d,h:m}=Ph(h),g=new hr({width:d||1,height:m||1});for(const x in e){const w=e[x],E=s[x].paddedRect;hr.copy(w.data,g,{x:0,y:0},{x:E.x+1,y:E.y+1},w.data)}for(const x in r){const w=r[x],E=c[x].paddedRect,A=E.x+1,z=E.y+1,P=w.data.width,$=w.data.height;hr.copy(w.data,g,{x:0,y:0},{x:A,y:z},w.data),hr.copy(w.data,g,{x:0,y:$-1},{x:A,y:z-1},{width:P,height:1}),hr.copy(w.data,g,{x:0,y:0},{x:A,y:z+$},{width:P,height:1}),hr.copy(w.data,g,{x:P-1,y:0},{x:A-1,y:z},{width:1,height:$}),hr.copy(w.data,g,{x:0,y:0},{x:A+P,y:z},{width:1,height:$})}this.image=g,this.iconPositions=s,this.patternPositions=c}addImages(e,r,s){for(const c in e){const h=e[c],d={x:0,y:0,w:h.data.width+2,h:h.data.height+2};s.push(d),r[c]=new Gc(d,h),h.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),r),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),r)}patchUpdatedImage(e,r,s){if(!e||!r||e.version===r.version)return;e.version=r.version;const[c,h]=e.tl;s.update(r.data,void 0,{x:c,y:h})}}Oe("ImagePosition",Gc),Oe("ImageAtlas",Dh),a.WritingMode=void 0,(ss=a.WritingMode||(a.WritingMode={}))[ss.none=0]="none",ss[ss.horizontal=1]="horizontal",ss[ss.vertical=2]="vertical",ss[ss.horizontalOnly=3]="horizontalOnly";const Ll=-17;class wa{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const s=new wa;return s.scale=e||1,s.fontStack=r,s}static forImage(e){const r=new wa;return r.imageName=e,r}}class bo{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const s=new bo;for(let c=0;c<e.sections.length;c++){const h=e.sections[c];h.image?s.addImageSection(h):s.addTextSection(h,r)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let s=0;s<e.length;s++){const c=e.charCodeAt(s+1)||null,h=e.charCodeAt(s-1)||null;r+=c&&fl(c)&&!ba[e[s+1]]||h&&fl(h)&&!ba[e[s-1]]||!ba[e[s]]?e[s]:ba[e[s]]}return r}(this.text)}trim(){let e=0;for(let s=0;s<this.text.length&&Rl[this.text.charCodeAt(s)];s++)e++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&Rl[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const s=new bo;return s.text=this.text.substring(e,r),s.sectionIndex=this.sectionIndex.slice(e,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(wa.forText(e.scale,e.fontStack||r));const s=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(s)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void st("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(wa.forImage(r)),this.sectionIndex.push(this.sections.length-1)):st("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Bl(i,e,r,s,c,h,d,m,g,x,w,E,A,z,P,$){const N=bo.fromFeature(i,c);let te;E===a.WritingMode.vertical&&N.verticalizePunctuation();const{processBidirectionalText:ae,processStyledBidirectionalText:ee}=Qi;if(ae&&N.sections.length===1){te=[];const ye=ae(N.toString(),Zc(N,x,h,e,s,z,P));for(const Fe of ye){const Ve=new bo;Ve.text=Fe,Ve.sections=N.sections;for(let Pe=0;Pe<Fe.length;Pe++)Ve.sectionIndex.push(0);te.push(Ve)}}else if(ee){te=[];const ye=ee(N.text,N.sectionIndex,Zc(N,x,h,e,s,z,P));for(const Fe of ye){const Ve=new bo;Ve.text=Fe[0],Ve.sectionIndex=Fe[1],Ve.sections=N.sections,te.push(Ve)}}else te=function(ye,Fe){const Ve=[],Pe=ye.text;let Ce=0;for(const Se of Fe)Ve.push(ye.substring(Ce,Se)),Ce=Se;return Ce<Pe.length&&Ve.push(ye.substring(Ce,Pe.length)),Ve}(N,Zc(N,x,h,e,s,z,P));const se=[],xe={positionedLines:se,text:N.toString(),top:w[1],bottom:w[1],left:w[0],right:w[0],writingMode:E,iconsInText:!1,verticalizable:!1};return function(ye,Fe,Ve,Pe,Ce,Se,De,Me,Te,Xe,Ze,ct){let Vt=0,jt=Ll,li=0,dr=0;const bi=Me==="right"?1:Me==="left"?0:.5;let ri=0;for(const ni of Ce){ni.trim();const Ti=ni.getMaxScale(),Ci=(Ti-1)*xi,Ri={positionedGlyphs:[],lineOffset:0};ye.positionedLines[ri]=Ri;const Gi=Ri.positionedGlyphs;let Zi=0;if(!ni.length()){jt+=Se,++ri;continue}for(let mi=0;mi<ni.length();mi++){const dt=ni.getSection(mi),ir=ni.getSectionIndex(mi),Ei=ni.getCharCode(mi);let ki=0,wr=null,Br=null,Rr=null,An=xi;const Tr=!(Te===a.WritingMode.horizontal||!Ze&&!ta(Ei)||Ze&&(Rl[Ei]||(fi=Ei,ze.Arabic(fi)||ze["Arabic Supplement"](fi)||ze["Arabic Extended-A"](fi)||ze["Arabic Presentation Forms-A"](fi)||ze["Arabic Presentation Forms-B"](fi))));if(dt.imageName){const fr=Pe[dt.imageName];if(!fr)continue;Rr=dt.imageName,ye.iconsInText=ye.iconsInText||!0,Br=fr.paddedRect;const ji=fr.displaySize;dt.scale=dt.scale*xi/ct,wr={width:ji[0],height:ji[1],left:1,top:-3,advance:Tr?ji[1]:ji[0]},ki=Ci+(xi-ji[1]*dt.scale),An=wr.advance;const Cn=Tr?ji[0]*dt.scale-xi*Ti:ji[1]*dt.scale-xi*Ti;Cn>0&&Cn>Zi&&(Zi=Cn)}else{const fr=Ve[dt.fontStack],ji=fr&&fr[Ei];if(ji&&ji.rect)Br=ji.rect,wr=ji.metrics;else{const Cn=Fe[dt.fontStack],Sa=Cn&&Cn[Ei];if(!Sa)continue;wr=Sa.metrics}ki=(Ti-dt.scale)*xi}Tr?(ye.verticalizable=!0,Gi.push({glyph:Ei,imageName:Rr,x:Vt,y:jt+ki,vertical:Tr,scale:dt.scale,fontStack:dt.fontStack,sectionIndex:ir,metrics:wr,rect:Br}),Vt+=An*dt.scale+Xe):(Gi.push({glyph:Ei,imageName:Rr,x:Vt,y:jt+ki,vertical:Tr,scale:dt.scale,fontStack:dt.fontStack,sectionIndex:ir,metrics:wr,rect:Br}),Vt+=wr.advance*dt.scale+Xe)}Gi.length!==0&&(li=Math.max(Vt-Xe,li),Ff(Gi,0,Gi.length-1,bi,Zi)),Vt=0;const Wt=Se*Ti+Zi;Ri.lineOffset=Math.max(Zi,Ci),jt+=Wt,dr=Math.max(Wt,dr),++ri}var fi;const wi=jt-Ll,{horizontalAlign:Ai,verticalAlign:qi}=jc(De);(function(ni,Ti,Ci,Ri,Gi,Zi,Wt,mi,dt){const ir=(Ti-Ci)*Gi;let Ei=0;Ei=Zi!==Wt?-mi*Ri-Ll:(-Ri*dt+.5)*Wt;for(const ki of ni)for(const wr of ki.positionedGlyphs)wr.x+=ir,wr.y+=Ei})(ye.positionedLines,bi,Ai,qi,li,dr,Se,wi,Ce.length),ye.top+=-qi*wi,ye.bottom=ye.top+wi,ye.left+=-Ai*li,ye.right=ye.left+li}(xe,e,r,s,te,d,m,g,E,x,A,$),!function(ye){for(const Fe of ye)if(Fe.positionedGlyphs.length!==0)return!1;return!0}(se)&&xe}const Rl={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Bf={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Lh(i,e,r,s,c,h){if(e.imageName){const d=s[e.imageName];return d?d.displaySize[0]*e.scale*xi/h+c:0}{const d=r[e.fontStack],m=d&&d[i];return m?m.metrics.advance*e.scale+c:0}}function Bh(i,e,r,s){const c=Math.pow(i-e,2);return s?i<e?c/2:2*c:c+Math.abs(r)*r}function Rf(i,e,r){let s=0;return i===10&&(s-=1e4),r&&(s+=150),i!==40&&i!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function Rh(i,e,r,s,c,h){let d=null,m=Bh(e,r,c,h);for(const g of s){const x=Bh(e-g.x,r,c,h)+g.badness;x<=m&&(d=g,m=x)}return{index:i,x:e,priorBreak:d,badness:m}}function Fh(i){return i?Fh(i.priorBreak).concat(i.index):[]}function Zc(i,e,r,s,c,h,d){if(h!=="point")return[];if(!i)return[];const m=[],g=function(A,z,P,$,N,te){let ae=0;for(let ee=0;ee<A.length();ee++){const se=A.getSection(ee);ae+=Lh(A.getCharCode(ee),se,$,N,z,te)}return ae/Math.max(1,Math.ceil(ae/P))}(i,e,r,s,c,d),x=i.text.indexOf("\u200B")>=0;let w=0;for(let A=0;A<i.length();A++){const z=i.getSection(A),P=i.getCharCode(A);if(Rl[P]||(w+=Lh(P,z,s,c,e,d)),A<i.length()-1){const $=!((E=P)<11904||!(ze["Bopomofo Extended"](E)||ze.Bopomofo(E)||ze["CJK Compatibility Forms"](E)||ze["CJK Compatibility Ideographs"](E)||ze["CJK Compatibility"](E)||ze["CJK Radicals Supplement"](E)||ze["CJK Strokes"](E)||ze["CJK Symbols and Punctuation"](E)||ze["CJK Unified Ideographs Extension A"](E)||ze["CJK Unified Ideographs"](E)||ze["Enclosed CJK Letters and Months"](E)||ze["Halfwidth and Fullwidth Forms"](E)||ze.Hiragana(E)||ze["Ideographic Description Characters"](E)||ze["Kangxi Radicals"](E)||ze["Katakana Phonetic Extensions"](E)||ze.Katakana(E)||ze["Vertical Forms"](E)||ze["Yi Radicals"](E)||ze["Yi Syllables"](E)));(Bf[P]||$||z.imageName)&&m.push(Rh(A+1,w,g,m,Rf(P,i.getCharCode(A+1),$&&x),!1))}}var E;return Fh(Rh(i.length(),w,g,m,0,!0))}function jc(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Ff(i,e,r,s,c){if(!s&&!c)return;const h=i[r],d=(i[r].x+h.metrics.advance*h.scale)*s;for(let m=e;m<=r;m++)i[m].x-=d,i[m].y+=c}function Of(i,e,r){const{horizontalAlign:s,verticalAlign:c}=jc(r),h=e[0]-i.displaySize[0]*s,d=e[1]-i.displaySize[1]*c;return{image:i,top:d,bottom:d+i.displaySize[1],left:h,right:h+i.displaySize[0]}}function Oh(i,e,r,s,c,h){const d=i.image;let m;if(d.content){const N=d.content,te=d.pixelRatio||1;m=[N[0]/te,N[1]/te,d.displaySize[0]-N[2]/te,d.displaySize[1]-N[3]/te]}const g=e.left*h,x=e.right*h;let w,E,A,z;r==="width"||r==="both"?(z=c[0]+g-s[3],E=c[0]+x+s[1]):(z=c[0]+(g+x-d.displaySize[0])/2,E=z+d.displaySize[0]);const P=e.top*h,$=e.bottom*h;return r==="height"||r==="both"?(w=c[1]+P-s[0],A=c[1]+$+s[2]):(w=c[1]+(P+$-d.displaySize[1])/2,A=w+d.displaySize[1]),{image:d,top:w,right:E,bottom:A,left:z,collisionPadding:m}}const In=128;function Uh(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Gt(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:c}=r;let h=0;for(;h<s.length&&s[h]<=i;)h++;h=Math.max(0,h-1);let d=h;for(;d<s.length&&s[d]<i+1;)d++;d=Math.min(s.length-1,d);const m=s[h],g=s[d];return r.kind==="composite"?{kind:"composite",minZoom:m,maxZoom:g,interpolationType:c}:{kind:"camera",minZoom:m,maxZoom:g,minSize:r.evaluate(new Gt(m)),maxSize:r.evaluate(new Gt(g)),interpolationType:c}}}class os extends Je{constructor(e,r,s,c){super(e,r),this.angle=s,c!==void 0&&(this.segment=c)}clone(){return new os(this.x,this.y,this.angle,this.segment)}}function Vh(i,e,r,s,c){if(e.segment===void 0)return!0;let h=e,d=e.segment+1,m=0;for(;m>-r/2;){if(d--,d<0)return!1;m-=i[d].dist(h),h=i[d]}m+=i[d].dist(i[d+1]),d++;const g=[];let x=0;for(;m<r/2;){const w=i[d],E=i[d+1];if(!E)return!1;let A=i[d-1].angleTo(w)-w.angleTo(E);for(A=Math.abs((A+3*Math.PI)%(2*Math.PI)-Math.PI),g.push({distance:m,angleDelta:A}),x+=A;m-g[0].distance>s;)x-=g.shift().angleDelta;if(x>c)return!1;d++,m+=w.dist(E)}return!0}function Nh(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function $h(i,e,r){return i?.6*e*r:0}function qh(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function Uf(i,e,r,s,c,h){const d=$h(r,c,h),m=qh(r,s)*h;let g=0;const x=Nh(i)/2;for(let w=0;w<i.length-1;w++){const E=i[w],A=i[w+1],z=E.dist(A);if(g+z>x){const P=(x-g)/z,$=$t(E.x,A.x,P),N=$t(E.y,A.y,P),te=new os($,N,A.angleTo(E),w);return te._round(),!d||Vh(i,te,m,d,e)?te:void 0}g+=z}}function Vf(i,e,r,s,c,h,d,m,g){const x=$h(s,h,d),w=qh(s,c),E=w*d,A=i[0].x===0||i[0].x===g||i[0].y===0||i[0].y===g;return e-E<e/4&&(e=E+e/4),Gh(i,A?e/2*m%e:(w/2+2*h)*d*m%e,e,x,r,E,A,!1,g)}function Gh(i,e,r,s,c,h,d,m,g){const x=h/2,w=Nh(i);let E=0,A=e-r,z=[];for(let P=0;P<i.length-1;P++){const $=i[P],N=i[P+1],te=$.dist(N),ae=N.angleTo($);for(;A+r<E+te;){A+=r;const ee=(A-E)/te,se=$t($.x,N.x,ee),xe=$t($.y,N.y,ee);if(se>=0&&se<g&&xe>=0&&xe<g&&A-x>=0&&A+x<=w){const ye=new os(se,xe,ae,P);ye._round(),s&&!Vh(i,ye,h,s,c)||z.push(ye)}}E+=te}return m||z.length||d||(z=Gh(i,E/2,r,s,c,h,d,!0,g)),z}function Zh(i,e,r,s,c){const h=[];for(let d=0;d<i.length;d++){const m=i[d];let g;for(let x=0;x<m.length-1;x++){let w=m[x],E=m[x+1];w.x<e&&E.x<e||(w.x<e?w=new Je(e,w.y+(e-w.x)/(E.x-w.x)*(E.y-w.y))._round():E.x<e&&(E=new Je(e,w.y+(e-w.x)/(E.x-w.x)*(E.y-w.y))._round()),w.y<r&&E.y<r||(w.y<r?w=new Je(w.x+(r-w.y)/(E.y-w.y)*(E.x-w.x),r)._round():E.y<r&&(E=new Je(w.x+(r-w.y)/(E.y-w.y)*(E.x-w.x),r)._round()),w.x>=s&&E.x>=s||(w.x>=s?w=new Je(s,w.y+(s-w.x)/(E.x-w.x)*(E.y-w.y))._round():E.x>=s&&(E=new Je(s,w.y+(s-w.x)/(E.x-w.x)*(E.y-w.y))._round()),w.y>=c&&E.y>=c||(w.y>=c?w=new Je(w.x+(c-w.y)/(E.y-w.y)*(E.x-w.x),c)._round():E.y>=c&&(E=new Je(w.x+(c-w.y)/(E.y-w.y)*(E.x-w.x),c)._round()),g&&w.equals(g[g.length-1])||(g=[w],h.push(g)),g.push(E)))))}}return h}function jh(i,e,r,s){const c=[],h=i.image,d=h.pixelRatio,m=h.paddedRect.w-2,g=h.paddedRect.h-2,x=i.right-i.left,w=i.bottom-i.top,E=h.stretchX||[[0,m]],A=h.stretchY||[[0,g]],z=(Se,De)=>Se+De[1]-De[0],P=E.reduce(z,0),$=A.reduce(z,0),N=m-P,te=g-$;let ae=0,ee=P,se=0,xe=$,ye=0,Fe=N,Ve=0,Pe=te;if(h.content&&s){const Se=h.content;ae=Fl(E,0,Se[0]),se=Fl(A,0,Se[1]),ee=Fl(E,Se[0],Se[2]),xe=Fl(A,Se[1],Se[3]),ye=Se[0]-ae,Ve=Se[1]-se,Fe=Se[2]-Se[0]-ee,Pe=Se[3]-Se[1]-xe}const Ce=(Se,De,Me,Te)=>{const Xe=Ol(Se.stretch-ae,ee,x,i.left),Ze=Ul(Se.fixed-ye,Fe,Se.stretch,P),ct=Ol(De.stretch-se,xe,w,i.top),Vt=Ul(De.fixed-Ve,Pe,De.stretch,$),jt=Ol(Me.stretch-ae,ee,x,i.left),li=Ul(Me.fixed-ye,Fe,Me.stretch,P),dr=Ol(Te.stretch-se,xe,w,i.top),bi=Ul(Te.fixed-Ve,Pe,Te.stretch,$),ri=new Je(Xe,ct),fi=new Je(jt,ct),wi=new Je(jt,dr),Ai=new Je(Xe,dr),qi=new Je(Ze/d,Vt/d),ni=new Je(li/d,bi/d),Ti=e*Math.PI/180;if(Ti){const Gi=Math.sin(Ti),Zi=Math.cos(Ti),Wt=[Zi,-Gi,Gi,Zi];ri._matMult(Wt),fi._matMult(Wt),Ai._matMult(Wt),wi._matMult(Wt)}const Ci=Se.stretch+Se.fixed,Ri=De.stretch+De.fixed;return{tl:ri,tr:fi,bl:Ai,br:wi,tex:{x:h.paddedRect.x+1+Ci,y:h.paddedRect.y+1+Ri,w:Me.stretch+Me.fixed-Ci,h:Te.stretch+Te.fixed-Ri},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:qi,pixelOffsetBR:ni,minFontScaleX:Fe/d/x,minFontScaleY:Pe/d/w,isSDF:r}};if(s&&(h.stretchX||h.stretchY)){const Se=Xh(E,N,P),De=Xh(A,te,$);for(let Me=0;Me<Se.length-1;Me++){const Te=Se[Me],Xe=Se[Me+1];for(let Ze=0;Ze<De.length-1;Ze++)c.push(Ce(Te,De[Ze],Xe,De[Ze+1]))}}else c.push(Ce({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:m+1},{fixed:0,stretch:g+1}));return c}function Fl(i,e,r){let s=0;for(const c of i)s+=Math.max(e,Math.min(r,c[1]))-Math.max(e,Math.min(r,c[0]));return s}function Xh(i,e,r){const s=[{fixed:-1,stretch:0}];for(const[c,h]of i){const d=s[s.length-1];s.push({fixed:c-d.stretch,stretch:d.stretch}),s.push({fixed:c-d.stretch,stretch:d.stretch+(h-c)})}return s.push({fixed:e+1,stretch:r}),s}function Ol(i,e,r,s){return i/e*r+s}function Ul(i,e,r,s){return i-e*r/s}Oe("Anchor",os);class Vl{constructor(e,r,s,c,h,d,m,g,x,w){if(this.boxStartIndex=e.length,x){let E=d.top,A=d.bottom;const z=d.collisionPadding;z&&(E-=z[1],A+=z[3]);let P=A-E;P>0&&(P=Math.max(10,P),this.circleDiameter=P)}else{let E=d.top*m-g[0],A=d.bottom*m+g[2],z=d.left*m-g[3],P=d.right*m+g[1];const $=d.collisionPadding;if($&&(z-=$[0]*m,E-=$[1]*m,P+=$[2]*m,A+=$[3]*m),w){const N=new Je(z,E),te=new Je(P,E),ae=new Je(z,A),ee=new Je(P,A),se=w*Math.PI/180;N._rotate(se),te._rotate(se),ae._rotate(se),ee._rotate(se),z=Math.min(N.x,te.x,ae.x,ee.x),P=Math.max(N.x,te.x,ae.x,ee.x),E=Math.min(N.y,te.y,ae.y,ee.y),A=Math.max(N.y,te.y,ae.y,ee.y)}e.emplaceBack(r.x,r.y,z,E,P,A,s,c,h)}this.boxEndIndex=e.length}}class Nf{constructor(e=[],r=$f){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:s}=this,c=r[e];for(;e>0;){const h=e-1>>1,d=r[h];if(s(c,d)>=0)break;r[e]=d,e=h}r[e]=c}_down(e){const{data:r,compare:s}=this,c=this.length>>1,h=r[e];for(;e<c;){let d=1+(e<<1),m=r[d];const g=d+1;if(g<this.length&&s(r[g],m)<0&&(d=g,m=r[g]),s(m,h)>=0)break;r[e]=m,e=d}r[e]=h}}function $f(i,e){return i<e?-1:i>e?1:0}function qf(i,e=1,r=!1){let s=1/0,c=1/0,h=-1/0,d=-1/0;const m=i[0];for(let z=0;z<m.length;z++){const P=m[z];(!z||P.x<s)&&(s=P.x),(!z||P.y<c)&&(c=P.y),(!z||P.x>h)&&(h=P.x),(!z||P.y>d)&&(d=P.y)}const g=Math.min(h-s,d-c);let x=g/2;const w=new Nf([],Gf);if(g===0)return new Je(s,c);for(let z=s;z<h;z+=g)for(let P=c;P<d;P+=g)w.push(new wo(z+x,P+x,x,i));let E=function(z){let P=0,$=0,N=0;const te=z[0];for(let ae=0,ee=te.length,se=ee-1;ae<ee;se=ae++){const xe=te[ae],ye=te[se],Fe=xe.x*ye.y-ye.x*xe.y;$+=(xe.x+ye.x)*Fe,N+=(xe.y+ye.y)*Fe,P+=3*Fe}return new wo($/P,N/P,0,z)}(i),A=w.length;for(;w.length;){const z=w.pop();(z.d>E.d||!E.d)&&(E=z,r&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,A)),z.max-E.d<=e||(x=z.h/2,w.push(new wo(z.p.x-x,z.p.y-x,x,i)),w.push(new wo(z.p.x+x,z.p.y-x,x,i)),w.push(new wo(z.p.x-x,z.p.y+x,x,i)),w.push(new wo(z.p.x+x,z.p.y+x,x,i)),A+=4)}return r&&(console.log(`num probes: ${A}`),console.log(`best distance: ${E.d}`)),E.p}function Gf(i,e){return e.max-i.max}function wo(i,e,r,s){this.p=new Je(i,e),this.h=r,this.d=function(c,h){let d=!1,m=1/0;for(let g=0;g<h.length;g++){const x=h[g];for(let w=0,E=x.length,A=E-1;w<E;A=w++){const z=x[w],P=x[A];z.y>c.y!=P.y>c.y&&c.x<(P.x-z.x)*(c.y-z.y)/(P.y-z.y)+z.x&&(d=!d),m=Math.min(m,th(c,z,P))}}return(d?1:-1)*Math.sqrt(m)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}const Xc=Number.POSITIVE_INFINITY;function Wh(i,e){return e[1]!==Xc?function(r,s,c){let h=0,d=0;switch(s=Math.abs(s),c=Math.abs(c),r){case"top-right":case"top-left":case"top":d=c-7;break;case"bottom-right":case"bottom-left":case"bottom":d=7-c}switch(r){case"top-right":case"bottom-right":case"right":h=-s;break;case"top-left":case"bottom-left":case"left":h=s}return[h,d]}(i,e[0],e[1]):function(r,s){let c=0,h=0;s<0&&(s=0);const d=s/Math.sqrt(2);switch(r){case"top-right":case"top-left":h=d-7;break;case"bottom-right":case"bottom-left":h=7-d;break;case"bottom":h=7-s;break;case"top":h=s-7}switch(r){case"top-right":case"bottom-right":c=-d;break;case"top-left":case"bottom-left":c=d;break;case"left":c=s;break;case"right":c=-s}return[c,h]}(i,e[0])}function Wc(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Zf(i,e,r,s,c,h,d,m,g,x,w){let E=h.textMaxSize.evaluate(e,{});E===void 0&&(E=d);const A=i.layers[0].layout,z=A.get("icon-offset").evaluate(e,{},w),P=Kh(r.horizontal),$=d/24,N=i.tilePixelRatio*$,te=i.tilePixelRatio*E/24,ae=i.tilePixelRatio*m,ee=i.tilePixelRatio*A.get("symbol-spacing"),se=A.get("text-padding")*i.tilePixelRatio,xe=function(Te,Xe,Ze,ct=1){const Vt=Te.get("icon-padding").evaluate(Xe,{},Ze),jt=Vt&&Vt.values;return[jt[0]*ct,jt[1]*ct,jt[2]*ct,jt[3]*ct]}(A,e,w,i.tilePixelRatio),ye=A.get("text-max-angle")/180*Math.PI,Fe=A.get("text-rotation-alignment")!=="viewport"&&A.get("symbol-placement")!=="point",Ve=A.get("icon-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",Pe=A.get("symbol-placement"),Ce=ee/2,Se=A.get("icon-text-fit");let De;s&&Se!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(De=Oh(s,r.vertical,Se,A.get("icon-text-fit-padding"),z,$)),P&&(s=Oh(s,P,Se,A.get("icon-text-fit-padding"),z,$)));const Me=(Te,Xe)=>{Xe.x<0||Xe.x>=ai||Xe.y<0||Xe.y>=ai||function(Ze,ct,Vt,jt,li,dr,bi,ri,fi,wi,Ai,qi,ni,Ti,Ci,Ri,Gi,Zi,Wt,mi,dt,ir,Ei,ki,wr){const Br=Ze.addToLineVertexArray(ct,Vt);let Rr,An,Tr,fr,ji=0,Cn=0,Sa=0,pp=0,nu=-1,su=-1;const kn={};let dp=di.exports(""),ou=0,au=0;if(ri._unevaluatedLayout.getValue("text-radial-offset")===void 0?[ou,au]=ri.layout.get("text-offset").evaluate(dt,{},ki).map(Xi=>Xi*xi):(ou=ri.layout.get("text-radial-offset").evaluate(dt,{},ki)*xi,au=Xc),Ze.allowVerticalPlacement&&jt.vertical){const Xi=ri.layout.get("text-rotate").evaluate(dt,{},ki)+90;Tr=new Vl(fi,ct,wi,Ai,qi,jt.vertical,ni,Ti,Ci,Xi),bi&&(fr=new Vl(fi,ct,wi,Ai,qi,bi,Gi,Zi,Ci,Xi))}if(li){const Xi=ri.layout.get("icon-rotate").evaluate(dt,{}),on=ri.layout.get("icon-text-fit")!=="none",Ia=jh(li,Xi,Ei,on),Aa=bi?jh(bi,Xi,Ei,on):void 0;An=new Vl(fi,ct,wi,Ai,qi,li,Gi,Zi,!1,Xi),ji=4*Ia.length;const gp=Ze.iconSizeData;let Gs=null;gp.kind==="source"?(Gs=[In*ri.layout.get("icon-size").evaluate(dt,{})],Gs[0]>as&&st(`${Ze.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):gp.kind==="composite"&&(Gs=[In*ir.compositeIconSizes[0].evaluate(dt,{},ki),In*ir.compositeIconSizes[1].evaluate(dt,{},ki)],(Gs[0]>as||Gs[1]>as)&&st(`${Ze.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ze.addSymbols(Ze.icon,Ia,Gs,mi,Wt,dt,a.WritingMode.none,ct,Br.lineStartIndex,Br.lineLength,-1,ki),nu=Ze.icon.placedSymbolArray.length-1,Aa&&(Cn=4*Aa.length,Ze.addSymbols(Ze.icon,Aa,Gs,mi,Wt,dt,a.WritingMode.vertical,ct,Br.lineStartIndex,Br.lineLength,-1,ki),su=Ze.icon.placedSymbolArray.length-1)}const fp=Object.keys(jt.horizontal);for(const Xi of fp){const on=jt.horizontal[Xi];if(!Rr){dp=di.exports(on.text);const Aa=ri.layout.get("text-rotate").evaluate(dt,{},ki);Rr=new Vl(fi,ct,wi,Ai,qi,on,ni,Ti,Ci,Aa)}const Ia=on.positionedLines.length===1;if(Sa+=Hh(Ze,ct,on,dr,ri,Ci,dt,Ri,Br,jt.vertical?a.WritingMode.horizontal:a.WritingMode.horizontalOnly,Ia?fp:[Xi],kn,nu,ir,ki),Ia)break}jt.vertical&&(pp+=Hh(Ze,ct,jt.vertical,dr,ri,Ci,dt,Ri,Br,a.WritingMode.vertical,["vertical"],kn,su,ir,ki));const nm=Rr?Rr.boxStartIndex:Ze.collisionBoxArray.length,sm=Rr?Rr.boxEndIndex:Ze.collisionBoxArray.length,om=Tr?Tr.boxStartIndex:Ze.collisionBoxArray.length,am=Tr?Tr.boxEndIndex:Ze.collisionBoxArray.length,lm=An?An.boxStartIndex:Ze.collisionBoxArray.length,cm=An?An.boxEndIndex:Ze.collisionBoxArray.length,um=fr?fr.boxStartIndex:Ze.collisionBoxArray.length,hm=fr?fr.boxEndIndex:Ze.collisionBoxArray.length;let Fr=-1;const Zl=(Xi,on)=>Xi&&Xi.circleDiameter?Math.max(Xi.circleDiameter,on):on;Fr=Zl(Rr,Fr),Fr=Zl(Tr,Fr),Fr=Zl(An,Fr),Fr=Zl(fr,Fr);const mp=Fr>-1?1:0;mp&&(Fr*=wr/xi),Ze.glyphOffsetArray.length>=To.MAX_GLYPHS&&st("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),dt.sortKey!==void 0&&Ze.addToSortKeyRanges(Ze.symbolInstances.length,dt.sortKey),Ze.symbolInstances.emplaceBack(ct.x,ct.y,kn.right>=0?kn.right:-1,kn.center>=0?kn.center:-1,kn.left>=0?kn.left:-1,kn.vertical||-1,nu,su,dp,nm,sm,om,am,lm,cm,um,hm,wi,Sa,pp,ji,Cn,mp,0,ni,ou,au,Fr)}(i,Xe,Te,r,s,c,De,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,N,[se,se,se,se],Fe,g,ae,xe,Ve,z,e,h,x,w,d)};if(Pe==="line")for(const Te of Zh(e.geometry,0,0,ai,ai)){const Xe=Vf(Te,ee,ye,r.vertical||P,s,24,te,i.overscaling,ai);for(const Ze of Xe){const ct=P;ct&&jf(i,ct.text,Ce,Ze)||Me(Te,Ze)}}else if(Pe==="line-center"){for(const Te of e.geometry)if(Te.length>1){const Xe=Uf(Te,ye,r.vertical||P,s,24,te);Xe&&Me(Te,Xe)}}else if(e.type==="Polygon")for(const Te of Bc(e.geometry,0)){const Xe=qf(Te,16);Me(Te[0],new os(Xe.x,Xe.y,0))}else if(e.type==="LineString")for(const Te of e.geometry)Me(Te,new os(Te[0].x,Te[0].y,0));else if(e.type==="Point")for(const Te of e.geometry)for(const Xe of Te)Me([Xe],new os(Xe.x,Xe.y,0))}const as=32640;function Hh(i,e,r,s,c,h,d,m,g,x,w,E,A,z,P){const $=function(ae,ee,se,xe,ye,Fe,Ve,Pe){const Ce=xe.layout.get("text-rotate").evaluate(Fe,{})*Math.PI/180,Se=[];for(const De of ee.positionedLines)for(const Me of De.positionedGlyphs){if(!Me.rect)continue;const Te=Me.rect||{};let Xe=4,Ze=!0,ct=1,Vt=0;const jt=(ye||Pe)&&Me.vertical,li=Me.metrics.advance*Me.scale/2;if(Pe&&ee.verticalizable){const Wt=(Me.scale-1)*xi,mi=(xi-Me.metrics.width*Me.scale)/2;Vt=De.lineOffset/2-(Me.imageName?-mi:Wt)}if(Me.imageName){const Wt=Ve[Me.imageName];Ze=Wt.sdf,ct=Wt.pixelRatio,Xe=1/ct}const dr=ye?[Me.x+li,Me.y]:[0,0];let bi=ye?[0,0]:[Me.x+li+se[0],Me.y+se[1]-Vt],ri=[0,0];jt&&(ri=bi,bi=[0,0]);const fi=(Me.metrics.left-Xe)*Me.scale-li+bi[0],wi=(-Me.metrics.top-Xe)*Me.scale+bi[1],Ai=fi+Te.w*Me.scale/ct,qi=wi+Te.h*Me.scale/ct,ni=new Je(fi,wi),Ti=new Je(Ai,wi),Ci=new Je(fi,qi),Ri=new Je(Ai,qi);if(jt){const Wt=new Je(-li,li-Ll),mi=-Math.PI/2,dt=12-li,ir=new Je(22-dt,-(Me.imageName?dt:0)),Ei=new Je(...ri);ni._rotateAround(mi,Wt)._add(ir)._add(Ei),Ti._rotateAround(mi,Wt)._add(ir)._add(Ei),Ci._rotateAround(mi,Wt)._add(ir)._add(Ei),Ri._rotateAround(mi,Wt)._add(ir)._add(Ei)}if(Ce){const Wt=Math.sin(Ce),mi=Math.cos(Ce),dt=[mi,-Wt,Wt,mi];ni._matMult(dt),Ti._matMult(dt),Ci._matMult(dt),Ri._matMult(dt)}const Gi=new Je(0,0),Zi=new Je(0,0);Se.push({tl:ni,tr:Ti,bl:Ci,br:Ri,tex:Te,writingMode:ee.writingMode,glyphOffset:dr,sectionIndex:Me.sectionIndex,isSDF:Ze,pixelOffsetTL:Gi,pixelOffsetBR:Zi,minFontScaleX:0,minFontScaleY:0})}return Se}(0,r,m,c,h,d,s,i.allowVerticalPlacement),N=i.textSizeData;let te=null;N.kind==="source"?(te=[In*c.layout.get("text-size").evaluate(d,{})],te[0]>as&&st(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):N.kind==="composite"&&(te=[In*z.compositeTextSizes[0].evaluate(d,{},P),In*z.compositeTextSizes[1].evaluate(d,{},P)],(te[0]>as||te[1]>as)&&st(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,$,te,m,h,d,x,e,g.lineStartIndex,g.lineLength,A,P);for(const ae of w)E[ae]=i.text.placedSymbolArray.length-1;return 4*$.length}function Kh(i){for(const e in i)return i[e];return null}function jf(i,e,r,s){const c=i.compareText;if(e in c){const h=c[e];for(let d=h.length-1;d>=0;d--)if(s.dist(h[d])<r)return!0}else c[e]=[];return c[e].push(s),!1}const Xf=ns.VectorTileFeature.types,Wf=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Nl(i,e,r,s,c,h,d,m,g,x,w,E,A){const z=m?Math.min(as,Math.round(m[0])):0,P=m?Math.min(as,Math.round(m[1])):0;i.emplaceBack(e,r,Math.round(32*s),Math.round(32*c),h,d,(z<<1)+(g?1:0),P,16*x,16*w,256*E,256*A)}function Hc(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function Hf(i){for(const e of i.sections)if(gl(e.text))return!0;return!1}class Kc{constructor(e){this.layoutVertexArray=new vr,this.indexArray=new Di,this.programConfigurations=e,this.segments=new pt,this.dynamicLayoutVertexArray=new ur,this.opacityVertexArray=new br,this.placedSymbolArray=new we}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,s,c){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,yf.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,xf.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Wf,!0),this.opacityVertexBuffer.itemSize=1),(s||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Oe("SymbolBuffers",Kc);class Yc{constructor(e,r,s){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new s,this.segments=new pt,this.collisionVertexArray=new er}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,vf.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Oe("CollisionBuffers",Yc);class To{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(d=>d.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=kc([]),this.placementViewportMatrix=kc([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Uh(this.zoom,r["text-size"]),this.iconSizeData=Uh(this.zoom,r["icon-size"]);const s=this.layers[0].layout,c=s.get("symbol-sort-key"),h=s.get("symbol-z-order");this.canOverlap=Qc(s,"text-overlap","text-allow-overlap")!=="never"||Qc(s,"icon-overlap","icon-allow-overlap")!=="never"||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&!c.isConstant(),this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(d=>a.WritingMode[d])),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.sourceID=e.sourceID}createArrays(){this.text=new Kc(new Us(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Kc(new Us(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Ae,this.lineVertexArray=new Re,this.symbolInstances=new Be}calculateGlyphDependencies(e,r,s,c,h){for(let d=0;d<e.length;d++)if(r[e.charCodeAt(d)]=!0,(s||c)&&h){const m=ba[e.charAt(d)];m&&(r[m.charCodeAt(0)]=!0)}}populate(e,r,s){const c=this.layers[0],h=c.layout,d=h.get("text-font"),m=h.get("text-field"),g=h.get("icon-image"),x=(m.value.kind!=="constant"||m.value.value instanceof W&&!m.value.value.isEmpty()||m.value.value.toString().length>0)&&(d.value.kind!=="constant"||d.value.value.length>0),w=g.value.kind!=="constant"||!!g.value.value||Object.keys(g.parameters).length>0,E=h.get("symbol-sort-key");if(this.features=[],!x&&!w)return;const A=r.iconDependencies,z=r.glyphDependencies,P=r.availableImages,$=new Gt(this.zoom);for(const{feature:N,id:te,index:ae,sourceLayerIndex:ee}of e){const se=c._featureFilter.needGeometry,xe=Ns(N,se);if(!c._featureFilter.filter($,xe,s))continue;let ye,Fe;if(se||(xe.geometry=Vs(N)),x){const Pe=c.getValueAndResolveTokens("text-field",xe,s,P),Ce=W.factory(Pe);Hf(Ce)&&(this.hasRTLText=!0),(!this.hasRTLText||Rs()==="unavailable"||this.hasRTLText&&Qi.isParsed())&&(ye=wf(Ce,c,xe))}if(w){const Pe=c.getValueAndResolveTokens("icon-image",xe,s,P);Fe=Pe instanceof J?Pe:J.fromString(Pe)}if(!ye&&!Fe)continue;const Ve=this.sortFeaturesByKey?E.evaluate(xe,{},s):void 0;if(this.features.push({id:te,text:ye,icon:Fe,index:ae,sourceLayerIndex:ee,geometry:xe.geometry,properties:N.properties,type:Xf[N.type],sortKey:Ve}),Fe&&(A[Fe.name]=!0),ye){const Pe=d.evaluate(xe,{},s).join(","),Ce=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(a.WritingMode.vertical)>=0;for(const Se of ye.sections)if(Se.image)A[Se.image.name]=!0;else{const De=uo(ye.toString()),Me=Se.fontStack||Pe,Te=z[Me]=z[Me]||{};this.calculateGlyphDependencies(Se.text,Te,Ce,this.allowVerticalPlacement,De)}}}h.get("symbol-placement")==="line"&&(this.features=function(N){const te={},ae={},ee=[];let se=0;function xe(Pe){ee.push(N[Pe]),se++}function ye(Pe,Ce,Se){const De=ae[Pe];return delete ae[Pe],ae[Ce]=De,ee[De].geometry[0].pop(),ee[De].geometry[0]=ee[De].geometry[0].concat(Se[0]),De}function Fe(Pe,Ce,Se){const De=te[Ce];return delete te[Ce],te[Pe]=De,ee[De].geometry[0].shift(),ee[De].geometry[0]=Se[0].concat(ee[De].geometry[0]),De}function Ve(Pe,Ce,Se){const De=Se?Ce[0][Ce[0].length-1]:Ce[0][0];return`${Pe}:${De.x}:${De.y}`}for(let Pe=0;Pe<N.length;Pe++){const Ce=N[Pe],Se=Ce.geometry,De=Ce.text?Ce.text.toString():null;if(!De){xe(Pe);continue}const Me=Ve(De,Se),Te=Ve(De,Se,!0);if(Me in ae&&Te in te&&ae[Me]!==te[Te]){const Xe=Fe(Me,Te,Se),Ze=ye(Me,Te,ee[Xe].geometry);delete te[Me],delete ae[Te],ae[Ve(De,ee[Ze].geometry,!0)]=Ze,ee[Xe].geometry=null}else Me in ae?ye(Me,Te,Se):Te in te?Fe(Me,Te,Se):(xe(Pe),te[Me]=se-1,ae[Te]=se-1)}return ee.filter(Pe=>Pe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((N,te)=>N.sortKey-te.sortKey)}update(e,r,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,s),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,s))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const s=this.lineVertexArray.length;if(e.segment!==void 0){let c=e.dist(r[e.segment+1]),h=e.dist(r[e.segment]);const d={};for(let m=e.segment+1;m<r.length;m++)d[m]={x:r[m].x,y:r[m].y,tileUnitDistanceFromAnchor:c},m<r.length-1&&(c+=r[m+1].dist(r[m]));for(let m=e.segment||0;m>=0;m--)d[m]={x:r[m].x,y:r[m].y,tileUnitDistanceFromAnchor:h},m>0&&(h+=r[m-1].dist(r[m]));for(let m=0;m<r.length;m++){const g=d[m];this.lineVertexArray.emplaceBack(g.x,g.y,g.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,r,s,c,h,d,m,g,x,w,E,A){const z=e.indexArray,P=e.layoutVertexArray,$=e.segments.prepareSegment(4*r.length,P,z,this.canOverlap?d.sortKey:void 0),N=this.glyphOffsetArray.length,te=$.vertexLength,ae=this.allowVerticalPlacement&&m===a.WritingMode.vertical?Math.PI/2:0,ee=d.text&&d.text.sections;for(let se=0;se<r.length;se++){const{tl:xe,tr:ye,bl:Fe,br:Ve,tex:Pe,pixelOffsetTL:Ce,pixelOffsetBR:Se,minFontScaleX:De,minFontScaleY:Me,glyphOffset:Te,isSDF:Xe,sectionIndex:Ze}=r[se],ct=$.vertexLength,Vt=Te[1];Nl(P,g.x,g.y,xe.x,Vt+xe.y,Pe.x,Pe.y,s,Xe,Ce.x,Ce.y,De,Me),Nl(P,g.x,g.y,ye.x,Vt+ye.y,Pe.x+Pe.w,Pe.y,s,Xe,Se.x,Ce.y,De,Me),Nl(P,g.x,g.y,Fe.x,Vt+Fe.y,Pe.x,Pe.y+Pe.h,s,Xe,Ce.x,Se.y,De,Me),Nl(P,g.x,g.y,Ve.x,Vt+Ve.y,Pe.x+Pe.w,Pe.y+Pe.h,s,Xe,Se.x,Se.y,De,Me),Hc(e.dynamicLayoutVertexArray,g,ae),z.emplaceBack(ct,ct+1,ct+2),z.emplaceBack(ct+1,ct+2,ct+3),$.vertexLength+=4,$.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Te[0]),se!==r.length-1&&Ze===r[se+1].sectionIndex||e.programConfigurations.populatePaintArrays(P.length,d,d.index,{},A,ee&&ee[Ze])}e.placedSymbolArray.emplaceBack(g.x,g.y,N,this.glyphOffsetArray.length-N,te,x,w,g.segment,s?s[0]:0,s?s[1]:0,c[0],c[1],m,0,!1,0,E)}_addCollisionDebugVertex(e,r,s,c,h,d){return r.emplaceBack(0,0),e.emplaceBack(s.x,s.y,c,h,Math.round(d.x),Math.round(d.y))}addCollisionDebugVertices(e,r,s,c,h,d,m){const g=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),x=g.vertexLength,w=h.layoutVertexArray,E=h.collisionVertexArray,A=m.anchorX,z=m.anchorY;this._addCollisionDebugVertex(w,E,d,A,z,new Je(e,r)),this._addCollisionDebugVertex(w,E,d,A,z,new Je(s,r)),this._addCollisionDebugVertex(w,E,d,A,z,new Je(s,c)),this._addCollisionDebugVertex(w,E,d,A,z,new Je(e,c)),g.vertexLength+=4;const P=h.indexArray;P.emplaceBack(x,x+1),P.emplaceBack(x+1,x+2),P.emplaceBack(x+2,x+3),P.emplaceBack(x+3,x),g.primitiveLength+=4}addDebugCollisionBoxes(e,r,s,c){for(let h=e;h<r;h++){const d=this.collisionBoxArray.get(h);this.addCollisionDebugVertices(d.x1,d.y1,d.x2,d.y2,c?this.textCollisionBox:this.iconCollisionBox,d.anchorPoint,s)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Yc(nn,Sh.members,Dr),this.iconCollisionBox=new Yc(nn,Sh.members,Dr);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,s,c,h,d,m,g,x){const w={};for(let E=r;E<s;E++){const A=e.get(E);w.textBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},w.textFeatureIndex=A.featureIndex;break}for(let E=c;E<h;E++){const A=e.get(E);w.verticalTextBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},w.verticalTextFeatureIndex=A.featureIndex;break}for(let E=d;E<m;E++){const A=e.get(E);w.iconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},w.iconFeatureIndex=A.featureIndex;break}for(let E=g;E<x;E++){const A=e.get(E);w.verticalIconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},w.verticalIconFeatureIndex=A.featureIndex;break}return w}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const s=e.placedSymbolArray.get(r),c=s.vertexStartIndex+4*s.numGlyphs;for(let h=s.vertexStartIndex;h<c;h+=4)e.indexArray.emplaceBack(h,h+1,h+2),e.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),s=Math.cos(e),c=[],h=[],d=[];for(let m=0;m<this.symbolInstances.length;++m){d.push(m);const g=this.symbolInstances.get(m);c.push(0|Math.round(r*g.anchorX+s*g.anchorY)),h.push(g.featureIndex)}return d.sort((m,g)=>c[m]-c[g]||h[g]-h[m]),d}addToSortKeyRanges(e,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((c,h,d)=>{c>=0&&d.indexOf(c)===h&&this.addIndicesForPlacedSymbol(this.text,c)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Oe("SymbolBucket",To,{omit:["layers","collisionBoxArray","features","compareText"]}),To.MAX_GLYPHS=65535,To.addDynamicAttributes=Hc;const Kf=new yi({"symbol-placement":new Ge(ge.layout_symbol["symbol-placement"]),"symbol-spacing":new Ge(ge.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ge(ge.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ke(ge.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ge(ge.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ge(ge.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ge(ge.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ge(ge.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ge(ge.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ge(ge.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ke(ge.layout_symbol["icon-size"]),"icon-text-fit":new Ge(ge.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ge(ge.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ke(ge.layout_symbol["icon-image"]),"icon-rotate":new Ke(ge.layout_symbol["icon-rotate"]),"icon-padding":new Ke(ge.layout_symbol["icon-padding"]),"icon-keep-upright":new Ge(ge.layout_symbol["icon-keep-upright"]),"icon-offset":new Ke(ge.layout_symbol["icon-offset"]),"icon-anchor":new Ke(ge.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ge(ge.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ge(ge.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ge(ge.layout_symbol["text-rotation-alignment"]),"text-field":new Ke(ge.layout_symbol["text-field"]),"text-font":new Ke(ge.layout_symbol["text-font"]),"text-size":new Ke(ge.layout_symbol["text-size"]),"text-max-width":new Ke(ge.layout_symbol["text-max-width"]),"text-line-height":new Ge(ge.layout_symbol["text-line-height"]),"text-letter-spacing":new Ke(ge.layout_symbol["text-letter-spacing"]),"text-justify":new Ke(ge.layout_symbol["text-justify"]),"text-radial-offset":new Ke(ge.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ge(ge.layout_symbol["text-variable-anchor"]),"text-anchor":new Ke(ge.layout_symbol["text-anchor"]),"text-max-angle":new Ge(ge.layout_symbol["text-max-angle"]),"text-writing-mode":new Ge(ge.layout_symbol["text-writing-mode"]),"text-rotate":new Ke(ge.layout_symbol["text-rotate"]),"text-padding":new Ge(ge.layout_symbol["text-padding"]),"text-keep-upright":new Ge(ge.layout_symbol["text-keep-upright"]),"text-transform":new Ke(ge.layout_symbol["text-transform"]),"text-offset":new Ke(ge.layout_symbol["text-offset"]),"text-allow-overlap":new Ge(ge.layout_symbol["text-allow-overlap"]),"text-overlap":new Ge(ge.layout_symbol["text-overlap"]),"text-ignore-placement":new Ge(ge.layout_symbol["text-ignore-placement"]),"text-optional":new Ge(ge.layout_symbol["text-optional"])});var Jc={paint:new yi({"icon-opacity":new Ke(ge.paint_symbol["icon-opacity"]),"icon-color":new Ke(ge.paint_symbol["icon-color"]),"icon-halo-color":new Ke(ge.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ke(ge.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ke(ge.paint_symbol["icon-halo-blur"]),"icon-translate":new Ge(ge.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ge(ge.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ke(ge.paint_symbol["text-opacity"]),"text-color":new Ke(ge.paint_symbol["text-color"],{runtimeType:_i,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Ke(ge.paint_symbol["text-halo-color"]),"text-halo-width":new Ke(ge.paint_symbol["text-halo-width"]),"text-halo-blur":new Ke(ge.paint_symbol["text-halo-blur"]),"text-translate":new Ge(ge.paint_symbol["text-translate"]),"text-translate-anchor":new Ge(ge.paint_symbol["text-translate-anchor"])}),layout:Kf};class Yh{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Hr,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Oe("FormatSectionOverride",Yh,{omit:["defaultValue"]});class $l extends xr{constructor(e){super(e,Jc)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const s=this.layout.get("text-writing-mode");if(s){const c=[];for(const h of s)c.indexOf(h)<0&&c.push(h);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,s,c){const h=this.layout.get(e).evaluate(r,{},s,c),d=this._unevaluatedLayout._values[e];return d.isDataDriven()||Ts(d.value)||!h?h:function(m,g){return g.replace(/{([^{}]+)}/g,(x,w)=>w in m?String(m[w]):"")}(r.properties,h)}createBucket(e){return new To(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Jc.paint.overridableProperties){if(!$l.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),s=new Yh(r),c=new no(s,r.property.specification);let h=null;h=r.value.kind==="constant"||r.value.kind==="source"?new Ss("source",c):new Ho("composite",c,r.value.zoomStops),this.paint._values[e]=new yr(r.property,h,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&$l.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const s=e.get("text-field"),c=Jc.paint.properties[r];let h=!1;const d=m=>{for(const g of m)if(c.overrides&&c.overrides.hasOverride(g))return void(h=!0)};if(s.value.kind==="constant"&&s.value.value instanceof W)d(s.value.value.sections);else if(s.value.kind==="source"){const m=x=>{h||(x instanceof $e&&ce(x.value)===ci?d(x.value.sections):x instanceof io?d(x.sections):x.eachChild(m))},g=s.value;g._styleExpression&&m(g._styleExpression.expression)}return h}}function Qc(i,e,r){let s="never";const c=i.get(e);return c?s=c:i.get(r)&&(s="always"),s}var Yf={paint:new yi({"background-color":new Ge(ge.paint_background["background-color"]),"background-pattern":new aa(ge.paint_background["background-pattern"]),"background-opacity":new Ge(ge.paint_background["background-opacity"])})},Jf={paint:new yi({"raster-opacity":new Ge(ge.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ge(ge.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ge(ge.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ge(ge.paint_raster["raster-brightness-max"]),"raster-saturation":new Ge(ge.paint_raster["raster-saturation"]),"raster-contrast":new Ge(ge.paint_raster["raster-contrast"]),"raster-resampling":new Ge(ge.paint_raster["raster-resampling"]),"raster-fade-duration":new Ge(ge.paint_raster["raster-fade-duration"])})};class Qf extends xr{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const em={circle:class extends xr{constructor(i){super(i,Md)}createBucket(i){return new Ic(i)}queryRadius(i){const e=i;return pa("circle-radius",this,e)+pa("circle-stroke-width",this,e)+Sl(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,r,s,c,h,d,m){const g=Il(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,d),x=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r),w=this.paint.get("circle-pitch-alignment")==="map",E=w?g:function(z,P){return z.map($=>lh($,P))}(g,m),A=w?x*d:x;for(const z of s)for(const P of z){const $=w?P:lh(P,m);let N=A;const te=Al([],[P.x,P.y,0,1],m);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?N*=te[3]/h.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(N*=h.cameraToCenterDistance/te[3]),Sd(E,$,N))return!0}return!1}},heatmap:class extends xr{constructor(i){super(i,Pd),this._updateColorRamp()}createBucket(i){return new ch(i)}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=hh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends xr{constructor(i){super(i,Dd)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends xr{constructor(i){super(i,Hd)}recalculate(i,e){super.recalculate(i,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Oc(i)}queryRadius(){return Sl(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,r,s,c,h,d){return eh(Il(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,d),s)}isTileClipped(){return!0}},"fill-extrusion":class extends xr{constructor(i){super(i,uf)}createBucket(i){return new Vc(i)}queryRadius(){return Sl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,e,r,s,c,h,d,m){const g=Il(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,d),x=this.paint.get("fill-extrusion-height").evaluate(e,r),w=this.paint.get("fill-extrusion-base").evaluate(e,r),E=function(z,P,$,N){const te=[];for(const ae of z){const ee=[ae.x,ae.y,0,1];Al(ee,ee,P),te.push(new Je(ee[0]/ee[3],ee[1]/ee[3]))}return te}(g,m),A=function(z,P,$,N){const te=[],ae=[],ee=N[8]*P,se=N[9]*P,xe=N[10]*P,ye=N[11]*P,Fe=N[8]*$,Ve=N[9]*$,Pe=N[10]*$,Ce=N[11]*$;for(const Se of z){const De=[],Me=[];for(const Te of Se){const Xe=Te.x,Ze=Te.y,ct=N[0]*Xe+N[4]*Ze+N[12],Vt=N[1]*Xe+N[5]*Ze+N[13],jt=N[2]*Xe+N[6]*Ze+N[14],li=N[3]*Xe+N[7]*Ze+N[15],dr=jt+xe,bi=li+ye,ri=ct+Fe,fi=Vt+Ve,wi=jt+Pe,Ai=li+Ce,qi=new Je((ct+ee)/bi,(Vt+se)/bi);qi.z=dr/bi,De.push(qi);const ni=new Je(ri/Ai,fi/Ai);ni.z=wi/Ai,Me.push(ni)}te.push(De),ae.push(Me)}return[te,ae]}(s,w,x,m);return function(z,P,$){let N=1/0;eh($,P)&&(N=vh($,P[0]));for(let te=0;te<P.length;te++){const ae=P[te],ee=z[te];for(let se=0;se<ae.length-1;se++){const xe=ae[se],ye=[xe,ae[se+1],ee[se+1],ee[se],xe];Qu($,ye)&&(N=Math.min(N,vh($,ye)))}}return N!==1/0&&N}(A[0],A[1],E)}},line:class extends xr{constructor(i){super(i,wh),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){i==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof ys,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=Th.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Nc(i)}queryRadius(i){const e=i,r=Eh(pa("line-width",this,e),pa("line-gap-width",this,e)),s=pa("line-offset",this,e);return r/2+Math.abs(s)+Sl(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,r,s,c,h,d){const m=Il(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,d),g=d/2*Eh(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),x=this.paint.get("line-offset").evaluate(e,r);return x&&(s=function(w,E){const A=[];for(let z=0;z<w.length;z++){const P=w[z],$=[];for(let N=0;N<P.length;N++){const te=P[N-1],ae=P[N],ee=P[N+1],se=N===0?new Je(0,0):ae.sub(te)._unit()._perp(),xe=N===P.length-1?new Je(0,0):ee.sub(ae)._unit()._perp(),ye=se._add(xe)._unit(),Fe=ye.x*xe.x+ye.y*xe.y;Fe!==0&&ye._mult(1/Fe),$.push(ye._mult(E)._add(ae))}A.push($)}return A}(s,x*d)),function(w,E,A){for(let z=0;z<E.length;z++){const P=E[z];if(w.length>=3){for(let $=0;$<P.length;$++)if(go(w,P[$]))return!0}if(Id(w,P,A))return!0}return!1}(m,s,g)}isTileClipped(){return!0}},symbol:$l,background:class extends xr{constructor(i){super(i,Yf)}},raster:class extends xr{constructor(i){super(i,Jf)}}};class tm{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Jh=63710088e-1;class Jt{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Jt(Ee(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,s=this.lat*r,c=e.lat*r,h=Math.sin(s)*Math.sin(c)+Math.cos(s)*Math.cos(c)*Math.cos((e.lng-this.lng)*r);return Jh*Math.acos(Math.min(h,1))}toBounds(e=0){const r=360*e/40075017,s=r/Math.cos(Math.PI/180*this.lat);return new qs(new Jt(this.lng-s,this.lat-r),new Jt(this.lng+s,this.lat+r))}static convert(e){if(e instanceof Jt)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Jt(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Jt(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class qs{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Jt?new Jt(e.lng,e.lat):Jt.convert(e),this}setSouthWest(e){return this._sw=e instanceof Jt?new Jt(e.lng,e.lat):Jt.convert(e),this}extend(e){const r=this._sw,s=this._ne;let c,h;if(e instanceof Jt)c=e,h=e;else{if(!(e instanceof qs))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(qs.convert(e)):this.extend(Jt.convert(e)):this;if(c=e._sw,h=e._ne,!c||!h)return this}return r||s?(r.lng=Math.min(c.lng,r.lng),r.lat=Math.min(c.lat,r.lat),s.lng=Math.max(h.lng,s.lng),s.lat=Math.max(h.lat,s.lat)):(this._sw=new Jt(c.lng,c.lat),this._ne=new Jt(h.lng,h.lat)),this}getCenter(){return new Jt((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Jt(this.getWest(),this.getNorth())}getSouthEast(){return new Jt(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:s}=Jt.convert(e);let c=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&c}static convert(e){return e instanceof qs?e:e&&new qs(e)}}const Qh=2*Math.PI*Jh;function ep(i){return Qh*Math.cos(i*Math.PI/180)}function tp(i){return(180+i)/360}function ip(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function rp(i,e){return i/ep(e)}function eu(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class ql{constructor(e,r,s=0){this.x=+e,this.y=+r,this.z=+s}static fromLngLat(e,r=0){const s=Jt.convert(e);return new ql(tp(s.lng),ip(s.lat),rp(r,s.lat))}toLngLat(){return new Jt(360*this.x-180,eu(this.y))}toAltitude(){return this.z*ep(eu(this.y))}meterInMercatorCoordinateUnits(){return 1/Qh*(e=eu(this.y),1/Math.cos(e*Math.PI/180));var e}}function np(i,e,r){var s=2*Math.PI*6378137/256/Math.pow(2,r);return[i*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class tu{constructor(e,r,s){if(e<0||e>25||s<0||s>=Math.pow(2,e)||r<0||r>=Math.pow(2,e))throw new Error(`x=${r}, y=${s}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=s,this.key=Ta(0,e,e,r,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,s){const c=(d=this.y,m=this.z,g=np(256*(h=this.x),256*(d=Math.pow(2,m)-d-1),m),x=np(256*(h+1),256*(d+1),m),g[0]+","+g[1]+","+x[0]+","+x[1]);var h,d,m,g,x;const w=function(E,A,z){let P,$="";for(let N=E;N>0;N--)P=1<<N-1,$+=(A&P?1:0)+(z&P?2:0);return $}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,w).replace(/{bbox-epsg-3857}/g,c)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new Je((e.x*r-this.x)*ai,(e.y*r-this.y)*ai)}toString(){return`${this.z}/${this.x}/${this.y}`}}class sp{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Ta(e,r.z,r.z,r.x,r.y)}}class pr{constructor(e,r,s,c,h){if(e<s)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${s}`);this.overscaledZ=e,this.wrap=r,this.canonical=new tu(s,+c,+h),this.key=Ta(r,e,s,c,h)}clone(){return new pr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new pr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new pr(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-e;return e>this.canonical.z?Ta(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):Ta(this.wrap*+r,e,e,this.canonical.x>>s,this.canonical.y>>s)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new pr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,c=2*this.canonical.y;return[new pr(r,this.wrap,r,s,c),new pr(r,this.wrap,r,s+1,c),new pr(r,this.wrap,r,s,c+1),new pr(r,this.wrap,r,s+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new pr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new pr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new sp(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new ql(e.x-this.wrap,e.y))}}function Ta(i,e,r,s,c){(i*=2)<0&&(i=-1*i-1);const h=1<<r;return(h*h*i+h*c+s).toString(36)+r.toString(36)+e.toString(36)}Oe("CanonicalTileID",tu),Oe("OverscaledTileID",pr,{omit:["posMatrix"]});class op{constructor(e,r,s){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return void st(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const c=this.dim=r.height-2;this.data=new Uint32Array(r.data.buffer),this.encoding=s||"mapbox";for(let h=0;h<c;h++)this.data[this._idx(-1,h)]=this.data[this._idx(0,h)],this.data[this._idx(c,h)]=this.data[this._idx(c-1,h)],this.data[this._idx(h,-1)]=this.data[this._idx(h,0)],this.data[this._idx(h,c)]=this.data[this._idx(h,c-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(c,-1)]=this.data[this._idx(c-1,0)],this.data[this._idx(-1,c)]=this.data[this._idx(0,c-1)],this.data[this._idx(c,c)]=this.data[this._idx(c-1,c-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let h=0;h<c;h++)for(let d=0;d<c;d++){const m=this.get(h,d);m>this.max&&(this.max=m),m<this.min&&(this.min=m)}}get(e,r){const s=new Uint8Array(this.data.buffer),c=4*this._idx(e,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(s[c],s[c+1],s[c+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}_unpackMapbox(e,r,s){return(256*e*256+256*r+s)/10-1e4}_unpackTerrarium(e,r,s){return 256*e+r+s/256-32768}getPixels(){return new hr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=r*this.dim,h=r*this.dim+this.dim,d=s*this.dim,m=s*this.dim+this.dim;switch(r){case-1:c=h-1;break;case 1:h=c+1}switch(s){case-1:d=m-1;break;case 1:m=d+1}const g=-r*this.dim,x=-s*this.dim;for(let w=d;w<m;w++)for(let E=c;E<h;E++)this.data[this._idx(E,w)]=e.data[this._idx(E+g,w+x)]}}Oe("DEMData",op);class ap{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const s=e[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class lp{constructor(e,r,s,c,h){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=s,e._y=c,this.properties=e.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class cp{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Bs(ai,16,0),this.grid3D=new Bs(ai,16,0),this.featureIndexArray=new lt,this.promoteId=r}insert(e,r,s,c,h,d){const m=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,c,h);const g=d?this.grid3D:this.grid;for(let x=0;x<r.length;x++){const w=r[x],E=[1/0,1/0,-1/0,-1/0];for(let A=0;A<w.length;A++){const z=w[A];E[0]=Math.min(E[0],z.x),E[1]=Math.min(E[1],z.y),E[2]=Math.max(E[2],z.x),E[3]=Math.max(E[3],z.y)}E[0]<ai&&E[1]<ai&&E[2]>=0&&E[3]>=0&&g.insert(m,E[0],E[1],E[2],E[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ns.VectorTile(new $c(this.rawTileData)).layers,this.sourceLayerCoder=new ap(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,s,c){this.loadVTLayers();const h=e.params||{},d=ai/e.tileSize/e.scale,m=ao(h.filter),g=e.queryGeometry,x=e.queryPadding*d,w=hp(g),E=this.grid.query(w.minX-x,w.minY-x,w.maxX+x,w.maxY+x),A=hp(e.cameraQueryGeometry),z=this.grid3D.query(A.minX-x,A.minY-x,A.maxX+x,A.maxY+x,(N,te,ae,ee)=>function(se,xe,ye,Fe,Ve){for(const Ce of se)if(xe<=Ce.x&&ye<=Ce.y&&Fe>=Ce.x&&Ve>=Ce.y)return!0;const Pe=[new Je(xe,ye),new Je(xe,Ve),new Je(Fe,Ve),new Je(Fe,ye)];if(se.length>2){for(const Ce of Pe)if(go(se,Ce))return!0}for(let Ce=0;Ce<se.length-1;Ce++)if(Cd(se[Ce],se[Ce+1],Pe))return!0;return!1}(e.cameraQueryGeometry,N-x,te-x,ae+x,ee+x));for(const N of z)E.push(N);E.sort(im);const P={};let $;for(let N=0;N<E.length;N++){const te=E[N];if(te===$)continue;$=te;const ae=this.featureIndexArray.get(te);let ee=null;this.loadMatchingFeature(P,ae.bucketIndex,ae.sourceLayerIndex,ae.featureIndex,m,h.layers,h.availableImages,r,s,c,(se,xe,ye)=>(ee||(ee=Vs(se)),xe.queryIntersectsFeature(g,se,ye,ee,this.z,e.transform,d,e.pixelPosMatrix)))}return P}loadMatchingFeature(e,r,s,c,h,d,m,g,x,w,E){const A=this.bucketLayerIDs[r];if(d&&!function(N,te){for(let ae=0;ae<N.length;ae++)if(te.indexOf(N[ae])>=0)return!0;return!1}(d,A))return;const z=this.sourceLayerCoder.decode(s),P=this.vtLayers[z].feature(c);if(h.needGeometry){const N=Ns(P,!0);if(!h.filter(new Gt(this.tileID.overscaledZ),N,this.tileID.canonical))return}else if(!h.filter(new Gt(this.tileID.overscaledZ),P))return;const $=this.getId(P,z);for(let N=0;N<A.length;N++){const te=A[N];if(d&&d.indexOf(te)<0)continue;const ae=g[te];if(!ae)continue;let ee={};$&&w&&(ee=w.getState(ae.sourceLayer||"_geojsonTileLayer",$));const se=qe({},x[te]);se.paint=up(se.paint,ae.paint,P,ee,m),se.layout=up(se.layout,ae.layout,P,ee,m);const xe=!E||E(P,ae,ee);if(!xe)continue;const ye=new lp(P,this.z,this.x,this.y,$);ye.layer=se;let Fe=e[te];Fe===void 0&&(Fe=e[te]=[]),Fe.push({featureIndex:c,feature:ye,intersectionZ:xe})}}lookupSymbolFeatures(e,r,s,c,h,d,m,g){const x={};this.loadVTLayers();const w=ao(h);for(const E of e)this.loadMatchingFeature(x,s,c,E,w,d,m,g,r);return x}hasLayer(e){for(const r of this.bucketLayerIDs)for(const s of r)if(e===s)return!0;return!1}getId(e,r){let s=e.id;return this.promoteId&&(s=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof s=="boolean"&&(s=Number(s))),s}}function up(i,e,r,s,c){return We(i,(h,d)=>{const m=e instanceof Os?e.get(d):null;return m&&m.evaluate?m.evaluate(r,s,c):m})}function hp(i){let e=1/0,r=1/0,s=-1/0,c=-1/0;for(const h of i)e=Math.min(e,h.x),r=Math.min(r,h.y),s=Math.max(s,h.x),c=Math.max(c,h.y);return{minX:e,minY:r,maxX:s,maxY:c}}function im(i,e){return e-i}var iu;Oe("FeatureIndex",cp,{omit:["rawTileData","sourceLayerCoder"]}),a.PerformanceMarkers=void 0,(iu=a.PerformanceMarkers||(a.PerformanceMarkers={})).create="create",iu.load="load",iu.fullLoad="fullLoad";let Gl=null,Ea=[];const ru=1e3/30,rm={mark(i){performance.mark(i)},frame(i){const e=i;Gl!=null&&Ea.push(e-Gl),Gl=e},clearMetrics(){Gl=null,Ea=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const i in a.PerformanceMarkers)performance.clearMarks(a.PerformanceMarkers[i])},getPerformanceMetrics(){performance.measure("loadTime",a.PerformanceMarkers.create,a.PerformanceMarkers.load),performance.measure("fullLoadTime",a.PerformanceMarkers.create,a.PerformanceMarkers.fullLoad);const i=performance.getEntriesByName("loadTime")[0].duration,e=performance.getEntriesByName("fullLoadTime")[0].duration,r=Ea.length,s=1/(Ea.reduce((h,d)=>h+d,0)/r/1e3),c=Ea.filter(h=>h>ru).reduce((h,d)=>h+(d-ru)/ru,0);return{loadTime:i,fullLoadTime:e,fps:s,percentDroppedFrames:c/(r+c)*100}}};a.AJAXError=Fi,a.ARRAY_TYPE=Bi,a.Actor=class{constructor(i,e,r){this.target=i,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Ne(["receive","process"],this),this.invoker=new tm(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ht()?i:window}send(i,e,r,s,c=!1){const h=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[h]=r);const d=Si(this.globalScope)?void 0:[];return this.target.postMessage({id:h,type:i,hasCallback:!!r,targetMapId:s,mustQueue:c,sourceMapId:this.mapId,data:xn(e,d)},d),{cancel:()=>{r&&delete this.callbacks[h],this.target.postMessage({id:h,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(i){const e=i.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){delete this.tasks[r];const s=this.cancelCallbacks[r];delete this.cancelCallbacks[r],s&&s()}else Ht()||e.mustQueue?(this.tasks[r]=e,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,e)}process(){if(!this.taskQueue.length)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){if(e.type==="<response>"){const r=this.callbacks[i];delete this.callbacks[i],r&&(e.error?r(Jr(e.error)):r(null,Jr(e.data)))}else{let r=!1;const s=Si(this.globalScope)?void 0:[],c=e.hasCallback?(m,g)=>{r=!0,delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:m?xn(m):null,data:xn(g,s)},s)}:m=>{r=!0};let h=null;const d=Jr(e.data);if(this.parent[e.type])h=this.parent[e.type](e.sourceMapId,d,c);else if(this.parent.getWorkerSource){const m=e.type.split(".");h=this.parent.getWorkerSource(e.sourceMapId,m[0],d.source)[m[1]](d,c)}else c(new Error(`Could not find function ${e.type}`));!r&&h&&h.cancel&&(this.cancelCallbacks[i]=h.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.AlphaImage=fa,a.CanonicalTileID=tu,a.CollisionBoxArray=de,a.CollisionCircleLayoutArray=class extends T{},a.Color=L,a.DEMData=op,a.DataConstantProperty=Ge,a.DictionaryCoder=ap,a.EXTENT=ai,a.ErrorEvent=Vn,a.EvaluationParameters=Gt,a.Event=Cr,a.Evented=kr,a.FeatureIndex=cp,a.FillBucket=Oc,a.FillExtrusionBucket=Vc,a.GeoJSONFeature=lp,a.ImageAtlas=Dh,a.ImagePosition=Gc,a.LineBucket=Nc,a.LineStripIndexArray=class extends V{},a.LngLat=Jt,a.LngLatBounds=qs,a.MercatorCoordinate=ql,a.ONE_EM=xi,a.OverscaledTileID=pr,a.PerformanceUtils=rm,a.PosArray=je,a.Properties=yi,a.QuadTriangleArray=class extends M{},a.RGBAImage=hr,a.RasterBoundsArray=class extends l{},a.RequestPerformance=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},a.ResourceType=Ir,a.SegmentVector=pt,a.SymbolBucket=To,a.Transitionable=xl,a.TriangleIndexArray=Di,a.Uniform1f=Tn,a.Uniform1i=class extends wn{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},a.Uniform2f=class extends wn{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},a.Uniform3f=class extends wn{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},a.Uniform4f=fo,a.UniformColor=Hu,a.UniformMatrix4f=class extends wn{constructor(i,e){super(i,e),this.current=Td}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},a.UnwrappedTileID=sp,a.ValidationError=ke,a.ZoomHistory=Qo,a.add=function(i,e,r){return i[0]=e[0]+r[0],i[1]=e[1]+r[1],i[2]=e[2]+r[2],i},a.addDynamicAttributes=Hc,a.asyncAll=function(i,e,r){if(!i.length)return r(null,[]);let s=i.length;const c=new Array(i.length);let h=null;i.forEach((d,m)=>{e(d,(g,x)=>{g&&(h=g),c[m]=x,--s==0&&r(h,c)})})},a.bezier=me,a.bindAll=Ne,a.cacheEntryPossiblyAdded=function(i){mr++,mr>Bn&&(i.getActor().send("enforceCacheSizeLimit",Ln),mr=0)},a.clamp=Y,a.clearTileCache=function(i){const e=caches.delete(or);i&&e.catch(i).then(()=>i())},a.clipLine=Zh,a.clone=function(i){var e=new Bi(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},a.clone$1=ht,a.clone$2=function(i){var e=new Bi(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},a.collisionCircleLayout=bf,a.config=Sr,a.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},a.create=function(){var i=new Bi(16);return Bi!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},a.create$1=rh,a.createExpression=Es,a.createFilter=ao,a.createLayout=ii,a.createStyleLayer=function(i){return i.type==="custom"?new Qf(i):new em[i.type](i)},a.cross=function(i,e,r){var s=e[0],c=e[1],h=e[2],d=r[0],m=r[1],g=r[2];return i[0]=c*g-h*m,i[1]=h*d-s*g,i[2]=s*m-c*d,i},a.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]},a.dot$1=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},a.ease=pe,a.emitValidationErrors=co,a.enforceCacheSizeLimit=function(i){Rn(),ar&&ar.then(e=>{e.keys().then(r=>{for(let s=0;s<r.length-i;s++)e.delete(r[s])})})},a.equals=function(i,e){var r=i[0],s=i[1],c=i[2],h=i[3],d=i[4],m=i[5],g=i[6],x=i[7],w=i[8],E=i[9],A=i[10],z=i[11],P=i[12],$=i[13],N=i[14],te=i[15],ae=e[0],ee=e[1],se=e[2],xe=e[3],ye=e[4],Fe=e[5],Ve=e[6],Pe=e[7],Ce=e[8],Se=e[9],De=e[10],Me=e[11],Te=e[12],Xe=e[13],Ze=e[14],ct=e[15];return Math.abs(r-ae)<=Li*Math.max(1,Math.abs(r),Math.abs(ae))&&Math.abs(s-ee)<=Li*Math.max(1,Math.abs(s),Math.abs(ee))&&Math.abs(c-se)<=Li*Math.max(1,Math.abs(c),Math.abs(se))&&Math.abs(h-xe)<=Li*Math.max(1,Math.abs(h),Math.abs(xe))&&Math.abs(d-ye)<=Li*Math.max(1,Math.abs(d),Math.abs(ye))&&Math.abs(m-Fe)<=Li*Math.max(1,Math.abs(m),Math.abs(Fe))&&Math.abs(g-Ve)<=Li*Math.max(1,Math.abs(g),Math.abs(Ve))&&Math.abs(x-Pe)<=Li*Math.max(1,Math.abs(x),Math.abs(Pe))&&Math.abs(w-Ce)<=Li*Math.max(1,Math.abs(w),Math.abs(Ce))&&Math.abs(E-Se)<=Li*Math.max(1,Math.abs(E),Math.abs(Se))&&Math.abs(A-De)<=Li*Math.max(1,Math.abs(A),Math.abs(De))&&Math.abs(z-Me)<=Li*Math.max(1,Math.abs(z),Math.abs(Me))&&Math.abs(P-Te)<=Li*Math.max(1,Math.abs(P),Math.abs(Te))&&Math.abs($-Xe)<=Li*Math.max(1,Math.abs($),Math.abs(Xe))&&Math.abs(N-Ze)<=Li*Math.max(1,Math.abs(N),Math.abs(Ze))&&Math.abs(te-ct)<=Li*Math.max(1,Math.abs(te),Math.abs(ct))},a.evaluateSizeForFeature=function(i,{uSize:e,uSizeT:r},{lowerSize:s,upperSize:c}){return i.kind==="source"?s/In:i.kind==="composite"?$t(s/In,c/In,r):e},a.evaluateSizeForZoom=function(i,e){let r=0,s=0;if(i.kind==="constant")s=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:c,minZoom:h,maxZoom:d}=i,m=c?Y(Vi.interpolationFactor(c,e,h,d),0,1):0;i.kind==="camera"?s=$t(i.minSize,i.maxSize,m):r=m}return{uSizeT:r,uSize:s}},a.evaluateVariableOffset=Wh,a.evented=oa,a.exported=$r,a.exported$1=qr,a.extend=qe,a.filterObject=Tt,a.fromRotation=function(i,e){var r=Math.sin(e),s=Math.cos(e);return i[0]=s,i[1]=r,i[2]=0,i[3]=-r,i[4]=s,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},a.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},a.getAnchorAlignment=jc,a.getAnchorJustification=Wc,a.getArrayBuffer=Un,a.getImage=Wr,a.getJSON=function(i,e){return On(qe(i,{type:"json"}),e)},a.getOverlapMode=Qc,a.getRTLTextPluginStatus=Rs,a.getReferrer=ds,a.getVideo=function(i,e){const r=window.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let s=0;s<i.length;s++){const c=window.document.createElement("source");fs(i[s])||(r.crossOrigin="Anonymous"),c.src=i[s],r.appendChild(c)}return{cancel:()=>{}}},a.identity=kc,a.invert=function(i,e){var r=e[0],s=e[1],c=e[2],h=e[3],d=e[4],m=e[5],g=e[6],x=e[7],w=e[8],E=e[9],A=e[10],z=e[11],P=e[12],$=e[13],N=e[14],te=e[15],ae=r*m-s*d,ee=r*g-c*d,se=r*x-h*d,xe=s*g-c*m,ye=s*x-h*m,Fe=c*x-h*g,Ve=w*$-E*P,Pe=w*N-A*P,Ce=w*te-z*P,Se=E*N-A*$,De=E*te-z*$,Me=A*te-z*N,Te=ae*Me-ee*De+se*Se+xe*Ce-ye*Pe+Fe*Ve;return Te?(i[0]=(m*Me-g*De+x*Se)*(Te=1/Te),i[1]=(c*De-s*Me-h*Se)*Te,i[2]=($*Fe-N*ye+te*xe)*Te,i[3]=(A*ye-E*Fe-z*xe)*Te,i[4]=(g*Ce-d*Me-x*Pe)*Te,i[5]=(r*Me-c*Ce+h*Pe)*Te,i[6]=(N*se-P*Fe-te*ee)*Te,i[7]=(w*Fe-A*se+z*ee)*Te,i[8]=(d*De-m*Ce+x*Ve)*Te,i[9]=(s*Ce-r*De-h*Ve)*Te,i[10]=(P*ye-$*se+te*ae)*Te,i[11]=(E*se-w*ye-z*ae)*Te,i[12]=(m*Pe-d*Se-g*Ve)*Te,i[13]=(r*Se-s*Pe+c*Ve)*Te,i[14]=($*ee-P*xe-N*ae)*Te,i[15]=(w*xe-E*ee+A*ae)*Te,i):null},a.isImageBitmap=Yi,a.isSafari=Si,a.isWorker=Ht,a.keysDifference=function(i,e){const r=[];for(const s in i)s in e||r.push(s);return r},a.lazyLoadRTLTextPlugin=function(){Qi.isLoading()||Qi.isLoaded()||Rs()!=="deferred"||yl()},a.makeRequest=On,a.mapObject=We,a.mercatorXfromLng=tp,a.mercatorYfromLat=ip,a.mercatorZfromAltitude=rp,a.mul=zd,a.mul$1=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},a.multiply=nh,a.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},a.normalize=function(i,e){var r=e[0],s=e[1],c=e[2],h=r*r+s*s+c*c;return h>0&&(h=1/Math.sqrt(h)),i[0]=e[0]*h,i[1]=e[1]*h,i[2]=e[2]*h,i},a.number=$t,a.ortho=function(i,e,r,s,c,h,d){var m=1/(e-r),g=1/(s-c),x=1/(h-d);return i[0]=-2*m,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*g,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*x,i[11]=0,i[12]=(e+r)*m,i[13]=(c+s)*g,i[14]=(d+h)*x,i[15]=1,i},a.parseCacheControl=Xt,a.parseGlyphPbf=function(i){return new $c(i).readFields(Pf,[])},a.pbf=$c,a.performSymbolLayout=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=ai/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0].layout,r=i.bucket.layers[0]._unevaluatedLayout._values,s={layoutIconSize:r["icon-size"].possiblyEvaluate(new Gt(i.bucket.zoom+1),i.canonical),layoutTextSize:r["text-size"].possiblyEvaluate(new Gt(i.bucket.zoom+1),i.canonical),textMaxSize:r["text-size"].possiblyEvaluate(new Gt(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:g,maxZoom:x}=i.bucket.textSizeData;s.compositeTextSizes=[r["text-size"].possiblyEvaluate(new Gt(g),i.canonical),r["text-size"].possiblyEvaluate(new Gt(x),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:g,maxZoom:x}=i.bucket.iconSizeData;s.compositeIconSizes=[r["icon-size"].possiblyEvaluate(new Gt(g),i.canonical),r["icon-size"].possiblyEvaluate(new Gt(x),i.canonical)]}const c=e.get("text-line-height")*xi,h=e.get("text-rotation-alignment")!=="viewport"&&e.get("symbol-placement")!=="point",d=e.get("text-keep-upright"),m=e.get("text-size");for(const g of i.bucket.features){const x=e.get("text-font").evaluate(g,{},i.canonical).join(","),w=m.evaluate(g,{},i.canonical),E=s.layoutTextSize.evaluate(g,{},i.canonical),A=s.layoutIconSize.evaluate(g,{},i.canonical),z={horizontal:{},vertical:void 0},P=g.text;let $,N=[0,0];if(P){const ee=P.toString(),se=e.get("text-letter-spacing").evaluate(g,{},i.canonical)*xi,xe=bc(ee)?se:0,ye=e.get("text-anchor").evaluate(g,{},i.canonical),Fe=e.get("text-variable-anchor");if(!Fe){const De=e.get("text-radial-offset").evaluate(g,{},i.canonical);N=De?Wh(ye,[De*xi,Xc]):e.get("text-offset").evaluate(g,{},i.canonical).map(Me=>Me*xi)}let Ve=h?"center":e.get("text-justify").evaluate(g,{},i.canonical);const Pe=e.get("symbol-placement"),Ce=Pe==="point"?e.get("text-max-width").evaluate(g,{},i.canonical)*xi:0,Se=()=>{i.bucket.allowVerticalPlacement&&uo(ee)&&(z.vertical=Bl(P,i.glyphMap,i.glyphPositions,i.imagePositions,x,Ce,c,ye,"left",xe,N,a.WritingMode.vertical,!0,Pe,E,w))};if(!h&&Fe){const De=Ve==="auto"?Fe.map(Te=>Wc(Te)):[Ve];let Me=!1;for(let Te=0;Te<De.length;Te++){const Xe=De[Te];if(!z.horizontal[Xe])if(Me)z.horizontal[Xe]=z.horizontal[0];else{const Ze=Bl(P,i.glyphMap,i.glyphPositions,i.imagePositions,x,Ce,c,"center",Xe,xe,N,a.WritingMode.horizontal,!1,Pe,E,w);Ze&&(z.horizontal[Xe]=Ze,Me=Ze.positionedLines.length===1)}}Se()}else{Ve==="auto"&&(Ve=Wc(ye));const De=Bl(P,i.glyphMap,i.glyphPositions,i.imagePositions,x,Ce,c,ye,Ve,xe,N,a.WritingMode.horizontal,!1,Pe,E,w);De&&(z.horizontal[Ve]=De),Se(),uo(ee)&&h&&d&&(z.vertical=Bl(P,i.glyphMap,i.glyphPositions,i.imagePositions,x,Ce,c,ye,Ve,xe,N,a.WritingMode.vertical,!1,Pe,E,w))}}let te=!1;if(g.icon&&g.icon.name){const ee=i.imageMap[g.icon.name];ee&&($=Of(i.imagePositions[g.icon.name],e.get("icon-offset").evaluate(g,{},i.canonical),e.get("icon-anchor").evaluate(g,{},i.canonical)),te=!!ee.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=te:i.bucket.sdfIcons!==te&&st("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ee.pixelRatio!==i.bucket.pixelRatio||e.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const ae=Kh(z.horizontal)||z.vertical;i.bucket.iconsInText=!!ae&&ae.iconsInText,(ae||$)&&Zf(i.bucket,g,z,$,i.imageMap,s,E,A,N,te,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},a.perspective=function(i,e,r,s,c){var h,d=1/Math.tan(e/2);return i[0]=d/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=d,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,c!=null&&c!==1/0?(i[10]=(c+s)*(h=1/(s-c)),i[14]=2*c*s*h):(i[10]=-1,i[14]=-2*s),i},a.pick=function(i,e){const r={};for(let s=0;s<e.length;s++){const c=e[s];c in i&&(r[c]=i[c])}return r},a.plugin=Qi,a.pointGeometry=Je,a.polygonIntersectsPolygon=Qu,a.potpack=Ph,a.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.register=Oe,a.registerForPluginStateChange=function(i){return i({pluginStatus:Pi,pluginURL:Qr}),oa.on("pluginStateChange",i),i},a.renderColorRamp=hh,a.rotateX=function(i,e,r){var s=Math.sin(r),c=Math.cos(r),h=e[4],d=e[5],m=e[6],g=e[7],x=e[8],w=e[9],E=e[10],A=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=h*c+x*s,i[5]=d*c+w*s,i[6]=m*c+E*s,i[7]=g*c+A*s,i[8]=x*c-h*s,i[9]=w*c-d*s,i[10]=E*c-m*s,i[11]=A*c-g*s,i},a.rotateZ=function(i,e,r){var s=Math.sin(r),c=Math.cos(r),h=e[0],d=e[1],m=e[2],g=e[3],x=e[4],w=e[5],E=e[6],A=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=h*c+x*s,i[1]=d*c+w*s,i[2]=m*c+E*s,i[3]=g*c+A*s,i[4]=x*c-h*s,i[5]=w*c-d*s,i[6]=E*c-m*s,i[7]=A*c-g*s,i},a.scale=function(i,e,r){var s=r[0],c=r[1],h=r[2];return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=e[3]*s,i[4]=e[4]*c,i[5]=e[5]*c,i[6]=e[6]*c,i[7]=e[7]*c,i[8]=e[8]*h,i[9]=e[9]*h,i[10]=e[10]*h,i[11]=e[11]*h,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},a.scale$1=function(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i},a.setCacheLimits=function(i,e){Ln=i,Bn=e},a.setRTLTextPlugin=function(i,e,r=!1){if(Pi===ia||Pi===ra||Pi===na)throw new Error("setRTLTextPlugin cannot be called multiple times.");Qr=$r.resolveURL(i),Pi=ia,sa=e,es(),r||yl()},a.spec=ge,a.sphericalToCartesian=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}},a.sqrLen=function(i){var e=i[0],r=i[1];return e*e+r*r},a.sub=function(i,e,r){return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],i},a.toEvaluationFeature=Ns,a.transformMat3=function(i,e,r){var s=e[0],c=e[1],h=e[2];return i[0]=s*r[0]+c*r[3]+h*r[6],i[1]=s*r[1]+c*r[4]+h*r[7],i[2]=s*r[2]+c*r[5]+h*r[8],i},a.transformMat4=Al,a.transformMat4$1=function(i,e,r){var s=e[0],c=e[1];return i[0]=r[0]*s+r[4]*c+r[12],i[1]=r[1]*s+r[5]*c+r[13],i},a.translate=function(i,e,r){var s,c,h,d,m,g,x,w,E,A,z,P,$=r[0],N=r[1],te=r[2];return e===i?(i[12]=e[0]*$+e[4]*N+e[8]*te+e[12],i[13]=e[1]*$+e[5]*N+e[9]*te+e[13],i[14]=e[2]*$+e[6]*N+e[10]*te+e[14],i[15]=e[3]*$+e[7]*N+e[11]*te+e[15]):(c=e[1],h=e[2],d=e[3],m=e[4],g=e[5],x=e[6],w=e[7],E=e[8],A=e[9],z=e[10],P=e[11],i[0]=s=e[0],i[1]=c,i[2]=h,i[3]=d,i[4]=m,i[5]=g,i[6]=x,i[7]=w,i[8]=E,i[9]=A,i[10]=z,i[11]=P,i[12]=s*$+m*N+E*te+e[12],i[13]=c*$+g*N+A*te+e[13],i[14]=h*$+x*N+z*te+e[14],i[15]=d*$+w*N+P*te+e[15]),i},a.triggerPluginCompletionEvent=_l,a.unicodeBlockLookup=ze,a.uniqueId=function(){return be++},a.validateCustomStyleLayer=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},a.validateLight=Jo,a.validateStyle=Ls,a.vectorTile=ns,a.warnOnce=st,a.wrap=Ee}),G(["./shared"],function(a){function _e(B){const b=typeof B;if(b==="number"||b==="boolean"||b==="string"||B==null)return JSON.stringify(B);if(Array.isArray(B)){let L="[";for(const Z of B)L+=`${_e(Z)},`;return`${L}]`}const S=Object.keys(B).sort();let D="{";for(let L=0;L<S.length;L++)D+=`${JSON.stringify(S[L])}:${_e(B[S[L]])},`;return`${D}}`}function le(B){let b="";for(const S of a.refProperties)b+=`/${_e(B[S])}`;return b}class me{constructor(b){this.keyCache={},b&&this.replace(b)}replace(b){this._layerConfigs={},this._layers={},this.update(b,[])}update(b,S){for(const L of b){this._layerConfigs[L.id]=L;const Z=this._layers[L.id]=a.createStyleLayer(L);Z._featureFilter=a.createFilter(Z.filter),this.keyCache[L.id]&&delete this.keyCache[L.id]}for(const L of S)delete this.keyCache[L],delete this._layerConfigs[L],delete this._layers[L];this.familiesBySource={};const D=function(L,Z){const K={};for(let j=0;j<L.length;j++){const J=Z&&Z[L[j].id]||le(L[j]);Z&&(Z[L[j].id]=J);let ue=K[J];ue||(ue=K[J]=[]),ue.push(L[j])}const W=[];for(const j in K)W.push(K[j]);return W}(Object.values(this._layerConfigs),this.keyCache);for(const L of D){const Z=L.map(ve=>this._layers[ve.id]),K=Z[0];if(K.visibility==="none")continue;const W=K.source||"";let j=this.familiesBySource[W];j||(j=this.familiesBySource[W]={});const J=K.sourceLayer||"_geojsonTileLayer";let ue=j[J];ue||(ue=j[J]=[]),ue.push(Z)}}}class pe{constructor(b){const S={},D=[];for(const W in b){const j=b[W],J=S[W]={};for(const ue in j){const ve=j[+ue];if(!ve||ve.bitmap.width===0||ve.bitmap.height===0)continue;const ce={x:0,y:0,w:ve.bitmap.width+2,h:ve.bitmap.height+2};D.push(ce),J[ue]={rect:ce,metrics:ve.metrics}}}const{w:L,h:Z}=a.potpack(D),K=new a.AlphaImage({width:L||1,height:Z||1});for(const W in b){const j=b[W];for(const J in j){const ue=j[+J];if(!ue||ue.bitmap.width===0||ue.bitmap.height===0)continue;const ve=S[W][J].rect;a.AlphaImage.copy(ue.bitmap,K,{x:0,y:0},{x:ve.x+1,y:ve.y+1},ue.bitmap)}}this.image=K,this.positions=S}}a.register("GlyphAtlas",pe);class Y{constructor(b){this.tileID=new a.OverscaledTileID(b.tileID.overscaledZ,b.tileID.wrap,b.tileID.canonical.z,b.tileID.canonical.x,b.tileID.canonical.y),this.uid=b.uid,this.zoom=b.zoom,this.pixelRatio=b.pixelRatio,this.tileSize=b.tileSize,this.source=b.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=b.showCollisionBoxes,this.collectResourceTiming=!!b.collectResourceTiming,this.returnDependencies=!!b.returnDependencies,this.promoteId=b.promoteId}parse(b,S,D,L,Z){this.status="parsing",this.data=b,this.collisionBoxArray=new a.CollisionBoxArray;const K=new a.DictionaryCoder(Object.keys(b.layers).sort()),W=new a.FeatureIndex(this.tileID,this.promoteId);W.bucketLayerIDs=[];const j={},J={featureIndex:W,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:D},ue=S.familiesBySource[this.source];for(const Qe in ue){const at=b.layers[Qe];if(!at)continue;at.version===1&&a.warnOnce(`Vector tile source "${this.source}" layer "${Qe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const xt=K.encode(Qe),Bt=[];for(let ui=0;ui<at.length;ui++){const Nt=at.feature(ui),vi=W.getId(Nt,Qe);Bt.push({feature:Nt,id:vi,index:ui,sourceLayerIndex:xt})}for(const ui of ue[Qe]){const Nt=ui[0];Nt.source!==this.source&&a.warnOnce(`layer.source = ${Nt.source} does not equal this.source = ${this.source}`),Nt.minzoom&&this.zoom<Math.floor(Nt.minzoom)||Nt.maxzoom&&this.zoom>=Nt.maxzoom||Nt.visibility!=="none"&&(Ee(ui,this.zoom,D),(j[Nt.id]=Nt.createBucket({index:W.bucketLayerIDs.length,layers:ui,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:xt,sourceID:this.source})).populate(Bt,J,this.tileID.canonical),W.bucketLayerIDs.push(ui.map(vi=>vi.id)))}}let ve,ce,Ue,$e;const Le=a.mapObject(J.glyphDependencies,Qe=>Object.keys(Qe).map(Number));Object.keys(Le).length?L.send("getGlyphs",{uid:this.uid,stacks:Le},(Qe,at)=>{ve||(ve=Qe,ce=at,yt.call(this))}):ce={};const He=Object.keys(J.iconDependencies);He.length?L.send("getImages",{icons:He,source:this.source,tileID:this.tileID,type:"icons"},(Qe,at)=>{ve||(ve=Qe,Ue=at,yt.call(this))}):Ue={};const Ye=Object.keys(J.patternDependencies);function yt(){if(ve)return Z(ve);if(ce&&Ue&&$e){const Qe=new pe(ce),at=new a.ImageAtlas(Ue,$e);for(const xt in j){const Bt=j[xt];Bt instanceof a.SymbolBucket?(Ee(Bt.layers,this.zoom,D),a.performSymbolLayout({bucket:Bt,glyphMap:ce,glyphPositions:Qe.positions,imageMap:Ue,imagePositions:at.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Bt.hasPattern&&(Bt instanceof a.LineBucket||Bt instanceof a.FillBucket||Bt instanceof a.FillExtrusionBucket)&&(Ee(Bt.layers,this.zoom,D),Bt.addFeatures(J,this.tileID.canonical,at.patternPositions))}this.status="done",Z(null,{buckets:Object.values(j).filter(xt=>!xt.isEmpty()),featureIndex:W,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Qe.image,imageAtlas:at,glyphMap:this.returnDependencies?ce:null,iconMap:this.returnDependencies?Ue:null,glyphPositions:this.returnDependencies?Qe.positions:null})}}Ye.length?L.send("getImages",{icons:Ye,source:this.source,tileID:this.tileID,type:"patterns"},(Qe,at)=>{ve||(ve=Qe,$e=at,yt.call(this))}):$e={},yt.call(this)}}function Ee(B,b,S){const D=new a.EvaluationParameters(b);for(const L of B)L.recalculate(D,S)}function qe(B,b){const S=a.getArrayBuffer(B.request,(D,L,Z,K)=>{D?b(D):L&&b(null,{vectorTile:new a.vectorTile.VectorTile(new a.pbf(L)),rawData:L,cacheControl:Z,expires:K})});return()=>{S.cancel(),b()}}class be{constructor(b,S,D,L){this.actor=b,this.layerIndex=S,this.availableImages=D,this.loadVectorData=L||qe,this.loading={},this.loaded={}}loadTile(b,S){const D=b.uid;this.loading||(this.loading={});const L=!!(b&&b.request&&b.request.collectResourceTiming)&&new a.RequestPerformance(b.request),Z=this.loading[D]=new Y(b);Z.abort=this.loadVectorData(b,(K,W)=>{if(delete this.loading[D],K||!W)return Z.status="done",this.loaded[D]=Z,S(K);const j=W.rawData,J={};W.expires&&(J.expires=W.expires),W.cacheControl&&(J.cacheControl=W.cacheControl);const ue={};if(L){const ve=L.finish();ve&&(ue.resourceTiming=JSON.parse(JSON.stringify(ve)))}Z.vectorTile=W.vectorTile,Z.parse(W.vectorTile,this.layerIndex,this.availableImages,this.actor,(ve,ce)=>{if(ve||!ce)return S(ve);S(null,a.extend({rawTileData:j.slice(0)},ce,J,ue))}),this.loaded=this.loaded||{},this.loaded[D]=Z})}reloadTile(b,S){const D=this.loaded,L=b.uid,Z=this;if(D&&D[L]){const K=D[L];K.showCollisionBoxes=b.showCollisionBoxes;const W=(j,J)=>{const ue=K.reloadCallback;ue&&(delete K.reloadCallback,K.parse(K.vectorTile,Z.layerIndex,this.availableImages,Z.actor,ue)),S(j,J)};K.status==="parsing"?K.reloadCallback=W:K.status==="done"&&(K.vectorTile?K.parse(K.vectorTile,this.layerIndex,this.availableImages,this.actor,W):W())}}abortTile(b,S){const D=this.loading,L=b.uid;D&&D[L]&&D[L].abort&&(D[L].abort(),delete D[L]),S()}removeTile(b,S){const D=this.loaded,L=b.uid;D&&D[L]&&delete D[L],S()}}class Ne{constructor(){this.loaded={}}loadTile(b,S){const{uid:D,encoding:L,rawImageData:Z}=b,K=a.isImageBitmap(Z)?this.getImageData(Z):Z,W=new a.DEMData(D,K,L);this.loaded=this.loaded||{},this.loaded[D]=W,S(null,W)}getImageData(b){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(b.width,b.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=b.width,this.offscreenCanvas.height=b.height,this.offscreenCanvasContext.drawImage(b,0,0,b.width,b.height);const S=this.offscreenCanvasContext.getImageData(-1,-1,b.width+2,b.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new a.RGBAImage({width:S.width,height:S.height},S.data)}removeTile(b){const S=this.loaded,D=b.uid;S&&S[D]&&delete S[D]}}var We=function B(b,S){var D,L=b&&b.type;if(L==="FeatureCollection")for(D=0;D<b.features.length;D++)B(b.features[D],S);else if(L==="GeometryCollection")for(D=0;D<b.geometries.length;D++)B(b.geometries[D],S);else if(L==="Feature")B(b.geometry,S);else if(L==="Polygon")Tt(b.coordinates,S);else if(L==="MultiPolygon")for(D=0;D<b.coordinates.length;D++)Tt(b.coordinates[D],S);return b};function Tt(B,b){if(B.length!==0){ht(B[0],b);for(var S=1;S<B.length;S++)ht(B[S],!b)}}function ht(B,b){for(var S=0,D=0,L=0,Z=B.length,K=Z-1;L<Z;K=L++){var W=(B[L][0]-B[K][0])*(B[K][1]+B[L][1]),j=S+W;D+=Math.abs(S)>=Math.abs(W)?S-j+W:W-j+S,S=j}S+D>=0!=!!b&&B.reverse()}const At=a.vectorTile.VectorTileFeature.prototype.toGeoJSON;class st{constructor(b){this._feature=b,this.extent=a.EXTENT,this.type=b.type,this.properties=b.tags,"id"in b&&!isNaN(b.id)&&(this.id=parseInt(b.id,10))}loadGeometry(){if(this._feature.type===1){const b=[];for(const S of this._feature.geometry)b.push([new a.pointGeometry(S[0],S[1])]);return b}{const b=[];for(const S of this._feature.geometry){const D=[];for(const L of S)D.push(new a.pointGeometry(L[0],L[1]));b.push(D)}return b}}toGeoJSON(b,S,D){return At.call(this,b,S,D)}}class Qt{constructor(b){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=b.length,this._features=b}feature(b){return new st(this._features[b])}}var tt={exports:{}},Ht=a.pointGeometry,Xt=a.vectorTile.VectorTileFeature,Kt=Mi;function Mi(B,b){this.options=b||{},this.features=B,this.length=B.length}function wt(B,b){this.id=typeof B.id=="number"?B.id:void 0,this.type=B.type,this.rawGeometry=B.type===1?[B.geometry]:B.geometry,this.properties=B.tags,this.extent=b||4096}Mi.prototype.feature=function(B){return new wt(this.features[B],this.options.extent)},wt.prototype.loadGeometry=function(){var B=this.rawGeometry;this.geometry=[];for(var b=0;b<B.length;b++){for(var S=B[b],D=[],L=0;L<S.length;L++)D.push(new Ht(S[L][0],S[L][1]));this.geometry.push(D)}return this.geometry},wt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var B=this.geometry,b=1/0,S=-1/0,D=1/0,L=-1/0,Z=0;Z<B.length;Z++)for(var K=B[Z],W=0;W<K.length;W++){var j=K[W];b=Math.min(b,j.x),S=Math.max(S,j.x),D=Math.min(D,j.y),L=Math.max(L,j.y)}return[b,D,S,L]},wt.prototype.toGeoJSON=Xt.prototype.toGeoJSON;var Si=a.pbf,Yi=Kt;function $r(B){var b=new Si;return function(S,D){for(var L in S.layers)D.writeMessage(3,Je,S.layers[L])}(B,b),b.finish()}function Je(B,b){var S;b.writeVarintField(15,B.version||1),b.writeStringField(1,B.name||""),b.writeVarintField(5,B.extent||4096);var D={keys:[],values:[],keycache:{},valuecache:{}};for(S=0;S<B.length;S++)D.feature=B.feature(S),b.writeMessage(2,Er,D);var L=D.keys;for(S=0;S<L.length;S++)b.writeStringField(3,L[S]);var Z=D.values;for(S=0;S<Z.length;S++)b.writeMessage(4,Ln,Z[S])}function Er(B,b){var S=B.feature;S.id!==void 0&&b.writeVarintField(1,S.id),b.writeMessage(2,Sr,B),b.writeVarintField(3,S.type),b.writeMessage(4,hn,S)}function Sr(B,b){var S=B.feature,D=B.keys,L=B.values,Z=B.keycache,K=B.valuecache;for(var W in S.properties){var j=S.properties[W],J=Z[W];if(j!==null){J===void 0&&(D.push(W),Z[W]=J=D.length-1),b.writeVarint(J);var ue=typeof j;ue!=="string"&&ue!=="boolean"&&ue!=="number"&&(j=JSON.stringify(j));var ve=ue+":"+j,ce=K[ve];ce===void 0&&(L.push(j),K[ve]=ce=L.length-1),b.writeVarint(ce)}}}function or(B,b){return(b<<3)+(7&B)}function ar(B){return B<<1^B>>31}function hn(B,b){for(var S=B.loadGeometry(),D=B.type,L=0,Z=0,K=S.length,W=0;W<K;W++){var j=S[W],J=1;D===1&&(J=j.length),b.writeVarint(or(1,J));for(var ue=D===3?j.length-1:j.length,ve=0;ve<ue;ve++){ve===1&&D!==1&&b.writeVarint(or(2,ue-1));var ce=j[ve].x-L,Ue=j[ve].y-Z;b.writeVarint(ar(ce)),b.writeVarint(ar(Ue)),L+=ce,Z+=Ue}D===3&&b.writeVarint(or(7,1))}}function Ln(B,b){var S=typeof B;S==="string"?b.writeStringField(1,B):S==="boolean"?b.writeBooleanField(7,B):S==="number"&&(B%1!=0?b.writeDoubleField(3,B):B<0?b.writeSVarintField(6,B):b.writeVarintField(5,B))}function Bn(B,b,S,D,L,Z){if(L-D<=S)return;const K=D+L>>1;Rn(B,b,K,D,L,Z%2),Bn(B,b,S,D,K-1,Z+1),Bn(B,b,S,K+1,L,Z+1)}function Rn(B,b,S,D,L,Z){for(;L>D;){if(L-D>600){const J=L-D+1,ue=S-D+1,ve=Math.log(J),ce=.5*Math.exp(2*ve/3),Ue=.5*Math.sqrt(ve*ce*(J-ce)/J)*(ue-J/2<0?-1:1);Rn(B,b,S,Math.max(D,Math.floor(S-ue*ce/J+Ue)),Math.min(L,Math.floor(S+(J-ue)*ce/J+Ue)),Z)}const K=b[2*S+Z];let W=D,j=L;for(mr(B,b,D,S),b[2*L+Z]>K&&mr(B,b,D,L);W<j;){for(mr(B,b,W,j),W++,j--;b[2*W+Z]<K;)W++;for(;b[2*j+Z]>K;)j--}b[2*D+Z]===K?mr(B,b,D,j):(j++,mr(B,b,j,L)),j<=S&&(D=j+1),S<=j&&(L=j-1)}}function mr(B,b,S,D){qr(B,S,D),qr(b,2*S,2*D),qr(b,2*S+1,2*D+1)}function qr(B,b,S){const D=B[b];B[b]=B[S],B[S]=D}function Gr(B,b,S,D){const L=B-S,Z=b-D;return L*L+Z*Z}tt.exports=$r,tt.exports.fromVectorTileJs=$r,tt.exports.fromGeojsonVt=function(B,b){b=b||{};var S={};for(var D in B)S[D]=new Yi(B[D].features,b),S[D].name=D,S[D].version=b.version,S[D].extent=b.extent;return $r({layers:S})},tt.exports.GeoJSONWrapper=Yi;const Zr=B=>B[0],zi=B=>B[1];class Fn{constructor(b,S=Zr,D=zi,L=64,Z=Float64Array){this.nodeSize=L,this.points=b;const K=b.length<65536?Uint16Array:Uint32Array,W=this.ids=new K(b.length),j=this.coords=new Z(2*b.length);for(let J=0;J<b.length;J++)W[J]=J,j[2*J]=S(b[J]),j[2*J+1]=D(b[J]);Bn(W,j,L,0,W.length-1,0)}range(b,S,D,L){return function(Z,K,W,j,J,ue,ve){const ce=[0,Z.length-1,0],Ue=[];let $e,Le;for(;ce.length;){const He=ce.pop(),Ye=ce.pop(),yt=ce.pop();if(Ye-yt<=ve){for(let xt=yt;xt<=Ye;xt++)$e=K[2*xt],Le=K[2*xt+1],$e>=W&&$e<=J&&Le>=j&&Le<=ue&&Ue.push(Z[xt]);continue}const Qe=Math.floor((yt+Ye)/2);$e=K[2*Qe],Le=K[2*Qe+1],$e>=W&&$e<=J&&Le>=j&&Le<=ue&&Ue.push(Z[Qe]);const at=(He+1)%2;(He===0?W<=$e:j<=Le)&&(ce.push(yt),ce.push(Qe-1),ce.push(at)),(He===0?J>=$e:ue>=Le)&&(ce.push(Qe+1),ce.push(Ye),ce.push(at))}return Ue}(this.ids,this.coords,b,S,D,L,this.nodeSize)}within(b,S,D){return function(L,Z,K,W,j,J){const ue=[0,L.length-1,0],ve=[],ce=j*j;for(;ue.length;){const Ue=ue.pop(),$e=ue.pop(),Le=ue.pop();if($e-Le<=J){for(let at=Le;at<=$e;at++)Gr(Z[2*at],Z[2*at+1],K,W)<=ce&&ve.push(L[at]);continue}const He=Math.floor((Le+$e)/2),Ye=Z[2*He],yt=Z[2*He+1];Gr(Ye,yt,K,W)<=ce&&ve.push(L[He]);const Qe=(Ue+1)%2;(Ue===0?K-j<=Ye:W-j<=yt)&&(ue.push(Le),ue.push(He-1),ue.push(Qe)),(Ue===0?K+j>=Ye:W+j>=yt)&&(ue.push(He+1),ue.push($e),ue.push(Qe))}return ve}(this.ids,this.coords,b,S,D,this.nodeSize)}}const ps={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:B=>B},Ir=Math.fround||(Fi=new Float32Array(1),B=>(Fi[0]=+B,Fi[0]));var Fi;class ds{constructor(b){this.options=Wr(Object.create(ps),b),this.trees=new Array(this.options.maxZoom+1)}load(b){const{log:S,minZoom:D,maxZoom:L,nodeSize:Z}=this.options;S&&console.time("total time");const K=`prepare ${b.length} points`;S&&console.time(K),this.points=b;let W=[];for(let j=0;j<b.length;j++)b[j].geometry&&W.push(On(b[j],j));this.trees[L+1]=new Fn(W,ms,Ar,Z,Float32Array),S&&console.timeEnd(K);for(let j=L;j>=D;j--){const J=+Date.now();W=this._cluster(W,j),this.trees[j]=new Fn(W,ms,Ar,Z,Float32Array),S&&console.log("z%d: %d clusters in %dms",j,W.length,+Date.now()-J)}return S&&console.timeEnd("total time"),this}getClusters(b,S){let D=((b[0]+180)%360+360)%360-180;const L=Math.max(-90,Math.min(90,b[1]));let Z=b[2]===180?180:((b[2]+180)%360+360)%360-180;const K=Math.max(-90,Math.min(90,b[3]));if(b[2]-b[0]>=360)D=-180,Z=180;else if(D>Z){const ue=this.getClusters([D,L,180,K],S),ve=this.getClusters([-180,L,Z,K],S);return ue.concat(ve)}const W=this.trees[this._limitZoom(S)],j=W.range(gt(D),gr(K),gt(Z),gr(L)),J=[];for(const ue of j){const ve=W.points[ue];J.push(ve.numPoints?Un(ve):this.points[ve.index])}return J}getChildren(b){const S=this._getOriginId(b),D=this._getOriginZoom(b),L="No cluster with the specified id.",Z=this.trees[D];if(!Z)throw new Error(L);const K=Z.points[S];if(!K)throw new Error(L);const W=this.options.radius/(this.options.extent*Math.pow(2,D-1)),j=Z.within(K.x,K.y,W),J=[];for(const ue of j){const ve=Z.points[ue];ve.parentId===b&&J.push(ve.numPoints?Un(ve):this.points[ve.index])}if(J.length===0)throw new Error(L);return J}getLeaves(b,S,D){const L=[];return this._appendLeaves(L,b,S=S||10,D=D||0,0),L}getTile(b,S,D){const L=this.trees[this._limitZoom(b)],Z=Math.pow(2,b),{extent:K,radius:W}=this.options,j=W/K,J=(D-j)/Z,ue=(D+1+j)/Z,ve={features:[]};return this._addTileFeatures(L.range((S-j)/Z,J,(S+1+j)/Z,ue),L.points,S,D,Z,ve),S===0&&this._addTileFeatures(L.range(1-j/Z,J,1,ue),L.points,Z,D,Z,ve),S===Z-1&&this._addTileFeatures(L.range(0,J,j/Z,ue),L.points,-1,D,Z,ve),ve.features.length?ve:null}getClusterExpansionZoom(b){let S=this._getOriginZoom(b)-1;for(;S<=this.options.maxZoom;){const D=this.getChildren(b);if(S++,D.length!==1)break;b=D[0].properties.cluster_id}return S}_appendLeaves(b,S,D,L,Z){const K=this.getChildren(S);for(const W of K){const j=W.properties;if(j&&j.cluster?Z+j.point_count<=L?Z+=j.point_count:Z=this._appendLeaves(b,j.cluster_id,D,L,Z):Z<L?Z++:b.push(W),b.length===D)break}return Z}_addTileFeatures(b,S,D,L,Z,K){for(const W of b){const j=S[W],J=j.numPoints;let ue,ve,ce;if(J)ue=fs(j),ve=j.x,ce=j.y;else{const Le=this.points[j.index];ue=Le.properties,ve=gt(Le.geometry.coordinates[0]),ce=gr(Le.geometry.coordinates[1])}const Ue={type:1,geometry:[[Math.round(this.options.extent*(ve*Z-D)),Math.round(this.options.extent*(ce*Z-L))]],tags:ue};let $e;J?$e=j.id:this.options.generateId?$e=j.index:this.points[j.index].id&&($e=this.points[j.index].id),$e!==void 0&&(Ue.id=$e),K.features.push(Ue)}}_limitZoom(b){return Math.max(this.options.minZoom,Math.min(Math.floor(+b),this.options.maxZoom+1))}_cluster(b,S){const D=[],{radius:L,extent:Z,reduce:K,minPoints:W}=this.options,j=L/(Z*Math.pow(2,S));for(let J=0;J<b.length;J++){const ue=b[J];if(ue.zoom<=S)continue;ue.zoom=S;const ve=this.trees[S+1],ce=ve.within(ue.x,ue.y,j),Ue=ue.numPoints||1;let $e=Ue;for(const Le of ce){const He=ve.points[Le];He.zoom>S&&($e+=He.numPoints||1)}if($e>Ue&&$e>=W){let Le=ue.x*Ue,He=ue.y*Ue,Ye=K&&Ue>1?this._map(ue,!0):null;const yt=(J<<5)+(S+1)+this.points.length;for(const Qe of ce){const at=ve.points[Qe];if(at.zoom<=S)continue;at.zoom=S;const xt=at.numPoints||1;Le+=at.x*xt,He+=at.y*xt,at.parentId=yt,K&&(Ye||(Ye=this._map(ue,!0)),K(Ye,this._map(at)))}ue.parentId=yt,D.push(jr(Le/$e,He/$e,yt,$e,Ye))}else if(D.push(ue),$e>1)for(const Le of ce){const He=ve.points[Le];He.zoom<=S||(He.zoom=S,D.push(He))}}return D}_getOriginId(b){return b-this.points.length>>5}_getOriginZoom(b){return(b-this.points.length)%32}_map(b,S){if(b.numPoints)return S?Wr({},b.properties):b.properties;const D=this.points[b.index].properties,L=this.options.map(D);return S&&L===D?Wr({},L):L}}function jr(B,b,S,D,L){return{x:Ir(B),y:Ir(b),zoom:1/0,id:S,parentId:-1,numPoints:D,properties:L}}function On(B,b){const[S,D]=B.geometry.coordinates;return{x:Ir(gt(S)),y:Ir(gr(D)),zoom:1/0,index:b,parentId:-1}}function Un(B){return{type:"Feature",id:B.id,properties:fs(B),geometry:{type:"Point",coordinates:[(b=B.x,360*(b-.5)),Xr(B.y)]}};var b}function fs(B){const b=B.numPoints,S=b>=1e4?`${Math.round(b/1e3)}k`:b>=1e3?Math.round(b/100)/10+"k":b;return Wr(Wr({},B.properties),{cluster:!0,cluster_id:B.id,point_count:b,point_count_abbreviated:S})}function gt(B){return B/360+.5}function gr(B){const b=Math.sin(B*Math.PI/180),S=.5-.25*Math.log((1+b)/(1-b))/Math.PI;return S<0?0:S>1?1:S}function Xr(B){const b=(180-360*B)*Math.PI/180;return 360*Math.atan(Math.exp(b))/Math.PI-90}function Wr(B,b){for(const S in b)B[S]=b[S];return B}function ms(B){return B.x}function Ar(B){return B.y}function Cr(B,b,S,D){for(var L,Z=D,K=S-b>>1,W=S-b,j=B[b],J=B[b+1],ue=B[S],ve=B[S+1],ce=b+3;ce<S;ce+=3){var Ue=Vn(B[ce],B[ce+1],j,J,ue,ve);if(Ue>Z)L=ce,Z=Ue;else if(Ue===Z){var $e=Math.abs(ce-K);$e<W&&(L=ce,W=$e)}}Z>D&&(L-b>3&&Cr(B,b,L,D),B[L+2]=Z,S-L>3&&Cr(B,L,S,D))}function Vn(B,b,S,D,L,Z){var K=L-S,W=Z-D;if(K!==0||W!==0){var j=((B-S)*K+(b-D)*W)/(K*K+W*W);j>1?(S=L,D=Z):j>0&&(S+=K*j,D+=W*j)}return(K=B-S)*K+(W=b-D)*W}function kr(B,b,S,D){var L={id:B===void 0?null:B,type:b,geometry:S,tags:D,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Z){var K=Z.geometry,W=Z.type;if(W==="Point"||W==="MultiPoint"||W==="LineString")ge(Z,K);else if(W==="Polygon"||W==="MultiLineString")for(var j=0;j<K.length;j++)ge(Z,K[j]);else if(W==="MultiPolygon")for(j=0;j<K.length;j++)for(var J=0;J<K[j].length;J++)ge(Z,K[j][J])}(L),L}function ge(B,b){for(var S=0;S<b.length;S+=3)B.minX=Math.min(B.minX,b[S]),B.minY=Math.min(B.minY,b[S+1]),B.maxX=Math.max(B.maxX,b[S]),B.maxY=Math.max(B.maxY,b[S+1])}function ke(B,b,S,D){if(b.geometry){var L=b.geometry.coordinates,Z=b.geometry.type,K=Math.pow(S.tolerance/((1<<S.maxZoom)*S.extent),2),W=[],j=b.id;if(S.promoteId?j=b.properties[S.promoteId]:S.generateId&&(j=D||0),Z==="Point")pn(L,W);else if(Z==="MultiPoint")for(var J=0;J<L.length;J++)pn(L[J],W);else if(Z==="LineString")lr(L,W,K,!1);else if(Z==="MultiLineString"){if(S.lineMetrics){for(J=0;J<L.length;J++)lr(L[J],W=[],K,!1),B.push(kr(j,"LineString",W,b.properties));return}_t(L,W,K,!1)}else if(Z==="Polygon")_t(L,W,K,!0);else{if(Z!=="MultiPolygon"){if(Z==="GeometryCollection"){for(J=0;J<b.geometry.geometries.length;J++)ke(B,{id:j,geometry:b.geometry.geometries[J],properties:b.properties},S,D);return}throw new Error("Input data is not a valid GeoJSON object.")}for(J=0;J<L.length;J++){var ue=[];_t(L[J],ue,K,!0),W.push(ue)}}B.push(kr(j,Z,W,b.properties))}}function pn(B,b){b.push(Ji(B[0])),b.push(Oi(B[1])),b.push(0)}function lr(B,b,S,D){for(var L,Z,K=0,W=0;W<B.length;W++){var j=Ji(B[W][0]),J=Oi(B[W][1]);b.push(j),b.push(J),b.push(0),W>0&&(K+=D?(L*J-j*Z)/2:Math.sqrt(Math.pow(j-L,2)+Math.pow(J-Z,2))),L=j,Z=J}var ue=b.length-3;b[2]=1,Cr(b,0,ue,S),b[ue+2]=1,b.size=Math.abs(K),b.start=0,b.end=b.size}function _t(B,b,S,D){for(var L=0;L<B.length;L++){var Z=[];lr(B[L],Z,S,D),b.push(Z)}}function Ji(B){return B/360+.5}function Oi(B){var b=Math.sin(B*Math.PI/180),S=.5-.25*Math.log((1+b)/(1-b))/Math.PI;return S<0?0:S>1?1:S}function Ui(B,b,S,D,L,Z,K,W){if(D/=b,Z>=(S/=b)&&K<D)return B;if(K<S||Z>=D)return null;for(var j=[],J=0;J<B.length;J++){var ue=B[J],ve=ue.geometry,ce=ue.type,Ue=L===0?ue.minX:ue.minY,$e=L===0?ue.maxX:ue.maxY;if(Ue>=S&&$e<D)j.push(ue);else if(!($e<S||Ue>=D)){var Le=[];if(ce==="Point"||ce==="MultiPoint")Hr(ve,Le,S,D,L);else if(ce==="LineString")Ie(ve,Le,S,D,L,!1,W.lineMetrics);else if(ce==="MultiLineString")it(ve,Le,S,D,L,!1);else if(ce==="Polygon")it(ve,Le,S,D,L,!0);else if(ce==="MultiPolygon")for(var He=0;He<ve.length;He++){var Ye=[];it(ve[He],Ye,S,D,L,!0),Ye.length&&Le.push(Ye)}if(Le.length){if(W.lineMetrics&&ce==="LineString"){for(He=0;He<Le.length;He++)j.push(kr(ue.id,ce,Le[He],ue.tags));continue}ce!=="LineString"&&ce!=="MultiLineString"||(Le.length===1?(ce="LineString",Le=Le[0]):ce="MultiLineString"),ce!=="Point"&&ce!=="MultiPoint"||(ce=Le.length===3?"Point":"MultiPoint"),j.push(kr(ue.id,ce,Le,ue.tags))}}}return j.length?j:null}function Hr(B,b,S,D,L){for(var Z=0;Z<B.length;Z+=3){var K=B[Z+L];K>=S&&K<=D&&(b.push(B[Z]),b.push(B[Z+1]),b.push(B[Z+2]))}}function Ie(B,b,S,D,L,Z,K){for(var W,j,J=ot(B),ue=L===0?Kr:et,ve=B.start,ce=0;ce<B.length-3;ce+=3){var Ue=B[ce],$e=B[ce+1],Le=B[ce+2],He=B[ce+3],Ye=B[ce+4],yt=L===0?Ue:$e,Qe=L===0?He:Ye,at=!1;K&&(W=Math.sqrt(Math.pow(Ue-He,2)+Math.pow($e-Ye,2))),yt<S?Qe>S&&(j=ue(J,Ue,$e,He,Ye,S),K&&(J.start=ve+W*j)):yt>D?Qe<D&&(j=ue(J,Ue,$e,He,Ye,D),K&&(J.start=ve+W*j)):_i(J,Ue,$e,Le),Qe<S&&yt>=S&&(j=ue(J,Ue,$e,He,Ye,S),at=!0),Qe>D&&yt<=D&&(j=ue(J,Ue,$e,He,Ye,D),at=!0),!Z&&at&&(K&&(J.end=ve+W*j),b.push(J),J=ot(B)),K&&(ve+=W)}var xt=B.length-3;Ue=B[xt],$e=B[xt+1],Le=B[xt+2],(yt=L===0?Ue:$e)>=S&&yt<=D&&_i(J,Ue,$e,Le),xt=J.length-3,Z&&xt>=3&&(J[xt]!==J[0]||J[xt+1]!==J[1])&&_i(J,J[0],J[1],J[2]),J.length&&b.push(J)}function ot(B){var b=[];return b.size=B.size,b.start=B.start,b.end=B.end,b}function it(B,b,S,D,L,Z){for(var K=0;K<B.length;K++)Ie(B[K],b,S,D,L,Z,!1)}function _i(B,b,S,D){B.push(b),B.push(S),B.push(D)}function Kr(B,b,S,D,L,Z){var K=(Z-b)/(D-b);return B.push(Z),B.push(S+(L-S)*K),B.push(1),K}function et(B,b,S,D,L,Z){var K=(Z-S)/(L-S);return B.push(b+(D-b)*K),B.push(Z),B.push(1),K}function Mr(B,b){for(var S=[],D=0;D<B.length;D++){var L,Z=B[D],K=Z.type;if(K==="Point"||K==="MultiPoint"||K==="LineString")L=ci(Z.geometry,b);else if(K==="MultiLineString"||K==="Polygon"){L=[];for(var W=0;W<Z.geometry.length;W++)L.push(ci(Z.geometry[W],b))}else if(K==="MultiPolygon")for(L=[],W=0;W<Z.geometry.length;W++){for(var j=[],J=0;J<Z.geometry[W].length;J++)j.push(ci(Z.geometry[W][J],b));L.push(j)}S.push(kr(Z.id,K,L,Z.tags))}return S}function ci(B,b){var S=[];S.size=B.size,B.start!==void 0&&(S.start=B.start,S.end=B.end);for(var D=0;D<B.length;D+=3)S.push(B[D]+b,B[D+1],B[D+2]);return S}function Nn(B,b){if(B.transformed)return B;var S,D,L,Z=1<<B.z,K=B.x,W=B.y;for(S=0;S<B.features.length;S++){var j=B.features[S],J=j.geometry,ue=j.type;if(j.geometry=[],ue===1)for(D=0;D<J.length;D+=2)j.geometry.push(ti(J[D],J[D+1],b,Z,K,W));else for(D=0;D<J.length;D++){var ve=[];for(L=0;L<J[D].length;L+=2)ve.push(ti(J[D][L],J[D][L+1],b,Z,K,W));j.geometry.push(ve)}}return B.transformed=!0,B}function ti(B,b,S,D,L,Z){return[Math.round(S*(B*D-L)),Math.round(S*(b*D-Z))]}function Ii(B,b,S,D,L){for(var Z=b===L.maxZoom?0:L.tolerance/((1<<b)*L.extent),K={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:S,y:D,z:b,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},W=0;W<B.length;W++){K.numFeatures++,zt(K,B[W],Z,L);var j=B[W].minX,J=B[W].minY,ue=B[W].maxX,ve=B[W].maxY;j<K.minX&&(K.minX=j),J<K.minY&&(K.minY=J),ue>K.maxX&&(K.maxX=ue),ve>K.maxY&&(K.maxY=ve)}return K}function zt(B,b,S,D){var L=b.geometry,Z=b.type,K=[];if(Z==="Point"||Z==="MultiPoint")for(var W=0;W<L.length;W+=3)K.push(L[W]),K.push(L[W+1]),B.numPoints++,B.numSimplified++;else if(Z==="LineString")$n(K,L,B,S,!1,!1);else if(Z==="MultiLineString"||Z==="Polygon")for(W=0;W<L.length;W++)$n(K,L[W],B,S,Z==="Polygon",W===0);else if(Z==="MultiPolygon")for(var j=0;j<L.length;j++){var J=L[j];for(W=0;W<J.length;W++)$n(K,J[W],B,S,!0,W===0)}if(K.length){var ue=b.tags||null;if(Z==="LineString"&&D.lineMetrics){for(var ve in ue={},b.tags)ue[ve]=b.tags[ve];ue.mapbox_clip_start=L.start/L.size,ue.mapbox_clip_end=L.end/L.size}var ce={geometry:K,type:Z==="Polygon"||Z==="MultiPolygon"?3:Z==="LineString"||Z==="MultiLineString"?2:1,tags:ue};b.id!==null&&(ce.id=b.id),B.features.push(ce)}}function $n(B,b,S,D,L,Z){var K=D*D;if(D>0&&b.size<(L?K:D))S.numPoints+=b.length/3;else{for(var W=[],j=0;j<b.length;j+=3)(D===0||b[j+2]>K)&&(S.numSimplified++,W.push(b[j]),W.push(b[j+1])),S.numPoints++;L&&function(J,ue){for(var ve=0,ce=0,Ue=J.length,$e=Ue-2;ce<Ue;$e=ce,ce+=2)ve+=(J[ce]-J[$e])*(J[ce+1]+J[$e+1]);if(ve>0===ue)for(ce=0,Ue=J.length;ce<Ue/2;ce+=2){var Le=J[ce],He=J[ce+1];J[ce]=J[Ue-2-ce],J[ce+1]=J[Ue-1-ce],J[Ue-2-ce]=Le,J[Ue-1-ce]=He}}(W,Z),B.push(W)}}function _r(B,b){var S=(b=this.options=function(L,Z){for(var K in Z)L[K]=Z[K];return L}(Object.create(this.options),b)).debug;if(S&&console.time("preprocess data"),b.maxZoom<0||b.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(b.promoteId&&b.generateId)throw new Error("promoteId and generateId cannot be used together.");var D=function(L,Z){var K=[];if(L.type==="FeatureCollection")for(var W=0;W<L.features.length;W++)ke(K,L.features[W],Z,W);else ke(K,L.type==="Feature"?L:{geometry:L},Z);return K}(B,b);this.tiles={},this.tileCoords=[],S&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",b.indexMaxZoom,b.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),D=function(L,Z){var K=Z.buffer/Z.extent,W=L,j=Ui(L,1,-1-K,K,0,-1,2,Z),J=Ui(L,1,1-K,2+K,0,-1,2,Z);return(j||J)&&(W=Ui(L,1,-K,1+K,0,-1,2,Z)||[],j&&(W=Mr(j,1).concat(W)),J&&(W=W.concat(Mr(J,-1)))),W}(D,b),D.length&&this.splitTile(D,0,0,0),S&&(D.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function dn(B,b,S){return 32*((1<<B)*S+b)+B}function fn(B,b){const S=B.tileID.canonical;if(!this._geoJSONIndex)return b(null,null);const D=this._geoJSONIndex.getTile(S.z,S.x,S.y);if(!D)return b(null,null);const L=new Qt(D.features);let Z=tt.exports(L);Z.byteOffset===0&&Z.byteLength===Z.buffer.byteLength||(Z=new Uint8Array(Z)),b(null,{vectorTile:L,rawData:Z.buffer})}_r.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},_r.prototype.splitTile=function(B,b,S,D,L,Z,K){for(var W=[B,b,S,D],j=this.options,J=j.debug;W.length;){D=W.pop(),S=W.pop(),b=W.pop(),B=W.pop();var ue=1<<b,ve=dn(b,S,D),ce=this.tiles[ve];if(!ce&&(J>1&&console.time("creation"),ce=this.tiles[ve]=Ii(B,b,S,D,j),this.tileCoords.push({z:b,x:S,y:D}),J)){J>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",b,S,D,ce.numFeatures,ce.numPoints,ce.numSimplified),console.timeEnd("creation"));var Ue="z"+b;this.stats[Ue]=(this.stats[Ue]||0)+1,this.total++}if(ce.source=B,L){if(b===j.maxZoom||b===L)continue;var $e=1<<L-b;if(S!==Math.floor(Z/$e)||D!==Math.floor(K/$e))continue}else if(b===j.indexMaxZoom||ce.numPoints<=j.indexMaxPoints)continue;if(ce.source=null,B.length!==0){J>1&&console.time("clipping");var Le,He,Ye,yt,Qe,at,xt=.5*j.buffer/j.extent,Bt=.5-xt,ui=.5+xt,Nt=1+xt;Le=He=Ye=yt=null,Qe=Ui(B,ue,S-xt,S+ui,0,ce.minX,ce.maxX,j),at=Ui(B,ue,S+Bt,S+Nt,0,ce.minX,ce.maxX,j),B=null,Qe&&(Le=Ui(Qe,ue,D-xt,D+ui,1,ce.minY,ce.maxY,j),He=Ui(Qe,ue,D+Bt,D+Nt,1,ce.minY,ce.maxY,j),Qe=null),at&&(Ye=Ui(at,ue,D-xt,D+ui,1,ce.minY,ce.maxY,j),yt=Ui(at,ue,D+Bt,D+Nt,1,ce.minY,ce.maxY,j),at=null),J>1&&console.timeEnd("clipping"),W.push(Le||[],b+1,2*S,2*D),W.push(He||[],b+1,2*S,2*D+1),W.push(Ye||[],b+1,2*S+1,2*D),W.push(yt||[],b+1,2*S+1,2*D+1)}}},_r.prototype.getTile=function(B,b,S){var D=this.options,L=D.extent,Z=D.debug;if(B<0||B>24)return null;var K=1<<B,W=dn(B,b=(b%K+K)%K,S);if(this.tiles[W])return Nn(this.tiles[W],L);Z>1&&console.log("drilling down to z%d-%d-%d",B,b,S);for(var j,J=B,ue=b,ve=S;!j&&J>0;)J--,ue=Math.floor(ue/2),ve=Math.floor(ve/2),j=this.tiles[dn(J,ue,ve)];return j&&j.source?(Z>1&&console.log("found parent tile z%d-%d-%d",J,ue,ve),Z>1&&console.time("drilling down"),this.splitTile(j.source,J,ue,ve,B,b,S),Z>1&&console.timeEnd("drilling down"),this.tiles[W]?Nn(this.tiles[W],L):null):null};class qn extends be{constructor(b,S,D,L){super(b,S,D,fn),L&&(this.loadGeoJSON=L)}loadData(b,S){var D;(D=this._pendingRequest)===null||D===void 0||D.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const L=!!(b&&b.request&&b.request.collectResourceTiming)&&new a.RequestPerformance(b.request);this._pendingCallback=S,this._pendingRequest=this.loadGeoJSON(b,(Z,K)=>{if(delete this._pendingCallback,delete this._pendingRequest,Z||!K)return S(Z);if(typeof K!="object")return S(new Error(`Input data given to '${b.source}' is not a valid GeoJSON object.`));{We(K,!0);try{if(b.filter){const j=a.createExpression(b.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(j.result==="error")throw new Error(j.value.map(ue=>`${ue.key}: ${ue.message}`).join(", "));K={type:"FeatureCollection",features:K.features.filter(ue=>j.value.evaluate({zoom:0},ue))}}this._geoJSONIndex=b.cluster?new ds(function({superclusterOptions:j,clusterProperties:J}){if(!J||!j)return j;const ue={},ve={},ce={accumulated:null,zoom:0},Ue={properties:null},$e=Object.keys(J);for(const Le of $e){const[He,Ye]=J[Le],yt=a.createExpression(Ye),Qe=a.createExpression(typeof He=="string"?[He,["accumulated"],["get",Le]]:He);ue[Le]=yt.value,ve[Le]=Qe.value}return j.map=Le=>{Ue.properties=Le;const He={};for(const Ye of $e)He[Ye]=ue[Ye].evaluate(ce,Ue);return He},j.reduce=(Le,He)=>{Ue.properties=He;for(const Ye of $e)ce.accumulated=Le[Ye],Le[Ye]=ve[Ye].evaluate(ce,Ue)},j}(b)).load(K.features):function(j,J){return new _r(j,J)}(K,b.geojsonVtOptions)}catch(j){return S(j)}this.loaded={};const W={};if(L){const j=L.finish();j&&(W.resourceTiming={},W.resourceTiming[b.source]=JSON.parse(JSON.stringify(j)))}S(null,W)}})}reloadTile(b,S){const D=this.loaded;return D&&D[b.uid]?super.reloadTile(b,S):this.loadTile(b,S)}loadGeoJSON(b,S){if(b.request)return a.getJSON(b.request,S);if(typeof b.data=="string")try{S(null,JSON.parse(b.data))}catch{S(new Error(`Input data given to '${b.source}' is not a valid GeoJSON object.`))}else S(new Error(`Input data given to '${b.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(b,S){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),S()}getClusterExpansionZoom(b,S){try{S(null,this._geoJSONIndex.getClusterExpansionZoom(b.clusterId))}catch(D){S(D)}}getClusterChildren(b,S){try{S(null,this._geoJSONIndex.getChildren(b.clusterId))}catch(D){S(D)}}getClusterLeaves(b,S){try{S(null,this._geoJSONIndex.getLeaves(b.clusterId,b.limit,b.offset))}catch(D){S(D)}}}class mn{constructor(b){this.self=b,this.actor=new a.Actor(b,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:be,geojson:qn},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(S,D)=>{if(this.workerSourceTypes[S])throw new Error(`Worker source with name "${S}" already registered.`);this.workerSourceTypes[S]=D},this.self.registerRTLTextPlugin=S=>{if(a.plugin.isParsed())throw new Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=S.applyArabicShaping,a.plugin.processBidirectionalText=S.processBidirectionalText,a.plugin.processStyledBidirectionalText=S.processStyledBidirectionalText}}setReferrer(b,S){this.referrer=S}setImages(b,S,D){this.availableImages[b]=S;for(const L in this.workerSources[b]){const Z=this.workerSources[b][L];for(const K in Z)Z[K].availableImages=S}D()}setLayers(b,S,D){this.getLayerIndex(b).replace(S),D()}updateLayers(b,S,D){this.getLayerIndex(b).update(S.layers,S.removedIds),D()}loadTile(b,S,D){this.getWorkerSource(b,S.type,S.source).loadTile(S,D)}loadDEMTile(b,S,D){this.getDEMWorkerSource(b,S.source).loadTile(S,D)}reloadTile(b,S,D){this.getWorkerSource(b,S.type,S.source).reloadTile(S,D)}abortTile(b,S,D){this.getWorkerSource(b,S.type,S.source).abortTile(S,D)}removeTile(b,S,D){this.getWorkerSource(b,S.type,S.source).removeTile(S,D)}removeDEMTile(b,S){this.getDEMWorkerSource(b,S.source).removeTile(S)}removeSource(b,S,D){if(!this.workerSources[b]||!this.workerSources[b][S.type]||!this.workerSources[b][S.type][S.source])return;const L=this.workerSources[b][S.type][S.source];delete this.workerSources[b][S.type][S.source],L.removeSource!==void 0?L.removeSource(S,D):D()}loadWorkerSource(b,S,D){try{this.self.importScripts(S.url),D()}catch(L){D(L.toString())}}syncRTLPluginState(b,S,D){try{a.plugin.setState(S);const L=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&L!=null){this.self.importScripts(L);const Z=a.plugin.isParsed();D(Z?void 0:new Error(`RTL Text Plugin failed to import scripts from ${L}`),Z)}}catch(L){D(L.toString())}}getAvailableImages(b){let S=this.availableImages[b];return S||(S=[]),S}getLayerIndex(b){let S=this.layerIndexes[b];return S||(S=this.layerIndexes[b]=new me),S}getWorkerSource(b,S,D){if(this.workerSources[b]||(this.workerSources[b]={}),this.workerSources[b][S]||(this.workerSources[b][S]={}),!this.workerSources[b][S][D]){const L={send:(Z,K,W)=>{this.actor.send(Z,K,W,b)}};this.workerSources[b][S][D]=new this.workerSourceTypes[S](L,this.getLayerIndex(b),this.getAvailableImages(b))}return this.workerSources[b][S][D]}getDEMWorkerSource(b,S){return this.demWorkerSources[b]||(this.demWorkerSources[b]={}),this.demWorkerSources[b][S]||(this.demWorkerSources[b][S]=new Ne),this.demWorkerSources[b][S]}enforceCacheSizeLimit(b,S){a.enforceCacheSizeLimit(S)}}return a.isWorker()&&(self.worker=new mn(self)),mn}),G(["./shared"],function(a){var _e=le;function le(l){return!function(t){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var o,u,p=new Blob([""],{type:"text/javascript"}),f=URL.createObjectURL(p);try{u=new Worker(f),o=!0}catch{o=!1}return u&&u.terminate(),URL.revokeObjectURL(f),o}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var o=document.createElement("canvas");o.width=o.height=1;var u=o.getContext("2d");if(!u)return!1;var p=u.getImageData(0,0,1,1);return p&&p.width===o.width}()?(me[n=t&&t.failIfMajorPerformanceCaveat]===void 0&&(me[n]=function(o){var u,p=function(f){var _=document.createElement("canvas"),y=Object.create(le.webGLContextAttributes);return y.failIfMajorPerformanceCaveat=f,_.getContext("webgl",y)||_.getContext("experimental-webgl",y)}(o);if(!p)return!1;try{u=p.createShader(p.VERTEX_SHADER)}catch{return!1}return!(!u||p.isContextLost())&&(p.shaderSource(u,"void main() {}"),p.compileShader(u),p.getShaderParameter(u,p.COMPILE_STATUS)===!0)}(n)),me[n]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var n}(l)}var me={};function pe(l,t){if(Array.isArray(l)){if(!Array.isArray(t)||l.length!==t.length)return!1;for(let n=0;n<l.length;n++)if(!pe(l[n],t[n]))return!1;return!0}if(typeof l=="object"&&l!==null&&t!==null){if(typeof t!="object"||Object.keys(l).length!==Object.keys(t).length)return!1;for(const n in l)if(!pe(l[n],t[n]))return!1;return!0}return l===t}le.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class Y{static testProp(t){if(!Y.docStyle)return t[0];for(let n=0;n<t.length;n++)if(t[n]in Y.docStyle)return t[n];return t[0]}static create(t,n,o){const u=window.document.createElement(t);return n!==void 0&&(u.className=n),o&&o.appendChild(u),u}static createNS(t,n){return window.document.createElementNS(t,n)}static disableDrag(){Y.docStyle&&Y.selectProp&&(Y.userSelect=Y.docStyle[Y.selectProp],Y.docStyle[Y.selectProp]="none")}static enableDrag(){Y.docStyle&&Y.selectProp&&(Y.docStyle[Y.selectProp]=Y.userSelect)}static setTransform(t,n){t.style[Y.transformProp]=n}static addEventListener(t,n,o,u={}){t.addEventListener(n,o,"passive"in u?u:u.capture)}static removeEventListener(t,n,o,u={}){t.removeEventListener(n,o,"passive"in u?u:u.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",Y.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Y.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",Y.suppressClickInternal,!0)},0)}static mousePos(t,n){const o=t.getBoundingClientRect();return new a.pointGeometry(n.clientX-o.left-t.clientLeft,n.clientY-o.top-t.clientTop)}static touchPos(t,n){const o=t.getBoundingClientRect(),u=[];for(let p=0;p<n.length;p++)u.push(new a.pointGeometry(n[p].clientX-o.left-t.clientLeft,n[p].clientY-o.top-t.clientTop));return u}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}Y.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Y.selectProp=Y.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Y.transformProp=Y.testProp(["transform","WebkitTransform"]);class Ee{constructor(t){this._transformRequestFn=t}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}normalizeSpriteURL(t,n,o){const u=function(p){const f=p.match(qe);if(!f)throw new Error(`Unable to parse URL "${p}"`);return{protocol:f[1],authority:f[2],path:f[3]||"/",params:f[4]?f[4].split("&"):[]}}(t);return u.path+=`${n}${o}`,function(p){const f=p.params.length?`?${p.params.join("&")}`:"";return`${p.protocol}://${p.authority}${p.path}${f}`}(u)}setTransformRequest(t){this._transformRequestFn=t}}const qe=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class be{constructor(t,n,o,u){this.context=t,this.format=o,this.texture=t.gl.createTexture(),this.update(n,u)}update(t,n,o){const{width:u,height:p}=t,f=!(this.size&&this.size[0]===u&&this.size[1]===p||o),{context:_}=this,{gl:y}=_;if(this.useMipmap=Boolean(n&&n.useMipmap),y.bindTexture(y.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!n||n.premultiply!==!1)),f)this.size=[u,p],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||a.isImageBitmap(t)?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,t):y.texImage2D(y.TEXTURE_2D,0,this.format,u,p,0,this.format,y.UNSIGNED_BYTE,t.data);else{const{x:v,y:T}=o||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||a.isImageBitmap(t)?y.texSubImage2D(y.TEXTURE_2D,0,v,T,y.RGBA,y.UNSIGNED_BYTE,t):y.texSubImage2D(y.TEXTURE_2D,0,v,T,u,p,y.RGBA,y.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&y.generateMipmap(y.TEXTURE_2D)}bind(t,n,o){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),o!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=p.LINEAR),t!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,t),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,o||t),this.filter=t),n!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,n),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function Ne(l){const{userImage:t}=l;return!!(t&&t.render&&t.render())&&(l.data.replace(new Uint8Array(t.data.buffer)),!0)}class We extends a.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:n,callback:o}of this.requestors)this._notify(n,o);this.requestors=[]}}getImage(t){return this.images[t]}addImage(t,n){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,n)&&(this.images[t]=n)}_validate(t,n){let o=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new a.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),o=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new a.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),o=!1),this._validateContent(n.content,n)||(this.fire(new a.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),o=!1),o}_validateStretch(t,n){if(!t)return!0;let o=0;for(const u of t){if(u[0]<o||u[1]<u[0]||n<u[1])return!1;o=u[1]}return!0}_validateContent(t,n){return!(t&&(t.length!==4||t[0]<0||n.data.width<t[0]||t[1]<0||n.data.height<t[1]||t[2]<0||n.data.width<t[2]||t[3]<0||n.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,n){const o=this.images[t];if(o.data.width!==n.data.width||o.data.height!==n.data.height)throw new Error(`size mismatch between old image (${o.data.width}x${o.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=o.version+1,this.images[t]=n,this.updatedImages[t]=!0}removeImage(t){const n=this.images[t];delete this.images[t],delete this.patterns[t],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,n){let o=!0;if(!this.isLoaded())for(const u of t)this.images[u]||(o=!1);this.isLoaded()||o?this._notify(t,n):this.requestors.push({ids:t,callback:n})}_notify(t,n){const o={};for(const u of t){this.images[u]||this.fire(new a.Event("styleimagemissing",{id:u}));const p=this.images[u];p?o[u]={data:p.data.clone(),pixelRatio:p.pixelRatio,sdf:p.sdf,version:p.version,stretchX:p.stretchX,stretchY:p.stretchY,content:p.content,hasRenderCallback:Boolean(p.userImage&&p.userImage.render)}:a.warnOnce(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}n(null,o)}getPixelSize(){const{width:t,height:n}=this.atlasImage;return{width:t,height:n}}getPattern(t){const n=this.patterns[t],o=this.getImage(t);if(!o)return null;if(n&&n.position.version===o.version)return n.position;if(n)n.position.version=o.version;else{const u={w:o.data.width+2,h:o.data.height+2,x:0,y:0},p=new a.ImagePosition(u,o);this.patterns[t]={bin:u,position:p}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const n=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new be(t,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const p in this.patterns)t.push(this.patterns[p].bin);const{w:n,h:o}=a.potpack(t),u=this.atlasImage;u.resize({width:n||1,height:o||1});for(const p in this.patterns){const{bin:f}=this.patterns[p],_=f.x+1,y=f.y+1,v=this.images[p].data,T=v.width,I=v.height;a.RGBAImage.copy(v,u,{x:0,y:0},{x:_,y},{width:T,height:I}),a.RGBAImage.copy(v,u,{x:0,y:I-1},{x:_,y:y-1},{width:T,height:1}),a.RGBAImage.copy(v,u,{x:0,y:0},{x:_,y:y+I},{width:T,height:1}),a.RGBAImage.copy(v,u,{x:T-1,y:0},{x:_-1,y},{width:1,height:I}),a.RGBAImage.copy(v,u,{x:0,y:0},{x:_+T,y},{width:1,height:I})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const n of t){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const o=this.images[n];o||a.warnOnce(`Image with ID: "${n}" was not found`),Ne(o)&&this.updateImage(n,o)}}}const Tt=1e20;function ht(l,t,n,o,u,p,f,_,y){for(let v=t;v<t+o;v++)At(l,n*p+v,p,u,f,_,y);for(let v=n;v<n+u;v++)At(l,v*p+t,1,o,f,_,y)}function At(l,t,n,o,u,p,f){p[0]=0,f[0]=-Tt,f[1]=Tt,u[0]=l[t];for(let _=1,y=0,v=0;_<o;_++){u[_]=l[t+_*n];const T=_*_;do{const I=p[y];v=(u[_]-u[I]+T-I*I)/(_-I)/2}while(v<=f[y]&&--y>-1);y++,p[y]=_,f[y]=v,f[y+1]=Tt}for(let _=0,y=0;_<o;_++){for(;f[y+1]<_;)y++;const v=p[y],T=_-v;l[t+_*n]=u[v]+T*T}}class st{constructor(t,n){this.requestManager=t,this.localIdeographFontFamily=n,this.entries={}}setURL(t){this.url=t}getGlyphs(t,n){const o=[];for(const u in t)for(const p of t[u])o.push({stack:u,id:p});a.asyncAll(o,({stack:u,id:p},f)=>{let _=this.entries[u];_||(_=this.entries[u]={glyphs:{},requests:{},ranges:{}});let y=_.glyphs[p];if(y!==void 0)return void f(null,{stack:u,id:p,glyph:y});if(y=this._tinySDF(_,u,p),y)return _.glyphs[p]=y,void f(null,{stack:u,id:p,glyph:y});const v=Math.floor(p/256);if(256*v>65535)return void f(new Error("glyphs > 65535 not supported"));if(_.ranges[v])return void f(null,{stack:u,id:p,glyph:y});let T=_.requests[v];T||(T=_.requests[v]=[],st.loadGlyphRange(u,v,this.url,this.requestManager,(I,M)=>{if(M){for(const U in M)this._doesCharSupportLocalGlyph(+U)||(_.glyphs[+U]=M[+U]);_.ranges[v]=!0}for(const U of T)U(I,M);delete _.requests[v]})),T.push((I,M)=>{I?f(I):M&&f(null,{stack:u,id:p,glyph:M[p]||null})})},(u,p)=>{if(u)n(u);else if(p){const f={};for(const{stack:_,id:y,glyph:v}of p)(f[_]||(f[_]={}))[y]=v&&{id:v.id,bitmap:v.bitmap.clone(),metrics:v.metrics};n(null,f)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(a.unicodeBlockLookup["CJK Unified Ideographs"](t)||a.unicodeBlockLookup["Hangul Syllables"](t)||a.unicodeBlockLookup.Hiragana(t)||a.unicodeBlockLookup.Katakana(t))}_tinySDF(t,n,o){const u=this.localIdeographFontFamily;if(!u||!this._doesCharSupportLocalGlyph(o))return;let p=t.tinySDF;if(!p){let _="400";/bold/i.test(n)?_="900":/medium/i.test(n)?_="500":/light/i.test(n)&&(_="200"),p=t.tinySDF=new st.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:u,fontWeight:_})}const f=p.draw(String.fromCharCode(o));return{id:o,bitmap:new a.AlphaImage({width:f.width||30,height:f.height||30},f.data),metrics:{width:f.glyphWidth||24,height:f.glyphHeight||24,left:f.glyphLeft||0,top:f.glyphTop-27||-8,advance:f.glyphAdvance||24}}}}st.loadGlyphRange=function(l,t,n,o,u){const p=256*t,f=p+255,_=o.transformRequest(n.replace("{fontstack}",l).replace("{range}",`${p}-${f}`),a.ResourceType.Glyphs);a.getArrayBuffer(_,(y,v)=>{if(y)u(y);else if(v){const T={};for(const I of a.parseGlyphPbf(v))T[I.id]=I;u(null,T)}})},st.TinySDF=class{constructor({fontSize:l=24,buffer:t=3,radius:n=8,cutoff:o=.25,fontFamily:u="sans-serif",fontWeight:p="normal",fontStyle:f="normal"}={}){this.buffer=t,this.cutoff=o,this.radius=n;const _=this.size=l+4*t,y=this._createCanvas(_),v=this.ctx=y.getContext("2d",{willReadFrequently:!0});v.font=`${f} ${p} ${l}px ${u}`,v.textBaseline="alphabetic",v.textAlign="left",v.fillStyle="black",this.gridOuter=new Float64Array(_*_),this.gridInner=new Float64Array(_*_),this.f=new Float64Array(_),this.z=new Float64Array(_+1),this.v=new Uint16Array(_)}_createCanvas(l){const t=document.createElement("canvas");return t.width=t.height=l,t}draw(l){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:o,actualBoundingBoxLeft:u,actualBoundingBoxRight:p}=this.ctx.measureText(l),f=Math.ceil(n),_=Math.min(this.size-this.buffer,Math.ceil(p-u)),y=Math.min(this.size-this.buffer,f+Math.ceil(o)),v=_+2*this.buffer,T=y+2*this.buffer,I=Math.max(v*T,0),M=new Uint8ClampedArray(I),U={data:M,width:v,height:T,glyphWidth:_,glyphHeight:y,glyphTop:f,glyphLeft:0,glyphAdvance:t};if(_===0||y===0)return U;const{ctx:R,buffer:O,gridInner:H,gridOuter:Q}=this;R.clearRect(O,O,_,y),R.fillText(l,O,O+f);const re=R.getImageData(O,O,_,y);Q.fill(Tt,0,I),H.fill(0,0,I);for(let V=0;V<y;V++)for(let oe=0;oe<_;oe++){const ne=re.data[4*(V*_+oe)+3]/255;if(ne===0)continue;const de=(V+O)*v+oe+O;if(ne===1)Q[de]=0,H[de]=Tt;else{const fe=.5-ne;Q[de]=fe>0?fe*fe:0,H[de]=fe<0?fe*fe:0}}ht(Q,0,0,v,T,v,this.f,this.v,this.z),ht(H,O,O,_,y,v,this.f,this.v,this.z);for(let V=0;V<I;V++){const oe=Math.sqrt(Q[V])-Math.sqrt(H[V]);M[V]=Math.round(255-255*(oe/this.radius+this.cutoff))}return U}};const Qt=new a.Properties({anchor:new a.DataConstantProperty(a.spec.light.anchor),position:new class{constructor(){this.specification=a.spec.light.position}possiblyEvaluate(l,t){return a.sphericalToCartesian(l.expression.evaluate(t))}interpolate(l,t,n){return{x:a.number(l.x,t.x,n),y:a.number(l.y,t.y,n),z:a.number(l.z,t.z,n)}}},color:new a.DataConstantProperty(a.spec.light.color),intensity:new a.DataConstantProperty(a.spec.light.intensity)}),tt="-transition";class Ht extends a.Evented{constructor(t){super(),this._transitionable=new a.Transitionable(Qt),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n={}){if(!this._validate(a.validateLight,t,n))for(const o in t){const u=t[o];o.endsWith(tt)?this._transitionable.setTransition(o.slice(0,-tt.length),u):this._transitionable.setValue(o,u)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,o){return(!o||o.validate!==!1)&&a.emitValidationErrors(this,t.call(a.validateStyle,a.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}class Xt{constructor(t,n){this.width=t,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,n){const o=t.join(",")+String(n);return this.dashEntry[o]||(this.dashEntry[o]=this.addDash(t,n)),this.dashEntry[o]}getDashRanges(t,n,o){const u=[];let p=t.length%2==1?-t[t.length-1]*o:0,f=t[0]*o,_=!0;u.push({left:p,right:f,isDash:_,zeroLength:t[0]===0});let y=t[0];for(let v=1;v<t.length;v++){_=!_;const T=t[v];p=y*o,y+=T,f=y*o,u.push({left:p,right:f,isDash:_,zeroLength:T===0})}return u}addRoundDash(t,n,o){const u=n/2;for(let p=-o;p<=o;p++){const f=this.width*(this.nextRow+o+p);let _=0,y=t[_];for(let v=0;v<this.width;v++){v/y.right>1&&(y=t[++_]);const T=Math.abs(v-y.left),I=Math.abs(v-y.right),M=Math.min(T,I);let U;const R=p/o*(u+1);if(y.isDash){const O=u-Math.abs(R);U=Math.sqrt(M*M+O*O)}else U=u-Math.sqrt(M*M+R*R);this.data[f+v]=Math.max(0,Math.min(255,U+128))}}}addRegularDash(t){for(let _=t.length-1;_>=0;--_){const y=t[_],v=t[_+1];y.zeroLength?t.splice(_,1):v&&v.isDash===y.isDash&&(v.left=y.left,t.splice(_,1))}const n=t[0],o=t[t.length-1];n.isDash===o.isDash&&(n.left=o.left-this.width,o.right=n.right+this.width);const u=this.width*this.nextRow;let p=0,f=t[p];for(let _=0;_<this.width;_++){_/f.right>1&&(f=t[++p]);const y=Math.abs(_-f.left),v=Math.abs(_-f.right),T=Math.min(y,v);this.data[u+_]=Math.max(0,Math.min(255,(f.isDash?T:-T)+128))}}addDash(t,n){const o=n?7:0,u=2*o+1;if(this.nextRow+u>this.height)return a.warnOnce("LineAtlas out of space"),null;let p=0;for(let _=0;_<t.length;_++)p+=t[_];if(p!==0){const _=this.width/p,y=this.getDashRanges(t,this.width,_);n?this.addRoundDash(y,_,o):this.addRegularDash(y)}const f={y:(this.nextRow+o+.5)/this.height,height:2*o/this.height,width:p};return this.nextRow+=u,this.dirty=!0,f}bind(t){const n=t.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}class Kt{constructor(t,n){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a.uniqueId();const o=this.workerPool.acquire(this.id);for(let u=0;u<o.length;u++){const p=new Kt.Actor(o[u],n,this.id);p.name=`Worker ${u}`,this.actors.push(p)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,n,o){a.asyncAll(this.actors,(u,p)=>{u.send(t,n,p)},o=o||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Mi(l,t,n){const o=function(u,p){if(u)return n(u);if(p){const f=a.pick(a.extend(p,l),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);p.vector_layers&&(f.vectorLayers=p.vector_layers,f.vectorLayerIds=f.vectorLayers.map(_=>_.id)),n(null,f)}};return l.url?a.getJSON(t.transformRequest(l.url,a.ResourceType.Source),o):a.exported.frame(()=>o(null,l))}Kt.Actor=a.Actor;class wt{constructor(t,n,o){this.bounds=a.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=o||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),o=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*n),u=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*n),p=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*n),f=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*n);return t.x>=o&&t.x<p&&t.y>=u&&t.y<f}}class Si extends a.Evented{constructor(t,n,o,u){if(super(),this.id=t,this.dispatcher=o,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(n,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u)}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Mi(this._options,this.map._requestManager,(t,n)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t?this.fire(new a.ErrorEvent(t)):n&&(a.extend(this,n),n.bounds&&(this.tileBounds=new wt(n.bounds,this.minzoom,this.maxzoom)),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}loadTile(t,n){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(o,a.ResourceType.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function p(f,_){return delete t.request,t.aborted?n(null):f&&f.status!==404?n(f):(_&&_.resourceTiming&&(t.resourceTiming=_.resourceTiming),this.map._refreshExpiredTiles&&_&&t.setExpiryData(_),t.loadVectorData(_,this.map.painter),a.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}u.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=n:t.request=t.actor.send("reloadTile",u,p.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",u,p.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Yi extends a.Evented{constructor(t,n,o,u){super(),this.id=t,this.dispatcher=o,this.setEventedParent(u),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},n),a.extend(this,a.pick(n,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Mi(this._options,this.map._requestManager,(t,n)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new a.ErrorEvent(t)):n&&(a.extend(this,n),n.bounds&&(this.tileBounds=new wt(n.bounds,this.minzoom,this.maxzoom)),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,n){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=a.getImage(this.map._requestManager.transformRequest(o,a.ResourceType.Tile),(u,p,f)=>{if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(u)t.state="errored",n(u);else if(p){this.map._refreshExpiredTiles&&t.setExpiryData(f);const _=this.map.painter.context,y=_.gl;t.texture=this.map.painter.getTileTexture(p.width),t.texture?t.texture.update(p,{useMipmap:!0}):(t.texture=new be(_,p,y.RGBA,{useMipmap:!0}),t.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST),_.extTextureFilterAnisotropic&&y.texParameterf(y.TEXTURE_2D,_.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,_.extTextureFilterAnisotropicMax)),t.state="loaded",a.cacheEntryPossiblyAdded(this.dispatcher),n(null)}})}abortTile(t,n){t.request&&(t.request.cancel(),delete t.request),n()}unloadTile(t,n){t.texture&&this.map.painter.saveTileTexture(t.texture),n()}hasTransition(){return!1}}let $r;class Je extends Yi{constructor(t,n,o,u){super(t,n,o,u),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(t,n){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function u(p,f){p&&(t.state="errored",n(p)),f&&(t.dem=f,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",n(null))}t.request=a.getImage(this.map._requestManager.transformRequest(o,a.ResourceType.Tile),function(p,f){if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(p)t.state="errored",n(p);else if(f){this.map._refreshExpiredTiles&&t.setExpiryData(f),delete f.cacheControl,delete f.expires;const _=a.isImageBitmap(f)&&($r==null&&($r=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),$r)?f:a.exported.getImageData(f,1),y={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:_,encoding:this.encoding};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",y,u.bind(this)))}}.bind(this)),t.neighboringTiles=this._getNeighboringTiles(t.tileID)}_getNeighboringTiles(t){const n=t.canonical,o=Math.pow(2,n.z),u=(n.x-1+o)%o,p=n.x===0?t.wrap-1:t.wrap,f=(n.x+1+o)%o,_=n.x+1===o?t.wrap+1:t.wrap,y={};return y[new a.OverscaledTileID(t.overscaledZ,p,n.z,u,n.y).key]={backfilled:!1},y[new a.OverscaledTileID(t.overscaledZ,_,n.z,f,n.y).key]={backfilled:!1},n.y>0&&(y[new a.OverscaledTileID(t.overscaledZ,p,n.z,u,n.y-1).key]={backfilled:!1},y[new a.OverscaledTileID(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},y[new a.OverscaledTileID(t.overscaledZ,_,n.z,f,n.y-1).key]={backfilled:!1}),n.y+1<o&&(y[new a.OverscaledTileID(t.overscaledZ,p,n.z,u,n.y+1).key]={backfilled:!1},y[new a.OverscaledTileID(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},y[new a.OverscaledTileID(t.overscaledZ,_,n.z,f,n.y+1).key]={backfilled:!1}),y}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class Er extends a.Evented{constructor(t,n,o,u){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=o.getActor(),this.setEventedParent(u),this._data=n.data,this._options=a.extend({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const p=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*p,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*p,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:a.EXTENT,radius:(n.clusterRadius||50)*p,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData("content"),this}getClusterExpansionZoom(t,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},n),this}getClusterChildren(t,n){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},n),this}getClusterLeaves(t,n,o,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:n,offset:o},u),this}_updateWorkerData(t){const n=a.extend({},this.workerOptions),o=this._data;typeof o=="string"?(n.request=this.map._requestManager.transformRequest(a.exported.resolveURL(o),a.ResourceType.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(o),this._pendingLoads++,this.fire(new a.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,n,(u,p)=>{if(this._pendingLoads--,this._removed||p&&p.abandoned)return void this.fire(new a.Event("dataabort",{dataType:"source",sourceDataType:t}));let f=null;if(p&&p.resourceTiming&&p.resourceTiming[this.id]&&(f=p.resourceTiming[this.id].slice(0)),u)return void this.fire(new a.ErrorEvent(u));const _={dataType:"source",sourceDataType:t};this._collectResourceTiming&&f&&f.length>0&&a.extend(_,{resourceTiming:f}),this.fire(new a.Event("data",_))})}loaded(){return this._pendingLoads===0}loadTile(t,n){const o=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const u={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(o,u,(p,f)=>(delete t.request,t.unloadVectorData(),t.aborted?n(null):p?n(p):(t.loadVectorData(f,this.map.painter,o==="reloadTile"),n(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return a.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Sr=a.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class or extends a.Evented{constructor(t,n,o,u){super(),this.id=t,this.dispatcher=o,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(u),this.options=n}load(t,n){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,a.getImage(this.map._requestManager.transformRequest(this.url,a.ResourceType.Image),(o,u)=>{this._loaded=!0,o?this.fire(new a.ErrorEvent(o)):u&&(this.image=u,t&&(this.coordinates=t),n&&n(),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}setCoordinates(t){this.coordinates=t;const n=t.map(a.MercatorCoordinate.fromLngLat);this.tileID=function(u){let p=1/0,f=1/0,_=-1/0,y=-1/0;for(const M of u)p=Math.min(p,M.x),f=Math.min(f,M.y),_=Math.max(_,M.x),y=Math.max(y,M.y);const v=Math.max(_-p,y-f),T=Math.max(0,Math.floor(-Math.log(v)/Math.LN2)),I=Math.pow(2,T);return new a.CanonicalTileID(T,Math.floor((p+_)/2*I),Math.floor((f+y)/2*I))}(n),this.minzoom=this.maxzoom=this.tileID.z;const o=n.map(u=>this.tileID.getTilePoint(u)._round());return this._boundsArray=new a.RasterBoundsArray,this._boundsArray.emplaceBack(o[0].x,o[0].y,0,0),this._boundsArray.emplaceBack(o[1].x,o[1].y,a.EXTENT,0),this._boundsArray.emplaceBack(o[3].x,o[3].y,0,a.EXTENT),this._boundsArray.emplaceBack(o[2].x,o[2].y,a.EXTENT,a.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,n=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Sr.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new be(t,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));for(const o in this.tiles){const u=this.tiles[o];u.state!=="loaded"&&(u.state="loaded",u.texture=this.texture)}}loadTile(t,n){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},n(null)):(t.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class ar extends or{constructor(t,n,o,u){super(t,n,o,u),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const n of t.urls)this.urls.push(this.map._requestManager.transformRequest(n,a.ResourceType.Source).url);a.getVideo(this.urls,(n,o)=>{this._loaded=!0,n?this.fire(new a.ErrorEvent(n)):o&&(this.video=o,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,n=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Sr.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new be(t,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));for(const o in this.tiles){const u=this.tiles[o];u.state!=="loaded"&&(u.state="loaded",u.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class hn extends or{constructor(t,n,o,u){super(t,n,o,u),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(f=>typeof f!="number"))||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context,o=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,Sr.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new be(n,this.canvas,o.RGBA,{premultiply:!0});for(const u in this.tiles){const p=this.tiles[u];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Ln={vector:Si,raster:Yi,"raster-dem":Je,geojson:Er,video:ar,image:or,canvas:hn};function Bn(l,t){const n=a.create();return a.translate(n,n,[1,1,0]),a.scale(n,n,[.5*l.width,.5*l.height,1]),a.multiply(n,n,l.calculatePosMatrix(t.toUnwrapped()))}function Rn(l,t,n,o,u,p){const f=function(I,M,U){if(I)for(const R of I){const O=M[R];if(O&&O.source===U&&O.type==="fill-extrusion")return!0}else for(const R in M){const O=M[R];if(O.source===U&&O.type==="fill-extrusion")return!0}return!1}(u&&u.layers,t,l.id),_=p.maxPitchScaleFactor(),y=l.tilesIn(o,_,f);y.sort(mr);const v=[];for(const I of y)v.push({wrappedTileID:I.tileID.wrapped().key,queryResults:I.tile.queryRenderedFeatures(t,n,l._state,I.queryGeometry,I.cameraQueryGeometry,I.scale,u,p,_,Bn(l.transform,I.tileID))});const T=function(I){const M={},U={};for(const R of I){const O=R.queryResults,H=R.wrappedTileID,Q=U[H]=U[H]||{};for(const re in O){const V=O[re],oe=Q[re]=Q[re]||{},ne=M[re]=M[re]||[];for(const de of V)oe[de.featureIndex]||(oe[de.featureIndex]=!0,ne.push(de))}}return M}(v);for(const I in T)T[I].forEach(M=>{const U=M.feature,R=l.getFeatureState(U.layer["source-layer"],U.id);U.source=U.layer.source,U.layer["source-layer"]&&(U.sourceLayer=U.layer["source-layer"]),U.state=R});return T}function mr(l,t){const n=l.tileID,o=t.tileID;return n.overscaledZ-o.overscaledZ||n.canonical.y-o.canonical.y||n.wrap-o.wrap||n.canonical.x-o.canonical.x}class qr{constructor(t,n){this.tileID=t,this.uid=a.uniqueId(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const n=t+this.timeAdded;n<a.exported.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.textures.forEach(n=>t.saveTileTexture(n)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(t,n,o){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(u,p){const f={};if(!p)return f;for(const _ of u){const y=_.layerIds.map(v=>p.getLayer(v)).filter(Boolean);if(y.length!==0){_.layers=y,_.stateDependentLayerIds&&(_.stateDependentLayers=_.stateDependentLayerIds.map(v=>y.filter(T=>T.id===v)[0]));for(const v of y)f[v.id]=_}}return f}(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const p=this.buckets[u];if(p instanceof a.SymbolBucket){if(this.hasSymbolBuckets=!0,!o)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const p=this.buckets[u];if(p instanceof a.SymbolBucket&&p.hasRTLText){this.hasRTLText=!0,a.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const u in this.buckets){const p=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(u).queryRadius(p))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new a.CollisionBoxArray}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const o in this.buckets){const u=this.buckets[o];u.uploadPending()&&u.upload(t)}const n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new be(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new be(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,n,o,u,p,f,_,y,v,T){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:u,cameraQueryGeometry:p,scale:f,tileSize:this.tileSize,pixelPosMatrix:T,transform:y,params:_,queryPadding:this.queryPadding*v},t,n,o):{}}querySourceFeatures(t,n){const o=this.latestFeatureIndex;if(!o||!o.rawTileData)return;const u=o.loadVTLayers(),p=n?n.sourceLayer:"",f=u._geojsonTileLayer||u[p];if(!f)return;const _=a.createFilter(n&&n.filter),{z:y,x:v,y:T}=this.tileID.canonical,I={z:y,x:v,y:T};for(let M=0;M<f.length;M++){const U=f.feature(M);if(_.needGeometry){const H=a.toEvaluationFeature(U,!0);if(!_.filter(new a.EvaluationParameters(this.tileID.overscaledZ),H,this.tileID.canonical))continue}else if(!_.filter(new a.EvaluationParameters(this.tileID.overscaledZ),U))continue;const R=o.getId(U,p),O=new a.GeoJSONFeature(U,y,v,T,R);O.tile=I,t.push(O)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const o=a.parseCacheControl(t.cacheControl);o["max-age"]&&(this.expirationTime=Date.now()+1e3*o["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const o=Date.now();let u=!1;if(this.expirationTime>o)u=!1;else if(n)if(this.expirationTime<n)u=!0;else{const p=this.expirationTime-n;p?this.expirationTime=o+Math.max(p,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const o=this.latestFeatureIndex.loadVTLayers();for(const u in this.buckets){if(!n.style.hasLayer(u))continue;const p=this.buckets[u],f=p.layers[0].sourceLayer||"_geojsonTileLayer",_=o[f],y=t[f];if(!_||!y||Object.keys(y).length===0)continue;p.update(y,_,this.imageAtlas&&this.imageAtlas.patternPositions||{});const v=n&&n.style&&n.style.getLayer(u);v&&(this.queryPadding=Math.max(this.queryPadding,v.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<a.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=a.exported.now()+t}setDependencies(t,n){const o={};for(const u of n)o[u]=!0;this.dependencies[t]=o}hasDependency(t,n){for(const o of t){const u=this.dependencies[o];if(u){for(const p of n)if(u[p])return!0}}return!1}}class Gr{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,o){const u=t.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const p={value:n,timeout:void 0};if(o!==void 0&&(p.timeout=setTimeout(()=>{this.remove(t,p)},o)),this.data[u].push(p),this.order.push(u),this.order.length>this.max){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const o=t.wrapped().key,u=n===void 0?0:this.data[o].indexOf(n),p=this.data[o][u];return this.data[o].splice(u,1),p.timeout&&clearTimeout(p.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(p.value),this.order.splice(this.order.indexOf(o),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const o in this.data)for(const u of this.data[o])t(u.value)||n.push(u);for(const o of n)this.remove(o.value.tileID,o)}}class Zr{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,o){const u=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][u]=this.stateChanges[t][u]||{},a.extend(this.stateChanges[t][u],o),this.deletedStates[t]===null){this.deletedStates[t]={};for(const p in this.state[t])p!==u&&(this.deletedStates[t][p]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][u]===null){this.deletedStates[t][u]={};for(const p in this.state[t][u])o[p]||(this.deletedStates[t][u][p]=null)}else for(const p in o)this.deletedStates[t]&&this.deletedStates[t][u]&&this.deletedStates[t][u][p]===null&&delete this.deletedStates[t][u][p]}removeFeatureState(t,n,o){if(this.deletedStates[t]===null)return;const u=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},o&&n!==void 0)this.deletedStates[t][u]!==null&&(this.deletedStates[t][u]=this.deletedStates[t][u]||{},this.deletedStates[t][u][o]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][u])for(o in this.deletedStates[t][u]={},this.stateChanges[t][u])this.deletedStates[t][u][o]=null;else this.deletedStates[t][u]=null;else this.deletedStates[t]=null}getState(t,n){const o=String(n),u=a.extend({},(this.state[t]||{})[o],(this.stateChanges[t]||{})[o]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const p=this.deletedStates[t][n];if(p===null)return{};for(const f in p)delete u[f]}return u}initializeTileState(t,n){t.setFeatureState(this.state,n)}coalesceChanges(t,n){const o={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const p={};for(const f in this.stateChanges[u])this.state[u][f]||(this.state[u][f]={}),a.extend(this.state[u][f],this.stateChanges[u][f]),p[f]=this.state[u][f];o[u]=p}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const p={};if(this.deletedStates[u]===null)for(const f in this.state[u])p[f]={},this.state[u][f]={};else for(const f in this.deletedStates[u]){if(this.deletedStates[u][f]===null)this.state[u][f]={};else for(const _ of Object.keys(this.deletedStates[u][f]))delete this.state[u][f][_];p[f]=this.state[u][f]}o[u]=o[u]||{},a.extend(o[u],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(o).length!==0)for(const u in t)t[u].setFeatureState(o,n)}}class zi extends a.Evented{constructor(t,n,o){super(),this.id=t,this.dispatcher=o,this.on("data",u=>{u.dataType==="source"&&u.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&u.dataType==="source"&&u.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(u,p,f,_){const y=new Ln[p.type](u,p,f,_);if(y.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${y.id}`);return a.bindAll(["load","abort","unload","serialize","prepare"],y),y}(t,n,o,this),this._tiles={},this._cache=new Gr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Zr}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const n=this._tiles[t];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,n){return this._source.loadTile(t,n)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new a.Event("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const o=this._tiles[n];o.upload(t),o.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Fn).map(t=>t.key)}getRenderableIds(t){const n=[];for(const o in this._tiles)this._isIdRenderable(o,t)&&n.push(this._tiles[o]);return t?n.sort((o,u)=>{const p=o.tileID,f=u.tileID,_=new a.pointGeometry(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),y=new a.pointGeometry(f.canonical.x,f.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-f.overscaledZ||y.y-_.y||y.x-_.x}).map(o=>o.tileID.key):n.map(o=>o.tileID).sort(Fn).map(o=>o.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,n){const o=this._tiles[t];o&&(o.state!=="loading"&&(o.state=n),this._loadTile(o,this._tileLoaded.bind(this,o,t,n)))}_tileLoaded(t,n,o,u){if(u)return t.state="errored",void(u.status!==404?this._source.fire(new a.ErrorEvent(u,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=a.exported.now(),o==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new a.Event("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const n=this.getRenderableIds();for(let u=0;u<n.length;u++){const p=n[u];if(t.neighboringTiles&&t.neighboringTiles[p]){const f=this.getTileByID(p);o(t,f),o(f,t)}}function o(u,p){u.needsHillshadePrepare=!0,u.needsTerrainPrepare=!0;let f=p.tileID.canonical.x-u.tileID.canonical.x;const _=p.tileID.canonical.y-u.tileID.canonical.y,y=Math.pow(2,u.tileID.canonical.z),v=p.tileID.key;f===0&&_===0||Math.abs(_)>1||(Math.abs(f)>1&&(Math.abs(f+y)===1?f+=y:Math.abs(f-y)===1&&(f-=y)),p.dem&&u.dem&&(u.dem.backfillBorder(p.dem,f,_),u.neighboringTiles&&u.neighboringTiles[v]&&(u.neighboringTiles[v].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,o,u){for(const p in this._tiles){let f=this._tiles[p];if(u[p]||!f.hasData()||f.tileID.overscaledZ<=n||f.tileID.overscaledZ>o)continue;let _=f.tileID;for(;f&&f.tileID.overscaledZ>n+1;){const v=f.tileID.scaledTo(f.tileID.overscaledZ-1);f=this._tiles[v.key],f&&f.hasData()&&(_=v)}let y=_;for(;y.overscaledZ>n;)if(y=y.scaledTo(y.overscaledZ-1),t[y.key]){u[_.key]=_;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const o=this._loadedParentTiles[t.key];return o&&o.tileID.overscaledZ>=n?o:null}for(let o=t.overscaledZ-1;o>=n;o--){const u=t.scaledTo(o),p=this._getLoadedTile(u);if(p)return p}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const n=Math.ceil(t.width/this._source.tileSize)+1,o=Math.ceil(t.height/this._source.tileSize)+1,u=Math.floor(n*o*5),p=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(p)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,n){const o={};for(const u in this._tiles){const p=this._tiles[u];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+n),o[p.tileID.key]=p}this._tiles=o;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(u,this._tiles[u])}}update(t,n){if(this.transform=t,this.terrain=n,!this._sourceLoaded||this._paused)return;let o;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?o=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(v=>new a.OverscaledTileID(v.canonical.z,v.wrap,v.canonical.z,v.canonical.x,v.canonical.y)):(o=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n}),this._source.hasTile&&(o=o.filter(v=>this._source.hasTile(v)))):o=[];const u=t.coveringZoomLevel(this._source),p=Math.max(u-zi.maxOverzooming,this._source.minzoom),f=Math.max(u+zi.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const v={};for(const T of o)if(T.canonical.z>this._source.minzoom){const I=T.scaledTo(T.canonical.z-1);v[I.key]=I;const M=T.scaledTo(Math.max(this._source.minzoom,Math.min(T.canonical.z,5)));v[M.key]=M}o=o.concat(Object.values(v))}const _=this._updateRetainedTiles(o,u);if(ps(this._source.type)){const v={},T={},I=Object.keys(_);for(const M of I){const U=_[M],R=this._tiles[M];if(!R||R.fadeEndTime&&R.fadeEndTime<=a.exported.now())continue;const O=this.findLoadedParent(U,p);O&&(this._addTile(O.tileID),v[O.tileID.key]=O.tileID),T[M]=U}this._retainLoadedChildren(T,u,f,_);for(const M in v)_[M]||(this._coveredTiles[M]=!0,_[M]=v[M]);if(n){const M={},U={};for(const R of o)this._tiles[R.key].hasData()?M[R.key]=R:U[R.key]=R;for(const R in U){const O=U[R].children(this._source.maxzoom);this._tiles[O[0].key]&&this._tiles[O[1].key]&&this._tiles[O[2].key]&&this._tiles[O[3].key]&&(M[O[0].key]=_[O[0].key]=O[0],M[O[1].key]=_[O[1].key]=O[1],M[O[2].key]=_[O[2].key]=O[2],M[O[3].key]=_[O[3].key]=O[3],delete U[R])}for(const R in U){const O=this.findLoadedParent(U[R],this._source.minzoom);if(O){M[O.tileID.key]=_[O.tileID.key]=O.tileID;for(const H in M)M[H].isChildOf(O.tileID)&&delete M[H]}}for(const R in this._tiles)M[R]||(this._coveredTiles[R]=!0)}}for(const v in _)this._tiles[v].clearFadeHold();const y=a.keysDifference(this._tiles,_);for(const v of y){const T=this._tiles[v];T.hasSymbolBuckets&&!T.holdingForFade()?T.setHoldDuration(this.map._fadeDuration):T.hasSymbolBuckets&&!T.symbolFadeFinished()||this._removeTile(v)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,n){const o={},u={},p=Math.max(n-zi.maxOverzooming,this._source.minzoom),f=Math.max(n+zi.maxUnderzooming,this._source.minzoom),_={};for(const y of t){const v=this._addTile(y);o[y.key]=y,v.hasData()||n<this._source.maxzoom&&(_[y.key]=y)}this._retainLoadedChildren(_,n,f,o);for(const y of t){let v=this._tiles[y.key];if(v.hasData())continue;if(n+1>this._source.maxzoom){const I=y.children(this._source.maxzoom)[0],M=this.getTile(I);if(M&&M.hasData()){o[I.key]=I;continue}}else{const I=y.children(this._source.maxzoom);if(o[I[0].key]&&o[I[1].key]&&o[I[2].key]&&o[I[3].key])continue}let T=v.wasRequested();for(let I=y.overscaledZ-1;I>=p;--I){const M=y.scaledTo(I);if(u[M.key]||(u[M.key]=!0,v=this.getTile(M),!v&&T&&(v=this._addTile(M)),v&&(o[M.key]=M,T=v.wasRequested(),v.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let o,u=this._tiles[t].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){o=this._loadedParentTiles[u.key];break}n.push(u.key);const p=u.scaledTo(u.overscaledZ-1);if(o=this._getLoadedTile(p),o)break;u=p}for(const p of n)this._loadedParentTiles[p]=o}}_addTile(t){let n=this._tiles[t.key];if(n)return n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const o=n;return n||(n=new qr(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))),n.uses++,this._tiles[t.key]=n,o||this._source.fire(new a.Event("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const o=n.getExpiryTimeout();o&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},o))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,n,o){const u=[],p=this.transform;if(!p)return u;const f=o?p.getCameraQueryGeometry(t):t,_=t.map(R=>p.pointCoordinate(R,this.terrain)),y=f.map(R=>p.pointCoordinate(R,this.terrain)),v=this.getIds();let T=1/0,I=1/0,M=-1/0,U=-1/0;for(const R of y)T=Math.min(T,R.x),I=Math.min(I,R.y),M=Math.max(M,R.x),U=Math.max(U,R.y);for(let R=0;R<v.length;R++){const O=this._tiles[v[R]];if(O.holdingForFade())continue;const H=O.tileID,Q=Math.pow(2,p.zoom-O.tileID.overscaledZ),re=n*O.queryPadding*a.EXTENT/O.tileSize/Q,V=[H.getTilePoint(new a.MercatorCoordinate(T,I)),H.getTilePoint(new a.MercatorCoordinate(M,U))];if(V[0].x-re<a.EXTENT&&V[0].y-re<a.EXTENT&&V[1].x+re>=0&&V[1].y+re>=0){const oe=_.map(de=>H.getTilePoint(de)),ne=y.map(de=>H.getTilePoint(de));u.push({tile:O,tileID:H,queryGeometry:oe,cameraQueryGeometry:ne,scale:Q})}}return u}getVisibleCoordinates(t){const n=this.getRenderableIds(t).map(o=>this._tiles[o].tileID);for(const o of n)o.posMatrix=this.transform.calculatePosMatrix(o.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(ps(this._source.type))for(const t in this._tiles){const n=this._tiles[t];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=a.exported.now())return!0}return!1}setFeatureState(t,n,o){this._state.updateState(t=t||"_geojsonTileLayer",n,o)}removeFeatureState(t,n,o){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,o)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,o){const u=this._tiles[t];u&&u.setDependencies(n,o)}reloadTilesForDependencies(t,n){for(const o in this._tiles)this._tiles[o].hasDependency(t,n)&&this._reloadTile(o,"reloading");this._cache.filter(o=>!o.hasDependency(t,n))}}function Fn(l,t){const n=Math.abs(2*l.wrap)-+(l.wrap<0),o=Math.abs(2*t.wrap)-+(t.wrap<0);return l.overscaledZ-t.overscaledZ||o-n||t.canonical.y-l.canonical.y||t.canonical.x-l.canonical.x}function ps(l){return l==="raster"||l==="image"||l==="video"}zi.maxOverzooming=10,zi.maxUnderzooming=3;const Ir="mapboxgl_preloaded_worker_pool";class Fi{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Fi.workerCount;)this.workers.push(new Worker(vn.workerUrl));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ir]}numActive(){return Object.keys(this.active).length}}const ds=Math.floor(a.exported.hardwareConcurrency/2);let jr;function On(){return jr||(jr=new Fi),jr}function Un(l,t){const n={};for(const o in l)o!=="ref"&&(n[o]=l[o]);return a.refProperties.forEach(o=>{o in t&&(n[o]=t[o])}),n}function fs(l){l=l.slice();const t=Object.create(null);for(let n=0;n<l.length;n++)t[l[n].id]=l[n];for(let n=0;n<l.length;n++)"ref"in l[n]&&(l[n]=Un(l[n],t[l[n].ref]));return l}Fi.workerCount=Math.max(Math.min(ds,6),1);const gt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function gr(l,t,n){n.push({command:gt.addSource,args:[l,t[l]]})}function Xr(l,t,n){t.push({command:gt.removeSource,args:[l]}),n[l]=!0}function Wr(l,t,n,o){Xr(l,n,o),gr(l,t,n)}function ms(l,t,n){let o;for(o in l[n])if(Object.prototype.hasOwnProperty.call(l[n],o)&&o!=="data"&&!pe(l[n][o],t[n][o]))return!1;for(o in t[n])if(Object.prototype.hasOwnProperty.call(t[n],o)&&o!=="data"&&!pe(l[n][o],t[n][o]))return!1;return!0}function Ar(l,t,n,o,u,p){let f;for(f in t=t||{},l=l||{})Object.prototype.hasOwnProperty.call(l,f)&&(pe(l[f],t[f])||n.push({command:p,args:[o,f,t[f],u]}));for(f in t)Object.prototype.hasOwnProperty.call(t,f)&&!Object.prototype.hasOwnProperty.call(l,f)&&(pe(l[f],t[f])||n.push({command:p,args:[o,f,t[f],u]}))}function Cr(l){return l.id}function Vn(l,t){return l[t.id]=t,l}class kr{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let o=1;o<this.points.length;o++)this._distances[o]=this._distances[o-1]+this.points[o].dist(this.points[o-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=a.clamp(t,0,1);let n=1,o=this._distances[n];const u=t*this.paddedLength+this.padding;for(;o<u&&n<this._distances.length;)o=this._distances[++n];const p=n-1,f=this._distances[p],_=o-f,y=_>0?(u-f)/_:0;return this.points[p].mult(1-y).add(this.points[n].mult(y))}}function ge(l,t){let n=!0;return l==="always"||l!=="never"&&t!=="never"||(n=!1),n}class ke{constructor(t,n,o){const u=this.boxCells=[],p=this.circleCells=[];this.xCellCount=Math.ceil(t/o),this.yCellCount=Math.ceil(n/o);for(let f=0;f<this.xCellCount*this.yCellCount;f++)u.push([]),p.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,o,u,p){this._forEachCell(n,o,u,p,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(p)}insertCircle(t,n,o,u){this._forEachCell(n-u,o-u,n+u,o+u,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(o),this.circles.push(u)}_insertBoxCell(t,n,o,u,p,f){this.boxCells[p].push(f)}_insertCircleCell(t,n,o,u,p,f){this.circleCells[p].push(f)}_query(t,n,o,u,p,f,_){if(o<0||t>this.width||u<0||n>this.height)return[];const y=[];if(t<=0&&n<=0&&this.width<=o&&this.height<=u){if(p)return[{key:null,x1:t,y1:n,x2:o,y2:u}];for(let v=0;v<this.boxKeys.length;v++)y.push({key:this.boxKeys[v],x1:this.bboxes[4*v],y1:this.bboxes[4*v+1],x2:this.bboxes[4*v+2],y2:this.bboxes[4*v+3]});for(let v=0;v<this.circleKeys.length;v++){const T=this.circles[3*v],I=this.circles[3*v+1],M=this.circles[3*v+2];y.push({key:this.circleKeys[v],x1:T-M,y1:I-M,x2:T+M,y2:I+M})}}else this._forEachCell(t,n,o,u,this._queryCell,y,{hitTest:p,overlapMode:f,seenUids:{box:{},circle:{}}},_);return y}query(t,n,o,u){return this._query(t,n,o,u,!1,null)}hitTest(t,n,o,u,p,f){return this._query(t,n,o,u,!0,p,f).length>0}hitTestCircle(t,n,o,u,p){const f=t-o,_=t+o,y=n-o,v=n+o;if(_<0||f>this.width||v<0||y>this.height)return!1;const T=[];return this._forEachCell(f,y,_,v,this._queryCellCircle,T,{hitTest:!0,overlapMode:u,circle:{x:t,y:n,radius:o},seenUids:{box:{},circle:{}}},p),T.length>0}_queryCell(t,n,o,u,p,f,_,y){const{seenUids:v,hitTest:T,overlapMode:I}=_,M=this.boxCells[p];if(M!==null){const R=this.bboxes;for(const O of M)if(!v.box[O]){v.box[O]=!0;const H=4*O,Q=this.boxKeys[O];if(t<=R[H+2]&&n<=R[H+3]&&o>=R[H+0]&&u>=R[H+1]&&(!y||y(Q))&&(!T||!ge(I,Q.overlapMode))&&(f.push({key:Q,x1:R[H],y1:R[H+1],x2:R[H+2],y2:R[H+3]}),T))return!0}}const U=this.circleCells[p];if(U!==null){const R=this.circles;for(const O of U)if(!v.circle[O]){v.circle[O]=!0;const H=3*O,Q=this.circleKeys[O];if(this._circleAndRectCollide(R[H],R[H+1],R[H+2],t,n,o,u)&&(!y||y(Q))&&(!T||!ge(I,Q.overlapMode))){const re=R[H],V=R[H+1],oe=R[H+2];if(f.push({key:Q,x1:re-oe,y1:V-oe,x2:re+oe,y2:V+oe}),T)return!0}}}return!1}_queryCellCircle(t,n,o,u,p,f,_,y){const{circle:v,seenUids:T,overlapMode:I}=_,M=this.boxCells[p];if(M!==null){const R=this.bboxes;for(const O of M)if(!T.box[O]){T.box[O]=!0;const H=4*O,Q=this.boxKeys[O];if(this._circleAndRectCollide(v.x,v.y,v.radius,R[H+0],R[H+1],R[H+2],R[H+3])&&(!y||y(Q))&&!ge(I,Q.overlapMode))return f.push(!0),!0}}const U=this.circleCells[p];if(U!==null){const R=this.circles;for(const O of U)if(!T.circle[O]){T.circle[O]=!0;const H=3*O,Q=this.circleKeys[O];if(this._circlesCollide(R[H],R[H+1],R[H+2],v.x,v.y,v.radius)&&(!y||y(Q))&&!ge(I,Q.overlapMode))return f.push(!0),!0}}}_forEachCell(t,n,o,u,p,f,_,y){const v=this._convertToXCellCoord(t),T=this._convertToYCellCoord(n),I=this._convertToXCellCoord(o),M=this._convertToYCellCoord(u);for(let U=v;U<=I;U++)for(let R=T;R<=M;R++)if(p.call(this,t,n,o,u,this.xCellCount*R+U,f,_,y))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,o,u,p,f){const _=u-t,y=p-n,v=o+f;return v*v>_*_+y*y}_circleAndRectCollide(t,n,o,u,p,f,_){const y=(f-u)/2,v=Math.abs(t-(u+y));if(v>y+o)return!1;const T=(_-p)/2,I=Math.abs(n-(p+T));if(I>T+o)return!1;if(v<=y||I<=T)return!0;const M=v-y,U=I-T;return M*M+U*U<=o*o}}function pn(l,t,n,o,u){const p=a.create();return t?(a.scale(p,p,[1/u,1/u,1]),n||a.rotateZ(p,p,o.angle)):a.multiply(p,o.labelPlaneMatrix,l),p}function lr(l,t,n,o,u){if(t){const p=a.clone(l);return a.scale(p,p,[u,u,1]),n||a.rotateZ(p,p,-o.angle),p}return o.glCoordMatrix}function _t(l,t,n){let o;n?(o=[l.x,l.y,n(l.x,l.y),1],a.transformMat4(o,o,t)):(o=[l.x,l.y,0,1],Mr(o,o,t));const u=o[3];return{point:new a.pointGeometry(o[0]/u,o[1]/u),signedDistanceFromCamera:u}}function Ji(l,t){return .5+l/t*.5}function Oi(l,t){const n=l[0]/l[3],o=l[1]/l[3];return n>=-t[0]&&n<=t[0]&&o>=-t[1]&&o<=t[1]}function Ui(l,t,n,o,u,p,f,_,y,v){const T=o?l.textSizeData:l.iconSizeData,I=a.evaluateSizeForZoom(T,n.transform.zoom),M=[256/n.width*2+1,256/n.height*2+1],U=o?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;U.clear();const R=l.lineVertexArray,O=o?l.text.placedSymbolArray:l.icon.placedSymbolArray,H=n.transform.width/n.transform.height;let Q=!1;for(let re=0;re<O.length;re++){const V=O.get(re);if(V.hidden||V.writingMode===a.WritingMode.vertical&&!Q){et(V.numGlyphs,U);continue}let oe;if(Q=!1,v?(oe=[V.anchorX,V.anchorY,v(V.anchorX,V.anchorY),1],a.transformMat4(oe,oe,t)):(oe=[V.anchorX,V.anchorY,0,1],Mr(oe,oe,t)),!Oi(oe,M)){et(V.numGlyphs,U);continue}const ne=Ji(n.transform.cameraToCenterDistance,oe[3]),de=a.evaluateSizeForFeature(T,I,V),fe=f?de/ne:de*ne,we=new a.pointGeometry(V.anchorX,V.anchorY),he=_t(we,u,v).point,Be={},Ae=ot(V,fe,!1,_,t,u,p,l.glyphOffsetArray,R,U,he,we,Be,H,y,v);Q=Ae.useVertical,(Ae.notEnoughRoom||Q||Ae.needsFlipping&&ot(V,fe,!0,_,t,u,p,l.glyphOffsetArray,R,U,he,we,Be,H,y,v).notEnoughRoom)&&et(V.numGlyphs,U)}o?l.text.dynamicLayoutVertexBuffer.updateData(U):l.icon.dynamicLayoutVertexBuffer.updateData(U)}function Hr(l,t,n,o,u,p,f,_,y,v,T,I,M){const U=_.glyphStartIndex+_.numGlyphs,R=_.lineStartIndex,O=_.lineStartIndex+_.lineLength,H=t.getoffsetX(_.glyphStartIndex),Q=t.getoffsetX(U-1),re=_i(l*H,n,o,u,p,f,_.segment,R,O,y,v,T,I,M);if(!re)return null;const V=_i(l*Q,n,o,u,p,f,_.segment,R,O,y,v,T,I,M);return V?{first:re,last:V}:null}function Ie(l,t,n,o){return l===a.WritingMode.horizontal&&Math.abs(n.y-t.y)>Math.abs(n.x-t.x)*o?{useVertical:!0}:(l===a.WritingMode.vertical?t.y<n.y:t.x>n.x)?{needsFlipping:!0}:null}function ot(l,t,n,o,u,p,f,_,y,v,T,I,M,U,R,O){const H=t/24,Q=l.lineOffsetX*H,re=l.lineOffsetY*H;let V;if(l.numGlyphs>1){const oe=l.glyphStartIndex+l.numGlyphs,ne=l.lineStartIndex,de=l.lineStartIndex+l.lineLength,fe=Hr(H,_,Q,re,n,T,I,l,y,p,M,R,O);if(!fe)return{notEnoughRoom:!0};const we=_t(fe.first.point,f,O).point,he=_t(fe.last.point,f,O).point;if(o&&!n){const Be=Ie(l.writingMode,we,he,U);if(Be)return Be}V=[fe.first];for(let Be=l.glyphStartIndex+1;Be<oe-1;Be++)V.push(_i(H*_.getoffsetX(Be),Q,re,n,T,I,l.segment,ne,de,y,p,M,R,O));V.push(fe.last)}else{if(o&&!n){const ne=_t(I,u,O).point,de=l.lineStartIndex+l.segment+1,fe=new a.pointGeometry(y.getx(de),y.gety(de)),we=_t(fe,u,O),he=we.signedDistanceFromCamera>0?we.point:it(I,fe,ne,1,u,O),Be=Ie(l.writingMode,ne,he,U);if(Be)return Be}const oe=_i(H*_.getoffsetX(l.glyphStartIndex),Q,re,n,T,I,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,y,p,M,R,O);if(!oe)return{notEnoughRoom:!0};V=[oe]}for(const oe of V)a.addDynamicAttributes(v,oe.point,oe.angle);return{}}function it(l,t,n,o,u,p){const f=_t(l.add(l.sub(t)._unit()),u,p).point,_=n.sub(f);return n.add(_._mult(o/_.mag()))}function _i(l,t,n,o,u,p,f,_,y,v,T,I,M,U){const R=o?l-t:l+t;let O=R>0?1:-1,H=0;o&&(O*=-1,H=Math.PI),O<0&&(H+=Math.PI);let Q=O>0?_+f:_+f+1,re=u,V=u,oe=0,ne=0;const de=Math.abs(R),fe=[];for(;oe+ne<=de;){if(Q+=O,Q<_||Q>=y)return null;if(V=re,fe.push(re),re=I[Q],re===void 0){const Re=new a.pointGeometry(v.getx(Q),v.gety(Q)),rt=_t(Re,T,U);if(rt.signedDistanceFromCamera>0)re=I[Q]=rt.point;else{const lt=Q-O;re=it(oe===0?p:new a.pointGeometry(v.getx(lt),v.gety(lt)),Re,V,de-oe+1,T,U)}}oe+=ne,ne=V.dist(re)}const we=(de-oe)/ne,he=re.sub(V),Be=he.mult(we)._add(V);Be._add(he._unit()._perp()._mult(n*O));const Ae=H+Math.atan2(re.y-V.y,re.x-V.x);return fe.push(Be),{point:Be,angle:M?Ae:0,path:fe}}const Kr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function et(l,t){for(let n=0;n<l;n++){const o=t.length;t.resize(o+4),t.float32.set(Kr,3*o)}}function Mr(l,t,n){const o=t[0],u=t[1];return l[0]=n[0]*o+n[4]*u+n[12],l[1]=n[1]*o+n[5]*u+n[13],l[3]=n[3]*o+n[7]*u+n[15],l}const ci=100;class Nn{constructor(t,n=new ke(t.width+200,t.height+200,25),o=new ke(t.width+200,t.height+200,25)){this.transform=t,this.grid=n,this.ignoredGrid=o,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+ci,this.screenBottomBoundary=t.height+ci,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,n,o,u,p,f){const _=this.projectAndGetPerspectiveRatio(u,t.anchorPointX,t.anchorPointY,f),y=o*_.perspectiveRatio,v=t.x1*y+_.point.x,T=t.y1*y+_.point.y,I=t.x2*y+_.point.x,M=t.y2*y+_.point.y;return!this.isInsideGrid(v,T,I,M)||n!=="always"&&this.grid.hitTest(v,T,I,M,n,p)||_.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[v,T,I,M],offscreen:this.isOffscreen(v,T,I,M)}}placeCollisionCircles(t,n,o,u,p,f,_,y,v,T,I,M,U,R){const O=[],H=new a.pointGeometry(n.anchorX,n.anchorY),Q=_t(H,f,R),re=Ji(this.transform.cameraToCenterDistance,Q.signedDistanceFromCamera),V=(T?p/re:p*re)/a.ONE_EM,oe=_t(H,_,R).point,ne=Hr(V,u,n.lineOffsetX*V,n.lineOffsetY*V,!1,oe,H,n,o,_,{},!1,R);let de=!1,fe=!1,we=!0;if(ne){const he=.5*M*re+U,Be=new a.pointGeometry(-100,-100),Ae=new a.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Re=new kr,rt=ne.first,lt=ne.last;let je=[];for(let mt=rt.path.length-1;mt>=1;mt--)je.push(rt.path[mt]);for(let mt=1;mt<lt.path.length;mt++)je.push(lt.path[mt]);const kt=2.5*he;if(y){const mt=je.map(vt=>_t(vt,y,R));je=mt.some(vt=>vt.signedDistanceFromCamera<=0)?[]:mt.map(vt=>vt.point)}let Mt=[];if(je.length>0){const mt=je[0].clone(),vt=je[0].clone();for(let Pt=1;Pt<je.length;Pt++)mt.x=Math.min(mt.x,je[Pt].x),mt.y=Math.min(mt.y,je[Pt].y),vt.x=Math.max(vt.x,je[Pt].x),vt.y=Math.max(vt.y,je[Pt].y);Mt=mt.x>=Be.x&&vt.x<=Ae.x&&mt.y>=Be.y&&vt.y<=Ae.y?[je]:vt.x<Be.x||mt.x>Ae.x||vt.y<Be.y||mt.y>Ae.y?[]:a.clipLine([je],Be.x,Be.y,Ae.x,Ae.y)}for(const mt of Mt){Re.reset(mt,.25*he);let vt=0;vt=Re.length<=.5*he?1:Math.ceil(Re.paddedLength/kt)+1;for(let Pt=0;Pt<vt;Pt++){const hi=Pt/Math.max(vt-1,1),vr=Re.lerp(hi),ur=vr.x+ci,br=vr.y+ci;O.push(ur,br,he,0);const nn=ur-he,er=br-he,Di=ur+he,Dr=br+he;if(we=we&&this.isOffscreen(nn,er,Di,Dr),fe=fe||this.isInsideGrid(nn,er,Di,Dr),t!=="always"&&this.grid.hitTestCircle(ur,br,he,t,I)&&(de=!0,!v))return{circles:[],offscreen:!1,collisionDetected:de}}}}return{circles:!v&&de||!fe||re<this.perspectiveRatioCutoff?[]:O,offscreen:we,collisionDetected:de}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let o=1/0,u=1/0,p=-1/0,f=-1/0;for(const T of t){const I=new a.pointGeometry(T.x+ci,T.y+ci);o=Math.min(o,I.x),u=Math.min(u,I.y),p=Math.max(p,I.x),f=Math.max(f,I.y),n.push(I)}const _=this.grid.query(o,u,p,f).concat(this.ignoredGrid.query(o,u,p,f)),y={},v={};for(const T of _){const I=T.key;if(y[I.bucketInstanceId]===void 0&&(y[I.bucketInstanceId]={}),y[I.bucketInstanceId][I.featureIndex])continue;const M=[new a.pointGeometry(T.x1,T.y1),new a.pointGeometry(T.x2,T.y1),new a.pointGeometry(T.x2,T.y2),new a.pointGeometry(T.x1,T.y2)];a.polygonIntersectsPolygon(n,M)&&(y[I.bucketInstanceId][I.featureIndex]=!0,v[I.bucketInstanceId]===void 0&&(v[I.bucketInstanceId]=[]),v[I.bucketInstanceId].push(I.featureIndex))}return v}insertCollisionBox(t,n,o,u,p,f){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:p,collisionGroupID:f,overlapMode:n},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,o,u,p,f){const _=o?this.ignoredGrid:this.grid,y={bucketInstanceId:u,featureIndex:p,collisionGroupID:f,overlapMode:n};for(let v=0;v<t.length;v+=4)_.insertCircle(y,t[v],t[v+1],t[v+2])}projectAndGetPerspectiveRatio(t,n,o,u){let p;return u?(p=[n,o,u(n,o),1],a.transformMat4(p,p,t)):(p=[n,o,0,1],Mr(p,p,t)),{point:new a.pointGeometry((p[0]/p[3]+1)/2*this.transform.width+ci,(-p[1]/p[3]+1)/2*this.transform.height+ci),perspectiveRatio:.5+this.transform.cameraToCenterDistance/p[3]*.5}}isOffscreen(t,n,o,u){return o<ci||t>=this.screenRightBoundary||u<ci||n>this.screenBottomBoundary}isInsideGrid(t,n,o,u){return o>=0&&t<this.gridRightBoundary&&u>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=a.identity([]);return a.translate(t,t,[-100,-100,0]),t}}function ti(l,t,n){return t*(a.EXTENT/(l.tileSize*Math.pow(2,n-l.tileID.overscaledZ)))}class Ii{constructor(t,n,o,u){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):u&&o?1:0,this.placed=o}isHidden(){return this.opacity===0&&!this.placed}}class zt{constructor(t,n,o,u,p){this.text=new Ii(t?t.text:null,n,o,p),this.icon=new Ii(t?t.icon:null,n,u,p)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class $n{constructor(t,n,o){this.text=t,this.icon=n,this.skipFade=o}}class _r{constructor(){this.invProjMatrix=a.create(),this.viewportMatrix=a.create(),this.circles=[]}}class dn{constructor(t,n,o,u,p){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=o,this.bucketIndex=u,this.tileID=p}}class fn{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:o=>o.collisionGroupID===n}}return this.collisionGroups[t]}}function qn(l,t,n,o,u){const{horizontalAlign:p,verticalAlign:f}=a.getAnchorAlignment(l),_=-(p-.5)*t,y=-(f-.5)*n,v=a.evaluateVariableOffset(l,o);return new a.pointGeometry(_+v[0]*u,y+v[1]*u)}function mn(l,t,n,o,u,p){const{x1:f,x2:_,y1:y,y2:v,anchorPointX:T,anchorPointY:I}=l,M=new a.pointGeometry(t,n);return o&&M._rotate(u?p:-p),{x1:f+M.x,y1:y+M.y,x2:_+M.x,y2:v+M.y,anchorPointX:T,anchorPointY:I}}class B{constructor(t,n,o,u,p){this.transform=t.clone(),this.terrain=n,this.collisionIndex=new Nn(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new fn(u),this.collisionCircleArrays={},this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,o,u){const p=o.getBucket(n),f=o.latestFeatureIndex;if(!p||!f||n.id!==p.layerIds[0])return;const _=o.collisionBoxArray,y=p.layers[0].layout,v=Math.pow(2,this.transform.zoom-o.tileID.overscaledZ),T=o.tileSize/a.EXTENT,I=this.transform.calculatePosMatrix(o.tileID.toUnwrapped()),M=y.get("text-pitch-alignment")==="map",U=y.get("text-rotation-alignment")==="map",R=ti(o,1,this.transform.zoom),O=pn(I,M,U,this.transform,R);let H=null;if(M){const re=lr(I,M,U,this.transform,R);H=a.multiply([],this.transform.labelPlaneMatrix,re)}this.retainedQueryData[p.bucketInstanceId]=new dn(p.bucketInstanceId,f,p.sourceLayerIndex,p.index,o.tileID);const Q={bucket:p,layout:y,posMatrix:I,textLabelPlaneMatrix:O,labelToScreenMatrix:H,scale:v,textPixelRatio:T,holdingForFade:o.holdingForFade(),collisionBoxArray:_,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(p.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(p.sourceID)};if(u)for(const re of p.sortKeyRanges){const{sortKey:V,symbolInstanceStart:oe,symbolInstanceEnd:ne}=re;t.push({sortKey:V,symbolInstanceStart:oe,symbolInstanceEnd:ne,parameters:Q})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:p.symbolInstances.length,parameters:Q})}attemptAnchorPlacement(t,n,o,u,p,f,_,y,v,T,I,M,U,R,O,H){const Q=[M.textOffset0,M.textOffset1],re=qn(t,o,u,Q,p),V=this.collisionIndex.placeCollisionBox(mn(n,re.x,re.y,f,_,this.transform.angle),I,y,v,T.predicate,H);if((!O||this.collisionIndex.placeCollisionBox(mn(O,re.x,re.y,f,_,this.transform.angle),I,y,v,T.predicate,H).box.length!==0)&&V.box.length>0){let oe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[M.crossTileID]&&this.prevPlacement.placements[M.crossTileID]&&this.prevPlacement.placements[M.crossTileID].text&&(oe=this.prevPlacement.variableOffsets[M.crossTileID].anchor),M.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[M.crossTileID]={textOffset:Q,width:o,height:u,anchor:t,textBoxScale:p,prevAnchor:oe},this.markUsedJustification(U,t,M,R),U.allowVerticalPlacement&&(this.markUsedOrientation(U,R,M),this.placedOrientations[M.crossTileID]=R),{shift:re,placedGlyphBoxes:V}}}placeLayerBucketPart(t,n,o){const{bucket:u,layout:p,posMatrix:f,textLabelPlaneMatrix:_,labelToScreenMatrix:y,textPixelRatio:v,holdingForFade:T,collisionBoxArray:I,partiallyEvaluatedTextSize:M,collisionGroup:U}=t.parameters,R=p.get("text-optional"),O=p.get("icon-optional"),H=a.getOverlapMode(p,"text-overlap","text-allow-overlap"),Q=H==="always",re=a.getOverlapMode(p,"icon-overlap","icon-allow-overlap"),V=re==="always",oe=p.get("text-rotation-alignment")==="map",ne=p.get("text-pitch-alignment")==="map",de=p.get("icon-text-fit")!=="none",fe=p.get("symbol-z-order")==="viewport-y",we=Q&&(V||!u.hasIconData()||O),he=V&&(Q||!u.hasTextData()||R);!u.collisionArrays&&I&&u.deserializeCollisionBoxes(I);const Be=(Ae,Re)=>{if(n[Ae.crossTileID])return;if(T)return void(this.placements[Ae.crossTileID]=new $n(!1,!1,!1));let rt=!1,lt=!1,je=!0,kt=null,Mt={box:null,offscreen:null},mt={box:null,offscreen:null},vt=null,Pt=null,hi=null,vr=0,ur=0,br=0;Re.textFeatureIndex?vr=Re.textFeatureIndex:Ae.useRuntimeCollisionCircles&&(vr=Ae.featureIndex),Re.verticalTextFeatureIndex&&(ur=Re.verticalTextFeatureIndex);const nn=this.retainedQueryData[u.bucketInstanceId].tileID,er=this.terrain?(oi,pt)=>this.terrain.getElevation(nn,oi,pt):null;for(const oi of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const pt=Re[oi];pt&&(pt.elevation=er?er(pt.anchorPointX,pt.anchorPointY):0)}const Di=Re.textBox;if(Di){const oi=Ct=>{let pi=a.WritingMode.horizontal;if(u.allowVerticalPlacement&&!Ct&&this.prevPlacement){const di=this.prevPlacement.placedOrientations[Ae.crossTileID];di&&(this.placedOrientations[Ae.crossTileID]=di,pi=di,this.markUsedOrientation(u,pi,Ae))}return pi},pt=(Ct,pi)=>{if(u.allowVerticalPlacement&&Ae.numVerticalGlyphVertices>0&&Re.verticalTextBox){for(const di of u.writingModes)if(di===a.WritingMode.vertical?(Mt=pi(),mt=Mt):Mt=Ct(),Mt&&Mt.box&&Mt.box.length)break}else Mt=Ct()};if(p.get("text-variable-anchor")){let Ct=p.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ae.crossTileID]){const Zt=this.prevPlacement.variableOffsets[Ae.crossTileID];Ct.indexOf(Zt.anchor)>0&&(Ct=Ct.filter(tr=>tr!==Zt.anchor),Ct.unshift(Zt.anchor))}const pi=(Zt,tr,bn)=>{const ca=Zt.x2-Zt.x1,is=Zt.y2-Zt.y1,Tl=Ae.textBoxScale,ua=de&&re==="never"?tr:null;let sn={box:[],offscreen:!1};const wn=H!=="never"?2*Ct.length:Ct.length;for(let Tn=0;Tn<wn;++Tn){const fo=this.attemptAnchorPlacement(Ct[Tn%Ct.length],Zt,ca,is,Tl,oe,ne,v,f,U,Tn>=Ct.length?H:"never",Ae,u,bn,ua,er);if(fo&&(sn=fo.placedGlyphBoxes,sn&&sn.box&&sn.box.length)){rt=!0,kt=fo.shift;break}}return sn};pt(()=>pi(Di,Re.iconBox,a.WritingMode.horizontal),()=>{const Zt=Re.verticalTextBox;return u.allowVerticalPlacement&&!(Mt&&Mt.box&&Mt.box.length)&&Ae.numVerticalGlyphVertices>0&&Zt?pi(Zt,Re.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null}}),Mt&&(rt=Mt.box,je=Mt.offscreen);const di=oi(Mt&&Mt.box);if(!rt&&this.prevPlacement){const Zt=this.prevPlacement.variableOffsets[Ae.crossTileID];Zt&&(this.variableOffsets[Ae.crossTileID]=Zt,this.markUsedJustification(u,Zt.anchor,Ae,di))}}else{const Ct=(pi,di)=>{const Zt=this.collisionIndex.placeCollisionBox(pi,H,v,f,U.predicate,er);return Zt&&Zt.box&&Zt.box.length&&(this.markUsedOrientation(u,di,Ae),this.placedOrientations[Ae.crossTileID]=di),Zt};pt(()=>Ct(Di,a.WritingMode.horizontal),()=>{const pi=Re.verticalTextBox;return u.allowVerticalPlacement&&Ae.numVerticalGlyphVertices>0&&pi?Ct(pi,a.WritingMode.vertical):{box:null,offscreen:null}}),oi(Mt&&Mt.box&&Mt.box.length)}}if(vt=Mt,rt=vt&&vt.box&&vt.box.length>0,je=vt&&vt.offscreen,Ae.useRuntimeCollisionCircles){const oi=u.text.placedSymbolArray.get(Ae.centerJustifiedTextSymbolIndex),pt=a.evaluateSizeForFeature(u.textSizeData,M,oi),Ct=p.get("text-padding");Pt=this.collisionIndex.placeCollisionCircles(H,oi,u.lineVertexArray,u.glyphOffsetArray,pt,f,_,y,o,ne,U.predicate,Ae.collisionCircleDiameter,Ct,er),Pt.circles.length&&Pt.collisionDetected&&!o&&a.warnOnce("Collisions detected, but collision boxes are not shown"),rt=Q||Pt.circles.length>0&&!Pt.collisionDetected,je=je&&Pt.offscreen}if(Re.iconFeatureIndex&&(br=Re.iconFeatureIndex),Re.iconBox){const oi=pt=>{const Ct=de&&kt?mn(pt,kt.x,kt.y,oe,ne,this.transform.angle):pt;return this.collisionIndex.placeCollisionBox(Ct,re,v,f,U.predicate,er)};mt&&mt.box&&mt.box.length&&Re.verticalIconBox?(hi=oi(Re.verticalIconBox),lt=hi.box.length>0):(hi=oi(Re.iconBox),lt=hi.box.length>0),je=je&&hi.offscreen}const Dr=R||Ae.numHorizontalGlyphVertices===0&&Ae.numVerticalGlyphVertices===0,po=O||Ae.numIconVertices===0;if(Dr||po?po?Dr||(lt=lt&&rt):rt=lt&&rt:lt=rt=lt&&rt,rt&&vt&&vt.box&&this.collisionIndex.insertCollisionBox(vt.box,H,p.get("text-ignore-placement"),u.bucketInstanceId,mt&&mt.box&&ur?ur:vr,U.ID),lt&&hi&&this.collisionIndex.insertCollisionBox(hi.box,re,p.get("icon-ignore-placement"),u.bucketInstanceId,br,U.ID),Pt&&(rt&&this.collisionIndex.insertCollisionCircles(Pt.circles,H,p.get("text-ignore-placement"),u.bucketInstanceId,vr,U.ID),o)){const oi=u.bucketInstanceId;let pt=this.collisionCircleArrays[oi];pt===void 0&&(pt=this.collisionCircleArrays[oi]=new _r);for(let Ct=0;Ct<Pt.circles.length;Ct+=4)pt.circles.push(Pt.circles[Ct+0]),pt.circles.push(Pt.circles[Ct+1]),pt.circles.push(Pt.circles[Ct+2]),pt.circles.push(Pt.collisionDetected?1:0)}if(Ae.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(u.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ae.crossTileID]=new $n(rt||we,lt||he,je||u.justReloaded),n[Ae.crossTileID]=!0};if(fe){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ae=u.getSortedSymbolIndexes(this.transform.angle);for(let Re=Ae.length-1;Re>=0;--Re){const rt=Ae[Re];Be(u.symbolInstances.get(rt),u.collisionArrays[rt])}}else for(let Ae=t.symbolInstanceStart;Ae<t.symbolInstanceEnd;Ae++)Be(u.symbolInstances.get(Ae),u.collisionArrays[Ae]);if(o&&u.bucketInstanceId in this.collisionCircleArrays){const Ae=this.collisionCircleArrays[u.bucketInstanceId];a.invert(Ae.invProjMatrix,f),Ae.viewportMatrix=this.collisionIndex.getViewportMatrix()}u.justReloaded=!1}markUsedJustification(t,n,o,u){let p;p=u===a.WritingMode.vertical?o.verticalPlacedTextSymbolIndex:{left:o.leftJustifiedTextSymbolIndex,center:o.centerJustifiedTextSymbolIndex,right:o.rightJustifiedTextSymbolIndex}[a.getAnchorJustification(n)];const f=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex,o.verticalPlacedTextSymbolIndex];for(const _ of f)_>=0&&(t.text.placedSymbolArray.get(_).crossTileID=p>=0&&_!==p?0:o.crossTileID)}markUsedOrientation(t,n,o){const u=n===a.WritingMode.horizontal||n===a.WritingMode.horizontalOnly?n:0,p=n===a.WritingMode.vertical?n:0,f=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex];for(const _ of f)t.text.placedSymbolArray.get(_).placedOrientation=u;o.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).placedOrientation=p)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let o=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const u=n?n.symbolFadeChange(t):1,p=n?n.opacities:{},f=n?n.variableOffsets:{},_=n?n.placedOrientations:{};for(const y in this.placements){const v=this.placements[y],T=p[y];T?(this.opacities[y]=new zt(T,u,v.text,v.icon),o=o||v.text!==T.text.placed||v.icon!==T.icon.placed):(this.opacities[y]=new zt(null,u,v.text,v.icon,v.skipFade),o=o||v.text||v.icon)}for(const y in p){const v=p[y];if(!this.opacities[y]){const T=new zt(v,u,!1,!1);T.isHidden()||(this.opacities[y]=T,o=o||v.text.placed||v.icon.placed)}}for(const y in f)this.variableOffsets[y]||!this.opacities[y]||this.opacities[y].isHidden()||(this.variableOffsets[y]=f[y]);for(const y in _)this.placedOrientations[y]||!this.opacities[y]||this.opacities[y].isHidden()||(this.placedOrientations[y]=_[y]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");o?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n){const o={};for(const u of n){const p=u.getBucket(t);p&&u.latestFeatureIndex&&t.id===p.layerIds[0]&&this.updateBucketOpacities(p,o,u.collisionBoxArray)}}updateBucketOpacities(t,n,o){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const u=t.layers[0].layout,p=new zt(null,0,!1,!1,!0),f=u.get("text-allow-overlap"),_=u.get("icon-allow-overlap"),y=u.get("text-variable-anchor"),v=u.get("text-rotation-alignment")==="map",T=u.get("text-pitch-alignment")==="map",I=u.get("icon-text-fit")!=="none",M=new zt(null,0,f&&(_||!t.hasIconData()||u.get("icon-optional")),_&&(f||!t.hasTextData()||u.get("text-optional")),!0);!t.collisionArrays&&o&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(o);const U=(R,O,H)=>{for(let Q=0;Q<O/4;Q++)R.opacityVertexArray.emplaceBack(H)};for(let R=0;R<t.symbolInstances.length;R++){const O=t.symbolInstances.get(R),{numHorizontalGlyphVertices:H,numVerticalGlyphVertices:Q,crossTileID:re}=O;let V=this.opacities[re];n[re]?V=p:V||(V=M,this.opacities[re]=V),n[re]=!0;const oe=O.numIconVertices>0,ne=this.placedOrientations[O.crossTileID],de=ne===a.WritingMode.vertical,fe=ne===a.WritingMode.horizontal||ne===a.WritingMode.horizontalOnly;if(H>0||Q>0){const we=J(V.text);U(t.text,H,de?ue:we),U(t.text,Q,fe?ue:we);const he=V.text.isHidden();[O.rightJustifiedTextSymbolIndex,O.centerJustifiedTextSymbolIndex,O.leftJustifiedTextSymbolIndex].forEach(Re=>{Re>=0&&(t.text.placedSymbolArray.get(Re).hidden=he||de?1:0)}),O.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(O.verticalPlacedTextSymbolIndex).hidden=he||fe?1:0);const Be=this.variableOffsets[O.crossTileID];Be&&this.markUsedJustification(t,Be.anchor,O,ne);const Ae=this.placedOrientations[O.crossTileID];Ae&&(this.markUsedJustification(t,"left",O,Ae),this.markUsedOrientation(t,Ae,O))}if(oe){const we=J(V.icon),he=!(I&&O.verticalPlacedIconSymbolIndex&&de);O.placedIconSymbolIndex>=0&&(U(t.icon,O.numIconVertices,he?we:ue),t.icon.placedSymbolArray.get(O.placedIconSymbolIndex).hidden=V.icon.isHidden()),O.verticalPlacedIconSymbolIndex>=0&&(U(t.icon,O.numVerticalIconVertices,he?ue:we),t.icon.placedSymbolArray.get(O.verticalPlacedIconSymbolIndex).hidden=V.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const we=t.collisionArrays[R];if(we){let he=new a.pointGeometry(0,0);if(we.textBox||we.verticalTextBox){let Ae=!0;if(y){const Re=this.variableOffsets[re];Re?(he=qn(Re.anchor,Re.width,Re.height,Re.textOffset,Re.textBoxScale),v&&he._rotate(T?this.transform.angle:-this.transform.angle)):Ae=!1}we.textBox&&b(t.textCollisionBox.collisionVertexArray,V.text.placed,!Ae||de,he.x,he.y),we.verticalTextBox&&b(t.textCollisionBox.collisionVertexArray,V.text.placed,!Ae||fe,he.x,he.y)}const Be=Boolean(!fe&&we.verticalIconBox);we.iconBox&&b(t.iconCollisionBox.collisionVertexArray,V.icon.placed,Be,I?he.x:0,I?he.y:0),we.verticalIconBox&&b(t.iconCollisionBox.collisionVertexArray,V.icon.placed,!Be,I?he.x:0,I?he.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const R=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=R.invProjMatrix,t.placementViewportMatrix=R.viewportMatrix,t.collisionCircleArray=R.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const o=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*o>t}setStale(){this.stale=!0}}function b(l,t,n,o,u){l.emplaceBack(t?1:0,n?1:0,o||0,u||0),l.emplaceBack(t?1:0,n?1:0,o||0,u||0),l.emplaceBack(t?1:0,n?1:0,o||0,u||0),l.emplaceBack(t?1:0,n?1:0,o||0,u||0)}const S=Math.pow(2,25),D=Math.pow(2,24),L=Math.pow(2,17),Z=Math.pow(2,16),K=Math.pow(2,9),W=Math.pow(2,8),j=Math.pow(2,1);function J(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;const t=l.placed?1:0,n=Math.floor(127*l.opacity);return n*S+t*D+n*L+t*Z+n*K+t*W+n*j+t}const ue=0;class ve{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,n,o,u,p){const f=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(f,u,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,p())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,f.sort((_,y)=>_.sortKey-y.sortKey));this._currentPartIndex<f.length;)if(n.placeLayerBucketPart(f[this._currentPartIndex],this._seenCrossTileIDs,o),this._currentPartIndex++,p())return!0;return!1}}class ce{constructor(t,n,o,u,p,f,_,y){this.placement=new B(t,n,f,_,y),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(t,n,o){const u=a.exported.now(),p=()=>{const f=a.exported.now()-u;return!this._forceFullPlacement&&f>2};for(;this._currentPlacementIndex>=0;){const f=n[t[this._currentPlacementIndex]],_=this.placement.collisionIndex.transform.zoom;if(f.type==="symbol"&&(!f.minzoom||f.minzoom<=_)&&(!f.maxzoom||f.maxzoom>_)){if(this._inProgressLayer||(this._inProgressLayer=new ve(f)),this._inProgressLayer.continuePlacement(o[f.source],this.placement,this._showCollisionBoxes,f,p))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Ue=512/a.EXTENT/2;class $e{constructor(t,n,o){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=o;for(let u=0;u<n.length;u++){const p=n.get(u),f=p.key;this.indexedSymbolInstances[f]||(this.indexedSymbolInstances[f]=[]),this.indexedSymbolInstances[f].push({crossTileID:p.crossTileID,coord:this.getScaledCoordinates(p,t)})}}getScaledCoordinates(t,n){const o=Ue/Math.pow(2,n.canonical.z-this.tileID.canonical.z);return{x:Math.floor((n.canonical.x*a.EXTENT+t.anchorX)*o),y:Math.floor((n.canonical.y*a.EXTENT+t.anchorY)*o)}}findMatches(t,n,o){const u=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let p=0;p<t.length;p++){const f=t.get(p);if(f.crossTileID)continue;const _=this.indexedSymbolInstances[f.key];if(!_)continue;const y=this.getScaledCoordinates(f,n);for(const v of _)if(Math.abs(v.coord.x-y.x)<=u&&Math.abs(v.coord.y-y.y)<=u&&!o[v.crossTileID]){o[v.crossTileID]=!0,f.crossTileID=v.crossTileID;break}}}}class Le{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class He{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const o in this.indexes){const u=this.indexes[o],p={};for(const f in u){const _=u[f];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+n),p[_.tileID.key]=_}this.indexes[o]=p}this.lng=t}addBucket(t,n,o){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let p=0;p<n.symbolInstances.length;p++)n.symbolInstances.get(p).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const u=this.usedCrossTileIDs[t.overscaledZ];for(const p in this.indexes){const f=this.indexes[p];if(Number(p)>t.overscaledZ)for(const _ in f){const y=f[_];y.tileID.isChildOf(t)&&y.findMatches(n.symbolInstances,t,u)}else{const _=f[t.scaledTo(Number(p)).key];_&&_.findMatches(n.symbolInstances,t,u)}}for(let p=0;p<n.symbolInstances.length;p++){const f=n.symbolInstances.get(p);f.crossTileID||(f.crossTileID=o.generate(),u[f.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new $e(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const o in n.indexedSymbolInstances)for(const u of n.indexedSymbolInstances[o])delete this.usedCrossTileIDs[t][u.crossTileID]}removeStaleBuckets(t){let n=!1;for(const o in this.indexes){const u=this.indexes[o];for(const p in u)t[u[p].bucketInstanceId]||(this.removeBucketCrossTileIDs(o,u[p]),delete u[p],n=!0)}return n}}class Ye{constructor(){this.layerIndexes={},this.crossTileIDs=new Le,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,o){let u=this.layerIndexes[t.id];u===void 0&&(u=this.layerIndexes[t.id]=new He);let p=!1;const f={};u.handleWrapJump(o);for(const _ of n){const y=_.getBucket(t);y&&t.id===y.layerIds[0]&&(y.bucketInstanceId||(y.bucketInstanceId=++this.maxBucketInstanceId),u.addBucket(_.tileID,y,this.crossTileIDs)&&(p=!0),f[y.bucketInstanceId]=!0)}return u.removeStaleBuckets(f)&&(p=!0),p}pruneUnusedLayers(t){const n={};t.forEach(o=>{n[o]=!0});for(const o in this.layerIndexes)n[o]||delete this.layerIndexes[o]}}var yt=a.createLayout([{name:"a_pos",type:"Int16",components:2}]);class Qe extends a.Evented{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=t._cache.max,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const t in this._tiles){const n=this._tiles[t];n.textures.forEach(o=>o.destroy()),n.textures=[]}}update(t,n){this.sourceCache.update(t,n),this._renderableTilesKeys=[];for(const o of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n}))this._renderableTilesKeys.push(o.key),this._tiles[o.key]||(o.posMatrix=new Float64Array(16),a.ortho(o.posMatrix,0,a.EXTENT,0,a.EXTENT,0,1),this._tiles[o.key]=new qr(o,this.tileSize))}removeOutdated(t){const n={};this.renderHistory=this.renderHistory.filter((o,u)=>this.renderHistory.indexOf(o)===u).slice(0,this.renderHistorySize);for(const o of this._renderableTilesKeys)n[o]=!0;for(const o of this.renderHistory)n[o]=!0;for(const o in this._tiles)n[o]||(this._tiles[o].clearTextures(t),delete this._tiles[o])}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const n={};for(const o of this._renderableTilesKeys){const u=this._tiles[o].tileID;if(u.canonical.equals(t.canonical)){const p=t.clone();p.posMatrix=new Float64Array(16),a.ortho(p.posMatrix,0,a.EXTENT,0,a.EXTENT,0,1),n[o]=p}else if(u.canonical.isChildOf(t.canonical)){const p=t.clone();p.posMatrix=new Float64Array(16);const f=u.canonical.z-t.canonical.z,_=u.canonical.x-(u.canonical.x>>f<<f),y=u.canonical.y-(u.canonical.y>>f<<f),v=a.EXTENT>>f;a.ortho(p.posMatrix,0,v,0,v,0,1),a.translate(p.posMatrix,p.posMatrix,[-_*v,-y*v,0]),n[o]=p}else if(t.canonical.isChildOf(u.canonical)){const p=t.clone();p.posMatrix=new Float64Array(16);const f=t.canonical.z-u.canonical.z,_=t.canonical.x-(t.canonical.x>>f<<f),y=t.canonical.y-(t.canonical.y>>f<<f),v=a.EXTENT>>f;a.ortho(p.posMatrix,0,a.EXTENT,0,a.EXTENT,0,1),a.translate(p.posMatrix,p.posMatrix,[_*v,y*v,0]),a.scale(p.posMatrix,p.posMatrix,[1/2**f,1/2**f,0]),n[o]=p}}return n}getSourceTile(t,n){const o=this.sourceCache._source;let u=t.overscaledZ-this.deltaZoom;if(u>o.maxzoom&&(u=o.maxzoom),u<o.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(u).key);let p=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!p||!p.dem)&&n)for(;u>=o.minzoom&&(!p||!p.dem);)p=this.sourceCache.getTileByID(t.scaledTo(u--).key);return p}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(n=>n.timeLoaded>=t)}}class at{constructor(t,n,o){this.style=t,this.sourceCache=new Qe(n),this.options=o,this.exaggeration=typeof o.exaggeration=="number"?o.exaggeration:1,this.elevationOffset=typeof o.elevationOffset=="number"?o.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(t,n,o,u=a.EXTENT){if(!(n>=0&&n<u&&o>=0&&o<u))return this.elevationOffset;let p=0;const f=this.getTerrainData(t);if(f.tile&&f.tile.dem){const _=a.transformMat4$1([],[n/u*a.EXTENT,o/u*a.EXTENT],f.u_terrain_matrix),y=[_[0]*f.tile.dem.dim,_[1]*f.tile.dem.dim],v=[Math.floor(y[0]),Math.floor(y[1])],T=f.tile.dem.get(v[0],v[1]),I=f.tile.dem.get(v[0],v[1]+1),M=f.tile.dem.get(v[0]+1,v[1]),U=f.tile.dem.get(v[0]+1,v[1]+1);p=a.number(a.number(T,I,y[0]-v[0]),a.number(M,U,y[0]-v[0]),y[1]-v[1])}return p}rememberForRerender(t,n){for(const o in this.sourceCache._tiles){const u=this.sourceCache._tiles[o];(u.tileID.equals(n)||u.tileID.isChildOf(n))&&(t===this.sourceCache.sourceCache.id&&(u.timeLoaded=Date.now()),this._rerender[t]=this._rerender[t]||{},this._rerender[t][u.tileID.key]=!0)}}needsRerender(t,n){return this._rerender[t]&&this._rerender[t][n.key]}clearRerenderCache(){this._rerender={}}getElevation(t,n,o,u=a.EXTENT){return(this.getDEMElevation(t,n,o,u)+this.elevationOffset)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const u=this.style.map.painter.context,p=new a.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new be(u,p,u.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new be(u,new a.RGBAImage({width:1,height:1}),u.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.identity([])}const n=this.sourceCache.getSourceTile(t,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const u=this.style.map.painter.context;n.demTexture=this.style.map.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new be(u,n.dem.getPixels(),u.gl.RGBA,{premultiply:!1}),n.demTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const o=n&&n+n.tileID.key+t.key;if(o&&!this._demMatrixCache[o]){const u=this.sourceCache.sourceCache._source.maxzoom;let p=t.canonical.z-n.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=u?p=t.canonical.z-u:a.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const f=t.canonical.x-(t.canonical.x>>p<<p),_=t.canonical.y-(t.canonical.y>>p<<p),y=a.fromScaling(new Float64Array(16),[1/(a.EXTENT<<p),1/(a.EXTENT<<p),0]);a.translate(y,y,[f*a.EXTENT,_*a.EXTENT,0]),this._demMatrixCache[t.key]={matrix:y,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:o?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getRTTFramebuffer(){const t=this.style.map.painter;if(!this._rttFramebuffer){const n=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=t.context.createFramebuffer(n,n,!0),this._rttFramebuffer.depthAttachment.set(t.context.createRenderbuffer(t.context.gl.DEPTH_COMPONENT16,n,n))}return this._rttFramebuffer}getFramebuffer(t){const n=this.style.map.painter,o=n.width/devicePixelRatio,u=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===o&&this._fbo.height===u||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new be(n.context,{width:o,height:u,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new be(n.context,{width:o,height:u,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(o,u,!0),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,o,u))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let p=0,f=0;p<this._coordsTextureSize;p++)for(let _=0;_<this._coordsTextureSize;_++,f+=4)n[f+0]=255&_,n[f+1]=255&p,n[f+2]=_>>8<<4|p>>8,n[f+3]=0;const o=new a.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),u=new be(t,o,t.gl.RGBA,{premultiply:!1});return u.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=u,u}pointCoordinate(t){const n=new Uint8Array(4),o=this.style.map.painter,u=o.context,p=u.gl;u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),p.readPixels(t.x,o.height/devicePixelRatio-t.y-1,1,1,p.RGBA,p.UNSIGNED_BYTE,n),u.bindFramebuffer.set(null);const f=n[0]+(n[2]>>4<<8),_=n[1]+((15&n[2])<<8),y=this.coordsIndex[255-n[3]],v=y&&this.sourceCache.getTileByID(y);if(!v)return null;const T=this._coordsTextureSize,I=(1<<v.tileID.canonical.z)*T;return new a.MercatorCoordinate((v.tileID.canonical.x*T+f)/I,(v.tileID.canonical.y*T+_)/I,this.getElevation(v.tileID,f,_,T))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.style.map.painter.context,n=new a.PosArray,o=new a.TriangleIndexArray,u=this.meshSize,p=a.EXTENT/u,f=u*u;for(let _=0;_<=u;_++)for(let y=0;y<=u;y++)n.emplaceBack(y*p,_*p);for(let _=0;_<f;_+=u+1)for(let y=0;y<u;y++)o.emplaceBack(y+_,u+y+_+1,u+y+_+2),o.emplaceBack(y+_,u+y+_+2,y+_+1);return this._mesh={indexBuffer:t.createIndexBuffer(o),vertexBuffer:t.createVertexBuffer(n,yt.members),segments:a.SegmentVector.simpleSegment(0,0,n.length,o.length)},this._mesh}getMinMaxElevation(t){const n=this.getTerrainData(t).tile,o={minElevation:null,maxElevation:null};return n&&n.dem&&(o.minElevation=(n.dem.min+this.elevationOffset)*this.exaggeration,o.maxElevation=(n.dem.max+this.elevationOffset)*this.exaggeration),o}}const xt=(l,t)=>a.emitValidationErrors(l,t&&t.filter(n=>n.identifier!=="source.canvas")),Bt=a.pick(gt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),ui=a.pick(gt,["setCenter","setZoom","setBearing","setPitch"]),Nt=function(){const l={},t=a.spec.$version;for(const n in a.spec.$root){const o=a.spec.$root[n];if(o.required){let u=null;u=n==="version"?t:o.type==="array"?[]:{},u!=null&&(l[n]=u)}}return l}();class vi extends a.Evented{constructor(t,n={}){super(),this.map=t,this.dispatcher=new Kt(On(),this),this.imageManager=new We,this.imageManager.setEventedParent(this),this.glyphManager=new st(t._requestManager,n.localIdeographFontFamily),this.lineAtlas=new Xt(256,512),this.crossTileSymbolIndex=new Ye,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());const o=this;this._rtlTextPluginCallback=vi.registerForPluginStateChange(u=>{o.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:u.pluginStatus,pluginURL:u.pluginURL},(p,f)=>{if(a.triggerPluginCompletionEvent(p),f&&f.every(_=>_))for(const _ in o.sourceCaches)o.sourceCaches[_].reload()})}),this.on("data",u=>{if(u.dataType!=="source"||u.sourceDataType!=="metadata")return;const p=this.sourceCaches[u.sourceId];if(!p)return;const f=p.getSource();if(f&&f.vectorLayerIds)for(const _ in this._layers){const y=this._layers[_];y.source===f.id&&this._validateLayer(y)}})}loadURL(t,n={}){this.fire(new a.Event("dataloading",{dataType:"style"}));const o=typeof n.validate!="boolean"||n.validate,u=this.map._requestManager.transformRequest(t,a.ResourceType.Style);this._request=a.getJSON(u,(p,f)=>{this._request=null,p?this.fire(new a.ErrorEvent(p)):f&&this._load(f,o)})}loadJSON(t,n={}){this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.exported.frame(()=>{this._request=null,this._load(t,n.validate!==!1)})}loadEmpty(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load(Nt,!1)}_load(t,n){if(n&&xt(this,a.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t;for(const u in t.sources)this.addSource(u,t.sources[u],{validate:!1});t.sprite?this._loadSprite(t.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(t.glyphs);const o=fs(this.stylesheet.layers);this._order=o.map(u=>u.id),this._layers={},this._serializedLayers={};for(let u of o)u=a.createStyleLayer(u),u.setEventedParent(this,{layer:{id:u.id}}),this._layers[u.id]=u,this._serializedLayers[u.id]=u.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ht(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}_loadSprite(t){this._spriteRequest=function(n,o,u,p){let f,_,y;const v=u>1?"@2x":"";let T=a.getJSON(o.transformRequest(o.normalizeSpriteURL(n,v,".json"),a.ResourceType.SpriteJSON),(U,R)=>{T=null,y||(y=U,f=R,M())}),I=a.getImage(o.transformRequest(o.normalizeSpriteURL(n,v,".png"),a.ResourceType.SpriteImage),(U,R)=>{I=null,y||(y=U,_=R,M())});function M(){if(y)p(y);else if(f&&_){const U=a.exported.getImageData(_),R={};for(const O in f){const{width:H,height:Q,x:re,y:V,sdf:oe,pixelRatio:ne,stretchX:de,stretchY:fe,content:we}=f[O],he=new a.RGBAImage({width:H,height:Q});a.RGBAImage.copy(U,he,{x:re,y:V},{x:0,y:0},{width:H,height:Q}),R[O]={data:he,pixelRatio:ne,sdf:oe,stretchX:de,stretchY:fe,content:we}}p(null,R)}}return{cancel(){T&&(T.cancel(),T=null),I&&(I.cancel(),I=null)}}}(t,this.map._requestManager,this.map.getPixelRatio(),(n,o)=>{if(this._spriteRequest=null,n)this.fire(new a.ErrorEvent(n));else if(o)for(const u in o)this.imageManager.addImage(u,o[u]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))})}_validateLayer(t){const n=this.sourceCaches[t.source];if(!n)return;const o=t.sourceLayer;if(!o)return;const u=n.getSource();(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(o)===-1)&&this.fire(new a.ErrorEvent(new Error(`Source layer "${o}" does not exist on source "${u.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const n=[];for(const o of t){const u=this._layers[o];u.type!=="custom"&&n.push(u.serialize())}return n}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const n=this._changed;if(this._changed){const u=Object.keys(this._updatedLayers),p=Object.keys(this._removedLayers);(u.length||p.length)&&this._updateWorkerLayers(u,p);for(const f in this._updatedSources){const _=this._updatedSources[f];if(_==="reload")this._reloadSource(f);else{if(_!=="clear")throw new Error(`Invalid action ${_}`);this._clearSource(f)}}this._updateTilesForChangedImages();for(const f in this._updatedPaintProps)this._layers[f].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const o={};for(const u in this.sourceCaches){const p=this.sourceCaches[u];o[u]=p.used,p.used=!1}for(const u of this._order){const p=this._layers[u];p.recalculate(t,this._availableImages),!p.isHidden(t.zoom)&&p.source&&(this.sourceCaches[p.source].used=!0)}for(const u in o){const p=this.sourceCaches[u];o[u]!==p.used&&p.fire(new a.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:u}))}this.light.recalculate(t),this.z=t.zoom,n&&this.fire(new a.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,n){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(t){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),t){const n=this.sourceCaches[t.source];if(!n)throw new Error(`cannot load terrain, because there exists no source with ID: ${t.source}`);this.terrain=new at(this,n,t),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=o=>{o.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=o=>{o.tile&&(o.sourceId===t.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(o.sourceId,o.tile.tileID)):o.source.type==="geojson"&&this.terrain.rememberForRerender(o.sourceId,o.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new a.Event("terrain",{terrain:t}))}setState(t){if(this._checkLoaded(),xt(this,a.validateStyle(t)))return!1;(t=a.clone$1(t)).layers=fs(t.layers);const n=function(u,p){if(!u)return[{command:gt.setStyle,args:[p]}];let f=[];try{if(!pe(u.version,p.version))return[{command:gt.setStyle,args:[p]}];pe(u.center,p.center)||f.push({command:gt.setCenter,args:[p.center]}),pe(u.zoom,p.zoom)||f.push({command:gt.setZoom,args:[p.zoom]}),pe(u.bearing,p.bearing)||f.push({command:gt.setBearing,args:[p.bearing]}),pe(u.pitch,p.pitch)||f.push({command:gt.setPitch,args:[p.pitch]}),pe(u.sprite,p.sprite)||f.push({command:gt.setSprite,args:[p.sprite]}),pe(u.glyphs,p.glyphs)||f.push({command:gt.setGlyphs,args:[p.glyphs]}),pe(u.transition,p.transition)||f.push({command:gt.setTransition,args:[p.transition]}),pe(u.light,p.light)||f.push({command:gt.setLight,args:[p.light]});const _={},y=[];(function(T,I,M,U){let R;for(R in I=I||{},T=T||{})Object.prototype.hasOwnProperty.call(T,R)&&(Object.prototype.hasOwnProperty.call(I,R)||Xr(R,M,U));for(R in I)Object.prototype.hasOwnProperty.call(I,R)&&(Object.prototype.hasOwnProperty.call(T,R)?pe(T[R],I[R])||(T[R].type==="geojson"&&I[R].type==="geojson"&&ms(T,I,R)?M.push({command:gt.setGeoJSONSourceData,args:[R,I[R].data]}):Wr(R,I,M,U)):gr(R,I,M))})(u.sources,p.sources,y,_);const v=[];u.layers&&u.layers.forEach(T=>{_[T.source]?f.push({command:gt.removeLayer,args:[T.id]}):v.push(T)}),f=f.concat(y),function(T,I,M){I=I||[];const U=(T=T||[]).map(Cr),R=I.map(Cr),O=T.reduce(Vn,{}),H=I.reduce(Vn,{}),Q=U.slice(),re=Object.create(null);let V,oe,ne,de,fe,we,he;for(V=0,oe=0;V<U.length;V++)ne=U[V],Object.prototype.hasOwnProperty.call(H,ne)?oe++:(M.push({command:gt.removeLayer,args:[ne]}),Q.splice(Q.indexOf(ne,oe),1));for(V=0,oe=0;V<R.length;V++)ne=R[R.length-1-V],Q[Q.length-1-V]!==ne&&(Object.prototype.hasOwnProperty.call(O,ne)?(M.push({command:gt.removeLayer,args:[ne]}),Q.splice(Q.lastIndexOf(ne,Q.length-oe),1)):oe++,we=Q[Q.length-V],M.push({command:gt.addLayer,args:[H[ne],we]}),Q.splice(Q.length-V,0,ne),re[ne]=!0);for(V=0;V<R.length;V++)if(ne=R[V],de=O[ne],fe=H[ne],!re[ne]&&!pe(de,fe))if(pe(de.source,fe.source)&&pe(de["source-layer"],fe["source-layer"])&&pe(de.type,fe.type)){for(he in Ar(de.layout,fe.layout,M,ne,null,gt.setLayoutProperty),Ar(de.paint,fe.paint,M,ne,null,gt.setPaintProperty),pe(de.filter,fe.filter)||M.push({command:gt.setFilter,args:[ne,fe.filter]}),pe(de.minzoom,fe.minzoom)&&pe(de.maxzoom,fe.maxzoom)||M.push({command:gt.setLayerZoomRange,args:[ne,fe.minzoom,fe.maxzoom]}),de)Object.prototype.hasOwnProperty.call(de,he)&&he!=="layout"&&he!=="paint"&&he!=="filter"&&he!=="metadata"&&he!=="minzoom"&&he!=="maxzoom"&&(he.indexOf("paint.")===0?Ar(de[he],fe[he],M,ne,he.slice(6),gt.setPaintProperty):pe(de[he],fe[he])||M.push({command:gt.setLayerProperty,args:[ne,he,fe[he]]}));for(he in fe)Object.prototype.hasOwnProperty.call(fe,he)&&!Object.prototype.hasOwnProperty.call(de,he)&&he!=="layout"&&he!=="paint"&&he!=="filter"&&he!=="metadata"&&he!=="minzoom"&&he!=="maxzoom"&&(he.indexOf("paint.")===0?Ar(de[he],fe[he],M,ne,he.slice(6),gt.setPaintProperty):pe(de[he],fe[he])||M.push({command:gt.setLayerProperty,args:[ne,he,fe[he]]}))}else M.push({command:gt.removeLayer,args:[ne]}),we=Q[Q.lastIndexOf(ne)+1],M.push({command:gt.addLayer,args:[fe,we]})}(v,p.layers,f)}catch(_){console.warn("Unable to compute style diff:",_),f=[{command:gt.setStyle,args:[p]}]}return f}(this.serialize(),t).filter(u=>!(u.command in ui));if(n.length===0)return!1;const o=n.filter(u=>!(u.command in Bt));if(o.length>0)throw new Error(`Unimplemented: ${o.map(u=>u.command).join(", ")}.`);return n.forEach(u=>{u.command!=="setTransition"&&this[u.command].apply(this,u.args)}),this.stylesheet=t,!0}addImage(t,n){if(this.getImage(t))return this.fire(new a.ErrorEvent(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,n),this._afterImageUpdated(t)}updateImage(t,n){this.imageManager.updateImage(t,n)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new a.ErrorEvent(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,n,o={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(a.validateStyle.source,`sources.${t}`,n,null,o))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const u=this.sourceCaches[t]=new zi(t,n,this.dispatcher);u.style=this,u.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:u.serialize(),sourceId:t})),u.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const o in this._layers)if(this._layers[o].source===t)return this.fire(new a.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${o}" is using it.`)));const n=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],n.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,n){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const o=this.sourceCaches[t].getSource();if(o.type!=="geojson")throw new Error(`geojsonSource.type is ${o.type}, which is !== 'geojson`);o.setData(n),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,n,o={}){this._checkLoaded();const u=t.id;if(this.getLayer(u))return void this.fire(new a.ErrorEvent(new Error(`Layer "${u}" already exists on this map.`)));let p;if(t.type==="custom"){if(xt(this,a.validateCustomStyleLayer(t)))return;p=a.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(u,t.source),t=a.clone$1(t),t=a.extend(t,{source:u})),this._validate(a.validateStyle.layer,`layers.${u}`,t,{arrayIndex:-1},o))return;p=a.createStyleLayer(t),this._validateLayer(p),p.setEventedParent(this,{layer:{id:u}}),this._serializedLayers[p.id]=p.serialize()}const f=n?this._order.indexOf(n):this._order.length;if(n&&f===-1)this.fire(new a.ErrorEvent(new Error(`Cannot add layer "${u}" before non-existing layer "${n}".`)));else{if(this._order.splice(f,0,u),this._layerOrderChanged=!0,this._layers[u]=p,this._removedLayers[u]&&p.source&&p.type!=="custom"){const _=this._removedLayers[u];delete this._removedLayers[u],_.type!==p.type?this._updatedSources[p.source]="clear":(this._updatedSources[p.source]="reload",this.sourceCaches[p.source].pause())}this._updateLayer(p),p.onAdd&&p.onAdd(this.map)}}moveLayer(t,n){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===n)return;const o=this._order.indexOf(t);this._order.splice(o,1);const u=n?this._order.indexOf(n):this._order.length;n&&u===-1?this.fire(new a.ErrorEvent(new Error(`Cannot move layer "${t}" before non-existing layer "${n}".`))):(this._order.splice(u,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const n=this._layers[t];if(!n)return void this.fire(new a.ErrorEvent(new Error(`Cannot remove non-existing layer "${t}".`)));n.setEventedParent(null);const o=this._order.indexOf(t);this._order.splice(o,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=n,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],n.onRemove&&n.onRemove(this.map)}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,n,o){this._checkLoaded();const u=this.getLayer(t);u?u.minzoom===n&&u.maxzoom===o||(n!=null&&(u.minzoom=n),o!=null&&(u.maxzoom=o),this._updateLayer(u)):this.fire(new a.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,n,o={}){this._checkLoaded();const u=this.getLayer(t);if(u){if(!pe(u.filter,n))return n==null?(u.filter=void 0,void this._updateLayer(u)):void(this._validate(a.validateStyle.filter,`layers.${u.id}.filter`,n,null,o)||(u.filter=a.clone$1(n),this._updateLayer(u)))}else this.fire(new a.ErrorEvent(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return a.clone$1(this.getLayer(t).filter)}setLayoutProperty(t,n,o,u={}){this._checkLoaded();const p=this.getLayer(t);p?pe(p.getLayoutProperty(n),o)||(p.setLayoutProperty(n,o,u),this._updateLayer(p)):this.fire(new a.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,n){const o=this.getLayer(t);if(o)return o.getLayoutProperty(n);this.fire(new a.ErrorEvent(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,n,o,u={}){this._checkLoaded();const p=this.getLayer(t);p?pe(p.getPaintProperty(n),o)||(p.setPaintProperty(n,o,u)&&this._updateLayer(p),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new a.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,n){return this.getLayer(t).getPaintProperty(n)}setFeatureState(t,n){this._checkLoaded();const o=t.source,u=t.sourceLayer,p=this.sourceCaches[o];if(p===void 0)return void this.fire(new a.ErrorEvent(new Error(`The source '${o}' does not exist in the map's style.`)));const f=p.getSource().type;f==="geojson"&&u?this.fire(new a.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):f!=="vector"||u?(t.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),p.setFeatureState(u,t.id,n)):this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,n){this._checkLoaded();const o=t.source,u=this.sourceCaches[o];if(u===void 0)return void this.fire(new a.ErrorEvent(new Error(`The source '${o}' does not exist in the map's style.`)));const p=u.getSource().type,f=p==="vector"?t.sourceLayer:void 0;p!=="vector"||f?n&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new a.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):u.removeFeatureState(f,t.id,n):this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const n=t.source,o=t.sourceLayer,u=this.sourceCaches[n];if(u!==void 0)return u.getSource().type!=="vector"||o?(t.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),u.getFeatureState(o,t.id)):void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.ErrorEvent(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return a.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:a.mapObject(this.sourceCaches,t=>t.serialize()),layers:this._serializeLayers(this._order)},t=>t!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(t){const n=f=>this._layers[f].type==="fill-extrusion",o={},u=[];for(let f=this._order.length-1;f>=0;f--){const _=this._order[f];if(n(_)){o[_]=f;for(const y of t){const v=y[_];if(v)for(const T of v)u.push(T)}}}u.sort((f,_)=>_.intersectionZ-f.intersectionZ);const p=[];for(let f=this._order.length-1;f>=0;f--){const _=this._order[f];if(n(_))for(let y=u.length-1;y>=0;y--){const v=u[y].feature;if(o[v.layer.id]<f)break;p.push(v),u.pop()}else for(const y of t){const v=y[_];if(v)for(const T of v)p.push(T.feature)}}return p}queryRenderedFeatures(t,n,o){n&&n.filter&&this._validate(a.validateStyle.filter,"queryRenderedFeatures.filter",n.filter,null,n);const u={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new a.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const f of n.layers){const _=this._layers[f];if(!_)return this.fire(new a.ErrorEvent(new Error(`The layer '${f}' does not exist in the map's style and cannot be queried for features.`))),[];u[_.source]=!0}}const p=[];n.availableImages=this._availableImages;for(const f in this.sourceCaches)n.layers&&!u[f]||p.push(Rn(this.sourceCaches[f],this._layers,this._serializedLayers,t,n,o));return this.placement&&p.push(function(f,_,y,v,T,I,M){const U={},R=I.queryRenderedSymbols(v),O=[];for(const H of Object.keys(R).map(Number))O.push(M[H]);O.sort(mr);for(const H of O){const Q=H.featureIndex.lookupSymbolFeatures(R[H.bucketInstanceId],_,H.bucketIndex,H.sourceLayerIndex,T.filter,T.layers,T.availableImages,f);for(const re in Q){const V=U[re]=U[re]||[],oe=Q[re];oe.sort((ne,de)=>{const fe=H.featureSortOrder;if(fe){const we=fe.indexOf(ne.featureIndex);return fe.indexOf(de.featureIndex)-we}return de.featureIndex-ne.featureIndex});for(const ne of oe)V.push(ne)}}for(const H in U)U[H].forEach(Q=>{const re=Q.feature,V=y[f[H].source].getFeatureState(re.layer["source-layer"],re.id);re.source=re.layer.source,re.layer["source-layer"]&&(re.sourceLayer=re.layer["source-layer"]),re.state=V});return U}(this._layers,this._serializedLayers,this.sourceCaches,t,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(p)}querySourceFeatures(t,n){n&&n.filter&&this._validate(a.validateStyle.filter,"querySourceFeatures.filter",n.filter,null,n);const o=this.sourceCaches[t];return o?function(u,p){const f=u.getRenderableIds().map(v=>u.getTileByID(v)),_=[],y={};for(let v=0;v<f.length;v++){const T=f[v],I=T.tileID.canonical.key;y[I]||(y[I]=!0,T.querySourceFeatures(_,p))}return _}(o,n):[]}addSourceType(t,n,o){return vi.getSourceType(t)?o(new Error(`A source type called "${t}" already exists.`)):(vi.setSourceType(t,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:n.workerSourceURL},o):o(null,null))}getLight(){return this.light.getLight()}setLight(t,n={}){this._checkLoaded();const o=this.light.getLight();let u=!1;for(const f in t)if(!pe(t[f],o[f])){u=!0;break}if(!u)return;const p={now:a.exported.now(),transition:a.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,n),this.light.updateTransitions(p)}_validate(t,n,o,u,p={}){return(!p||p.validate!==!1)&&xt(this,t.call(a.validateStyle,a.extend({key:n,style:this.serialize(),value:o,styleSpec:a.spec},u)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this.sourceCaches){const n=this.sourceCaches[t];n.setEventedParent(null),n.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const n in this.sourceCaches)this.sourceCaches[n].update(t,this.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,n,o,u,p=!1){let f=!1,_=!1;const y={};for(const v of this._order){const T=this._layers[v];if(T.type!=="symbol")continue;if(!y[T.source]){const M=this.sourceCaches[T.source];y[T.source]=M.getRenderableIds(!0).map(U=>M.getTileByID(U)).sort((U,R)=>R.tileID.overscaledZ-U.tileID.overscaledZ||(U.tileID.isLessThan(R.tileID)?-1:1))}const I=this.crossTileSymbolIndex.addLayer(T,y[T.source],t.center.lng);f=f||I}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((p=p||this._layerOrderChanged||o===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.exported.now(),t.zoom))&&(this.pauseablePlacement=new ce(t,this.terrain,this._order,p,n,o,u,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,y),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.exported.now()),_=!0),f&&this.pauseablePlacement.placement.setStale()),_||f)for(const v of this._order){const T=this._layers[v];T.type==="symbol"&&this.placement.updateLayerOpacities(T,y[T.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.exported.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,n,o){this.imageManager.getImages(n.icons,o),this._updateTilesForChangedImages();const u=this.sourceCaches[n.source];u&&u.setDependencies(n.tileID.key,n.type,n.icons)}getGlyphs(t,n,o){this.glyphManager.getGlyphs(n.stacks,o)}getResource(t,n,o){return a.makeRequest(n,o)}}vi.getSourceType=function(l){return Ln[l]},vi.setSourceType=function(l,t){Ln[l]=t},vi.registerForPluginStateChange=a.registerForPluginStateChange;var Gn="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const gs={prelude:Rt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Rt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Rt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Rt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Rt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Rt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Rt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Rt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Rt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Rt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Rt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Rt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Rt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Rt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Rt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Rt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Rt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Rt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Rt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Rt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Rt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Rt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Rt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Rt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Rt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Rt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Rt("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Gn),terrainDepth:Rt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Gn),terrainCoords:Rt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Gn)};function Rt(l,t){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,o=t.match(/attribute ([\w]+) ([\w]+)/g),u=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),p=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),f=p?p.concat(u):u,_={};return{fragmentSource:l=l.replace(n,(y,v,T,I,M)=>(_[M]=!0,v==="define"?`
#ifndef HAS_UNIFORM_u_${M}
varying ${T} ${I} ${M};
#else
uniform ${T} ${I} u_${M};
#endif
`:`
#ifdef HAS_UNIFORM_u_${M}
    ${T} ${I} ${M} = u_${M};
#endif
`)),vertexSource:t=t.replace(n,(y,v,T,I,M)=>{const U=I==="float"?"vec2":"vec4",R=M.match(/color/)?"color":U;return _[M]?v==="define"?`
#ifndef HAS_UNIFORM_u_${M}
uniform lowp float u_${M}_t;
attribute ${T} ${U} a_${M};
varying ${T} ${I} ${M};
#else
uniform ${T} ${I} u_${M};
#endif
`:R==="vec4"?`
#ifndef HAS_UNIFORM_u_${M}
    ${M} = a_${M};
#else
    ${T} ${I} ${M} = u_${M};
#endif
`:`
#ifndef HAS_UNIFORM_u_${M}
    ${M} = unpack_mix_${R}(a_${M}, u_${M}_t);
#else
    ${T} ${I} ${M} = u_${M};
#endif
`:v==="define"?`
#ifndef HAS_UNIFORM_u_${M}
uniform lowp float u_${M}_t;
attribute ${T} ${U} a_${M};
#else
uniform ${T} ${I} u_${M};
#endif
`:R==="vec4"?`
#ifndef HAS_UNIFORM_u_${M}
    ${T} ${I} ${M} = a_${M};
#else
    ${T} ${I} ${M} = u_${M};
#endif
`:`
#ifndef HAS_UNIFORM_u_${M}
    ${T} ${I} ${M} = unpack_mix_${R}(a_${M}, u_${M}_t);
#else
    ${T} ${I} ${M} = u_${M};
#endif
`}),staticAttributes:o,staticUniforms:f}}class zo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,n,o,u,p,f,_,y,v){this.context=t;let T=this.boundPaintVertexBuffers.length!==u.length;for(let I=0;!T&&I<u.length;I++)this.boundPaintVertexBuffers[I]!==u[I]&&(T=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===n&&this.boundLayoutVertexBuffer===o&&!T&&this.boundIndexBuffer===p&&this.boundVertexOffset===f&&this.boundDynamicVertexBuffer===_&&this.boundDynamicVertexBuffer2===y&&this.boundDynamicVertexBuffer3===v?(t.bindVertexArrayOES.set(this.vao),_&&_.bind(),p&&p.dynamicDraw&&p.bind(),y&&y.bind(),v&&v.bind()):this.freshBind(n,o,u,p,f,_,y,v)}freshBind(t,n,o,u,p,f,_,y){let v;const T=t.numAttributes,I=this.context,M=I.gl;if(I.extVertexArrayObject)this.vao&&this.destroy(),this.vao=I.extVertexArrayObject.createVertexArrayOES(),I.bindVertexArrayOES.set(this.vao),v=0,this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=o,this.boundIndexBuffer=u,this.boundVertexOffset=p,this.boundDynamicVertexBuffer=f,this.boundDynamicVertexBuffer2=_,this.boundDynamicVertexBuffer3=y;else{v=I.currentNumAttributes||0;for(let U=T;U<v;U++)M.disableVertexAttribArray(U)}n.enableAttributes(M,t);for(const U of o)U.enableAttributes(M,t);f&&f.enableAttributes(M,t),_&&_.enableAttributes(M,t),y&&y.enableAttributes(M,t),n.bind(),n.setVertexAttribPointers(M,t,p);for(const U of o)U.bind(),U.setVertexAttribPointers(M,t,p);f&&(f.bind(),f.setVertexAttribPointers(M,t,p)),u&&u.bind(),_&&(_.bind(),_.setVertexAttribPointers(M,t,p)),y&&(y.bind(),y.setVertexAttribPointers(M,t,p)),I.currentNumAttributes=T}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Po(l){const t=[];for(let n=0;n<l.length;n++){if(l[n]===null)continue;const o=l[n].split(" ");t.push(o.pop())}return t}class Ua{constructor(t,n,o,u,p,f,_){const y=t.gl;this.program=y.createProgram();const v=Po(o.staticAttributes),T=u?u.getBinderAttributes():[],I=v.concat(T),M=gs.prelude.staticUniforms?Po(gs.prelude.staticUniforms):[],U=o.staticUniforms?Po(o.staticUniforms):[],R=u?u.getBinderUniforms():[],O=M.concat(U).concat(R),H=[];for(const fe of O)H.indexOf(fe)<0&&H.push(fe);const Q=u?u.defines():[];f&&Q.push("#define OVERDRAW_INSPECTOR;"),_&&Q.push("#define TERRAIN3D;");const re=Q.concat(gs.prelude.fragmentSource,o.fragmentSource).join(`
`),V=Q.concat(gs.prelude.vertexSource,o.vertexSource).join(`
`),oe=y.createShader(y.FRAGMENT_SHADER);if(y.isContextLost())return void(this.failedToCreate=!0);y.shaderSource(oe,re),y.compileShader(oe),y.attachShader(this.program,oe);const ne=y.createShader(y.VERTEX_SHADER);if(y.isContextLost())return void(this.failedToCreate=!0);y.shaderSource(ne,V),y.compileShader(ne),y.attachShader(this.program,ne),this.attributes={};const de={};this.numAttributes=I.length;for(let fe=0;fe<this.numAttributes;fe++)I[fe]&&(y.bindAttribLocation(this.program,fe,I[fe]),this.attributes[I[fe]]=fe);y.linkProgram(this.program),y.deleteShader(ne),y.deleteShader(oe);for(let fe=0;fe<H.length;fe++){const we=H[fe];if(we&&!de[we]){const he=y.getUniformLocation(this.program,we);he&&(de[we]=he)}}this.fixedUniforms=p(t,de),this.terrainUniforms=((fe,we)=>({u_depth:new a.Uniform1i(fe,we.u_depth),u_terrain:new a.Uniform1i(fe,we.u_terrain),u_terrain_dim:new a.Uniform1f(fe,we.u_terrain_dim),u_terrain_matrix:new a.UniformMatrix4f(fe,we.u_terrain_matrix),u_terrain_unpack:new a.Uniform4f(fe,we.u_terrain_unpack),u_terrain_offset:new a.Uniform1f(fe,we.u_terrain_offset),u_terrain_exaggeration:new a.Uniform1f(fe,we.u_terrain_exaggeration)}))(t,de),this.binderUniforms=u?u.getUniforms(t,de):[]}draw(t,n,o,u,p,f,_,y,v,T,I,M,U,R,O,H,Q,re){const V=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(o),t.setStencilMode(u),t.setColorMode(p),t.setCullFace(f),y){t.activeTexture.set(V.TEXTURE2),V.bindTexture(V.TEXTURE_2D,y.depthTexture),t.activeTexture.set(V.TEXTURE3),V.bindTexture(V.TEXTURE_2D,y.texture);for(const ne in this.terrainUniforms)this.terrainUniforms[ne].set(y[ne])}for(const ne in this.fixedUniforms)this.fixedUniforms[ne].set(_[ne]);O&&O.setUniforms(t,this.binderUniforms,U,{zoom:R});let oe=0;switch(n){case V.LINES:oe=2;break;case V.TRIANGLES:oe=3;break;case V.LINE_STRIP:oe=1}for(const ne of M.get()){const de=ne.vaos||(ne.vaos={});(de[v]||(de[v]=new zo)).bind(t,this,T,O?O.getPaintVertexBuffers():[],I,ne.vertexOffset,H,Q,re),V.drawElements(n,ne.primitiveLength*oe,V.UNSIGNED_SHORT,ne.primitiveOffset*oe*2)}}}function Va(l,t,n){const o=1/ti(n,1,t.transform.tileZoom),u=Math.pow(2,n.tileID.overscaledZ),p=n.tileSize*Math.pow(2,t.transform.tileZoom)/u,f=p*(n.tileID.canonical.x+n.tileID.wrap*u),_=p*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[o,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[f>>16,_>>16],u_pixel_coord_lower:[65535&f,65535&_]}}const Do=(l,t,n,o)=>{const u=t.style.light,p=u.properties.get("position"),f=[p.x,p.y,p.z],_=a.create$1();u.properties.get("anchor")==="viewport"&&a.fromRotation(_,-t.transform.angle),a.transformMat3(f,f,_);const y=u.properties.get("color");return{u_matrix:l,u_lightpos:f,u_lightintensity:u.properties.get("intensity"),u_lightcolor:[y.r,y.g,y.b],u_vertical_gradient:+n,u_opacity:o}},nc=(l,t,n,o,u,p,f)=>a.extend(Do(l,t,n,o),Va(p,t,f),{u_height_factor:-Math.pow(2,u.overscaledZ)/f.tileSize/8}),Xs=l=>({u_matrix:l}),Lo=(l,t,n,o)=>a.extend(Xs(l),Va(n,t,o)),Na=(l,t)=>({u_matrix:l,u_world:t}),$a=(l,t,n,o,u)=>a.extend(Lo(l,t,n,o),{u_world:u}),qa=(l,t,n,o)=>{const u=l.transform;let p,f;if(o.paint.get("circle-pitch-alignment")==="map"){const _=ti(n,1,u.zoom);p=!0,f=[_,_]}else p=!1,f=u.pixelsToGLUnits;return{u_camera_to_center_distance:u.cameraToCenterDistance,u_scale_with_map:+(o.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(t.posMatrix,n,o.paint.get("circle-translate"),o.paint.get("circle-translate-anchor")),u_pitch_with_map:+p,u_device_pixel_ratio:l.pixelRatio,u_extrude_scale:f}},gn=(l,t,n)=>{const o=ti(n,1,t.zoom),u=Math.pow(2,t.zoom-n.tileID.overscaledZ),p=n.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:o,u_extrude_scale:[t.pixelsToGLUnits[0]/(o*u),t.pixelsToGLUnits[1]/(o*u)],u_overscale_factor:p}},_s=(l,t,n=1)=>({u_matrix:l,u_color:t,u_overlay:0,u_overlay_scale:n}),Zn=l=>({u_matrix:l}),Ws=(l,t,n,o)=>({u_matrix:l,u_extrude_scale:ti(t,1,n),u_intensity:o});function Hs(l,t){const n=Math.pow(2,t.canonical.z),o=t.canonical.y;return[new a.MercatorCoordinate(0,o/n).toLngLat().lat,new a.MercatorCoordinate(0,(o+1)/n).toLngLat().lat]}const jn=(l,t,n,o)=>{const u=l.transform;return{u_matrix:xs(l,t,n,o),u_ratio:1/ti(t,1,u.zoom),u_device_pixel_ratio:l.pixelRatio,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},Bo=(l,t,n,o,u)=>a.extend(jn(l,t,n,u),{u_image:0,u_image_height:o}),Ks=(l,t,n,o,u)=>{const p=l.transform,f=$t(t,p);return{u_matrix:xs(l,t,n,u),u_texsize:t.imageAtlasTexture.size,u_ratio:1/ti(t,1,p.zoom),u_device_pixel_ratio:l.pixelRatio,u_image:0,u_scale:[f,o.fromScale,o.toScale],u_fade:o.t,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},ys=(l,t,n,o,u,p)=>{const f=l.lineAtlas,_=$t(t,l.transform),y=n.layout.get("line-cap")==="round",v=f.getDash(o.from,y),T=f.getDash(o.to,y),I=v.width*u.fromScale,M=T.width*u.toScale;return a.extend(jn(l,t,n,p),{u_patternscale_a:[_/I,-v.height/2],u_patternscale_b:[_/M,-T.height/2],u_sdfgamma:f.width/(256*Math.min(I,M)*l.pixelRatio)/2,u_image:0,u_tex_y_a:v.y,u_tex_y_b:T.y,u_mix:u.t})};function $t(l,t){return 1/ti(l,1,t.tileZoom)}function xs(l,t,n,o){return l.translatePosMatrix(o?o.posMatrix:t.tileID.posMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Ga=(l,t,n,o,u)=>{return{u_matrix:l,u_tl_parent:t,u_scale_parent:n,u_buffer_scale:1,u_fade_t:o.mix,u_opacity:o.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(f=u.paint.get("raster-saturation"),f>0?1-1/(1.001-f):-f),u_contrast_factor:(p=u.paint.get("raster-contrast"),p>0?1/(1-p):1+p),u_spin_weights:Za(u.paint.get("raster-hue-rotate"))};var p,f};function Za(l){l*=Math.PI/180;const t=Math.sin(l),n=Math.cos(l);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const Ro=(l,t,n,o,u,p,f,_,y,v)=>{const T=u.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:T.cameraToCenterDistance,u_pitch:T.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:T.width/T.height,u_fade_change:u.options.fadeDuration?u.symbolFadeChange:1,u_matrix:p,u_label_plane_matrix:f,u_coord_matrix:_,u_is_text:+y,u_pitch_with_map:+o,u_texsize:v,u_texture:0}},Ys=(l,t,n,o,u,p,f,_,y,v,T)=>{const I=u.transform;return a.extend(Ro(l,t,n,o,u,p,f,_,y,v),{u_gamma_scale:o?Math.cos(I._pitch)*I.cameraToCenterDistance:1,u_device_pixel_ratio:u.pixelRatio,u_is_halo:+T})},ja=(l,t,n,o,u,p,f,_,y,v)=>a.extend(Ys(l,t,n,o,u,p,f,_,!0,y,!0),{u_texsize_icon:v,u_texture_icon:1}),sc=(l,t,n)=>({u_matrix:l,u_opacity:t,u_color:n}),oc=(l,t,n,o,u,p)=>a.extend(function(f,_,y,v){const T=y.imageManager.getPattern(f.from.toString()),I=y.imageManager.getPattern(f.to.toString()),{width:M,height:U}=y.imageManager.getPixelSize(),R=Math.pow(2,v.tileID.overscaledZ),O=v.tileSize*Math.pow(2,y.transform.tileZoom)/R,H=O*(v.tileID.canonical.x+v.tileID.wrap*R),Q=O*v.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:T.tl,u_pattern_br_a:T.br,u_pattern_tl_b:I.tl,u_pattern_br_b:I.br,u_texsize:[M,U],u_mix:_.t,u_pattern_size_a:T.displaySize,u_pattern_size_b:I.displaySize,u_scale_a:_.fromScale,u_scale_b:_.toScale,u_tile_units_to_pixels:1/ti(v,1,y.transform.tileZoom),u_pixel_coord_upper:[H>>16,Q>>16],u_pixel_coord_lower:[65535&H,65535&Q]}}(o,p,n,u),{u_matrix:l,u_opacity:t}),Fo={fillExtrusion:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_lightpos:new a.Uniform3f(l,t.u_lightpos),u_lightintensity:new a.Uniform1f(l,t.u_lightintensity),u_lightcolor:new a.Uniform3f(l,t.u_lightcolor),u_vertical_gradient:new a.Uniform1f(l,t.u_vertical_gradient),u_opacity:new a.Uniform1f(l,t.u_opacity)}),fillExtrusionPattern:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_lightpos:new a.Uniform3f(l,t.u_lightpos),u_lightintensity:new a.Uniform1f(l,t.u_lightintensity),u_lightcolor:new a.Uniform3f(l,t.u_lightcolor),u_vertical_gradient:new a.Uniform1f(l,t.u_vertical_gradient),u_height_factor:new a.Uniform1f(l,t.u_height_factor),u_image:new a.Uniform1i(l,t.u_image),u_texsize:new a.Uniform2f(l,t.u_texsize),u_pixel_coord_upper:new a.Uniform2f(l,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(l,t.u_pixel_coord_lower),u_scale:new a.Uniform3f(l,t.u_scale),u_fade:new a.Uniform1f(l,t.u_fade),u_opacity:new a.Uniform1f(l,t.u_opacity)}),fill:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix)}),fillPattern:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_image:new a.Uniform1i(l,t.u_image),u_texsize:new a.Uniform2f(l,t.u_texsize),u_pixel_coord_upper:new a.Uniform2f(l,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(l,t.u_pixel_coord_lower),u_scale:new a.Uniform3f(l,t.u_scale),u_fade:new a.Uniform1f(l,t.u_fade)}),fillOutline:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_world:new a.Uniform2f(l,t.u_world)}),fillOutlinePattern:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_world:new a.Uniform2f(l,t.u_world),u_image:new a.Uniform1i(l,t.u_image),u_texsize:new a.Uniform2f(l,t.u_texsize),u_pixel_coord_upper:new a.Uniform2f(l,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(l,t.u_pixel_coord_lower),u_scale:new a.Uniform3f(l,t.u_scale),u_fade:new a.Uniform1f(l,t.u_fade)}),circle:(l,t)=>({u_camera_to_center_distance:new a.Uniform1f(l,t.u_camera_to_center_distance),u_scale_with_map:new a.Uniform1i(l,t.u_scale_with_map),u_pitch_with_map:new a.Uniform1i(l,t.u_pitch_with_map),u_extrude_scale:new a.Uniform2f(l,t.u_extrude_scale),u_device_pixel_ratio:new a.Uniform1f(l,t.u_device_pixel_ratio),u_matrix:new a.UniformMatrix4f(l,t.u_matrix)}),collisionBox:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_camera_to_center_distance:new a.Uniform1f(l,t.u_camera_to_center_distance),u_pixels_to_tile_units:new a.Uniform1f(l,t.u_pixels_to_tile_units),u_extrude_scale:new a.Uniform2f(l,t.u_extrude_scale),u_overscale_factor:new a.Uniform1f(l,t.u_overscale_factor)}),collisionCircle:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_inv_matrix:new a.UniformMatrix4f(l,t.u_inv_matrix),u_camera_to_center_distance:new a.Uniform1f(l,t.u_camera_to_center_distance),u_viewport_size:new a.Uniform2f(l,t.u_viewport_size)}),debug:(l,t)=>({u_color:new a.UniformColor(l,t.u_color),u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_overlay:new a.Uniform1i(l,t.u_overlay),u_overlay_scale:new a.Uniform1f(l,t.u_overlay_scale)}),clippingMask:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix)}),heatmap:(l,t)=>({u_extrude_scale:new a.Uniform1f(l,t.u_extrude_scale),u_intensity:new a.Uniform1f(l,t.u_intensity),u_matrix:new a.UniformMatrix4f(l,t.u_matrix)}),heatmapTexture:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_world:new a.Uniform2f(l,t.u_world),u_image:new a.Uniform1i(l,t.u_image),u_color_ramp:new a.Uniform1i(l,t.u_color_ramp),u_opacity:new a.Uniform1f(l,t.u_opacity)}),hillshade:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_image:new a.Uniform1i(l,t.u_image),u_latrange:new a.Uniform2f(l,t.u_latrange),u_light:new a.Uniform2f(l,t.u_light),u_shadow:new a.UniformColor(l,t.u_shadow),u_highlight:new a.UniformColor(l,t.u_highlight),u_accent:new a.UniformColor(l,t.u_accent)}),hillshadePrepare:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_image:new a.Uniform1i(l,t.u_image),u_dimension:new a.Uniform2f(l,t.u_dimension),u_zoom:new a.Uniform1f(l,t.u_zoom),u_unpack:new a.Uniform4f(l,t.u_unpack)}),line:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_ratio:new a.Uniform1f(l,t.u_ratio),u_device_pixel_ratio:new a.Uniform1f(l,t.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(l,t.u_units_to_pixels)}),lineGradient:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_ratio:new a.Uniform1f(l,t.u_ratio),u_device_pixel_ratio:new a.Uniform1f(l,t.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(l,t.u_units_to_pixels),u_image:new a.Uniform1i(l,t.u_image),u_image_height:new a.Uniform1f(l,t.u_image_height)}),linePattern:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_texsize:new a.Uniform2f(l,t.u_texsize),u_ratio:new a.Uniform1f(l,t.u_ratio),u_device_pixel_ratio:new a.Uniform1f(l,t.u_device_pixel_ratio),u_image:new a.Uniform1i(l,t.u_image),u_units_to_pixels:new a.Uniform2f(l,t.u_units_to_pixels),u_scale:new a.Uniform3f(l,t.u_scale),u_fade:new a.Uniform1f(l,t.u_fade)}),lineSDF:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_ratio:new a.Uniform1f(l,t.u_ratio),u_device_pixel_ratio:new a.Uniform1f(l,t.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(l,t.u_units_to_pixels),u_patternscale_a:new a.Uniform2f(l,t.u_patternscale_a),u_patternscale_b:new a.Uniform2f(l,t.u_patternscale_b),u_sdfgamma:new a.Uniform1f(l,t.u_sdfgamma),u_image:new a.Uniform1i(l,t.u_image),u_tex_y_a:new a.Uniform1f(l,t.u_tex_y_a),u_tex_y_b:new a.Uniform1f(l,t.u_tex_y_b),u_mix:new a.Uniform1f(l,t.u_mix)}),raster:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_tl_parent:new a.Uniform2f(l,t.u_tl_parent),u_scale_parent:new a.Uniform1f(l,t.u_scale_parent),u_buffer_scale:new a.Uniform1f(l,t.u_buffer_scale),u_fade_t:new a.Uniform1f(l,t.u_fade_t),u_opacity:new a.Uniform1f(l,t.u_opacity),u_image0:new a.Uniform1i(l,t.u_image0),u_image1:new a.Uniform1i(l,t.u_image1),u_brightness_low:new a.Uniform1f(l,t.u_brightness_low),u_brightness_high:new a.Uniform1f(l,t.u_brightness_high),u_saturation_factor:new a.Uniform1f(l,t.u_saturation_factor),u_contrast_factor:new a.Uniform1f(l,t.u_contrast_factor),u_spin_weights:new a.Uniform3f(l,t.u_spin_weights)}),symbolIcon:(l,t)=>({u_is_size_zoom_constant:new a.Uniform1i(l,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(l,t.u_is_size_feature_constant),u_size_t:new a.Uniform1f(l,t.u_size_t),u_size:new a.Uniform1f(l,t.u_size),u_camera_to_center_distance:new a.Uniform1f(l,t.u_camera_to_center_distance),u_pitch:new a.Uniform1f(l,t.u_pitch),u_rotate_symbol:new a.Uniform1i(l,t.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(l,t.u_aspect_ratio),u_fade_change:new a.Uniform1f(l,t.u_fade_change),u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(l,t.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(l,t.u_coord_matrix),u_is_text:new a.Uniform1i(l,t.u_is_text),u_pitch_with_map:new a.Uniform1i(l,t.u_pitch_with_map),u_texsize:new a.Uniform2f(l,t.u_texsize),u_texture:new a.Uniform1i(l,t.u_texture)}),symbolSDF:(l,t)=>({u_is_size_zoom_constant:new a.Uniform1i(l,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(l,t.u_is_size_feature_constant),u_size_t:new a.Uniform1f(l,t.u_size_t),u_size:new a.Uniform1f(l,t.u_size),u_camera_to_center_distance:new a.Uniform1f(l,t.u_camera_to_center_distance),u_pitch:new a.Uniform1f(l,t.u_pitch),u_rotate_symbol:new a.Uniform1i(l,t.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(l,t.u_aspect_ratio),u_fade_change:new a.Uniform1f(l,t.u_fade_change),u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(l,t.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(l,t.u_coord_matrix),u_is_text:new a.Uniform1i(l,t.u_is_text),u_pitch_with_map:new a.Uniform1i(l,t.u_pitch_with_map),u_texsize:new a.Uniform2f(l,t.u_texsize),u_texture:new a.Uniform1i(l,t.u_texture),u_gamma_scale:new a.Uniform1f(l,t.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(l,t.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(l,t.u_is_halo)}),symbolTextAndIcon:(l,t)=>({u_is_size_zoom_constant:new a.Uniform1i(l,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(l,t.u_is_size_feature_constant),u_size_t:new a.Uniform1f(l,t.u_size_t),u_size:new a.Uniform1f(l,t.u_size),u_camera_to_center_distance:new a.Uniform1f(l,t.u_camera_to_center_distance),u_pitch:new a.Uniform1f(l,t.u_pitch),u_rotate_symbol:new a.Uniform1i(l,t.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(l,t.u_aspect_ratio),u_fade_change:new a.Uniform1f(l,t.u_fade_change),u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(l,t.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(l,t.u_coord_matrix),u_is_text:new a.Uniform1i(l,t.u_is_text),u_pitch_with_map:new a.Uniform1i(l,t.u_pitch_with_map),u_texsize:new a.Uniform2f(l,t.u_texsize),u_texsize_icon:new a.Uniform2f(l,t.u_texsize_icon),u_texture:new a.Uniform1i(l,t.u_texture),u_texture_icon:new a.Uniform1i(l,t.u_texture_icon),u_gamma_scale:new a.Uniform1f(l,t.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(l,t.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(l,t.u_is_halo)}),background:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_opacity:new a.Uniform1f(l,t.u_opacity),u_color:new a.UniformColor(l,t.u_color)}),backgroundPattern:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_opacity:new a.Uniform1f(l,t.u_opacity),u_image:new a.Uniform1i(l,t.u_image),u_pattern_tl_a:new a.Uniform2f(l,t.u_pattern_tl_a),u_pattern_br_a:new a.Uniform2f(l,t.u_pattern_br_a),u_pattern_tl_b:new a.Uniform2f(l,t.u_pattern_tl_b),u_pattern_br_b:new a.Uniform2f(l,t.u_pattern_br_b),u_texsize:new a.Uniform2f(l,t.u_texsize),u_mix:new a.Uniform1f(l,t.u_mix),u_pattern_size_a:new a.Uniform2f(l,t.u_pattern_size_a),u_pattern_size_b:new a.Uniform2f(l,t.u_pattern_size_b),u_scale_a:new a.Uniform1f(l,t.u_scale_a),u_scale_b:new a.Uniform1f(l,t.u_scale_b),u_pixel_coord_upper:new a.Uniform2f(l,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(l,t.u_pixel_coord_lower),u_tile_units_to_pixels:new a.Uniform1f(l,t.u_tile_units_to_pixels)}),terrain:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_texture:new a.Uniform1i(l,t.u_texture)}),terrainDepth:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix)}),terrainCoords:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_texture:new a.Uniform1i(l,t.u_texture),u_terrain_coords_id:new a.Uniform1f(l,t.u_terrain_coords_id)})};class Oo{constructor(t,n,o){this.context=t;const u=t.gl;this.buffer=u.createBuffer(),this.dynamicDraw=Boolean(o),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Uo={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Vo{constructor(t,n,o,u){this.length=n.length,this.attributes=o,this.itemSize=n.bytesPerElement,this.dynamicDraw=u,this.context=t;const p=t.gl;this.buffer=p.createBuffer(),t.bindVertexBuffer.set(this.buffer),p.bufferData(p.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let o=0;o<this.attributes.length;o++){const u=n.attributes[this.attributes[o].name];u!==void 0&&t.enableVertexAttribArray(u)}}setVertexAttribPointers(t,n,o){for(let u=0;u<this.attributes.length;u++){const p=this.attributes[u],f=n.attributes[p.name];f!==void 0&&t.vertexAttribPointer(f,p.components,t[Uo[p.type]],!1,this.itemSize,p.offset+this.itemSize*(o||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Et{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Xa extends Et{getDefault(){return a.Color.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ac extends Et{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class vs extends Et{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class bs extends Et{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Wa extends Et{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Vi extends Et{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class No extends Et{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Js extends Et{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Qs extends Et{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class $o extends Et{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class qo extends Et{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class eo extends Et{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Go extends Et{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class Zo extends Et{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class to extends Et{getDefault(){return a.Color.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ha extends Et{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Ka extends Et{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class Xn extends Et{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class lc extends Et{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class cc extends Et{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class uc extends Et{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class hc extends Et{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class pc extends Et{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class dc extends Et{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class jo extends Et{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class io extends Et{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Xo extends Et{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Wo extends Et{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class Wn extends Et{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Ya extends Et{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Ja extends Et{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class ro extends Et{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class _n extends ro{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Qa extends ro{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Hn{constructor(t,n,o,u){this.context=t,this.width=n,this.height=o;const p=t.gl,f=this.framebuffer=p.createFramebuffer();if(this.colorAttachment=new _n(t,f),u&&(this.depthAttachment=new Qa(t,f)),p.checkFramebufferStatus(p.FRAMEBUFFER)!==p.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,n=this.colorAttachment.get();if(n&&t.deleteTexture(n),this.depthAttachment){const o=this.depthAttachment.get();o&&t.deleteRenderbuffer(o)}t.deleteFramebuffer(this.framebuffer)}}class Ut{constructor(t,n,o){this.blendFunction=t,this.blendColor=n,this.mask=o}}Ut.Replace=[1,0],Ut.disabled=new Ut(Ut.Replace,a.Color.transparent,[!1,!1,!1,!1]),Ut.unblended=new Ut(Ut.Replace,a.Color.transparent,[!0,!0,!0,!0]),Ut.alphaBlended=new Ut([1,771],a.Color.transparent,[!0,!0,!0,!0]);class el{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Xa(this),this.clearDepth=new ac(this),this.clearStencil=new vs(this),this.colorMask=new bs(this),this.depthMask=new Wa(this),this.stencilMask=new Vi(this),this.stencilFunc=new No(this),this.stencilOp=new Js(this),this.stencilTest=new Qs(this),this.depthRange=new $o(this),this.depthTest=new qo(this),this.depthFunc=new eo(this),this.blend=new Go(this),this.blendFunc=new Zo(this),this.blendColor=new to(this),this.blendEquation=new Ha(this),this.cullFace=new Ka(this),this.cullFaceSide=new Xn(this),this.frontFace=new lc(this),this.program=new cc(this),this.activeTexture=new uc(this),this.viewport=new hc(this),this.bindFramebuffer=new pc(this),this.bindRenderbuffer=new dc(this),this.bindTexture=new jo(this),this.bindVertexBuffer=new io(this),this.bindElementBuffer=new Xo(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Wo(this),this.pixelStoreUnpack=new Wn(this),this.pixelStoreUnpackPremultiplyAlpha=new Ya(this),this.pixelStoreUnpackFlipY=new Ja(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n){return new Oo(this,t,n)}createVertexBuffer(t,n,o){return new Vo(this,t,n,o)}createRenderbuffer(t,n,o){const u=this.gl,p=u.createRenderbuffer();return this.bindRenderbuffer.set(p),u.renderbufferStorage(u.RENDERBUFFER,t,n,o),this.bindRenderbuffer.set(null),p}createFramebuffer(t,n,o){return new Hn(this,t,n,o)}clear({color:t,depth:n}){const o=this.gl;let u=0;t&&(u|=o.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(u|=o.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),o.clear(u)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){pe(t.blendFunction,Ut.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ft{constructor(t,n,o){this.func=t,this.mask=n,this.range=o}}ft.ReadOnly=!1,ft.ReadWrite=!0,ft.disabled=new ft(519,ft.ReadOnly,[0,1]);const St=7680;class Ot{constructor(t,n,o,u,p,f){this.test=t,this.ref=n,this.mask=o,this.fail=u,this.depthFail=p,this.pass=f}}Ot.disabled=new Ot({func:519,mask:0},0,0,St,St,St);class qt{constructor(t,n,o){this.enable=t,this.mode=n,this.frontFace=o}}let ws;function Kn(l,t,n,o,u,p,f){const _=l.context,y=_.gl,v=l.useProgram("collisionBox"),T=[];let I=0,M=0;for(let V=0;V<o.length;V++){const oe=o[V],ne=t.getTile(oe),de=ne.getBucket(n);if(!de)continue;let fe=oe.posMatrix;u[0]===0&&u[1]===0||(fe=l.translatePosMatrix(oe.posMatrix,ne,u,p));const we=f?de.textCollisionBox:de.iconCollisionBox,he=de.collisionCircleArray;if(he.length>0){const Be=a.create(),Ae=fe;a.mul(Be,de.placementInvProjMatrix,l.transform.glCoordMatrix),a.mul(Be,Be,de.placementViewportMatrix),T.push({circleArray:he,circleOffset:M,transform:Ae,invTransform:Be,coord:oe}),I+=he.length/4,M=I}we&&v.draw(_,y.LINES,ft.disabled,Ot.disabled,l.colorModeForRenderPass(),qt.disabled,gn(fe,l.transform,ne),l.style.terrain&&l.style.terrain.getTerrainData(oe),n.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,null,l.transform.zoom,null,null,we.collisionVertexBuffer)}if(!f||!T.length)return;const U=l.useProgram("collisionCircle"),R=new a.CollisionCircleLayoutArray;R.resize(4*I),R._trim();let O=0;for(const V of T)for(let oe=0;oe<V.circleArray.length/4;oe++){const ne=4*oe,de=V.circleArray[ne+0],fe=V.circleArray[ne+1],we=V.circleArray[ne+2],he=V.circleArray[ne+3];R.emplace(O++,de,fe,we,he,0),R.emplace(O++,de,fe,we,he,1),R.emplace(O++,de,fe,we,he,2),R.emplace(O++,de,fe,we,he,3)}(!ws||ws.length<2*I)&&(ws=function(V){const oe=2*V,ne=new a.QuadTriangleArray;ne.resize(oe),ne._trim();for(let de=0;de<oe;de++){const fe=6*de;ne.uint16[fe+0]=4*de+0,ne.uint16[fe+1]=4*de+1,ne.uint16[fe+2]=4*de+2,ne.uint16[fe+3]=4*de+2,ne.uint16[fe+4]=4*de+3,ne.uint16[fe+5]=4*de+0}return ne}(I));const H=_.createIndexBuffer(ws,!0),Q=_.createVertexBuffer(R,a.collisionCircleLayout.members,!0);for(const V of T){const oe={u_matrix:V.transform,u_inv_matrix:V.invTransform,u_camera_to_center_distance:(re=l.transform).cameraToCenterDistance,u_viewport_size:[re.width,re.height]};U.draw(_,y.TRIANGLES,ft.disabled,Ot.disabled,l.colorModeForRenderPass(),qt.disabled,oe,l.style.terrain&&l.style.terrain.getTerrainData(V.coord),n.id,Q,H,a.SegmentVector.simpleSegment(0,2*V.circleOffset,V.circleArray.length,V.circleArray.length/2),null,l.transform.zoom,null,null,null)}var re;Q.destroy(),H.destroy()}qt.disabled=new qt(!1,1029,2305),qt.backCCW=new qt(!0,1029,2305);const fc=a.identity(new Float32Array(16));function mc(l,t,n,o,u,p){const{horizontalAlign:f,verticalAlign:_}=a.getAnchorAlignment(l),y=-(f-.5)*t,v=-(_-.5)*n,T=a.evaluateVariableOffset(l,o);return new a.pointGeometry((y/u+T[0])*p,(v/u+T[1])*p)}function tl(l,t,n,o,u,p,f,_,y,v,T){const I=l.text.placedSymbolArray,M=l.text.dynamicLayoutVertexArray,U=l.icon.dynamicLayoutVertexArray,R={};M.clear();for(let O=0;O<I.length;O++){const H=I.get(O),Q=l.allowVerticalPlacement&&!H.placedOrientation,re=H.hidden||!H.crossTileID||Q?null:o[H.crossTileID];if(re){const V=new a.pointGeometry(H.anchorX,H.anchorY),oe=_t(V,n?f:p,T),ne=Ji(u.cameraToCenterDistance,oe.signedDistanceFromCamera);let de=a.evaluateSizeForFeature(l.textSizeData,y,H)*ne/a.ONE_EM;n&&(de*=l.tilePixelRatio/_);const{width:fe,height:we,anchor:he,textOffset:Be,textBoxScale:Ae}=re,Re=mc(he,fe,we,Be,Ae,de),rt=n?_t(V.add(Re),p,T).point:oe.point.add(t?Re.rotate(-u.angle):Re),lt=l.allowVerticalPlacement&&H.placedOrientation===a.WritingMode.vertical?Math.PI/2:0;for(let je=0;je<H.numGlyphs;je++)a.addDynamicAttributes(M,rt,lt);v&&H.associatedIconIndex>=0&&(R[H.associatedIconIndex]={shiftedAnchor:rt,angle:lt})}else et(H.numGlyphs,M)}if(v){U.clear();const O=l.icon.placedSymbolArray;for(let H=0;H<O.length;H++){const Q=O.get(H);if(Q.hidden)et(Q.numGlyphs,U);else{const re=R[H];if(re)for(let V=0;V<Q.numGlyphs;V++)a.addDynamicAttributes(U,re.shiftedAnchor,re.angle);else et(Q.numGlyphs,U)}}l.icon.dynamicLayoutVertexBuffer.updateData(U)}l.text.dynamicLayoutVertexBuffer.updateData(M)}function gc(l,t,n){return n.iconsInText&&t?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function no(l,t,n,o,u,p,f,_,y,v,T,I){const M=l.context,U=M.gl,R=l.transform,O=_==="map",H=y==="map",Q=_!=="viewport"&&n.layout.get("symbol-placement")!=="point",re=O&&!H&&!Q,V=!n.layout.get("symbol-sort-key").isConstant();let oe=!1;const ne=l.depthModeForSublayer(0,ft.ReadOnly),de=n.layout.get("text-variable-anchor"),fe=[];for(const we of o){const he=t.getTile(we),Be=he.getBucket(n);if(!Be)continue;const Ae=u?Be.text:Be.icon;if(!Ae||!Ae.segments.get().length)continue;const Re=Ae.programConfigurations.get(n.id),rt=u||Be.sdfIcons,lt=u?Be.textSizeData:Be.iconSizeData,je=H||R.pitch!==0,kt=l.useProgram(gc(rt,u,Be),Re),Mt=a.evaluateSizeForZoom(lt,R.zoom),mt=l.style.terrain&&l.style.terrain.getTerrainData(we);let vt,Pt,hi,vr,ur=[0,0],br=null;if(u){if(Pt=he.glyphAtlasTexture,hi=U.LINEAR,vt=he.glyphAtlasTexture.size,Be.iconsInText){ur=he.imageAtlasTexture.size,br=he.imageAtlasTexture;const tr=lt.kind==="composite"||lt.kind==="camera";vr=je||l.options.rotating||l.options.zooming||tr?U.LINEAR:U.NEAREST}}else{const tr=n.layout.get("icon-size").constantOr(0)!==1||Be.iconsNeedLinear;Pt=he.imageAtlasTexture,hi=rt||l.options.rotating||l.options.zooming||tr||je?U.LINEAR:U.NEAREST,vt=he.imageAtlasTexture.size}const nn=ti(he,1,l.transform.zoom),er=pn(we.posMatrix,H,O,l.transform,nn),Di=lr(we.posMatrix,H,O,l.transform,nn),Dr=de&&Be.hasTextData(),po=n.layout.get("icon-text-fit")!=="none"&&Dr&&Be.hasIconData();if(Q){const tr=l.style.terrain?(ca,is)=>l.style.terrain.getElevation(we,ca,is):null,bn=n.layout.get("text-rotation-alignment")==="map";Ui(Be,we.posMatrix,l,u,er,Di,H,v,bn,tr)}const oi=l.translatePosMatrix(we.posMatrix,he,p,f),pt=Q||u&&de||po?fc:er,Ct=l.translatePosMatrix(Di,he,p,f,!0),pi=rt&&n.paint.get(u?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let di;di=rt?Be.iconsInText?ja(lt.kind,Mt,re,H,l,oi,pt,Ct,vt,ur):Ys(lt.kind,Mt,re,H,l,oi,pt,Ct,u,vt,!0):Ro(lt.kind,Mt,re,H,l,oi,pt,Ct,u,vt);const Zt={program:kt,buffers:Ae,uniformValues:di,atlasTexture:Pt,atlasTextureIcon:br,atlasInterpolation:hi,atlasInterpolationIcon:vr,isSDF:rt,hasHalo:pi};if(V&&Be.canOverlap){oe=!0;const tr=Ae.segments.get();for(const bn of tr)fe.push({segments:new a.SegmentVector([bn]),sortKey:bn.sortKey,state:Zt,terrainData:mt})}else fe.push({segments:Ae.segments,sortKey:0,state:Zt,terrainData:mt})}oe&&fe.sort((we,he)=>we.sortKey-he.sortKey);for(const we of fe){const he=we.state;if(M.activeTexture.set(U.TEXTURE0),he.atlasTexture.bind(he.atlasInterpolation,U.CLAMP_TO_EDGE),he.atlasTextureIcon&&(M.activeTexture.set(U.TEXTURE1),he.atlasTextureIcon&&he.atlasTextureIcon.bind(he.atlasInterpolationIcon,U.CLAMP_TO_EDGE)),he.isSDF){const Be=he.uniformValues;he.hasHalo&&(Be.u_is_halo=1,Ts(he.buffers,we.segments,n,l,he.program,ne,T,I,Be,we.terrainData)),Be.u_is_halo=0}Ts(he.buffers,we.segments,n,l,he.program,ne,T,I,he.uniformValues,we.terrainData)}}function Ts(l,t,n,o,u,p,f,_,y,v){const T=o.context;u.draw(T,T.gl.TRIANGLES,p,f,_,qt.disabled,y,v,n.id,l.layoutVertexBuffer,l.indexBuffer,t,n.paint,o.transform.zoom,l.programConfigurations.get(n.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function Es(l,t,n,o,u,p,f){const _=l.context.gl,y=n.paint.get("fill-pattern"),v=y&&y.constantOr(1),T=n.getCrossfadeParameters();let I,M,U,R,O;f?(M=v&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",I=_.LINES):(M=v?"fillPattern":"fill",I=_.TRIANGLES);for(const H of o){const Q=t.getTile(H);if(v&&!Q.patternsLoaded())continue;const re=Q.getBucket(n);if(!re)continue;const V=re.programConfigurations.get(n.id),oe=l.useProgram(M,V),ne=l.style.terrain&&l.style.terrain.getTerrainData(H);v&&(l.context.activeTexture.set(_.TEXTURE0),Q.imageAtlasTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),V.updatePaintBuffers(T));const de=y.constantOr(null);if(de&&Q.imageAtlas){const he=Q.imageAtlas,Be=he.patternPositions[de.to.toString()],Ae=he.patternPositions[de.from.toString()];Be&&Ae&&V.setConstantPatternPositions(Be,Ae)}const fe=ne?H:null,we=l.translatePosMatrix(fe?fe.posMatrix:H.posMatrix,Q,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(f){R=re.indexBuffer2,O=re.segments2;const he=[_.drawingBufferWidth,_.drawingBufferHeight];U=M==="fillOutlinePattern"&&v?$a(we,l,T,Q,he):Na(we,he)}else R=re.indexBuffer,O=re.segments,U=v?Lo(we,l,T,Q):Xs(we);oe.draw(l.context,I,u,l.stencilModeForClipping(H),p,qt.disabled,U,ne,n.id,re.layoutVertexBuffer,R,O,n.paint,l.transform.zoom,V)}}function Ss(l,t,n,o,u,p,f){const _=l.context,y=_.gl,v=n.paint.get("fill-extrusion-pattern"),T=v.constantOr(1),I=n.getCrossfadeParameters(),M=n.paint.get("fill-extrusion-opacity");for(const U of o){const R=t.getTile(U),O=R.getBucket(n);if(!O)continue;const H=l.style.terrain&&l.style.terrain.getTerrainData(U),Q=O.programConfigurations.get(n.id),re=l.useProgram(T?"fillExtrusionPattern":"fillExtrusion",Q);T&&(l.context.activeTexture.set(y.TEXTURE0),R.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),Q.updatePaintBuffers(I));const V=v.constantOr(null);if(V&&R.imageAtlas){const fe=R.imageAtlas,we=fe.patternPositions[V.to.toString()],he=fe.patternPositions[V.from.toString()];we&&he&&Q.setConstantPatternPositions(we,he)}const oe=l.translatePosMatrix(U.posMatrix,R,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),ne=n.paint.get("fill-extrusion-vertical-gradient"),de=T?nc(oe,l,ne,M,U,I,R):Do(oe,l,ne,M);re.draw(_,_.gl.TRIANGLES,u,p,f,qt.backCCW,de,H,n.id,O.layoutVertexBuffer,O.indexBuffer,O.segments,n.paint,l.transform.zoom,Q,l.style.terrain&&O.centroidVertexBuffer)}}function Ho(l,t,n,o,u,p,f){const _=l.context,y=_.gl,v=n.fbo;if(!v)return;const T=l.useProgram("hillshade"),I=l.style.terrain&&l.style.terrain.getTerrainData(t);_.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,v.colorAttachment.get()),T.draw(_,y.TRIANGLES,u,p,f,qt.disabled,((M,U,R,O)=>{const H=R.paint.get("hillshade-shadow-color"),Q=R.paint.get("hillshade-highlight-color"),re=R.paint.get("hillshade-accent-color");let V=R.paint.get("hillshade-illumination-direction")*(Math.PI/180);R.paint.get("hillshade-illumination-anchor")==="viewport"&&(V-=M.transform.angle);const oe=!M.options.moving;return{u_matrix:O?O.posMatrix:M.transform.calculatePosMatrix(U.tileID.toUnwrapped(),oe),u_image:0,u_latrange:Hs(0,U.tileID),u_light:[R.paint.get("hillshade-exaggeration"),V],u_shadow:H,u_highlight:Q,u_accent:re}})(l,n,o,I?t:null),I,o.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}function il(l,t,n,o,u,p){const f=l.context,_=f.gl,y=t.dem;if(y&&y.data){const v=y.dim,T=y.stride,I=y.getPixels();if(f.activeTexture.set(_.TEXTURE1),f.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||l.getTileTexture(T),t.demTexture){const U=t.demTexture;U.update(I,{premultiply:!1}),U.bind(_.NEAREST,_.CLAMP_TO_EDGE)}else t.demTexture=new be(f,I,_.RGBA,{premultiply:!1}),t.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);f.activeTexture.set(_.TEXTURE0);let M=t.fbo;if(!M){const U=new be(f,{width:v,height:v,data:null},_.RGBA);U.bind(_.LINEAR,_.CLAMP_TO_EDGE),M=t.fbo=f.createFramebuffer(v,v,!0),M.colorAttachment.set(U.texture)}f.bindFramebuffer.set(M.framebuffer),f.viewport.set([0,0,v,v]),l.useProgram("hillshadePrepare").draw(f,_.TRIANGLES,o,u,p,qt.disabled,((U,R)=>{const O=R.stride,H=a.create();return a.ortho(H,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate(H,H,[0,-a.EXTENT,0]),{u_matrix:H,u_image:1,u_dimension:[O,O],u_zoom:U.overscaledZ,u_unpack:R.getUnpackVector()}})(t.tileID,y),null,n.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function so(l,t,n,o,u,p){const f=o.paint.get("raster-fade-duration");if(!p&&f>0){const _=a.exported.now(),y=(_-l.timeAdded)/f,v=t?(_-t.timeAdded)/f:-1,T=n.getSource(),I=u.coveringZoomLevel({tileSize:T.tileSize,roundZoom:T.roundZoom}),M=!t||Math.abs(t.tileID.overscaledZ-I)>Math.abs(l.tileID.overscaledZ-I),U=M&&l.refreshedUponExpiration?1:a.clamp(M?y:1-v,0,1);return l.refreshedUponExpiration&&y>=1&&(l.refreshedUponExpiration=!1),t?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}const oo=new a.Color(1,0,0,1),cr=new a.Color(0,1,0,1),rl=new a.Color(0,0,1,1),Ko=new a.Color(1,0,1,1),nl=new a.Color(0,1,1,1);function yn(l,t,n,o){Yn(l,0,t+n/2,l.transform.width,n,o)}function Is(l,t,n,o){Yn(l,t-n/2,0,n,l.transform.height,o)}function Yn(l,t,n,o,u,p){const f=l.context,_=f.gl;_.enable(_.SCISSOR_TEST),_.scissor(t*l.pixelRatio,n*l.pixelRatio,o*l.pixelRatio,u*l.pixelRatio),f.clear({color:p}),_.disable(_.SCISSOR_TEST)}function _c(l,t,n){const o=l.context,u=o.gl,p=n.posMatrix,f=l.useProgram("debug"),_=ft.disabled,y=Ot.disabled,v=l.colorModeForRenderPass(),T="$debug",I=l.style.terrain&&l.style.terrain.getTerrainData(n);o.activeTexture.set(u.TEXTURE0),l.emptyTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE);const M=t.getTileByID(n.key).latestRawTileData,U=Math.floor((M&&M.byteLength||0)/1024),R=t.getTile(n).tileSize,O=512/Math.min(R,512)*(n.overscaledZ/l.transform.zoom)*.5;let H=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(H+=` => ${n.overscaledZ}`),function(Q,re){Q.initDebugOverlayCanvas();const V=Q.debugOverlayCanvas,oe=Q.context.gl,ne=Q.debugOverlayCanvas.getContext("2d");ne.clearRect(0,0,V.width,V.height),ne.shadowColor="white",ne.shadowBlur=2,ne.lineWidth=1.5,ne.strokeStyle="white",ne.textBaseline="top",ne.font="bold 36px Open Sans, sans-serif",ne.fillText(re,5,5),ne.strokeText(re,5,5),Q.debugOverlayTexture.update(V),Q.debugOverlayTexture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE)}(l,`${H} ${U}kB`),f.draw(o,u.TRIANGLES,_,y,Ut.alphaBlended,qt.disabled,_s(p,a.Color.transparent,O),null,T,l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments),f.draw(o,u.LINE_STRIP,_,y,v,qt.disabled,_s(p,a.Color.red),I,T,l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments)}function ao(l,t,n){const o=l.context,u=o.gl,p=l.colorModeForRenderPass(),f=new ft(u.LEQUAL,ft.ReadWrite,l.depthRangeFor3D),_=l.useProgram("terrain"),y=t.getTerrainMesh(),v=t.getTerrainData(n.tileID);o.bindFramebuffer.set(null),o.viewport.set([0,0,l.width,l.height]),o.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,t.getRTTFramebuffer().colorAttachment.get());const T=l.transform.calculatePosMatrix(n.tileID.toUnwrapped());_.draw(o,u.TRIANGLES,f,Ot.disabled,p,qt.backCCW,{u_matrix:T,u_texture:0},v,"terrain",y.vertexBuffer,y.indexBuffer,y.segments)}function sl(l,t,n,o){const u=l.context,p=n.tileSize*t.qualityFactor;n.textures[o]||(n.textures[o]=l.getTileTexture(p)||new be(u,{width:p,height:p,data:null},u.gl.RGBA),n.textures[o].bind(u.gl.LINEAR,u.gl.CLAMP_TO_EDGE),o===0&&t.sourceCache.renderHistory.unshift(n.tileID.key));const f=t.getRTTFramebuffer();f.colorAttachment.set(n.textures[o].texture),u.bindFramebuffer.set(f.framebuffer),u.viewport.set([0,0,p,p])}class ol{constructor(t){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=t,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=t.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const t=this.painter.style,n=t.terrain;for(const o in t.sourceCaches){this._coordsDescendingInv[o]={};const u=t.sourceCaches[o].getVisibleCoordinates();for(const p of u){const f=n.sourceCache.getTerrainCoords(p);for(const _ in f)this._coordsDescendingInv[o][_]||(this._coordsDescendingInv[o][_]=[]),this._coordsDescendingInv[o][_].push(f[_])}}for(const o of t._order){const u=t._layers[o],p=u.source;if(this._renderToTexture[u.type]&&!this._coordsDescendingInvStr[p]){this._coordsDescendingInvStr[p]={};for(const f in this._coordsDescendingInv[p])this._coordsDescendingInvStr[p][f]=this._coordsDescendingInv[p][f].map(_=>_.key).sort().join()}}return this._renderableTiles.forEach(o=>{for(const u in this._coordsDescendingInvStr){const p=this._coordsDescendingInvStr[u][o.tileID.key];p&&p!==o.textureCoords[u]&&o.clearTextures(this.painter),n.needsRerender(u,o.tileID)&&o.clearTextures(this.painter)}this._rerender[o.tileID.key]=!o.textures.length}),n.clearRerenderCache(),n.sourceCache.removeOutdated(this.painter),this}renderLayer(t){const n=t.type,o=this.painter,u=o.style._order,p=o.currentLayer,f=p+1===u.length;if(this._renderToTexture[n]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=n,this._stacks[this._stacks.length-1].push(u[p]),!f))return!0;if(this._renderToTexture[this._prevType]||n==="hillshade"||this._renderToTexture[n]&&f){this._prevType=n;const _=this._stacks.length-1,y=this._stacks[_]||[];for(const v of this._renderableTiles){if(sl(o,o.style.terrain,v,_),this._rerender[v.tileID.key]){o.context.clear({color:a.Color.transparent});for(let T=0;T<y.length;T++){const I=o.style._layers[y[T]],M=I.source?this._coordsDescendingInv[I.source][v.tileID.key]:[v.tileID];o._renderTileClippingMasks(I,M),o.renderLayer(o,o.style.sourceCaches[I.source],I,M),I.source&&(v.textureCoords[I.source]=this._coordsDescendingInvStr[I.source][v.tileID.key])}}ao(o,o.style.terrain,v)}if(n==="hillshade"){this._stacks.push([u[p]]);for(const v of this._renderableTiles){const T=this._coordsDescendingInv[t.source][v.tileID.key];sl(o,o.style.terrain,v,this._stacks.length-1),o.context.clear({color:a.Color.transparent}),o._renderTileClippingMasks(t,T),o.renderLayer(o,o.style.sourceCaches[t.source],t,T),ao(o,o.style.terrain,v)}return!0}return this._renderToTexture[n]}return!1}}const As={symbol:function(l,t,n,o,u){if(l.renderPass!=="translucent")return;const p=Ot.disabled,f=l.colorModeForRenderPass();n.layout.get("text-variable-anchor")&&function(_,y,v,T,I,M,U){const R=y.transform,O=I==="map",H=M==="map";for(const Q of _){const re=T.getTile(Q),V=re.getBucket(v);if(!V||!V.text||!V.text.segments.get().length)continue;const oe=a.evaluateSizeForZoom(V.textSizeData,R.zoom),ne=ti(re,1,y.transform.zoom),de=pn(Q.posMatrix,H,O,y.transform,ne),fe=v.layout.get("icon-text-fit")!=="none"&&V.hasIconData();if(oe){const we=Math.pow(2,R.zoom-re.tileID.overscaledZ);tl(V,O,H,U,R,de,Q.posMatrix,we,oe,fe,y.style.terrain?(he,Be)=>y.style.terrain.getElevation(Q,he,Be):null)}}}(o,l,n,t,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),u),n.paint.get("icon-opacity").constantOr(1)!==0&&no(l,t,n,o,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright"),p,f),n.paint.get("text-opacity").constantOr(1)!==0&&no(l,t,n,o,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright"),p,f),t.map.showCollisionBoxes&&(Kn(l,t,n,o,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),Kn(l,t,n,o,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(l,t,n,o){if(l.renderPass!=="translucent")return;const u=n.paint.get("circle-opacity"),p=n.paint.get("circle-stroke-width"),f=n.paint.get("circle-stroke-opacity"),_=!n.layout.get("circle-sort-key").isConstant();if(u.constantOr(1)===0&&(p.constantOr(1)===0||f.constantOr(1)===0))return;const y=l.context,v=y.gl,T=l.depthModeForSublayer(0,ft.ReadOnly),I=Ot.disabled,M=l.colorModeForRenderPass(),U=[];for(let R=0;R<o.length;R++){const O=o[R],H=t.getTile(O),Q=H.getBucket(n);if(!Q)continue;const re=Q.programConfigurations.get(n.id),V=l.useProgram("circle",re),oe=Q.layoutVertexBuffer,ne=Q.indexBuffer,de=l.style.terrain&&l.style.terrain.getTerrainData(O),fe={programConfiguration:re,program:V,layoutVertexBuffer:oe,indexBuffer:ne,uniformValues:qa(l,O,H,n),terrainData:de};if(_){const we=Q.segments.get();for(const he of we)U.push({segments:new a.SegmentVector([he]),sortKey:he.sortKey,state:fe})}else U.push({segments:Q.segments,sortKey:0,state:fe})}_&&U.sort((R,O)=>R.sortKey-O.sortKey);for(const R of U){const{programConfiguration:O,program:H,layoutVertexBuffer:Q,indexBuffer:re,uniformValues:V,terrainData:oe}=R.state;H.draw(y,v.TRIANGLES,T,I,M,qt.disabled,V,oe,n.id,Q,re,R.segments,n.paint,l.transform.zoom,O)}},heatmap:function(l,t,n,o){if(n.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){const u=l.context,p=u.gl,f=Ot.disabled,_=new Ut([p.ONE,p.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(y,v,T){const I=y.gl;y.activeTexture.set(I.TEXTURE1),y.viewport.set([0,0,v.width/4,v.height/4]);let M=T.heatmapFbo;if(M)I.bindTexture(I.TEXTURE_2D,M.colorAttachment.get()),y.bindFramebuffer.set(M.framebuffer);else{const U=I.createTexture();I.bindTexture(I.TEXTURE_2D,U),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_S,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_T,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MIN_FILTER,I.LINEAR),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MAG_FILTER,I.LINEAR),M=T.heatmapFbo=y.createFramebuffer(v.width/4,v.height/4,!1),function(R,O,H,Q){const re=R.gl;re.texImage2D(re.TEXTURE_2D,0,re.RGBA,O.width/4,O.height/4,0,re.RGBA,R.extRenderToTextureHalfFloat?R.extTextureHalfFloat.HALF_FLOAT_OES:re.UNSIGNED_BYTE,null),Q.colorAttachment.set(H)}(y,v,U,M)}})(u,l,n),u.clear({color:a.Color.transparent});for(let y=0;y<o.length;y++){const v=o[y];if(t.hasRenderableParent(v))continue;const T=t.getTile(v),I=T.getBucket(n);if(!I)continue;const M=I.programConfigurations.get(n.id),U=l.useProgram("heatmap",M),{zoom:R}=l.transform;U.draw(u,p.TRIANGLES,ft.disabled,f,_,qt.disabled,Ws(v.posMatrix,T,R,n.paint.get("heatmap-intensity")),null,n.id,I.layoutVertexBuffer,I.indexBuffer,I.segments,n.paint,l.transform.zoom,M)}u.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(u,p){const f=u.context,_=f.gl,y=p.heatmapFbo;if(!y)return;f.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,y.colorAttachment.get()),f.activeTexture.set(_.TEXTURE1);let v=p.colorRampTexture;v||(v=p.colorRampTexture=new be(f,p.colorRamp,_.RGBA)),v.bind(_.LINEAR,_.CLAMP_TO_EDGE),u.useProgram("heatmapTexture").draw(f,_.TRIANGLES,ft.disabled,Ot.disabled,u.colorModeForRenderPass(),qt.disabled,((T,I,M,U)=>{const R=a.create();a.ortho(R,0,T.width,T.height,0,0,1);const O=T.context.gl;return{u_matrix:R,u_world:[O.drawingBufferWidth,O.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:I.paint.get("heatmap-opacity")}})(u,p),null,p.id,u.viewportBuffer,u.quadTriangleIndexBuffer,u.viewportSegments,p.paint,u.transform.zoom)}(l,n))},line:function(l,t,n,o){if(l.renderPass!=="translucent")return;const u=n.paint.get("line-opacity"),p=n.paint.get("line-width");if(u.constantOr(1)===0||p.constantOr(1)===0)return;const f=l.depthModeForSublayer(0,ft.ReadOnly),_=l.colorModeForRenderPass(),y=n.paint.get("line-dasharray"),v=n.paint.get("line-pattern"),T=v.constantOr(1),I=n.paint.get("line-gradient"),M=n.getCrossfadeParameters(),U=T?"linePattern":y?"lineSDF":I?"lineGradient":"line",R=l.context,O=R.gl;let H=!0;for(const Q of o){const re=t.getTile(Q);if(T&&!re.patternsLoaded())continue;const V=re.getBucket(n);if(!V)continue;const oe=V.programConfigurations.get(n.id),ne=l.context.program.get(),de=l.useProgram(U,oe),fe=H||de.program!==ne,we=l.style.terrain&&l.style.terrain.getTerrainData(Q),he=v.constantOr(null);if(he&&re.imageAtlas){const Re=re.imageAtlas,rt=Re.patternPositions[he.to.toString()],lt=Re.patternPositions[he.from.toString()];rt&&lt&&oe.setConstantPatternPositions(rt,lt)}const Be=we?Q:null,Ae=T?Ks(l,re,n,M,Be):y?ys(l,re,n,y,M,Be):I?Bo(l,re,n,V.lineClipsArray.length,Be):jn(l,re,n,Be);if(T)R.activeTexture.set(O.TEXTURE0),re.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),oe.updatePaintBuffers(M);else if(y&&(fe||l.lineAtlas.dirty))R.activeTexture.set(O.TEXTURE0),l.lineAtlas.bind(R);else if(I){const Re=V.gradients[n.id];let rt=Re.texture;if(n.gradientVersion!==Re.version){let lt=256;if(n.stepInterpolant){const je=t.getSource().maxzoom,kt=Q.canonical.z===je?Math.ceil(1<<l.transform.maxZoom-Q.canonical.z):1;lt=a.clamp(a.nextPowerOfTwo(V.maxLineLength/a.EXTENT*1024*kt),256,R.maxTextureSize)}Re.gradient=a.renderColorRamp({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:lt,image:Re.gradient||void 0,clips:V.lineClipsArray}),Re.texture?Re.texture.update(Re.gradient):Re.texture=new be(R,Re.gradient,O.RGBA),Re.version=n.gradientVersion,rt=Re.texture}R.activeTexture.set(O.TEXTURE0),rt.bind(n.stepInterpolant?O.NEAREST:O.LINEAR,O.CLAMP_TO_EDGE)}de.draw(R,O.TRIANGLES,f,l.stencilModeForClipping(Q),_,qt.disabled,Ae,we,n.id,V.layoutVertexBuffer,V.indexBuffer,V.segments,n.paint,l.transform.zoom,oe,V.layoutVertexBuffer2),H=!1}},fill:function(l,t,n,o){const u=n.paint.get("fill-color"),p=n.paint.get("fill-opacity");if(p.constantOr(1)===0)return;const f=l.colorModeForRenderPass(),_=n.paint.get("fill-pattern"),y=l.opaquePassEnabledForLayer()&&!_.constantOr(1)&&u.constantOr(a.Color.transparent).a===1&&p.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===y){const v=l.depthModeForSublayer(1,l.renderPass==="opaque"?ft.ReadWrite:ft.ReadOnly);Es(l,t,n,o,v,f,!1)}if(l.renderPass==="translucent"&&n.paint.get("fill-antialias")){const v=l.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,ft.ReadOnly);Es(l,t,n,o,v,f,!0)}},"fill-extrusion":function(l,t,n,o){const u=n.paint.get("fill-extrusion-opacity");if(u!==0&&l.renderPass==="translucent"){const p=new ft(l.context.gl.LEQUAL,ft.ReadWrite,l.depthRangeFor3D);if(u!==1||n.paint.get("fill-extrusion-pattern").constantOr(1))Ss(l,t,n,o,p,Ot.disabled,Ut.disabled),Ss(l,t,n,o,p,l.stencilModeFor3D(),l.colorModeForRenderPass());else{const f=l.colorModeForRenderPass();Ss(l,t,n,o,p,Ot.disabled,f)}}},hillshade:function(l,t,n,o){if(l.renderPass!=="offscreen"&&l.renderPass!=="translucent")return;const u=l.context,p=l.depthModeForSublayer(0,ft.ReadOnly),f=l.colorModeForRenderPass(),[_,y]=l.renderPass==="translucent"?l.stencilConfigForOverlap(o):[{},o];for(const v of y){const T=t.getTile(v);T.needsHillshadePrepare!==void 0&&T.needsHillshadePrepare&&l.renderPass==="offscreen"?il(l,T,n,p,Ot.disabled,f):l.renderPass==="translucent"&&Ho(l,v,T,n,p,_[v.overscaledZ],f)}u.viewport.set([0,0,l.width,l.height])},raster:function(l,t,n,o){if(l.renderPass!=="translucent"||n.paint.get("raster-opacity")===0||!o.length)return;const u=l.context,p=u.gl,f=t.getSource(),_=l.useProgram("raster"),y=l.colorModeForRenderPass(),[v,T]=f instanceof or?[{},o]:l.stencilConfigForOverlap(o),I=T[T.length-1].overscaledZ,M=!l.options.moving;for(const U of T){const R=l.depthModeForSublayer(U.overscaledZ-I,n.paint.get("raster-opacity")===1?ft.ReadWrite:ft.ReadOnly,p.LESS),O=t.getTile(U);O.registerFadeDuration(n.paint.get("raster-fade-duration"));const H=t.findLoadedParent(U,0),Q=so(O,H,t,n,l.transform,l.style.terrain);let re,V;const oe=n.paint.get("raster-resampling")==="nearest"?p.NEAREST:p.LINEAR;u.activeTexture.set(p.TEXTURE0),O.texture.bind(oe,p.CLAMP_TO_EDGE,p.LINEAR_MIPMAP_NEAREST),u.activeTexture.set(p.TEXTURE1),H?(H.texture.bind(oe,p.CLAMP_TO_EDGE,p.LINEAR_MIPMAP_NEAREST),re=Math.pow(2,H.tileID.overscaledZ-O.tileID.overscaledZ),V=[O.tileID.canonical.x*re%1,O.tileID.canonical.y*re%1]):O.texture.bind(oe,p.CLAMP_TO_EDGE,p.LINEAR_MIPMAP_NEAREST);const ne=l.style.terrain&&l.style.terrain.getTerrainData(U),de=ne?U:null,fe=de?de.posMatrix:l.transform.calculatePosMatrix(U.toUnwrapped(),M),we=Ga(fe,V||[0,0],re||1,Q,n);f instanceof or?_.draw(u,p.TRIANGLES,R,Ot.disabled,y,qt.disabled,we,ne,n.id,f.boundsBuffer,l.quadTriangleIndexBuffer,f.boundsSegments):_.draw(u,p.TRIANGLES,R,v[U.overscaledZ],y,qt.disabled,we,ne,n.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,t,n,o){const u=n.paint.get("background-color"),p=n.paint.get("background-opacity");if(p===0)return;const f=l.context,_=f.gl,y=l.transform,v=y.tileSize,T=n.paint.get("background-pattern");if(l.isPatternMissing(T))return;const I=!T&&u.a===1&&p===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass!==I)return;const M=Ot.disabled,U=l.depthModeForSublayer(0,I==="opaque"?ft.ReadWrite:ft.ReadOnly),R=l.colorModeForRenderPass(),O=l.useProgram(T?"backgroundPattern":"background"),H=o||y.coveringTiles({tileSize:v,terrain:l.style.terrain});T&&(f.activeTexture.set(_.TEXTURE0),l.imageManager.bind(l.context));const Q=n.getCrossfadeParameters();for(const re of H){const V=o?re.posMatrix:l.transform.calculatePosMatrix(re.toUnwrapped()),oe=T?oc(V,p,l,T,{tileID:re,tileSize:v},Q):sc(V,p,u),ne=l.style.terrain&&l.style.terrain.getTerrainData(re);O.draw(f,_.TRIANGLES,U,M,R,qt.disabled,oe,ne,n.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}},debug:function(l,t,n){for(let o=0;o<n.length;o++)_c(l,t,n[o])},custom:function(l,t,n){const o=l.context,u=n.implementation;if(l.renderPass==="offscreen"){const p=u.prerender;p&&(l.setCustomLayerDefaults(),o.setColorMode(l.colorModeForRenderPass()),p.call(u,o.gl,l.transform.customLayerMatrix()),o.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),o.setColorMode(l.colorModeForRenderPass()),o.setStencilMode(Ot.disabled);const p=u.renderingMode==="3d"?new ft(l.context.gl.LEQUAL,ft.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,ft.ReadOnly);o.setDepthMode(p),u.render(o.gl,l.transform.customLayerMatrix()),o.setDirty(),l.setBaseState(),o.bindFramebuffer.set(null)}}};class Yo{constructor(t,n){this.context=new el(t),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.create(),renderTime:0},this.setup(),this.numSublayers=zi.maxUnderzooming+zi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ye,this.gpuTimers={}}resize(t,n,o){if(this.width=t*o,this.height=n*o,this.pixelRatio=o,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style._order)this.style._layers[u].resize()}setup(){const t=this.context,n=new a.PosArray;n.emplaceBack(0,0),n.emplaceBack(a.EXTENT,0),n.emplaceBack(0,a.EXTENT),n.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(n,yt.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);const o=new a.PosArray;o.emplaceBack(0,0),o.emplaceBack(a.EXTENT,0),o.emplaceBack(0,a.EXTENT),o.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=t.createVertexBuffer(o,yt.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);const u=new a.RasterBoundsArray;u.emplaceBack(0,0,0,0),u.emplaceBack(a.EXTENT,0,a.EXTENT,0),u.emplaceBack(0,a.EXTENT,0,a.EXTENT),u.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(u,Sr.members),this.rasterBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);const p=new a.PosArray;p.emplaceBack(0,0),p.emplaceBack(1,0),p.emplaceBack(0,1),p.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(p,yt.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);const f=new a.LineStripIndexArray;f.emplaceBack(0),f.emplaceBack(1),f.emplaceBack(3),f.emplaceBack(2),f.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(f);const _=new a.TriangleIndexArray;_.emplaceBack(0,1,2),_.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(_),this.emptyTexture=new be(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA);const y=this.context.gl;this.stencilClearMode=new Ot({func:y.ALWAYS,mask:0},0,255,y.ZERO,y.ZERO,y.ZERO)}clearStencil(){const t=this.context,n=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const o=a.create();a.ortho(o,0,this.width,this.height,0,0,1),a.scale(o,o,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,n.TRIANGLES,ft.disabled,this.stencilClearMode,Ut.disabled,qt.disabled,Zn(o),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,n){if(this.currentStencilSource===t.source||!t.isTileClipped()||!n||!n.length)return;this.currentStencilSource=t.source;const o=this.context,u=o.gl;this.nextStencilID+n.length>256&&this.clearStencil(),o.setColorMode(Ut.disabled),o.setDepthMode(ft.disabled);const p=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const f of n){const _=this._tileClippingMaskIDs[f.key]=this.nextStencilID++,y=this.style.terrain&&this.style.terrain.getTerrainData(f);p.draw(o,u.TRIANGLES,ft.disabled,new Ot({func:u.ALWAYS,mask:0},_,255,u.KEEP,u.KEEP,u.REPLACE),Ut.disabled,qt.disabled,Zn(f.posMatrix),y,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new Ot({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){const n=this.context.gl;return new Ot({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,o=t.sort((f,_)=>_.overscaledZ-f.overscaledZ),u=o[o.length-1].overscaledZ,p=o[0].overscaledZ-u+1;if(p>1){this.currentStencilSource=void 0,this.nextStencilID+p>256&&this.clearStencil();const f={};for(let _=0;_<p;_++)f[_+u]=new Ot({func:n.GEQUAL,mask:255},_+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=p,[f,o]}return[{[u]:Ot.disabled},o]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Ut([t.CONSTANT_COLOR,t.ONE],new a.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ut.unblended:Ut.alphaBlended}depthModeForSublayer(t,n,o){if(!this.opaquePassEnabledForLayer())return ft.disabled;const u=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new ft(o||this.context.gl.LEQUAL,n,[u,u])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,n){this.style=t,this.options=n,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(a.exported.now()),this.imageManager.beginFrame();const o=this.style._order,u=this.style.sourceCaches,p=this.style.terrain&&new ol(this);for(const v in u){const T=u[v];T.used&&T.prepare(this.context)}const f={},_={},y={};for(const v in u){const T=u[v];f[v]=T.getVisibleCoordinates(),_[v]=f[v].slice().reverse(),y[v]=T.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let v=0;v<o.length;v++)if(this.style._layers[o[v]].is3D()){this.opaquePassCutoff=v;break}if(p){this.opaquePassCutoff=0;const v=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!a.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||v.length)&&(a.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(T,I){const M=T.context,U=M.gl,R=Ut.unblended,O=new ft(U.LEQUAL,ft.ReadWrite,[0,1]),H=I.getTerrainMesh(),Q=I.sourceCache.getRenderableTiles(),re=T.useProgram("terrainDepth");M.bindFramebuffer.set(I.getFramebuffer("depth").framebuffer),M.viewport.set([0,0,T.width/devicePixelRatio,T.height/devicePixelRatio]),M.clear({color:a.Color.transparent,depth:1});for(const V of Q){const oe=I.getTerrainData(V.tileID),ne=T.transform.calculatePosMatrix(V.tileID.toUnwrapped());re.draw(M,U.TRIANGLES,O,Ot.disabled,R,qt.backCCW,{u_matrix:ne},oe,"terrain",H.vertexBuffer,H.indexBuffer,H.segments)}M.bindFramebuffer.set(null),M.viewport.set([0,0,T.width,T.height])}(this,this.style.terrain),function(T,I){const M=T.context,U=M.gl,R=Ut.unblended,O=new ft(U.LEQUAL,ft.ReadWrite,[0,1]),H=I.getTerrainMesh(),Q=I.getCoordsTexture(),re=I.sourceCache.getRenderableTiles(),V=T.useProgram("terrainCoords");M.bindFramebuffer.set(I.getFramebuffer("coords").framebuffer),M.viewport.set([0,0,T.width/devicePixelRatio,T.height/devicePixelRatio]),M.clear({color:a.Color.transparent,depth:1}),I.coordsIndex=[];for(const oe of re){const ne=I.getTerrainData(oe.tileID);M.activeTexture.set(U.TEXTURE0),U.bindTexture(U.TEXTURE_2D,Q.texture);const de=T.transform.calculatePosMatrix(oe.tileID.toUnwrapped());V.draw(M,U.TRIANGLES,O,Ot.disabled,R,qt.backCCW,{u_matrix:de,u_terrain_coords_id:(255-I.coordsIndex.length)/255,u_texture:0},ne,"terrain",H.vertexBuffer,H.indexBuffer,H.segments),I.coordsIndex.push(oe.tileID.key)}M.bindFramebuffer.set(null),M.viewport.set([0,0,T.width,T.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const v of o){const T=this.style._layers[v];if(!T.hasOffscreenPass()||T.isHidden(this.transform.zoom))continue;const I=_[T.source];(T.type==="custom"||I.length)&&this.renderLayer(this,u[T.source],T,I)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?a.Color.black:a.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!p)for(this.renderPass="opaque",this.currentLayer=o.length-1;this.currentLayer>=0;this.currentLayer--){const v=this.style._layers[o[this.currentLayer]],T=u[v.source],I=f[v.source];this._renderTileClippingMasks(v,I),this.renderLayer(this,T,v,I)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<o.length;this.currentLayer++){const v=this.style._layers[o[this.currentLayer]],T=u[v.source];if(p&&p.renderLayer(v))continue;const I=(v.type==="symbol"?y:_)[v.source];this._renderTileClippingMasks(v,f[v.source]),this.renderLayer(this,T,v,I)}if(this.options.showTileBoundaries){let v,T;Object.values(this.style._layers).forEach(I=>{I.source&&!I.isHidden(this.transform.zoom)&&(I.source!==(T&&T.id)&&(T=this.style.sourceCaches[I.source]),(!v||v.getSource().maxzoom<T.getSource().maxzoom)&&(v=T))}),v&&As.debug(this,v,v.getVisibleCoordinates())}this.options.showPadding&&function(v){const T=v.transform.padding;yn(v,v.transform.height-(T.top||0),3,oo),yn(v,T.bottom||0,3,cr),Is(v,T.left||0,3,rl),Is(v,v.transform.width-(T.right||0),3,Ko);const I=v.transform.centerPoint;(function(M,U,R,O){Yn(M,U-1,R-10,2,20,O),Yn(M,U-10,R-1,20,2,O)})(v,I.x,v.transform.height-I.y,nl)}(this),this.context.setDefault()}renderLayer(t,n,o,u){o.isHidden(this.transform.zoom)||(o.type==="background"||o.type==="custom"||(u||[]).length)&&(this.id=o.id,this.gpuTimingStart(o),As[o.type](t,n,o,u,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;let o=this.gpuTimers[t.id];o||(o=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:n.createQueryEXT()}),o.calls++,n.beginQueryEXT(n.TIME_ELAPSED_EXT,o.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const n={};for(const o in t){const u=t[o],p=this.context.extTimerQuery,f=p.getQueryObjectEXT(u.query,p.QUERY_RESULT_EXT)/1e6;p.deleteQueryEXT(u.query),n[o]=f}return n}translatePosMatrix(t,n,o,u,p){if(!o[0]&&!o[1])return t;const f=p?u==="map"?this.transform.angle:0:u==="viewport"?-this.transform.angle:0;if(f){const v=Math.sin(f),T=Math.cos(f);o=[o[0]*T-o[1]*v,o[0]*v+o[1]*T]}const _=[p?o[0]:ti(n,o[0],this.transform.zoom),p?o[1]:ti(n,o[1],this.transform.zoom),0],y=new Float32Array(16);return a.translate(y,t,_),y}saveTileTexture(t){const n=this._tileTextures[t.size[0]];n?n.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const n=this.imageManager.getPattern(t.from.toString()),o=this.imageManager.getPattern(t.to.toString());return!n||!o}useProgram(t,n){this.cache=this.cache||{};const o=t+(n?n.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[o]||(this.cache[o]=new Ua(this.context,t,gs[t],n,Fo[t],this._showOverdrawInspector,this.style.terrain)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new be(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class lo{constructor(t,n){this.points=t,this.planes=n}static fromInvProjectionMatrix(t,n,o){const u=Math.pow(2,o),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(_=>{const y=1/(_=a.transformMat4([],_,t))[3]/n*u;return a.mul$1(_,_,[y,y,1/_[3],y])}),f=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(_=>{const y=a.sub([],p[_[0]],p[_[1]]),v=a.sub([],p[_[2]],p[_[1]]),T=a.normalize([],a.cross([],y,v)),I=-a.dot(T,p[_[1]]);return T.concat(I)});return new lo(p,f)}}class Cs{constructor(t,n){this.min=t,this.max=n,this.center=a.scale$1([],a.add([],this.min,this.max),.5)}quadrant(t){const n=[t%2==0,t<2],o=a.clone$2(this.min),u=a.clone$2(this.max);for(let p=0;p<n.length;p++)o[p]=n[p]?this.min[p]:this.center[p],u[p]=n[p]?this.center[p]:this.max[p];return u[2]=this.max[2],new Cs(o,u)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let o=!0;for(let u=0;u<t.planes.length;u++){const p=t.planes[u];let f=0;for(let _=0;_<n.length;_++)a.dot$1(p,n[_])>=0&&f++;if(f===0)return 0;f!==n.length&&(o=!1)}if(o)return 2;for(let u=0;u<3;u++){let p=Number.MAX_VALUE,f=-Number.MAX_VALUE;for(let _=0;_<t.points.length;_++){const y=t.points[_][u]-this.min[u];p=Math.min(p,y),f=Math.max(f,y)}if(f<0||p>this.max[u]-this.min[u])return 0}return 1}}class Jn{constructor(t=0,n=0,o=0,u=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(o)||o<0||isNaN(u)||u<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=o,this.right=u}interpolate(t,n,o){return n.top!=null&&t.top!=null&&(this.top=a.number(t.top,n.top,o)),n.bottom!=null&&t.bottom!=null&&(this.bottom=a.number(t.bottom,n.bottom,o)),n.left!=null&&t.left!=null&&(this.left=a.number(t.left,n.left,o)),n.right!=null&&t.right!=null&&(this.right=a.number(t.right,n.right,o)),this}getCenter(t,n){const o=a.clamp((this.left+t-this.right)/2,0,t),u=a.clamp((this.top+n-this.bottom)/2,0,n);return new a.pointGeometry(o,u)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Jn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class ks{constructor(t,n,o,u,p){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=p===void 0||!!p,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=o==null?0:o,this._maxPitch=u==null?60:u,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Jn,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const t=new ks(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t._elevation=this._elevation,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._calcMatrices(),t}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const n=-a.wrap(t,-180,180)*Math.PI/180;var o;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=(o=new a.ARRAY_TYPE(4),a.ARRAY_TYPE!=Float32Array&&(o[1]=0,o[2]=0),o[0]=1,o[3]=1,o),function(u,p,f){var _=p[0],y=p[1],v=p[2],T=p[3],I=Math.sin(f),M=Math.cos(f);u[0]=_*M+v*I,u[1]=y*M+T*I,u[2]=_*-I+v*M,u[3]=y*-I+T*M}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=a.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const n=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,o){this._unmodified=!1,this._edgeInsets.interpolate(t,n,o),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(t){const n=[new a.UnwrappedTileID(0,t)];if(this._renderWorldCopies){const o=this.pointCoordinate(new a.pointGeometry(0,0)),u=this.pointCoordinate(new a.pointGeometry(this.width,0)),p=this.pointCoordinate(new a.pointGeometry(this.width,this.height)),f=this.pointCoordinate(new a.pointGeometry(0,this.height)),_=Math.floor(Math.min(o.x,u.x,p.x,f.x)),y=Math.floor(Math.max(o.x,u.x,p.x,f.x)),v=1;for(let T=_-v;T<=y+v;T++)T!==0&&n.push(new a.UnwrappedTileID(T,t))}return n}coveringTiles(t){var n,o;let u=this.coveringZoomLevel(t);const p=u;if(t.minzoom!==void 0&&u<t.minzoom)return[];t.maxzoom!==void 0&&u>t.maxzoom&&(u=t.maxzoom);const f=this.pointCoordinate(this.getCameraPoint()),_=a.MercatorCoordinate.fromLngLat(this.center),y=Math.pow(2,u),v=[y*f.x,y*f.y,0],T=[y*_.x,y*_.y,0],I=lo.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u);let M=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(M=u);const U=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,R=V=>({aabb:new Cs([V*y,0,0],[(V+1)*y,y,0]),zoom:0,x:0,y:0,wrap:V,fullyVisible:!1}),O=[],H=[],Q=u,re=t.reparseOverscaled?p:u;if(this._renderWorldCopies)for(let V=1;V<=3;V++)O.push(R(-V)),O.push(R(V));for(O.push(R(0));O.length>0;){const V=O.pop(),oe=V.x,ne=V.y;let de=V.fullyVisible;if(!de){const Re=V.aabb.intersects(I);if(Re===0)continue;de=Re===2}const fe=t.terrain?v:T,we=V.aabb.distanceX(fe),he=V.aabb.distanceY(fe),Be=Math.max(Math.abs(we),Math.abs(he)),Ae=U+(1<<Q-V.zoom)-2;if(V.zoom===Q||Be>Ae&&V.zoom>=M){const Re=Q-V.zoom,rt=v[0]-.5-(oe<<Re),lt=v[1]-.5-(ne<<Re);H.push({tileID:new a.OverscaledTileID(V.zoom===Q?re:V.zoom,V.wrap,V.zoom,oe,ne),distanceSq:a.sqrLen([T[0]-.5-oe,T[1]-.5-ne]),tileDistanceToCamera:Math.sqrt(rt*rt+lt*lt)})}else for(let Re=0;Re<4;Re++){const rt=(oe<<1)+Re%2,lt=(ne<<1)+(Re>>1),je=V.zoom+1;let kt=V.aabb.quadrant(Re);if(t.terrain){const Mt=new a.OverscaledTileID(je,V.wrap,je,rt,lt),mt=t.terrain.getMinMaxElevation(Mt),vt=(n=mt.minElevation)!==null&&n!==void 0?n:this.elevation,Pt=(o=mt.maxElevation)!==null&&o!==void 0?o:this.elevation;kt=new Cs([kt.min[0],kt.min[1],vt],[kt.max[0],kt.max[1],Pt])}O.push({aabb:kt,zoom:je,x:rt,y:lt,wrap:V.wrap,fullyVisible:de})}}return H.sort((V,oe)=>V.distanceSq-oe.distanceSq).map(V=>V.tileID)}resize(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const n=a.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new a.pointGeometry(a.mercatorXfromLng(t.lng)*this.worldSize,a.mercatorYfromLat(n)*this.worldSize)}unproject(t){return new a.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(t){this.freezeElevation||(this.elevation=t?this.getElevation(this._center,t):0)}getElevation(t,n){const o=a.MercatorCoordinate.fromLngLat(t),u=(1<<this.tileZoom)*a.EXTENT,p=o.x*u,f=o.y*u,_=Math.floor(p/a.EXTENT),y=Math.floor(f/a.EXTENT),v=new a.OverscaledTileID(this.tileZoom,0,this.tileZoom,_,y);return n.getElevation(v,p%a.EXTENT,f%a.EXTENT,a.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const n=this.pointLocation(this.centerPoint,t),o=this.getElevation(n,t);if(!(this.elevation-o))return;const u=this.getCameraPosition(),p=a.MercatorCoordinate.fromLngLat(u.lngLat,u.altitude),f=a.MercatorCoordinate.fromLngLat(n,o),_=p.x-f.x,y=p.y-f.y,v=p.z-f.z,T=Math.sqrt(_*_+y*y+v*v),I=this.scaleZoom(this.cameraToCenterDistance/T/this.tileSize);this._elevation=o,this._center=n,this.zoom=I}setLocationAtPoint(t,n){const o=this.pointCoordinate(n),u=this.pointCoordinate(this.centerPoint),p=this.locationCoordinate(t),f=new a.MercatorCoordinate(p.x-(o.x-u.x),p.y-(o.y-u.y));this.center=this.coordinateLocation(f),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,n){return n?this.coordinatePoint(this.locationCoordinate(t),this.getElevation(t,n),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,n){return this.coordinateLocation(this.pointCoordinate(t,n))}locationCoordinate(t){return a.MercatorCoordinate.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,n){if(n){const M=n.pointCoordinate(t);if(M!=null)return M}const o=[t.x,t.y,0,1],u=[t.x,t.y,1,1];a.transformMat4(o,o,this.pixelMatrixInverse),a.transformMat4(u,u,this.pixelMatrixInverse);const p=o[3],f=u[3],_=o[1]/p,y=u[1]/f,v=o[2]/p,T=u[2]/f,I=v===T?0:(0-v)/(T-v);return new a.MercatorCoordinate(a.number(o[0]/p,u[0]/f,I)/this.worldSize,a.number(_,y,I)/this.worldSize)}coordinatePoint(t,n=0,o=this.pixelMatrix){const u=[t.x*this.worldSize,t.y*this.worldSize,n,1];return a.transformMat4(u,u,o),new a.pointGeometry(u[0]/u[3],u[1]/u[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new a.LngLatBounds().extend(this.pointLocation(new a.pointGeometry(0,t))).extend(this.pointLocation(new a.pointGeometry(this.width,t))).extend(this.pointLocation(new a.pointGeometry(this.width,this.height))).extend(this.pointLocation(new a.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new a.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,n=!1){const o=t.key,u=n?this._alignedPosMatrixCache:this._posMatrixCache;if(u[o])return u[o];const p=t.canonical,f=this.worldSize/this.zoomScale(p.z),_=p.x+Math.pow(2,p.z)*t.wrap,y=a.identity(new Float64Array(16));return a.translate(y,y,[_*f,p.y*f,0]),a.scale(y,y,[f/a.EXTENT,f/a.EXTENT,1]),a.multiply(y,n?this.alignedProjMatrix:this.projMatrix,y),u[o]=new Float32Array(y),u[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,n,o,u,p=-90,f=90,_=-180,y=180;const v=this.size,T=this._unmodified;if(this.latRange){const U=this.latRange;p=a.mercatorYfromLat(U[1])*this.worldSize,f=a.mercatorYfromLat(U[0])*this.worldSize,t=f-p<v.y?v.y/(f-p):0}if(this.lngRange){const U=this.lngRange;_=a.wrap(a.mercatorXfromLng(U[0])*this.worldSize,0,this.worldSize),y=a.wrap(a.mercatorXfromLng(U[1])*this.worldSize,0,this.worldSize),y<_&&(y+=this.worldSize),n=y-_<v.x?v.x/(y-_):0}const I=this.point,M=Math.max(n||0,t||0);if(M)return this.center=this.unproject(new a.pointGeometry(n?(y+_)/2:I.x,t?(f+p)/2:I.y)),this.zoom+=this.scaleZoom(M),this._unmodified=T,void(this._constraining=!1);if(this.latRange){const U=I.y,R=v.y/2;U-R<p&&(u=p+R),U+R>f&&(u=f-R)}if(this.lngRange){const U=(_+y)/2,R=a.wrap(I.x,U-this.worldSize/2,U+this.worldSize/2),O=v.x/2;R-O<_&&(o=_+O),R+O>y&&(o=y-O)}o===void 0&&u===void 0||(this.center=this.unproject(new a.pointGeometry(o!==void 0?o:I.x,u!==void 0?u:I.y)).wrap()),this._unmodified=T,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n=this.point.x,o=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let u=a.identity(new Float64Array(16));a.scale(u,u,[this.width/2,-this.height/2,1]),a.translate(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=a.identity(new Float64Array(16)),a.scale(u,u,[1,-1,1]),a.translate(u,u,[-1,-1,0]),a.scale(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const p=Math.PI/2+this._pitch,f=this._fov*(.5+t.y/this.height),_=Math.sin(f)*this.cameraToSeaLevelDistance/Math.sin(a.clamp(Math.PI-p-f,.01,Math.PI-.01)),y=this.getHorizon(),v=2*Math.atan(y/this.cameraToCenterDistance)*(.5+t.y/(2*y)),T=Math.sin(v)*this.cameraToSeaLevelDistance/Math.sin(a.clamp(Math.PI-p-v,.01,Math.PI-.01)),I=Math.cos(Math.PI/2-this._pitch)*_+this.cameraToSeaLevelDistance,M=Math.cos(Math.PI/2-this._pitch)*T+this.cameraToSeaLevelDistance,U=1.01*Math.min(I,M),R=this.height/50;u=new Float64Array(16),a.perspective(u,this._fov,this.width/this.height,R,U),u[8]=2*-t.x/this.width,u[9]=2*t.y/this.height,a.scale(u,u,[1,-1,1]),a.translate(u,u,[0,0,-this.cameraToCenterDistance]),a.rotateX(u,u,this._pitch),a.rotateZ(u,u,this.angle),a.translate(u,u,[-n,-o,0]),this.mercatorMatrix=a.scale([],u,[this.worldSize,this.worldSize,this.worldSize]),a.scale(u,u,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.multiply(new Float64Array(16),this.labelPlaneMatrix,u),a.translate(u,u,[0,0,-this.elevation]),this.projMatrix=u,this.invProjMatrix=a.invert([],u),this.pixelMatrix3D=a.multiply(new Float64Array(16),this.labelPlaneMatrix,u);const O=this.width%2/2,H=this.height%2/2,Q=Math.cos(this.angle),re=Math.sin(this.angle),V=n-Math.round(n)+Q*O+re*H,oe=o-Math.round(o)+Q*H+re*O,ne=new Float64Array(u);if(a.translate(ne,ne,[V>.5?V-1:V,oe>.5?oe-1:oe,0]),this.alignedProjMatrix=ne,u=a.invert(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");this.pixelMatrixInverse=u,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new a.pointGeometry(0,0)),n=[t.x*this.worldSize,t.y*this.worldSize,0,1];return a.transformMat4(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.pointGeometry(0,t))}getCameraQueryGeometry(t){const n=this.getCameraPoint();if(t.length===1)return[t[0],n];{let o=n.x,u=n.y,p=n.x,f=n.y;for(const _ of t)o=Math.min(o,_.x),u=Math.min(u,_.y),p=Math.max(p,_.x),f=Math.max(f,_.y);return[new a.pointGeometry(o,u),new a.pointGeometry(p,u),new a.pointGeometry(p,f),new a.pointGeometry(o,f),new a.pointGeometry(o,u)]}}}class al{constructor(t){this._hashName=t&&encodeURIComponent(t),a.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(n,o){let u=!1,p=null;const f=()=>{p=null,u&&(n(),p=setTimeout(f,300),u=!1)};return()=>(u=!0,p||f(),p)}(this._updateHashUnthrottled.bind(this))}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const n=this._map.getCenter(),o=Math.round(100*this._map.getZoom())/100,u=Math.ceil((o*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,u),f=Math.round(n.lng*p)/p,_=Math.round(n.lat*p)/p,y=this._map.getBearing(),v=this._map.getPitch();let T="";if(T+=t?`/${f}/${_}/${o}`:`${o}/${_}/${f}`,(y||v)&&(T+="/"+Math.round(10*y)/10),v&&(T+=`/${Math.round(v)}`),this._hashName){const I=this._hashName;let M=!1;const U=window.location.hash.slice(1).split("&").map(R=>{const O=R.split("=")[0];return O===I?(M=!0,`${O}=${T}`):R}).filter(R=>R);return M||U.push(`${I}=${T}`),`#${U.join("&")}`}return`#${T}`}_getCurrentHash(){const t=window.location.hash.replace("#","");if(this._hashName){let n;return t.split("&").map(o=>o.split("=")).forEach(o=>{o[0]===this._hashName&&(n=o)}),(n&&n[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._getCurrentHash();if(t.length>=3&&!t.some(n=>isNaN(n))){const n=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:n,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,t)}catch{}}}const Ms={linearity:.3,easing:a.bezier(0,0,.3,1)},ll=a.extend({deceleration:2500,maxSpeed:1400},Ms),cl=a.extend({deceleration:20,maxSpeed:1400},Ms),ul=a.extend({deceleration:1e3,maxSpeed:360},Ms),Qn=a.extend({deceleration:1e3,maxSpeed:90},Ms);class hl{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=a.exported.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new a.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:p}of this._inertiaBuffer)n.zoom+=p.zoomDelta||0,n.bearing+=p.bearingDelta||0,n.pitch+=p.pitchDelta||0,p.panDelta&&n.pan._add(p.panDelta),p.around&&(n.around=p.around),p.pinchAround&&(n.pinchAround=p.pinchAround);const o=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,u={};if(n.pan.mag()){const p=Ps(n.pan.mag(),o,a.extend({},ll,t||{}));u.offset=n.pan.mult(p.amount/n.pan.mag()),u.center=this._map.transform.center,zs(u,p)}if(n.zoom){const p=Ps(n.zoom,o,cl);u.zoom=this._map.transform.zoom+p.amount,zs(u,p)}if(n.bearing){const p=Ps(n.bearing,o,ul);u.bearing=this._map.transform.bearing+a.clamp(p.amount,-179,179),zs(u,p)}if(n.pitch){const p=Ps(n.pitch,o,Qn);u.pitch=this._map.transform.pitch+p.amount,zs(u,p)}if(u.zoom||u.bearing){const p=n.pinchAround===void 0?n.around:n.pinchAround;u.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),a.extend(u,{noMoveStart:!0})}}function zs(l,t){(!l.duration||l.duration<t.duration)&&(l.duration=t.duration,l.easing=t.easing)}function Ps(l,t,n){const{maxSpeed:o,linearity:u,deceleration:p}=n,f=a.clamp(l*u/(t/1e3),-o,o),_=Math.abs(f)/(p*u);return{easing:n.easing,duration:1e3*_,amount:f*(_/2)}}class Ni extends a.Event{constructor(t,n,o,u={}){const p=Y.mousePos(n.getCanvasContainer(),o),f=n.unproject(p);super(t,a.extend({point:p,lngLat:f,originalEvent:o},u)),this._defaultPrevented=!1,this.target=n}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Ds extends a.Event{constructor(t,n,o){const u=t==="touchend"?o.changedTouches:o.touches,p=Y.touchPos(n.getCanvasContainer(),u),f=p.map(y=>n.unproject(y)),_=p.reduce((y,v,T,I)=>y.add(v.div(I.length)),new a.pointGeometry(0,0));super(t,{points:p,point:_,lngLats:f,lngLat:n.unproject(_),originalEvent:o}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class $i extends a.Event{constructor(t,n,o){super(t,{originalEvent:o}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class yc{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new $i(t.type,this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new Ni(t.type,this._map,t))}mouseup(t){this._map.fire(new Ni(t.type,this._map,t))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new Ni(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Ni(t.type,this._map,t))}mouseover(t){this._map.fire(new Ni(t.type,this._map,t))}mouseout(t){this._map.fire(new Ni(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Ds(t.type,this._map,t))}touchmove(t){this._map.fire(new Ds(t.type,this._map,t))}touchend(t){this._map.fire(new Ds(t.type,this._map,t))}touchcancel(t){this._map.fire(new Ds(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Yr{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Ni(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ni("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Ni(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class pl{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(Y.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const o=n;if(this._lastPos.equals(o)||!this._box&&o.dist(this._startPos)<this._clickTolerance)return;const u=this._startPos;this._lastPos=o,this._box||(this._box=Y.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const p=Math.min(u.x,o.x),f=Math.max(u.x,o.x),_=Math.min(u.y,o.y),y=Math.max(u.y,o.y);Y.setTransform(this._box,`translate(${p}px,${_}px)`),this._box.style.width=f-p+"px",this._box.style.height=y-_+"px"}mouseupWindow(t,n){if(!this._active||t.button!==0)return;const o=this._startPos,u=n;if(this.reset(),Y.suppressClick(),o.x!==u.x||o.y!==u.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:p=>p.fitScreenCoordinates(o,u,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(Y.remove(this._box),this._box=null),Y.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new a.Event(t,{originalEvent:n}))}}function zr(l,t){if(l.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${l.length}, points ${t.length}`);const n={};for(let o=0;o<l.length;o++)n[l[o].identifier]=t[o];return n}class Ls{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,n,o){(this.centroid||o.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),o.length===this.numTouches&&(this.centroid=function(u){const p=new a.pointGeometry(0,0);for(const f of u)p._add(f);return p.div(u.length)}(n),this.touches=zr(o,n)))}touchmove(t,n,o){if(this.aborted||!this.centroid)return;const u=zr(o,n);for(const p in this.touches){const f=this.touches[p],_=u[p];(!_||_.dist(f)>30)&&(this.aborted=!0)}}touchend(t,n,o){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),o.length===0){const u=!this.aborted&&this.centroid;if(this.reset(),u)return u}}}class Jo{constructor(t){this.singleTap=new Ls(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,n,o){this.singleTap.touchstart(t,n,o)}touchmove(t,n,o){this.singleTap.touchmove(t,n,o)}touchend(t,n,o){const u=this.singleTap.touchend(t,n,o);if(u){const p=t.timeStamp-this.lastTime<500,f=!this.lastTap||this.lastTap.dist(u)<30;if(p&&f||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=u,this.count===this.numTaps)return this.reset(),u}}}class xc{constructor(){this._zoomIn=new Jo({numTouches:1,numTaps:2}),this._zoomOut=new Jo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,o){this._zoomIn.touchstart(t,n,o),this._zoomOut.touchstart(t,n,o)}touchmove(t,n,o){this._zoomIn.touchmove(t,n,o),this._zoomOut.touchmove(t,n,o)}touchend(t,n,o){const u=this._zoomIn.touchend(t,n,o),p=this._zoomOut.touchend(t,n,o);return u?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:f=>f.easeTo({duration:300,zoom:f.getZoom()+1,around:f.unproject(u)},{originalEvent:t})}):p?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:f=>f.easeTo({duration:300,zoom:f.getZoom()-1,around:f.unproject(p)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const vc={0:1,2:2};class co{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(t,n){return!1}_move(t,n){return{}}mousedown(t,n){if(this._lastPoint)return;const o=Y.mouseButton(t);this._correctButton(t,o)&&(this._lastPoint=n,this._eventButton=o)}mousemoveWindow(t,n){const o=this._lastPoint;if(o){if(t.preventDefault(),function(u,p){const f=vc[p];return u.buttons===void 0||(u.buttons&f)!==f}(t,this._eventButton))this.reset();else if(this._moved||!(n.dist(o)<this._clickTolerance))return this._moved=!0,this._lastPoint=n,this._move(o,n)}}mouseupWindow(t){this._lastPoint&&Y.mouseButton(t)===this._eventButton&&(this._moved&&Y.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bs extends co{mousedown(t,n){super.mousedown(t,n),this._lastPoint&&(this._active=!0)}_correctButton(t,n){return n===0&&!t.ctrlKey}_move(t,n){return{around:n,panDelta:n.sub(t)}}}class Pr extends co{_correctButton(t,n){return n===0&&t.ctrlKey||n===2}_move(t,n){const o=.8*(n.x-t.x);if(o)return this._active=!0,{bearingDelta:o}}contextmenu(t){t.preventDefault()}}class Oe extends co{_correctButton(t,n){return n===0&&t.ctrlKey||n===2}_move(t,n){const o=-.5*(n.y-t.y);if(o)return this._active=!0,{pitchDelta:o}}contextmenu(t){t.preventDefault()}}class dl{constructor(t,n){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,n,o){return this._calculateTransform(t,n,o)}touchmove(t,n,o){if(this._map._cooperativeGestures&&(this._minTouches===2&&o.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,o.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(o.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,n,o)}touchend(t,n,o){this._calculateTransform(t,n,o),this._active&&o.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,o){o.length>0&&(this._active=!0);const u=zr(o,n),p=new a.pointGeometry(0,0),f=new a.pointGeometry(0,0);let _=0;for(const v in u){const T=u[v],I=this._touches[v];I&&(p._add(T),f._add(T.sub(I)),_++,u[v]=T)}if(this._touches=u,_<this._minTouches||!f.mag())return;const y=f.div(_);return this._sum._add(y),this._sum.mag()<this._clickTolerance?void 0:{around:p.div(_),panDelta:y}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xn{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(t){}_move(t,n,o){return{}}touchstart(t,n,o){this._firstTwoTouches||o.length<2||(this._firstTwoTouches=[o[0].identifier,o[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,o){if(!this._firstTwoTouches)return;t.preventDefault();const[u,p]=this._firstTwoTouches,f=Jr(o,n,u),_=Jr(o,n,p);if(!f||!_)return;const y=this._aroundCenter?null:f.add(_).div(2);return this._move([f,_],y,t)}touchend(t,n,o){if(!this._firstTwoTouches)return;const[u,p]=this._firstTwoTouches,f=Jr(o,n,u),_=Jr(o,n,p);f&&_||(this._active&&Y.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Jr(l,t,n){for(let o=0;o<l.length;o++)if(l[o].identifier===n)return t[o]}function Qo(l,t){return Math.log(l/t)/Math.LN2}class ze extends xn{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const o=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Qo(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Qo(this._distance,o),pinchAround:n}}}function uo(l,t){return 180*l.angleWith(t)/Math.PI}class bc extends xn{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n){const o=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:uo(this._vector,o),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,o=uo(t,this._startVector);return Math.abs(o)<n}}function ea(l){return Math.abs(l.y)>Math.abs(l.x)}class ta extends xn{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,n,o){super.touchstart(t,n,o),this._currentTouchCount=o.length}_start(t){this._lastPoints=t,ea(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,o){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const u=t[0].sub(this._lastPoints[0]),p=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(u,p,o.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(u.y+p.y)/2*-.5}):void 0}gestureBeginsVertically(t,n,o){if(this._valid!==void 0)return this._valid;const u=t.mag()>=2,p=n.mag()>=2;if(!u&&!p)return;if(!u||!p)return this._firstMove===void 0&&(this._firstMove=o),o-this._firstMove<100&&void 0;const f=t.y>0==n.y>0;return ea(t)&&ea(n)&&f}}const fl={panStep:100,bearingStep:15,pitchStep:10};class ml{constructor(){const t=fl;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,o=0,u=0,p=0,f=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?o=-1:(t.preventDefault(),p=-1);break;case 39:t.shiftKey?o=1:(t.preventDefault(),p=1);break;case 38:t.shiftKey?u=1:(t.preventDefault(),f=-1);break;case 40:t.shiftKey?u=-1:(t.preventDefault(),f=1);break;default:return}return this._rotationDisabled&&(o=0,u=0),{cameraAnimation:_=>{const y=_.getZoom();_.easeTo({duration:300,easeId:"keyboardHandler",easing:wc,zoom:n?Math.round(y)+n*(t.shiftKey?2:1):y,bearing:_.getBearing()+o*this._bearingStep,pitch:_.getPitch()+u*this._pitchStep,offset:[-p*this._panStep,-f*this._panStep],center:_.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function wc(l){return l*(2-l)}const gl=4.000244140625;class ia{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._handler=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,a.bindAll(["_onTimeout"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;t.preventDefault()}let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const o=a.exported.now(),u=o-(this._lastWheelEventTime||0);this._lastWheelEventTime=o,n!==0&&n%gl==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":u>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(u*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=Y.mousePos(this._el,t);this._around=a.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(n)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;if(this._delta!==0){const _=this._type==="wheel"&&Math.abs(this._delta)>gl?this._wheelZoomRate:this._defaultZoomRate;let y=2/(1+Math.exp(-Math.abs(this._delta*_)));this._delta<0&&y!==0&&(y=1/y);const v=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(v*y))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,o=this._startZoom,u=this._easing;let p,f=!1;if(this._type==="wheel"&&o&&u){const _=Math.min((a.exported.now()-this._lastWheelEventTime)/200,1),y=u(_);p=a.number(o,n,y),_<1?this._frameId||(this._frameId=!0):f=!0}else p=n,f=!0;return this._active=!0,f&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!f,zoomDelta:p-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=a.ease;if(this._prevEase){const o=this._prevEase,u=(a.exported.now()-o.start)/o.duration,p=o.easing(u+.01)-o.easing(u),f=.27/Math.sqrt(p*p+1e-4)*.01,_=Math.sqrt(.0729-f*f);n=a.bezier(f,_,.25,1)}return this._prevEase={start:a.exported.now(),duration:t,easing:n},n}reset(){this._active=!1}}class ra{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class na{constructor(){this.reset()}reset(){this._active=!1}dblclick(t,n){return t.preventDefault(),{cameraAnimation:o=>{o.easeTo({duration:300,zoom:o.getZoom()+(t.shiftKey?-1:1),around:o.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sa{constructor(){this._tap=new Jo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(t,n,o){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?o.length>0&&(this._swipePoint=n[0],this._swipeTouch=o[0].identifier):this._tap.touchstart(t,n,o))}touchmove(t,n,o){if(this._tapTime){if(this._swipePoint){if(o[0].identifier!==this._swipeTouch)return;const u=n[0],p=u.y-this._swipePoint.y;return this._swipePoint=u,t.preventDefault(),this._active=!0,{zoomDelta:p/128}}}else this._tap.touchmove(t,n,o)}touchend(t,n,o){this._tapTime?this._swipePoint&&o.length===0&&this.reset():this._tap.touchend(t,n,o)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pi{constructor(t,n,o){this._el=t,this._mousePan=n,this._touchPan=o}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Qr{constructor(t,n,o){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=o}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class _l{constructor(t,n,o,u){this._el=t,this._touchZoom=n,this._touchRotate=o,this._tapDragZoom=u,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const es=l=>l.zoom||l.drag||l.pitch||l.rotate;class oa extends a.Event{}function Rs(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}class yl{constructor(t,n){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new hl(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n),a.bindAll(["handleEvent","handleWindowEvent"],this);const o=this._el;this._listeners=[[o,"touchstart",{passive:!0}],[o,"touchmove",{passive:!1}],[o,"touchend",void 0],[o,"touchcancel",void 0],[o,"mousedown",void 0],[o,"mousemove",void 0],[o,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[o,"mouseover",void 0],[o,"mouseout",void 0],[o,"dblclick",void 0],[o,"click",void 0],[o,"keydown",{capture:!1}],[o,"keyup",void 0],[o,"wheel",{passive:!1}],[o,"contextmenu",void 0],[window,"blur",void 0]];for(const[u,p,f]of this._listeners)Y.addEventListener(u,p,u===document?this.handleWindowEvent:this.handleEvent,f)}destroy(){for(const[t,n,o]of this._listeners)Y.removeEventListener(t,n,t===document?this.handleWindowEvent:this.handleEvent,o)}_addDefaultHandlers(t){const n=this._map,o=n.getCanvasContainer();this._add("mapEvent",new yc(n,t));const u=n.boxZoom=new pl(n,t);this._add("boxZoom",u);const p=new xc,f=new na;n.doubleClickZoom=new ra(f,p),this._add("tapZoom",p),this._add("clickZoom",f);const _=new sa;this._add("tapDragZoom",_);const y=n.touchPitch=new ta(n);this._add("touchPitch",y);const v=new Pr(t),T=new Oe(t);n.dragRotate=new Qr(t,v,T),this._add("mouseRotate",v,["mousePitch"]),this._add("mousePitch",T,["mouseRotate"]);const I=new Bs(t),M=new dl(t,n);n.dragPan=new Pi(o,I,M),this._add("mousePan",I),this._add("touchPan",M,["touchZoom","touchRotate"]);const U=new bc,R=new ze;n.touchZoomRotate=new _l(o,R,U,_),this._add("touchRotate",U,["touchPan","touchZoom"]),this._add("touchZoom",R,["touchPan","touchRotate"]);const O=n.scrollZoom=new ia(n,this);this._add("scrollZoom",O,["mousePan"]);const H=n.keyboard=new ml;this._add("keyboard",H),this._add("blockableMapEvent",new Yr(n));for(const Q of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[Q]&&n[Q].enable(t[Q])}_add(t,n,o){this._handlers.push({handlerName:t,handler:n,allowed:o}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(es(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,n,o){for(const u in t)if(u!==o&&(!n||n.indexOf(u)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const n=[];for(const o of t)this._el.contains(o.target)&&n.push(o);return n}handleEvent(t,n){if(t.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const o=t.type==="renderFrame"?void 0:t,u={needsRenderFrame:!1},p={},f={},_=t.touches,y=_?this._getMapTouches(_):void 0,v=y?Y.touchPos(this._el,y):Y.mousePos(this._el,t);for(const{handlerName:M,handler:U,allowed:R}of this._handlers){if(!U.isEnabled())continue;let O;this._blockedByActive(f,R,M)?U.reset():U[n||t.type]&&(O=U[n||t.type](t,v,y),this.mergeHandlerResult(u,p,O,M,o),O&&O.needsRenderFrame&&this._triggerRenderFrame()),(O||U.isActive())&&(f[M]=U)}const T={};for(const M in this._previousActiveHandlers)f[M]||(T[M]=o);this._previousActiveHandlers=f,(Object.keys(T).length||Rs(u))&&(this._changes.push([u,p,T]),this._triggerRenderFrame()),(Object.keys(f).length||Rs(u))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:I}=u;I&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],I(this._map))}mergeHandlerResult(t,n,o,u,p){if(!o)return;a.extend(t,o);const f={handlerName:u,originalEvent:o.originalEvent||p};o.zoomDelta!==void 0&&(n.zoom=f),o.panDelta!==void 0&&(n.drag=f),o.pitchDelta!==void 0&&(n.pitch=f),o.bearingDelta!==void 0&&(n.rotate=f)}_applyChanges(){const t={},n={},o={};for(const[u,p,f]of this._changes)u.panDelta&&(t.panDelta=(t.panDelta||new a.pointGeometry(0,0))._add(u.panDelta)),u.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+u.zoomDelta),u.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+u.bearingDelta),u.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+u.pitchDelta),u.around!==void 0&&(t.around=u.around),u.pinchAround!==void 0&&(t.pinchAround=u.pinchAround),u.noInertia&&(t.noInertia=u.noInertia),a.extend(n,p),a.extend(o,f);this._updateMapTransform(t,n,o),this._changes=[]}_updateMapTransform(t,n,o){const u=this._map,p=u.transform,f=u.style&&u.style.terrain;if(!(Rs(t)||f&&this._drag))return this._fireEvents(n,o,!0);let{panDelta:_,zoomDelta:y,bearingDelta:v,pitchDelta:T,around:I,pinchAround:M}=t;M!==void 0&&(I=M),u._stop(!0),I=I||u.transform.centerPoint;const U=p.pointLocation(_?I.sub(_):I);v&&(p.bearing+=v),T&&(p.pitch+=T),y&&(p.zoom+=y),f?n.drag&&!this._drag?(this._drag={center:p.centerPoint,lngLat:p.pointLocation(I),point:I,handlerName:n.drag.handlerName},u.fire(new a.Event("freezeElevation",{freeze:!0}))):this._drag&&o[this._drag.handlerName]?(u.fire(new a.Event("freezeElevation",{freeze:!1})),this._drag=null):n.drag&&this._drag&&(p.center=p.pointLocation(p.centerPoint.sub(_))):p.setLocationAtPoint(U,I),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,o,!0)}_fireEvents(t,n,o){const u=es(this._eventsInProgress),p=es(t),f={};for(const T in t){const{originalEvent:I}=t[T];this._eventsInProgress[T]||(f[`${T}start`]=I),this._eventsInProgress[T]=t[T]}!u&&p&&this._fireEvent("movestart",p.originalEvent);for(const T in f)this._fireEvent(T,f[T]);p&&this._fireEvent("move",p.originalEvent);for(const T in t){const{originalEvent:I}=t[T];this._fireEvent(T,I)}const _={};let y;for(const T in this._eventsInProgress){const{handlerName:I,originalEvent:M}=this._eventsInProgress[T];this._handlersById[I].isActive()||(delete this._eventsInProgress[T],y=n[I]||M,_[`${T}end`]=y)}for(const T in _)this._fireEvent(T,_[T]);const v=es(this._eventsInProgress);if(o&&(u||p)&&!v){this._updatingCamera=!0;const T=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),I=M=>M!==0&&-this._bearingSnap<M&&M<this._bearingSnap;T?(I(T.bearing||this._map.getBearing())&&(T.bearing=0),this._map.easeTo(T,{originalEvent:y})):(this._map.fire(new a.Event("moveend",{originalEvent:y})),I(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new a.Event(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new oa("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Qi={extend:(l,...t)=>a.extend(l,...t),run(l){l()},logToElement(l,t=!1,n="log"){const o=window.document.getElementById(n);o&&(t&&(o.innerHTML=""),o.innerHTML+=`<br>${l}`)}};class Gt extends a.Evented{constructor(t,n){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,a.bindAll(["_renderFrameCallback"],this)}getCenter(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}panBy(t,n,o){return t=a.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,a.extend({offset:t},n),o)}panTo(t,n,o){return this.easeTo(a.extend({center:t},n),o)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,o){return this.easeTo(a.extend({zoom:t},n),o)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,o){return this.easeTo(a.extend({bearing:t},n),o)}resetNorth(t,n){return this.rotateTo(0,a.extend({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}cameraForBounds(t,n){t=a.LngLatBounds.convert(t);const o=n&&n.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),o,n)}_cameraForBoxAndBearing(t,n,o,u){const p={top:0,bottom:0,right:0,left:0};if(typeof(u=a.extend({padding:p,offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=="number"){const ne=u.padding;u.padding={top:ne,bottom:ne,right:ne,left:ne}}u.padding=a.extend(p,u.padding);const f=this.transform,_=f.padding,y=f.project(a.LngLat.convert(t)),v=f.project(a.LngLat.convert(n)),T=y.rotate(-o*Math.PI/180),I=v.rotate(-o*Math.PI/180),M=new a.pointGeometry(Math.max(T.x,I.x),Math.max(T.y,I.y)),U=new a.pointGeometry(Math.min(T.x,I.x),Math.min(T.y,I.y)),R=M.sub(U),O=(f.width-(_.left+_.right+u.padding.left+u.padding.right))/R.x,H=(f.height-(_.top+_.bottom+u.padding.top+u.padding.bottom))/R.y;if(H<0||O<0)return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Q=Math.min(f.scaleZoom(f.scale*Math.min(O,H)),u.maxZoom),re=a.pointGeometry.convert(u.offset),V=new a.pointGeometry((u.padding.left-u.padding.right)/2,(u.padding.top-u.padding.bottom)/2).rotate(o*Math.PI/180),oe=re.add(V).mult(f.scale/f.zoomScale(Q));return{center:f.unproject(y.add(v).div(2).sub(oe)),zoom:Q,bearing:o}}fitBounds(t,n,o){return this._fitInternal(this.cameraForBounds(t,n),n,o)}fitScreenCoordinates(t,n,o,u,p){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.pointGeometry.convert(t)),this.transform.pointLocation(a.pointGeometry.convert(n)),o,u),u,p)}_fitInternal(t,n,o){return t?(delete(n=a.extend(t,n)).padding,n.linear?this.easeTo(n,o):this.flyTo(n,o)):this}jumpTo(t,n){this.stop();const o=this.transform;let u=!1,p=!1,f=!1;return"zoom"in t&&o.zoom!==+t.zoom&&(u=!0,o.zoom=+t.zoom),t.center!==void 0&&(o.center=a.LngLat.convert(t.center)),"bearing"in t&&o.bearing!==+t.bearing&&(p=!0,o.bearing=+t.bearing),"pitch"in t&&o.pitch!==+t.pitch&&(f=!0,o.pitch=+t.pitch),t.padding==null||o.isPaddingEqual(t.padding)||(o.padding=t.padding),this.fire(new a.Event("movestart",n)).fire(new a.Event("move",n)),u&&this.fire(new a.Event("zoomstart",n)).fire(new a.Event("zoom",n)).fire(new a.Event("zoomend",n)),p&&this.fire(new a.Event("rotatestart",n)).fire(new a.Event("rotate",n)).fire(new a.Event("rotateend",n)),f&&this.fire(new a.Event("pitchstart",n)).fire(new a.Event("pitch",n)).fire(new a.Event("pitchend",n)),this.fire(new a.Event("moveend",n))}calculateCameraOptionsFromTo(t,n,o,u=0){const p=a.MercatorCoordinate.fromLngLat(t,n),f=a.MercatorCoordinate.fromLngLat(o,u),_=f.x-p.x,y=f.y-p.y,v=f.z-p.z,T=Math.hypot(_,y,v);if(T===0)throw new Error("Can't calculate camera options with same From and To");const I=Math.hypot(_,y),M=this.transform.scaleZoom(this.transform.cameraToCenterDistance/T/this.transform.tileSize),U=180*Math.atan2(_,-y)/Math.PI;let R=180*Math.acos(I/T)/Math.PI;return R=v<0?90-R:90+R,{center:f.toLngLat(),zoom:M,pitch:R,bearing:U}}easeTo(t,n){this._stop(!1,t.easeId),((t=a.extend({offset:[0,0],duration:500,easing:a.ease},t)).animate===!1||!t.essential&&a.exported.prefersReducedMotion)&&(t.duration=0);const o=this.transform,u=this.getZoom(),p=this.getBearing(),f=this.getPitch(),_=this.getPadding(),y="zoom"in t?+t.zoom:u,v="bearing"in t?this._normalizeBearing(t.bearing,p):p,T="pitch"in t?+t.pitch:f,I="padding"in t?t.padding:o.padding,M=a.pointGeometry.convert(t.offset);let U=o.centerPoint.add(M);const R=o.pointLocation(U),O=a.LngLat.convert(t.center||R);this._normalizeCenter(O);const H=o.project(R),Q=o.project(O).sub(H),re=o.zoomScale(y-u);let V,oe;t.around&&(V=a.LngLat.convert(t.around),oe=o.locationPoint(V));const ne={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||y!==u,this._rotating=this._rotating||p!==v,this._pitching=this._pitching||T!==f,this._padding=!o.isPaddingEqual(I),this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,ne),this._ease(de=>{if(this._zooming&&(o.zoom=a.number(u,y,de)),this._rotating&&(o.bearing=a.number(p,v,de)),this._pitching&&(o.pitch=a.number(f,T,de)),this._padding&&(o.interpolatePadding(_,I,de),U=o.centerPoint.add(M)),V)o.setLocationAtPoint(V,oe);else{const fe=o.zoomScale(o.zoom-u),we=y>u?Math.min(2,re):Math.max(.5,re),he=Math.pow(we,1-de),Be=o.unproject(H.add(Q.mult(de*he)).mult(fe));o.setLocationAtPoint(o.renderWorldCopies?Be.wrap():Be,U)}this._fireMoveEvents(n)},de=>{this._afterEase(n,de)},t),this}_prepareEase(t,n,o={}){this._moving=!0,this.fire(new a.Event("freezeElevation",{freeze:!0})),n||o.moving||this.fire(new a.Event("movestart",t)),this._zooming&&!o.zooming&&this.fire(new a.Event("zoomstart",t)),this._rotating&&!o.rotating&&this.fire(new a.Event("rotatestart",t)),this._pitching&&!o.pitching&&this.fire(new a.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new a.Event("move",t)),this._zooming&&this.fire(new a.Event("zoom",t)),this._rotating&&this.fire(new a.Event("rotate",t)),this._pitching&&this.fire(new a.Event("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId,this.fire(new a.Event("freezeElevation",{freeze:!1}));const o=this._zooming,u=this._rotating,p=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,o&&this.fire(new a.Event("zoomend",t)),u&&this.fire(new a.Event("rotateend",t)),p&&this.fire(new a.Event("pitchend",t)),this.fire(new a.Event("moveend",t))}flyTo(t,n){if(!t.essential&&a.exported.prefersReducedMotion){const je=a.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(je,n)}this.stop(),t=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.ease},t);const o=this.transform,u=this.getZoom(),p=this.getBearing(),f=this.getPitch(),_=this.getPadding(),y="zoom"in t?a.clamp(+t.zoom,o.minZoom,o.maxZoom):u,v="bearing"in t?this._normalizeBearing(t.bearing,p):p,T="pitch"in t?+t.pitch:f,I="padding"in t?t.padding:o.padding,M=o.zoomScale(y-u),U=a.pointGeometry.convert(t.offset);let R=o.centerPoint.add(U);const O=o.pointLocation(R),H=a.LngLat.convert(t.center||O);this._normalizeCenter(H);const Q=o.project(O),re=o.project(H).sub(Q);let V=t.curve;const oe=Math.max(o.width,o.height),ne=oe/M,de=re.mag();if("minZoom"in t){const je=a.clamp(Math.min(t.minZoom,u,y),o.minZoom,o.maxZoom),kt=oe/o.zoomScale(je-u);V=Math.sqrt(kt/de*2)}const fe=V*V;function we(je){const kt=(ne*ne-oe*oe+(je?-1:1)*fe*fe*de*de)/(2*(je?ne:oe)*fe*de);return Math.log(Math.sqrt(kt*kt+1)-kt)}function he(je){return(Math.exp(je)-Math.exp(-je))/2}function Be(je){return(Math.exp(je)+Math.exp(-je))/2}const Ae=we(0);let Re=function(je){return Be(Ae)/Be(Ae+V*je)},rt=function(je){return oe*((Be(Ae)*(he(kt=Ae+V*je)/Be(kt))-he(Ae))/fe)/de;var kt},lt=(we(1)-Ae)/V;if(Math.abs(de)<1e-6||!isFinite(lt)){if(Math.abs(oe-ne)<1e-6)return this.easeTo(t,n);const je=ne<oe?-1:1;lt=Math.abs(Math.log(ne/oe))/V,rt=function(){return 0},Re=function(kt){return Math.exp(je*V*kt)}}return t.duration="duration"in t?+t.duration:1e3*lt/("screenSpeed"in t?+t.screenSpeed/V:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=p!==v,this._pitching=T!==f,this._padding=!o.isPaddingEqual(I),this._prepareEase(n,!1),this._ease(je=>{const kt=je*lt,Mt=1/Re(kt);o.zoom=je===1?y:u+o.scaleZoom(Mt),this._rotating&&(o.bearing=a.number(p,v,je)),this._pitching&&(o.pitch=a.number(f,T,je)),this._padding&&(o.interpolatePadding(_,I,je),R=o.centerPoint.add(U));const mt=je===1?H:o.unproject(Q.add(re.mult(rt(kt))).mult(Mt));o.setLocationAtPoint(o.renderWorldCopies?mt.wrap():mt,R),this._fireMoveEvents(n)},()=>this._afterEase(n),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const o=this._onEaseEnd;delete this._onEaseEnd,o.call(this,n)}if(!t){const o=this.handlers;o&&o.stop(!1)}return this}_ease(t,n,o){o.animate===!1||o.duration===0?(t(1),n()):(this._easeStart=a.exported.now(),this._easeOptions=o,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((a.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,n){t=a.wrap(t,-180,180);const o=Math.abs(t-n);return Math.abs(t-360-n)<o&&(t-=360),Math.abs(t+360-n)<o&&(t+=360),t}_normalizeCenter(t){const n=this.transform;if(!n.renderWorldCopies||n.lngRange)return;const o=t.lng-n.center.lng;t.lng+=o>180?-360:o<-180?360:0}}class Fs{constructor(t={}){this.options=t,a.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=Y.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Y.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Y.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Y.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,n){const o=this._map._getUIString(`AttributionControl.${n}`);t.title=o,t.setAttribute("aria-label",o)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"&&t.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(u=>typeof u!="string"?"":u)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}const n=this._map.style.sourceCaches;for(const u in n){const p=n[u];if(p.used||p.usedForTerrain){const f=p.getSource();f.attribution&&t.indexOf(f.attribution)<0&&t.push(f.attribution)}}t=t.filter(u=>String(u).trim()),t.sort((u,p)=>u.length-p.length),t=t.filter((u,p)=>{for(let f=p+1;f<t.length;f++)if(t[f].indexOf(u)>=0)return!1;return!0});const o=t.join(" | ");o!==this._attribHTML&&(this._attribHTML=o,t.length?(this._innerContainer.innerHTML=o,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class ho{constructor(t={}){this.options=t,a.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=Y.create("div","maplibregl-ctrl mapboxgl-ctrl");const n=Y.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Y.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const t=this._container.children;if(t.length){const n=t[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&n.classList.add("maplibregl-compact","mapboxgl-compact"):n.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class xl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,o=n?this._queue.concat(n):this._queue;for(const u of o)if(u.id===t)return void(u.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const o of n)if(!o.cancelled&&(o.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const vl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},bl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},Tc={showCompass:!0,showZoom:!0,visualizePitch:!1};class yr{constructor(t,n,o=!1){this._clickTolerance=10,this.element=n,this.mouseRotate=new Pr({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,o&&(this.mousePitch=new Oe({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),a.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),Y.addEventListener(n,"mousedown",this.mousedown),Y.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),Y.addEventListener(n,"touchmove",this.touchmove),Y.addEventListener(n,"touchend",this.touchend),Y.addEventListener(n,"touchcancel",this.reset)}down(t,n){this.mouseRotate.mousedown(t,n),this.mousePitch&&this.mousePitch.mousedown(t,n),Y.disableDrag()}move(t,n){const o=this.map,u=this.mouseRotate.mousemoveWindow(t,n);if(u&&u.bearingDelta&&o.setBearing(o.getBearing()+u.bearingDelta),this.mousePitch){const p=this.mousePitch.mousemoveWindow(t,n);p&&p.pitchDelta&&o.setPitch(o.getPitch()+p.pitchDelta)}}off(){const t=this.element;Y.removeEventListener(t,"mousedown",this.mousedown),Y.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),Y.removeEventListener(t,"touchmove",this.touchmove),Y.removeEventListener(t,"touchend",this.touchend),Y.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){Y.enableDrag(),Y.removeEventListener(window,"mousemove",this.mousemove),Y.removeEventListener(window,"mouseup",this.mouseup)}mousedown(t){this.down(a.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Y.mousePos(this.element,t)),Y.addEventListener(window,"mousemove",this.mousemove),Y.addEventListener(window,"mouseup",this.mouseup)}mousemove(t){this.move(t,Y.mousePos(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Y.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=Y.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Os(l,t,n){if(l=new a.LngLat(l.lng,l.lat),t){const o=new a.LngLat(l.lng-360,l.lat),u=new a.LngLat(l.lng+360,l.lat),p=n.locationPoint(l).distSqr(t);n.locationPoint(o).distSqr(t)<p?l=o:n.locationPoint(u).distSqr(t)<p&&(l=u)}for(;Math.abs(l.lng-n.center.lng)>180;){const o=n.locationPoint(l);if(o.x>=0&&o.y>=0&&o.x<=n.width&&o.y<=n.height)break;l.lng>n.center.lng?l.lng-=360:l.lng+=360}return l}const Ge={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ke(l,t,n){const o=l.classList;for(const u in Ge)o.remove(`maplibregl-${n}-anchor-${u}`,`mapboxgl-${n}-anchor-${u}`);o.add(`maplibregl-${n}-anchor-${t}`,`mapboxgl-${n}-anchor-${t}`)}class ts extends a.Evented{constructor(t,n){if(super(),(t instanceof HTMLElement||n)&&(t=a.extend({element:t},n)),a.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=a.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=Y.create("div"),this._element.setAttribute("aria-label","Map marker");const o=Y.createNS("http://www.w3.org/2000/svg","svg"),u=41,p=27;o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height",`${u}px`),o.setAttributeNS(null,"width",`${p}px`),o.setAttributeNS(null,"viewBox",`0 0 ${p} ${u}`);const f=Y.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"stroke","none"),f.setAttributeNS(null,"stroke-width","1"),f.setAttributeNS(null,"fill","none"),f.setAttributeNS(null,"fill-rule","evenodd");const _=Y.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"fill-rule","nonzero");const y=Y.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"transform","translate(3.0, 29.0)"),y.setAttributeNS(null,"fill","#000000");const v=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const re of v){const V=Y.createNS("http://www.w3.org/2000/svg","ellipse");V.setAttributeNS(null,"opacity","0.04"),V.setAttributeNS(null,"cx","10.5"),V.setAttributeNS(null,"cy","5.80029008"),V.setAttributeNS(null,"rx",re.rx),V.setAttributeNS(null,"ry",re.ry),y.appendChild(V)}const T=Y.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill",this._color);const I=Y.createNS("http://www.w3.org/2000/svg","path");I.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),T.appendChild(I);const M=Y.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"opacity","0.25"),M.setAttributeNS(null,"fill","#000000");const U=Y.createNS("http://www.w3.org/2000/svg","path");U.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),M.appendChild(U);const R=Y.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(6.0, 7.0)"),R.setAttributeNS(null,"fill","#FFFFFF");const O=Y.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"transform","translate(8.0, 8.0)");const H=Y.createNS("http://www.w3.org/2000/svg","circle");H.setAttributeNS(null,"fill","#000000"),H.setAttributeNS(null,"opacity","0.25"),H.setAttributeNS(null,"cx","5.5"),H.setAttributeNS(null,"cy","5.5"),H.setAttributeNS(null,"r","5.4999962");const Q=Y.createNS("http://www.w3.org/2000/svg","circle");Q.setAttributeNS(null,"fill","#FFFFFF"),Q.setAttributeNS(null,"cx","5.5"),Q.setAttributeNS(null,"cy","5.5"),Q.setAttributeNS(null,"r","5.4999962"),O.appendChild(H),O.appendChild(Q),_.appendChild(y),_.appendChild(T),_.appendChild(M),_.appendChild(R),_.appendChild(O),o.appendChild(_),o.setAttributeNS(null,"height",u*this._scale+"px"),o.setAttributeNS(null,"width",p*this._scale+"px"),this._element.appendChild(o),this._offset=a.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",o=>{o.preventDefault()}),this._element.addEventListener("mousedown",o=>{o.preventDefault()}),Ke(this._element,this._anchor,"marker"),this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Y.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=a.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const u=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[u,-1*(38.1-13.5+u)],"bottom-right":[-u,-1*(38.1-13.5+u)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(t){const n=t.code,o=t.charCode||t.keyCode;n!=="Space"&&n!=="Enter"&&o!==32&&o!==13||this.togglePopup()}_onMapClick(t){const n=t.originalEvent.target,o=this._element;this._popup&&(n===o||o.contains(n))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}_update(t){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Os(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let n="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?n=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(n=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let o="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?o="rotateX(0deg)":this._pitchAlignment==="map"&&(o=`rotateX(${this._map.getPitch()}deg)`),t&&t.type!=="moveend"||(this._pos=this._pos.round()),Y.setTransform(this._element,`${Ge[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${o} ${n}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const u=this._map.unproject(this._pos),p=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=u.distanceTo(this._lngLat)>20*p?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(t){return this._offset=a.pointGeometry.convert(t),this._update(),this}_onMove(t){if(!this._isDragging){const n=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=n}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.Event("dragend")),this._state="inactive"}_addDragHandler(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const aa={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let en,yi=0,tn=!1;const xr={maxWidth:100,unit:"metric"};function wl(l,t,n){const o=n&&n.maxWidth||100,u=l._container.clientHeight/2,p=l.unproject([0,u]),f=l.unproject([o,u]),_=p.distanceTo(f);if(n&&n.unit==="imperial"){const y=3.2808*_;y>5280?rn(t,o,y/5280,l._getUIString("ScaleControl.Miles")):rn(t,o,y,l._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?rn(t,o,_/1852,l._getUIString("ScaleControl.NauticalMiles")):_>=1e3?rn(t,o,_/1e3,l._getUIString("ScaleControl.Kilometers")):rn(t,o,_,l._getUIString("ScaleControl.Meters"))}function rn(l,t,n,o){const u=function(p){const f=Math.pow(10,`${Math.floor(p)}`.length-1);let _=p/f;return _=_>=10?10:_>=5?5:_>=3?3:_>=2?2:_>=1?1:function(y){const v=Math.pow(10,Math.ceil(-Math.log(y)/Math.LN10));return Math.round(y*v)/v}(_),f*_}(n);l.style.width=t*(u/n)+"px",l.innerHTML=`${u}&nbsp;${o}`}const Yt={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ii=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function la(l){if(l){if(typeof l=="number"){const t=Math.round(Math.sqrt(.5*Math.pow(l,2)));return{center:new a.pointGeometry(0,0),top:new a.pointGeometry(0,l),"top-left":new a.pointGeometry(t,t),"top-right":new a.pointGeometry(-t,t),bottom:new a.pointGeometry(0,-l),"bottom-left":new a.pointGeometry(t,-t),"bottom-right":new a.pointGeometry(-t,-t),left:new a.pointGeometry(l,0),right:new a.pointGeometry(-l,0)}}if(l instanceof a.pointGeometry||Array.isArray(l)){const t=a.pointGeometry.convert(l);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:a.pointGeometry.convert(l.center||[0,0]),top:a.pointGeometry.convert(l.top||[0,0]),"top-left":a.pointGeometry.convert(l["top-left"]||[0,0]),"top-right":a.pointGeometry.convert(l["top-right"]||[0,0]),bottom:a.pointGeometry.convert(l.bottom||[0,0]),"bottom-left":a.pointGeometry.convert(l["bottom-left"]||[0,0]),"bottom-right":a.pointGeometry.convert(l["bottom-right"]||[0,0]),left:a.pointGeometry.convert(l.left||[0,0]),right:a.pointGeometry.convert(l.right||[0,0])}}return la(new a.pointGeometry(0,0))}const vn={supported:_e,setRTLTextPlugin:a.setRTLTextPlugin,getRTLTextPluginStatus:a.getRTLTextPluginStatus,Map:class extends Gt{constructor(l){var t;if(a.PerformanceUtils.mark(a.PerformanceMarkers.create),(l=a.extend({},bl,l)).minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ks(l.minZoom,l.maxZoom,l.minPitch,l.maxPitch,l.renderWorldCopies),{bearingSnap:l.bearingSnap}),this._interactive=l.interactive,this._cooperativeGestures=l.cooperativeGestures,this._maxTileCacheSize=l.maxTileCacheSize,this._failIfMajorPerformanceCaveat=l.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=l.preserveDrawingBuffer,this._antialias=l.antialias,this._trackResize=l.trackResize,this._bearingSnap=l.bearingSnap,this._refreshExpiredTiles=l.refreshExpiredTiles,this._fadeDuration=l.fadeDuration,this._crossSourceCollisions=l.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=l.collectResourceTiming,this._renderTaskQueue=new xl,this._controls=[],this._mapId=a.uniqueId(),this._locale=a.extend({},vl,l.locale),this._clickTolerance=l.clickTolerance,this._pixelRatio=(t=l.pixelRatio)!==null&&t!==void 0?t:devicePixelRatio,this._requestManager=new Ee(l.transformRequest),typeof l.container=="string"){if(this._container=document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(l.maxBounds&&this.setMaxBounds(l.maxBounds),a.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new yl(this,l),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=l.hash&&new al(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,a.extend({},l.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=l.localIdeographFontFamily,l.style&&this.setStyle(l.style,{localIdeographFontFamily:l.localIdeographFontFamily}),l.attributionControl&&this.addControl(new Fs({customAttribution:l.customAttribution})),l.maplibreLogo&&this.addControl(new ho,l.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new a.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new a.Event(`${n.dataType}dataloading`,n))}),this.on("dataabort",n=>{this.fire(new a.Event("sourcedataabort",n))})}_getMapId(){return this._mapId}addControl(l,t){if(t===void 0&&(t=l.getDefaultPosition?l.getDefaultPosition():"top-right"),!l||!l.onAdd)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=l.onAdd(this);this._controls.push(l);const o=this._controlPositions[t];return t.indexOf("bottom")!==-1?o.insertBefore(n,o.firstChild):o.appendChild(n),this}removeControl(l){if(!l||!l.onRemove)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(l);return t>-1&&this._controls.splice(t,1),l.onRemove(this),this}hasControl(l){return this._controls.indexOf(l)>-1}calculateCameraOptionsFromTo(l,t,n,o){return o==null&&this.style.terrain&&(o=this.transform.getElevation(n,this.style.terrain)),super.calculateCameraOptionsFromTo(l,t,n,o)}resize(l){const t=this._containerDimensions(),n=t[0],o=t[1];this._resizeCanvas(n,o,this.getPixelRatio()),this.transform.resize(n,o),this.painter.resize(n,o,this.getPixelRatio());const u=!this._moving;return u&&(this.stop(),this.fire(new a.Event("movestart",l)).fire(new a.Event("move",l))),this.fire(new a.Event("resize",l)),u&&this.fire(new a.Event("moveend",l)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(l){const[t,n]=this._containerDimensions();this._pixelRatio=l,this._resizeCanvas(t,n,l),this.painter.resize(t,n,l)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(l){return this.transform.setMaxBounds(a.LngLatBounds.convert(l)),this._update()}setMinZoom(l){if((l=l==null?-2:l)>=-2&&l<=this.transform.maxZoom)return this.transform.minZoom=l,this._update(),this.getZoom()<l&&this.setZoom(l),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(l){if((l=l==null?22:l)>=this.transform.minZoom)return this.transform.maxZoom=l,this._update(),this.getZoom()>l&&this.setZoom(l),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(l){if((l=l==null?0:l)<0)throw new Error("minPitch must be greater than or equal to 0");if(l>=0&&l<=this.transform.maxPitch)return this.transform.minPitch=l,this._update(),this.getPitch()<l&&this.setPitch(l),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(l){if((l=l==null?60:l)>85)throw new Error("maxPitch must be less than or equal to 85");if(l>=this.transform.minPitch)return this.transform.maxPitch=l,this._update(),this.getPitch()>l&&this.setPitch(l),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(l){return this.transform.renderWorldCopies=l,this._update()}project(l){return this.transform.locationPoint(a.LngLat.convert(l),this.style&&this.style.terrain)}unproject(l){return this.transform.pointLocation(a.pointGeometry.convert(l),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(l,t,n){if(l==="mouseenter"||l==="mouseover"){let o=!1;return{layer:t,listener:n,delegates:{mousemove:p=>{const f=this.getLayer(t)?this.queryRenderedFeatures(p.point,{layers:[t]}):[];f.length?o||(o=!0,n.call(this,new Ni(l,this,p.originalEvent,{features:f}))):o=!1},mouseout:()=>{o=!1}}}}if(l==="mouseleave"||l==="mouseout"){let o=!1;return{layer:t,listener:n,delegates:{mousemove:f=>{(this.getLayer(t)?this.queryRenderedFeatures(f.point,{layers:[t]}):[]).length?o=!0:o&&(o=!1,n.call(this,new Ni(l,this,f.originalEvent)))},mouseout:f=>{o&&(o=!1,n.call(this,new Ni(l,this,f.originalEvent)))}}}}{const o=u=>{const p=this.getLayer(t)?this.queryRenderedFeatures(u.point,{layers:[t]}):[];p.length&&(u.features=p,n.call(this,u),delete u.features)};return{layer:t,listener:n,delegates:{[l]:o}}}}on(l,t,n){if(n===void 0)return super.on(l,t);const o=this._createDelegatedListener(l,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[l]=this._delegatedListeners[l]||[],this._delegatedListeners[l].push(o);for(const u in o.delegates)this.on(u,o.delegates[u]);return this}once(l,t,n){if(n===void 0)return super.once(l,t);const o=this._createDelegatedListener(l,t,n);for(const u in o.delegates)this.once(u,o.delegates[u]);return this}off(l,t,n){return n===void 0?super.off(l,t):(this._delegatedListeners&&this._delegatedListeners[l]&&(o=>{const u=this._delegatedListeners[l];for(let p=0;p<u.length;p++){const f=u[p];if(f.layer===t&&f.listener===n){for(const _ in f.delegates)this.off(_,f.delegates[_]);return u.splice(p,1),this}}})(),this)}queryRenderedFeatures(l,t){if(!this.style)return[];let n;if(t!==void 0||l===void 0||l instanceof a.pointGeometry||Array.isArray(l)||(t=l,l=void 0),t=t||{},(l=l||[[0,0],[this.transform.width,this.transform.height]])instanceof a.pointGeometry||typeof l[0]=="number")n=[a.pointGeometry.convert(l)];else{const o=a.pointGeometry.convert(l[0]),u=a.pointGeometry.convert(l[1]);n=[o,new a.pointGeometry(u.x,o.y),u,new a.pointGeometry(o.x,u.y),o]}return this.style.queryRenderedFeatures(n,t,this.transform)}querySourceFeatures(l,t){return this.style.querySourceFeatures(l,t)}setStyle(l,t){return(t=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&l?(this._diffStyle(l,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(l,t))}setTransformRequest(l){return this._requestManager.setTransformRequest(l),this}_getUIString(l){const t=this._locale[l];if(t==null)throw new Error(`Missing UI string '${l}'`);return t}_updateStyle(l,t){return this.style&&(this.style.setEventedParent(null),this.style._remove()),l?(this.style=new vi(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof l=="string"?this.style.loadURL(l):this.style.loadJSON(l),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new vi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(l,t){if(typeof l=="string"){const n=this._requestManager.transformRequest(l,a.ResourceType.Style);a.getJSON(n,(o,u)=>{o?this.fire(new a.ErrorEvent(o)):u&&this._updateDiff(u,t)})}else typeof l=="object"&&this._updateDiff(l,t)}_updateDiff(l,t){try{this.style.setState(l)&&this._update(!0)}catch(n){a.warnOnce(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(l,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.warnOnce("There is no style added to the map.")}addSource(l,t){return this._lazyInitEmptyStyle(),this.style.addSource(l,t),this._update(!0)}isSourceLoaded(l){const t=this.style&&this.style.sourceCaches[l];if(t!==void 0)return t.loaded();this.fire(new a.ErrorEvent(new Error(`There is no source with ID '${l}'`)))}setTerrain(l){return this.style.setTerrain(l),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const l=this.style&&this.style.sourceCaches;for(const t in l){const n=l[t]._tiles;for(const o in n){const u=n[o];if(u.state!=="loaded"&&u.state!=="errored")return!1}}return!0}addSourceType(l,t,n){return this._lazyInitEmptyStyle(),this.style.addSourceType(l,t,n)}removeSource(l){return this.style.removeSource(l),this._update(!0)}getSource(l){return this.style.getSource(l)}addImage(l,t,{pixelRatio:n=1,sdf:o=!1,stretchX:u,stretchY:p,content:f}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||a.isImageBitmap(t)){const{width:_,height:y,data:v}=a.exported.getImageData(t);this.style.addImage(l,{data:new a.RGBAImage({width:_,height:y},v),pixelRatio:n,stretchX:u,stretchY:p,content:f,sdf:o,version:0})}else{if(t.width===void 0||t.height===void 0)return this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:_,height:y,data:v}=t,T=t;this.style.addImage(l,{data:new a.RGBAImage({width:_,height:y},new Uint8Array(v)),pixelRatio:n,stretchX:u,stretchY:p,content:f,sdf:o,version:0,userImage:T}),T.onAdd&&T.onAdd(this,l)}}}updateImage(l,t){const n=this.style.getImage(l);if(!n)return this.fire(new a.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const o=t instanceof HTMLImageElement||a.isImageBitmap(t)?a.exported.getImageData(t):t,{width:u,height:p,data:f}=o;if(u===void 0||p===void 0)return this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(u!==n.data.width||p!==n.data.height)return this.fire(new a.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const _=!(t instanceof HTMLImageElement||a.isImageBitmap(t));n.data.replace(f,_),this.style.updateImage(l,n)}hasImage(l){return l?!!this.style.getImage(l):(this.fire(new a.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(l){this.style.removeImage(l)}loadImage(l,t){a.getImage(this._requestManager.transformRequest(l,a.ResourceType.Image),t)}listImages(){return this.style.listImages()}addLayer(l,t){return this._lazyInitEmptyStyle(),this.style.addLayer(l,t),this._update(!0)}moveLayer(l,t){return this.style.moveLayer(l,t),this._update(!0)}removeLayer(l){return this.style.removeLayer(l),this._update(!0)}getLayer(l){return this.style.getLayer(l)}setLayerZoomRange(l,t,n){return this.style.setLayerZoomRange(l,t,n),this._update(!0)}setFilter(l,t,n={}){return this.style.setFilter(l,t,n),this._update(!0)}getFilter(l){return this.style.getFilter(l)}setPaintProperty(l,t,n,o={}){return this.style.setPaintProperty(l,t,n,o),this._update(!0)}getPaintProperty(l,t){return this.style.getPaintProperty(l,t)}setLayoutProperty(l,t,n,o={}){return this.style.setLayoutProperty(l,t,n,o),this._update(!0)}getLayoutProperty(l,t){return this.style.getLayoutProperty(l,t)}setLight(l,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(l,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(l,t){return this.style.setFeatureState(l,t),this._update()}removeFeatureState(l,t){return this.style.removeFeatureState(l,t),this._update()}getFeatureState(l){return this.style.getFeatureState(l)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let l=0,t=0;return this._container&&(l=this._container.clientWidth||400,t=this._container.clientHeight||300),[l,t]}_setupContainer(){const l=this._container;l.classList.add("maplibregl-map","mapboxgl-map");const t=this._canvasContainer=Y.create("div","maplibregl-canvas-container mapboxgl-canvas-container",l);this._interactive&&t.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=Y.create("canvas","maplibregl-canvas mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const n=this._containerDimensions();this._resizeCanvas(n[0],n[1],this.getPixelRatio());const o=this._controlContainer=Y.create("div","maplibregl-control-container mapboxgl-control-container",l),u=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(p=>{u[p]=Y.create("div",`maplibregl-ctrl-${p} mapboxgl-ctrl-${p}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const l=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=Y.create("div","maplibregl-cooperative-gesture-screen",l);let t="Control",n=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(n=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use \u2318 + scroll to zoom the map",t="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${n}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",o=>{o.key===t&&(this._metaPress=!0)}),document.addEventListener("keyup",o=>{o.key===t&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",o=>{this._onCooperativeGesture(o,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(l,t,n){this._canvas.width=n*l,this._canvas.height=n*t,this._canvas.style.width=`${l}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const l=a.extend({},_e.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",l)||this._canvas.getContext("experimental-webgl",l);t?(this.painter=new Yo(t,this.transform),a.exported$1.testSupport(t)):this.fire(new a.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(l){l.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:l}))}_contextRestored(l){this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:l}))}_onMapScroll(l){if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(l,t,n){return!t&&n<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(l){return this.style?(this._styleDirty=this._styleDirty||l,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(l){return this._update(),this._renderTaskQueue.add(l)}_cancelRenderFrame(l){this._renderTaskQueue.remove(l)}_render(l){let t,n=0;const o=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(t=o.createQueryEXT(),o.beginQueryEXT(o.TIME_ELAPSED_EXT,t),n=a.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(l),this._removed)return;let u=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const f=this.transform.zoom,_=a.exported.now();this.style.zoomHistory.update(f,_);const y=new a.EvaluationParameters(f,{now:_,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),v=y.crossFadingFactor();v===1&&v===this._crossFadingFactor||(u=!0,this._crossFadingFactor=v),this.style.update(y)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.PerformanceUtils.mark(a.PerformanceMarkers.load),this.fire(new a.Event("load"))),this.style&&(this.style.hasTransitions()||u)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const f=a.exported.now()-n;o.endQueryEXT(o.TIME_ELAPSED_EXT,t),setTimeout(()=>{const _=o.getQueryObjectEXT(t,o.QUERY_RESULT_EXT)/1e6;o.deleteQueryEXT(t),this.fire(new a.Event("gpu-timing-frame",{cpuTime:f,gpuTime:_}))},50)}if(this.listens("gpu-timing-layer")){const f=this.painter.collectGpuTimers();setTimeout(()=>{const _=this.painter.queryGpuTimers(f);this.fire(new a.Event("gpu-timing-layer",{layerTimes:_}))},50)}const p=this._sourcesDirty||this._styleDirty||this._placementDirty;return p||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.Event("idle")),!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0,a.PerformanceUtils.mark(a.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Y.remove(this._canvasContainer),Y.remove(this._controlContainer),this._cooperativeGestures&&Y.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),a.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new a.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=a.exported.frame(l=>{a.PerformanceUtils.frame(l),this._frame=null,this._render(l)}))}_onWindowOnline(){this._update()}_onWindowResize(l){this._trackResize&&this.resize({originalEvent:l})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(l){this._showTileBoundaries!==l&&(this._showTileBoundaries=l,this._update())}get showPadding(){return!!this._showPadding}set showPadding(l){this._showPadding!==l&&(this._showPadding=l,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(l){this._showCollisionBoxes!==l&&(this._showCollisionBoxes=l,l?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(l){this._showOverdrawInspector!==l&&(this._showOverdrawInspector=l,this._update())}get repaint(){return!!this._repaint}set repaint(l){this._repaint!==l&&(this._repaint=l,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(l){this._vertices=l,this._update()}_setCacheLimits(l,t){a.setCacheLimits(l,t)}get version(){return"2.4.0"}},NavigationControl:class{constructor(l){this.options=a.extend({},Tc,l),this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(a.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),Y.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),Y.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=Y.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const l=this._map.getZoom(),t=l===this._map.getMaxZoom(),n=l===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())}_rotateCompassArrow(){const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=l}onAdd(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new yr(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Y.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(l,t){const n=Y.create("button",l,this._container);return n.type="button",n.addEventListener("click",t),n}_setButtonTitle(l,t){const n=this._map._getUIString(`NavigationControl.${t}`);l.title=n,l.setAttribute("aria-label",n)}},GeolocateControl:class extends a.Evented{constructor(l){super(),this.options=a.extend({},aa,l),a.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(l){var t;return this._map=l,this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),t=this._setupUI,en!==void 0?t(en):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(n=>{en=n.state!=="denied",t(en)}):(en=!!window.navigator.geolocation,t(en)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Y.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,yi=0,tn=!1}_isOutOfMapMaxBounds(l){const t=this._map.getMaxBounds(),n=l.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(l){if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new a.Event("geolocate",l)),this._finish()}}_updateCamera(l){const t=new a.LngLat(l.coords.longitude,l.coords.latitude),n=l.coords.accuracy,o=this._map.getBearing(),u=a.extend({bearing:o},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(n),u,{geolocateSource:!0})}_updateMarker(l){if(l){const t=new a.LngLat(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const l=this._map._container.clientHeight/2,t=this._map.unproject([0,l]),n=this._map.unproject([1,l]),o=t.distanceTo(n),u=Math.ceil(2*this._accuracy/o);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(l){if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&tn)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new a.Event("error",l)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(l){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=Y.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),Y.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Y.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new ts(this._dotElement),this._circleElement=Y.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ts({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new a.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":yi--,tn=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let l;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),yi++,yi>1?(l={maximumAge:6e5,timeout:0},tn=!0):(l=this.options.positionOptions,tn=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,l)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Fs,LogoControl:ho,ScaleControl:class{constructor(l){this.options=a.extend({},xr,l),a.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){wl(this._map,this._container,this.options)}onAdd(l){return this._map=l,this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Y.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(l){this.options.unit=l,wl(this._map,this._container,this.options)}},FullscreenControl:class{constructor(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof HTMLElement?this._container=l.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),a.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){Y.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const l=this._fullscreenButton=Y.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);Y.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",l).setAttribute("aria-hidden","true"),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(l){this.options=l,a.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(l){return this._map=l,this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=Y.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),Y.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Y.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends a.Evented{constructor(l){super(),this.options=a.extend(Object.create(Yt),l),a.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(l){return this._map&&this.remove(),this._map=l,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new a.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&Y.remove(this._content),this._container&&(Y.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new a.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=a.LngLat.convert(l),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(l){return this.setDOMContent(document.createTextNode(l))}setHTML(l){const t=document.createDocumentFragment(),n=document.createElement("body");let o;for(n.innerHTML=l;o=n.firstChild,o;)t.appendChild(o);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(l){return this.options.maxWidth=l,this._update(),this}setDOMContent(l){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Y.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(l),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(l){this._container&&this._container.classList.add(l)}removeClassName(l){this._container&&this._container.classList.remove(l)}setOffset(l){return this.options.offset=l,this._update(),this}toggleClassName(l){if(this._container)return this._container.classList.toggle(l)}_createCloseButton(){this.options.closeButton&&(this._closeButton=Y.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(l){this._update(l.point)}_onMouseMove(l){this._update(l.point)}_onDrag(l){this._update(l.point)}_update(l){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=Y.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=Y.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(p=>this._container.classList.add(p)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Os(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!l))return;const t=this._pos=this._trackPointer&&l?l:this._map.project(this._lngLat);let n=this.options.anchor;const o=la(this.options.offset);if(!n){const p=this._container.offsetWidth,f=this._container.offsetHeight;let _;_=t.y+o.bottom.y<f?["top"]:t.y>this._map.transform.height-f?["bottom"]:[],t.x<p/2?_.push("left"):t.x>this._map.transform.width-p/2&&_.push("right"),n=_.length===0?"bottom":_.join("-")}const u=t.add(o[n]).round();Y.setTransform(this._container,`${Ge[n]} translate(${u.x}px,${u.y}px)`),Ke(this._container,n,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const l=this._container.querySelector(ii);l&&l.focus()}_onClose(){this.remove()}},Marker:ts,Style:vi,LngLat:a.LngLat,LngLatBounds:a.LngLatBounds,Point:a.pointGeometry,MercatorCoordinate:a.MercatorCoordinate,Evented:a.Evented,AJAXError:a.AJAXError,config:a.config,CanvasSource:hn,GeoJSONSource:Er,ImageSource:or,RasterDEMTileSource:Je,RasterTileSource:Yi,VectorTileSource:Si,VideoSource:ar,prewarm:function(){On().acquire(Ir)},clearPrewarmedResources:function(){const l=jr;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(Ir),jr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return Fi.workerCount},set workerCount(l){Fi.workerCount=l},get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){a.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage(l){a.clearTileCache(l)},workerUrl:"",addProtocol(l,t){a.config.REGISTERED_PROTOCOLS[l]=t},removeProtocol(l){delete a.config.REGISTERED_PROTOCOLS[l]}};return Qi.extend(vn,{isSafari:a.isSafari,getPerformanceMetrics:a.PerformanceUtils.getPerformanceMetrics}),vn});var ie=q;return ie})})(Mo);function hs(C){const k=C-1;return k*k*k+1}function Tu(C,{delay:k=0,duration:F=400,easing:X=Or}={}){const q=+getComputedStyle(C).opacity;return{delay:k,duration:F,easing:X,css:G=>`opacity: ${G*q}`}}function js(C,{delay:k=0,duration:F=400,easing:X=hs,x:q=0,y:G=0,opacity:ie=0}={}){const a=getComputedStyle(C),_e=+a.opacity,le=a.transform==="none"?"":a.transform,me=_e*(1-ie);return{delay:k,duration:F,easing:X,css:(pe,Y)=>`
			transform: ${le} translate(${(1-pe)*q}px, ${(1-pe)*G}px);
			opacity: ${_e-me*Y}`}}function Rp(C){let k,F=[{width:C[1]},{height:C[1]},{"stroke-width":"0"},{class:C[2]},C[0].a,C[4],{xmlns:"http://www.w3.org/2000/svg"}],X={};for(let q=0;q<F.length;q+=1)X=lu(X,F[q]);return{c(){k=wp("svg"),gu(k,X)},m(q,G){gi(q,k,G),k.innerHTML=C[3]},p(q,[G]){G&8&&(k.innerHTML=q[3]),gu(k,X=wu(F,[G&2&&{width:q[1]},G&2&&{height:q[1]},{"stroke-width":"0"},G&4&&{class:q[2]},G&1&&q[0].a,G&16&&q[4],{xmlns:"http://www.w3.org/2000/svg"}]))},i:Dt,o:Dt,d(q){q&&si(k)}}}function Fp(C,k,F){let{src:X}=k,{size:q="1em"}=k,{color:G=void 0}=k,{title:ie=void 0}=k,{className:a=""}=k,_e,le;return C.$$set=me=>{"src"in me&&F(0,X=me.src),"size"in me&&F(1,q=me.size),"color"in me&&F(5,G=me.color),"title"in me&&F(6,ie=me.title),"className"in me&&F(2,a=me.className)},C.$$.update=()=>{C.$$.dirty&33&&(F(4,le={}),G&&(X.a.stroke!=="none"&&F(4,le.stroke=G,le),X.a.fill!=="none"&&F(4,le.fill=G,le))),C.$$.dirty&65&&F(3,_e=(ie?`<title>${ie}</title>`:"")+X.c)},[X,q,a,_e,le,G,ie]}class Pn extends zn{constructor(k){super(),Mn(this,k,Fp,Rp,Ur,{src:0,size:1,color:5,title:6,className:2})}}const Eu={a:{viewBox:"0 0 24 24",fill:"none"},c:'<path d="M6.2253 4.81108C5.83477 4.42056 5.20161 4.42056 4.81108 4.81108C4.42056 5.20161 4.42056 5.83477 4.81108 6.2253L10.5858 12L4.81114 17.7747C4.42062 18.1652 4.42062 18.7984 4.81114 19.1889C5.20167 19.5794 5.83483 19.5794 6.22535 19.1889L12 13.4142L17.7747 19.1889C18.1652 19.5794 18.7984 19.5794 19.1889 19.1889C19.5794 18.7984 19.5794 18.1652 19.1889 17.7747L13.4142 12L19.189 6.2253C19.5795 5.83477 19.5795 5.20161 19.189 4.81108C18.7985 4.42056 18.1653 4.42056 17.7748 4.81108L12 10.5858L6.2253 4.81108Z" fill="currentColor"></path>'},Op={a:{viewBox:"0 0 24 24",fill:"none"},c:'<path d="M6.34317 7.75732L4.92896 9.17154L12 16.2426L19.0711 9.17157L17.6569 7.75735L12 13.4142L6.34317 7.75732Z" fill="currentColor"></path>'},Up={a:{viewBox:"0 0 24 24",fill:"none"},c:'<path d="M17.6569 16.2427L19.0711 14.8285L12.0001 7.75739L4.92896 14.8285L6.34317 16.2427L12.0001 10.5858L17.6569 16.2427Z" fill="currentColor"></path>'},Vp={a:{fill:"currentColor",viewBox:"0 0 16 16"},c:'<path fill-rule="evenodd" d="M0 .5A.5.5 0 0 1 .5 0h4a.5.5 0 0 1 0 1h-4A.5.5 0 0 1 0 .5Zm0 2A.5.5 0 0 1 .5 2h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5Zm9 0a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5Zm-9 2A.5.5 0 0 1 .5 4h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5Zm5 0a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5Zm7 0a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5Zm-12 2A.5.5 0 0 1 .5 6h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5Zm8 0a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5Zm-8 2A.5.5 0 0 1 .5 8h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5Zm7 0a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5Zm-7 2a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 0 1h-8a.5.5 0 0 1-.5-.5Zm0 2a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1h-4a.5.5 0 0 1-.5-.5Zm0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Z"></path>'},fm="";function Np(C){let k,F;return k=new Pn({props:{src:Vp}}),{c(){sr(k.$$.fragment)},m(X,q){Hi(k,X,q),F=!0},p:Dt,i(X){F||(bt(k.$$.fragment,X),F=!0)},o(X){Lt(k.$$.fragment,X),F=!1},d(X){Ki(k,X)}}}function $p(C){let k,F,X;return{c(){k=It("img"),hu(k.src,F=C[1].thumbnail_url)||nt(k,"src",F),nt(k,"alt",X=`${C[1].title} preview`),nt(k,"class","svelte-1uifmyu")},m(q,G){gi(q,k,G)},p(q,G){G&2&&!hu(k.src,F=q[1].thumbnail_url)&&nt(k,"src",F),G&2&&X!==(X=`${q[1].title} preview`)&&nt(k,"alt",X)},i:Dt,o:Dt,d(q){q&&si(k)}}}function qp(C){let k,F,X,q,G,ie,a,_e=C[1].title+"",le,me,pe,Y=C[1].text+"",Ee,qe,be,Ne=C[1].long_id+"",We,Tt,ht,At,st;const Qt=[$p,Np],tt=[];function Ht(Xt,Kt){return Xt[1].thumbnail_url?0:1}return X=Ht(C),q=tt[X]=Qt[X](C),{c(){k=It("div"),F=It("aside"),q.c(),G=nr(),ie=It("section"),a=It("h1"),le=Wi(_e),me=nr(),pe=It("p"),Ee=Wi(Y),qe=nr(),be=It("a"),We=Wi(Ne),nt(F,"class","thumbnail svelte-1uifmyu"),nt(a,"class","svelte-1uifmyu"),nt(pe,"class","text svelte-1uifmyu"),nt(be,"href",Tt=C[1].item_url),nt(be,"target","_blank"),nt(be,"rel","noreferrer"),nt(be,"class","svelte-1uifmyu"),nt(ie,"class","svelte-1uifmyu"),nt(k,"class","mappola-popup-card svelte-1uifmyu")},m(Xt,Kt){gi(Xt,k,Kt),ut(k,F),tt[X].m(F,null),ut(k,G),ut(k,ie),ut(ie,a),ut(a,le),ut(ie,me),ut(ie,pe),ut(pe,Ee),ut(ie,qe),ut(ie,be),ut(be,We),st=!0},p(Xt,[Kt]){C=Xt;let Mi=X;X=Ht(C),X===Mi?tt[X].p(C,Kt):(cn(),Lt(tt[Mi],1,1,()=>{tt[Mi]=null}),un(),q=tt[X],q?q.p(C,Kt):(q=tt[X]=Qt[X](C),q.c()),bt(q,1),q.m(F,null)),(!st||Kt&2)&&_e!==(_e=C[1].title+"")&&ls(le,_e),(!st||Kt&2)&&Y!==(Y=C[1].text+"")&&ls(Ee,Y),(!st||Kt&2)&&Ne!==(Ne=C[1].long_id+"")&&ls(We,Ne),(!st||Kt&2&&Tt!==(Tt=C[1].item_url))&&nt(be,"href",Tt)},i(Xt){st||(bt(q),Vr(()=>{At&&At.end(1),ht=vu(k,js,{y:50,duration:120,easing:hs,delay:C[0]}),ht.start()}),st=!0)},o(Xt){Lt(q),ht&&ht.invalidate(),At=bu(k,js,{y:50,duration:120,easing:hs,delay:C[0]?120-C[0]:0}),st=!1},d(Xt){Xt&&si(k),tt[X].d(),Xt&&At&&At.end()}}}function Gp(C,k,F){let{delay:X=0}=k,{item:q}=k;return C.$$set=G=>{"delay"in G&&F(0,X=G.delay),"item"in G&&F(1,q=G.item)},[X,q]}class Su extends zn{constructor(k){super(),Mn(this,k,Gp,qp,Ur,{delay:0,item:1})}}const mm="";function Iu(C,k,F){const X=C.slice();return X[9]=k[F],X[11]=F,X}function Au(C){let k,F,X,q,G,ie;return F=new Su({props:{item:C[9],delay:C[11]<C[2]?0:120-50*(C[11]-C[2])}}),{c(){k=It("div"),sr(F.$$.fragment),X=nr(),nt(k,"class","endless-list-item svelte-uw3g4d"),nt(k,"data-idx",C[11])},m(a,_e){gi(a,k,_e),Hi(F,k,null),ut(k,X),q=!0,G||(ie=ln(k,"pointerdown",C[4]),G=!0)},p(a,_e){const le={};_e&1&&(le.item=a[9]),_e&4&&(le.delay=a[11]<a[2]?0:120-50*(a[11]-a[2])),F.$set(le)},i(a){q||(bt(F.$$.fragment,a),q=!0)},o(a){Lt(F.$$.fragment,a),q=!1},d(a){a&&si(k),Ki(F),G=!1,ie()}}}function Zp(C){let k,F,X,q,G=C[0],ie=[];for(let _e=0;_e<G.length;_e+=1)ie[_e]=Au(Iu(C,G,_e));const a=_e=>Lt(ie[_e],1,1,()=>{ie[_e]=null});return{c(){k=It("div");for(let _e=0;_e<ie.length;_e+=1)ie[_e].c();nt(k,"class","endless-list-container svelte-uw3g4d")},m(_e,le){gi(_e,k,le);for(let me=0;me<ie.length;me+=1)ie[me].m(k,null);C[6](k),F=!0,X||(q=ln(k,"pointerdown",C[3]),X=!0)},p(_e,[le]){if(le&21){G=_e[0];let me;for(me=0;me<G.length;me+=1){const pe=Iu(_e,G,me);ie[me]?(ie[me].p(pe,le),bt(ie[me],1)):(ie[me]=Au(pe),ie[me].c(),bt(ie[me],1),ie[me].m(k,null))}for(cn(),me=G.length;me<ie.length;me+=1)a(me);un()}},i(_e){if(!F){for(let le=0;le<G.length;le+=1)bt(ie[le]);F=!0}},o(_e){ie=ie.filter(Boolean);for(let le=0;le<ie.length;le+=1)Lt(ie[le]);F=!1},d(_e){_e&&si(k),mu(ie,_e),C[6](null),X=!1,q()}}}const Cu=.88,ku=50,jp=90;function Xp(C,k,F){let{items:X}=k,q;const G=Yl();let ie=0;const a=Y=>{const Ee=document.querySelector(".endless-list-container");Ee.scrollTo({top:Ee.scrollTop+jp*Y,behavior:"smooth"})},_e=Y=>{Y.forEach(be=>{const{style:Ne}=be.target,We=be.intersectionRatio;if(be.isIntersecting){const Tt=be.boundingClientRect.y<be.rootBounds.y;Tt&&We<.9&&F(2,ie=parseInt(be.target.dataset.idx)),Ne.opacity=Math.sqrt(We);const ht=We*(1-Cu)+Cu,At=Tt?5*(1-We):-5*(1-We),st=ku-Math.sqrt(We)*ku;Ne.transform=`scale(${ht}) perspective(500px) rotateX(${At}deg) translateY(${Tt?st:-st}px)`,We>.9?Ne.zIndex=1:Ne.zIndex=0}else Ne.opacity=0});const Ee=Math.round(100*q.scrollTop/q.scrollHeight),qe=Math.round(100*(q.scrollTop+q.offsetHeight)/q.scrollHeight);G("scroll",{from:Ee,to:qe})},le=Y=>{Y.target===q&&G("close")},me=Y=>{const Ee=Y.target.closest(".endless-list-item"),{opacity:qe}=Ee.style;if(qe<.99){const be=Ee.getBoundingClientRect(),Ne=Ee.offsetTop-Ee.parentElement.scrollTop>be.height;a(Ne?2:-2)}};Ao(()=>{const Y={root:q,rootMargin:"0px",threshold:Array.from({length:51},(qe,be)=>be*.02)},Ee=new IntersectionObserver(_e,Y);return q.childNodes.forEach(qe=>Ee.observe(qe)),()=>Ee.disconnect()});function pe(Y){cs[Y?"unshift":"push"](()=>{q=Y,F(1,q)})}return C.$$set=Y=>{"items"in Y&&F(0,X=Y.items)},[X,q,ie,le,me,a,pe]}class Wp extends zn{constructor(k){super(),Mn(this,k,Xp,Zp,Ur,{items:0,scrollBy:5})}get scrollBy(){return this.$$.ctx[5]}}const Dn=40,Mu=(C,k)=>{const F=C.getCanvasContainer().querySelector("canvas").getBoundingClientRect();let X=0,q=0;k.left-Dn<F.left?X=k.left-F.left-Dn:k.right+Dn>F.right&&(X=k.right-F.right+Dn),k.top-Dn<F.top?q=k.top-F.top-Dn:k.bottom+Dn>F.bottom&&(q=k.bottom+Dn-F.bottom),(X!==0||q!==0)&&C.panBy([X,q])},gm="";function zu(C,k,F){const X=C.slice();return X[20]=k[F],X[22]=F,X}function Hp(C){let k,F,X,q,G,ie,a,_e,le,me=Math.round(C[1].length*(C[6]-1)/100)+"",pe,Y,Ee=C[1].length+"",qe,be,Ne,We,Tt,ht,At,st,Qt,tt,Ht,Xt;function Kt(wt){C[13](wt)}let Mi={items:C[1]};return C[5]!==void 0&&(Mi.scrollBy=C[5]),F=new Wp({props:Mi}),cs.push(()=>Dp(F,"scrollBy",Kt,C[5])),F.$on("close",C[14]),F.$on("scroll",C[10]),a=new Pn({props:{src:Eu}}),We=new Pn({props:{src:Up}}),At=new Pn({props:{src:Op}}),{c(){k=It("div"),sr(F.$$.fragment),q=nr(),G=It("div"),ie=It("button"),sr(a.$$.fragment),_e=nr(),le=It("span"),pe=Wi(me),Y=Wi("/"),qe=Wi(Ee),be=nr(),Ne=It("button"),sr(We.$$.fragment),Tt=nr(),ht=It("button"),sr(At.$$.fragment),nt(ie,"class","svelte-tw82ee"),nt(le,"class","scroll-position svelte-tw82ee"),Ne.disabled=C[7],nt(Ne,"class","svelte-tw82ee"),ht.disabled=C[8],nt(ht,"class","svelte-tw82ee"),nt(G,"class","mappola-popup-controls right svelte-tw82ee"),nt(k,"class","wrapper svelte-tw82ee")},m(wt,Si){gi(wt,k,Si),Hi(F,k,null),ut(k,q),ut(k,G),ut(G,ie),Hi(a,ie,null),ut(G,_e),ut(G,le),ut(le,pe),ut(le,Y),ut(le,qe),ut(G,be),ut(G,Ne),Hi(We,Ne,null),ut(G,Tt),ut(G,ht),Hi(At,ht,null),tt=!0,Ht||(Xt=[ln(ie,"click",C[15]),ln(Ne,"click",C[16]),ln(ht,"click",C[17])],Ht=!0)},p(wt,Si){const Yi={};Si&2&&(Yi.items=wt[1]),!X&&Si&32&&(X=!0,Yi.scrollBy=wt[5],Mp(()=>X=!1)),F.$set(Yi),(!tt||Si&66)&&me!==(me=Math.round(wt[1].length*(wt[6]-1)/100)+"")&&ls(pe,me),(!tt||Si&2)&&Ee!==(Ee=wt[1].length+"")&&ls(qe,Ee),(!tt||Si&128)&&(Ne.disabled=wt[7]),(!tt||Si&256)&&(ht.disabled=wt[8])},i(wt){tt||(bt(F.$$.fragment,wt),bt(a.$$.fragment,wt),bt(We.$$.fragment,wt),bt(At.$$.fragment,wt),Vr(()=>{Qt&&Qt.end(1),st=vu(G,Tu,{duration:200,delay:170}),st.start()}),tt=!0)},o(wt){Lt(F.$$.fragment,wt),Lt(a.$$.fragment,wt),Lt(We.$$.fragment,wt),Lt(At.$$.fragment,wt),st&&st.invalidate(),Qt=bu(G,Tu,{duration:120}),tt=!1},d(wt){wt&&si(k),Ki(F),Ki(a),Ki(We),Ki(At),wt&&Qt&&Qt.end(),Ht=!1,an(Xt)}}}function Kp(C){let k,F,X,q,G,ie,a,_e,le,me=C[1],pe=[];for(let Ee=0;Ee<me.length;Ee+=1)pe[Ee]=Pu(zu(C,me,Ee));const Y=Ee=>Lt(pe[Ee],1,1,()=>{pe[Ee]=null});return G=new Pn({props:{src:Eu}}),{c(){k=It("div");for(let Ee=0;Ee<pe.length;Ee+=1)pe[Ee].c();F=nr(),X=It("div"),q=It("button"),sr(G.$$.fragment),nt(q,"class","svelte-tw82ee"),nt(X,"class","mappola-popup-controls single svelte-tw82ee"),nt(k,"class","wrapper svelte-tw82ee")},m(Ee,qe){gi(Ee,k,qe);for(let be=0;be<pe.length;be+=1)pe[be].m(k,null);ut(k,F),ut(k,X),ut(X,q),Hi(G,q,null),a=!0,_e||(le=ln(q,"click",C[12]),_e=!0)},p(Ee,qe){if(C=Ee,qe&2){me=C[1];let be;for(be=0;be<me.length;be+=1){const Ne=zu(C,me,be);pe[be]?(pe[be].p(Ne,qe),bt(pe[be],1)):(pe[be]=Pu(Ne),pe[be].c(),bt(pe[be],1),pe[be].m(k,F))}for(cn(),be=me.length;be<pe.length;be+=1)Y(be);un()}},i(Ee){if(!a){for(let qe=0;qe<me.length;qe+=1)bt(pe[qe]);bt(G.$$.fragment,Ee),Vr(()=>{ie||(ie=Fa(X,js,{y:50,duration:120,delay:(C[1].length-1)*50,easing:hs},!0)),ie.run(1)}),a=!0}},o(Ee){pe=pe.filter(Boolean);for(let qe=0;qe<pe.length;qe+=1)Lt(pe[qe]);Lt(G.$$.fragment,Ee),ie||(ie=Fa(X,js,{y:50,duration:120,delay:(C[1].length-1)*50,easing:hs},!1)),ie.run(0),a=!1},d(Ee){Ee&&si(k),mu(pe,Ee),Ki(G),Ee&&ie&&ie.end(),_e=!1,le()}}}function Pu(C){let k,F,X;return F=new Su({props:{item:C[20],delay:C[1].length===1?0:150-50*C[22]}}),{c(){k=It("div"),sr(F.$$.fragment),nt(k,"class","no-scroll svelte-tw82ee")},m(q,G){gi(q,k,G),Hi(F,k,null),X=!0},p(q,G){const ie={};G&2&&(ie.item=q[20]),G&2&&(ie.delay=q[1].length===1?0:150-50*q[22]),F.$set(ie)},i(q){X||(bt(F.$$.fragment,q),X=!0)},o(q){Lt(F.$$.fragment,q),X=!1},d(q){q&&si(k),Ki(F)}}}function Du(C){let k,F,X,q,G;const ie=[Kp,Hp],a=[];function _e(le,me){return le[1].length<4?0:1}return F=_e(C),X=a[F]=ie[F](C),{c(){k=It("div"),X.c(),nt(k,"class","mappola-popup-container svelte-tw82ee"),nt(k,"style",q=`bottom: ${C[4]+20}px; left: ${C[3]-160}px;`)},m(le,me){gi(le,k,me),a[F].m(k,null),C[18](k),G=!0},p(le,me){let pe=F;F=_e(le),F===pe?a[F].p(le,me):(cn(),Lt(a[pe],1,1,()=>{a[pe]=null}),un(),X=a[F],X?X.p(le,me):(X=a[F]=ie[F](le),X.c()),bt(X,1),X.m(k,null)),(!G||me&24&&q!==(q=`bottom: ${le[4]+20}px; left: ${le[3]-160}px;`))&&nt(k,"style",q)},i(le){G||(bt(X),G=!0)},o(le){Lt(X),G=!1},d(le){le&&si(k),a[F].d(),C[18](null)}}}function Yp(C){let k=C[0].properties.results,F,X,q=Du(C);return{c(){q.c(),F=Hl()},m(G,ie){q.m(G,ie),gi(G,F,ie),X=!0},p(G,[ie]){ie&1&&Ur(k,k=G[0].properties.results)?(cn(),Lt(q,1,1,Dt),un(),q=Du(G),q.c(),bt(q,1),q.m(F.parentNode,F)):q.p(G,ie)},i(G){X||(bt(q),X=!0)},o(G){Lt(q),X=!1},d(G){G&&si(F),q.d(G)}}}function Jp(C,k,F){let{map:X}=k,{selected:q}=k,{results:G}=k,ie,a,_e,le,me=3,pe=!0,Y=!1;const Ee=Yl(),qe=tt=>{const{coordinates:Ht}=tt.geometry,Xt=X.project(Ht),{height:Kt}=X._container.getBoundingClientRect();F(3,a=Xt.x),F(4,_e=Kt-Xt.y)},be=tt=>{const{from:Ht,to:Xt}=tt.detail;F(6,me=Xt),F(7,pe=Ht===0),F(8,Y=Xt===100)};Ao(()=>{const tt=()=>qe(q);return X.on("move",tt),Mu(X,ie.getBoundingClientRect()),()=>X.off("move",tt)});const Ne=()=>Ee("close");function We(tt){le=tt,F(5,le)}function Tt(tt){Ap.call(this,C,tt)}const ht=()=>Ee("close"),At=()=>le(-2),st=()=>le(2);function Qt(tt){cs[tt?"unshift":"push"](()=>{ie=tt,F(2,ie)})}return C.$$set=tt=>{"map"in tt&&F(11,X=tt.map),"selected"in tt&&F(0,q=tt.selected),"results"in tt&&F(1,G=tt.results)},C.$$.update=()=>{C.$$.dirty&2053&&(qe(q),ie&&Mu(X,ie.getBoundingClientRect()))},[q,G,ie,a,_e,le,me,pe,Y,Ee,be,X,Ne,We,Tt,ht,At,st,Qt]}class Qp extends zn{constructor(k){super(),Mn(this,k,Jp,Yp,Ur,{map:11,selected:0,results:1})}}const ed=C=>({type:"Feature",properties:{...C},geometry:{type:"Point",coordinates:C.coords.slice().reverse()}}),Lu={type:"FeatureCollection",features:[]},Bu=(C,k,F=10)=>({type:"FeatureCollection",features:C.map(ed)}),td=C=>{if(!C||C.length===0)return;let k=1/0,F=1/0,X=-1/0,q=-1/0;return C.forEach(({coords:G})=>{const[ie,a]=G;a<F&&(F=a),a>q&&(q=a),ie<k&&(k=ie),ie>X&&(X=ie)}),[[F,k],[q,X]]},Ru={type:"circle",paint:{"circle-radius":["interpolate",["linear"],["number",["get","point_count"],1],0,4,10,18],"circle-color":"#eb585b","circle-stroke-color":"#472a2d","circle-stroke-width":1}},Fu={type:"circle",paint:{"circle-radius":["interpolate",["linear"],["number",["get","point_count"],1],0,20,10,38],"circle-color":"#eb585b","circle-opacity":.35,"circle-stroke-color":"#eb585b","circle-stroke-width":1,"circle-stroke-opacity":.6}},id="2Ey0xKbFXj7eys0FUBdR",rd="outdoor",nd="17.0",sd="41.5",Ou="6",Oa=8,od={maptiler:`https://api.maptiler.com/maps/${rd}/style.json?key=${id}`,dare:{version:8,sources:{dare:{type:"raster",tiles:["https://dh.gu.se/tiles/imperium/{z}/{x}/{y}.png"],tileSize:256,attribution:"Digital Atlas of the Roman Empire \xA9 2020 Johan \xC5hlfeldt, Centre for Digital Humanities, University of Gothenburg, Sweden"}},layers:[{id:"dare-tiles",type:"raster",source:"dare"}]}},rc=C=>od[C],ad={a:{viewBox:"0 0 512 512"},c:'<title></title><path d="M256,256c-13.47,0-26.94-2.39-37.44-7.17l-148-67.49C63.79,178.26,48,169.25,48,152.24s15.79-26,22.58-29.12L219.86,55.05c20.57-9.4,51.61-9.4,72.19,0l149.37,68.07c6.79,3.09,22.58,12.1,22.58,29.12s-15.79,26-22.58,29.11l-148,67.48C282.94,253.61,269.47,256,256,256ZM432.76,155.14h0Z"></path><path d="M441.36,226.81,426.27,220,387.5,237.74l-94,43c-10.5,4.8-24,7.19-37.44,7.19s-26.93-2.39-37.42-7.19l-94.07-43L85.79,220l-15.22,6.84C63.79,229.93,48,239,48,256s15.79,26.08,22.56,29.17l148,67.63C229,357.6,242.49,360,256,360s26.94-2.4,37.44-7.19L441.31,285.2C448.12,282.11,464,273.09,464,256S448.23,229.93,441.36,226.81Z"></path><path d="M441.36,330.8,426.27,324,387.5,341.73l-94,42.95c-10.5,4.78-24,7.18-37.44,7.18s-26.93-2.39-37.42-7.18l-94.07-43L85.79,324l-15.22,6.84C63.79,333.93,48,343,48,360s15.79,26.07,22.56,29.15l148,67.59C229,461.52,242.54,464,256,464s26.88-2.48,37.38-7.27l147.92-67.57C448.12,386.08,464,377.06,464,360S448.23,333.93,441.36,330.8Z"></path>'},Uu={a:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},c:'<polyline points="20 6 9 17 4 12"></polyline>'},_m="";function Vu(C){let k,F,X,q,G,ie,a,_e,le,me,pe,Y,Ee,qe,be;return G=new Pn({props:{src:Uu}}),me=new Pn({props:{src:Uu}}),{c(){k=It("div"),F=It("ul"),X=It("li"),q=It("button"),sr(G.$$.fragment),ie=Wi(" OpenStreetMap"),a=nr(),_e=It("li"),le=It("button"),sr(me.$$.fragment),pe=Wi(" Digital Atlas of the Roman Empire"),nt(q,"class","svelte-2qii39"),nt(X,"class","svelte-2qii39"),ka(X,"selected",C[1]==="maptiler"),nt(le,"class","svelte-2qii39"),nt(_e,"class","svelte-2qii39"),ka(_e,"selected",C[1]==="dare"),nt(F,"class","svelte-2qii39"),nt(k,"class","mappola-layer-dropdown svelte-2qii39")},m(Ne,We){gi(Ne,k,We),ut(k,F),ut(F,X),ut(X,q),Hi(G,q,null),ut(q,ie),ut(F,a),ut(F,_e),ut(_e,le),Hi(me,le,null),ut(le,pe),Ee=!0,qe||(be=[ln(q,"click",C[2]("maptiler")),ln(le,"click",C[2]("dare"))],qe=!0)},p(Ne,We){C=Ne,(!Ee||We&2)&&ka(X,"selected",C[1]==="maptiler"),(!Ee||We&2)&&ka(_e,"selected",C[1]==="dare")},i(Ne){Ee||(bt(G.$$.fragment,Ne),bt(me.$$.fragment,Ne),Vr(()=>{Y||(Y=Fa(k,js,{x:50,duration:120,easing:hs},!0)),Y.run(1)}),Ee=!0)},o(Ne){Lt(G.$$.fragment,Ne),Lt(me.$$.fragment,Ne),Y||(Y=Fa(k,js,{x:50,duration:120,easing:hs},!1)),Y.run(0),Ee=!1},d(Ne){Ne&&si(k),Ki(G),Ki(me),Ne&&Y&&Y.end(),qe=!1,an(be)}}}function ld(C){let k,F,X,q,G,ie,a,_e;X=new Pn({props:{src:ad}});let le=C[0]&&Vu(C);return{c(){k=It("div"),F=It("button"),sr(X.$$.fragment),q=nr(),le&&le.c(),G=Hl(),nt(F,"class","svelte-2qii39"),nt(k,"class","mappola-layer-switcher svelte-2qii39")},m(me,pe){gi(me,k,pe),ut(k,F),Hi(X,F,null),gi(me,q,pe),le&&le.m(me,pe),gi(me,G,pe),ie=!0,a||(_e=ln(F,"click",C[4]),a=!0)},p(me,[pe]){me[0]?le?(le.p(me,pe),pe&1&&bt(le,1)):(le=Vu(me),le.c(),bt(le,1),le.m(G.parentNode,G)):le&&(cn(),Lt(le,1,1,()=>{le=null}),un())},i(me){ie||(bt(X.$$.fragment,me),bt(le),ie=!0)},o(me){Lt(X.$$.fragment,me),Lt(le),ie=!1},d(me){me&&si(k),Ki(X),me&&si(q),le&&le.d(me),me&&si(G),a=!1,_e()}}}function cd(C,k,F){const X=Yl();let{map:q}=k,G=!1,ie="maptiler";const a=le=>()=>{F(1,ie=le),F(0,G=!1),q.once("styledata",()=>X("change")),q.setStyle(rc(le))};Ao(()=>{var le;try{F(1,ie=(le=q==null?void 0:q.getStyle())!=null&&le.sources.dare?"dare":"maptiler")}catch{}});const _e=()=>F(0,G=!G);return C.$$set=le=>{"map"in le&&F(3,q=le.map)},[G,ie,a,q,_e]}class ud extends zn{constructor(k){super(),Mn(this,k,cd,ld,Ur,{map:3})}}class hd{constructor(k){this.callbacks=k||{}}onAdd(k){return this._map=k,this._container=document.createElement("div"),this._container.className="maplibregl-ctrl",this.control=new ud({target:this._container,props:{map:k}}),this.control.$on("change",()=>this.callbacks.onChange&&this.callbacks.onChange()),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}const ym="";function Nu(C){let k;return{c(){k=Wi("s")},m(F,X){gi(F,k,X)},d(F){F&&si(k)}}}function pd(C){let k,F,X,q,G,ie=C[2].length+"",a,_e,le,me=C[2].length>1&&Nu();return{c(){k=It("div"),F=It("span"),X=Wi(C[3]),q=nr(),G=It("span"),a=Wi(ie),_e=Wi(" Result"),me&&me.c(),nt(F,"class","placename svelte-129aez3"),nt(G,"class","count svelte-129aez3"),nt(k,"class","mappola-hover-tooltip svelte-129aez3"),nt(k,"style",le=`top: ${C[1]+qu}px; left: ${C[0]+$u}px;`)},m(pe,Y){gi(pe,k,Y),ut(k,F),ut(F,X),ut(k,q),ut(k,G),ut(G,a),ut(G,_e),me&&me.m(G,null)},p(pe,[Y]){Y&8&&ls(X,pe[3]),Y&4&&ie!==(ie=pe[2].length+"")&&ls(a,ie),pe[2].length>1?me||(me=Nu(),me.c(),me.m(G,null)):me&&(me.d(1),me=null),Y&3&&le!==(le=`top: ${pe[1]+qu}px; left: ${pe[0]+$u}px;`)&&nt(k,"style",le)},i:Dt,o:Dt,d(pe){pe&&si(k),me&&me.d()}}}const $u=14,qu=10;function dd(C,k,F){let X,{clientX:q}=k,{clientY:G}=k,{results:ie}=k;const a=_e=>{const me=_e.map(pe=>pe.place).reduce((pe,Y)=>(pe[Y]=(pe[Y]||0)+1,pe),{});return Object.keys(me).reduce((pe,Y)=>me[Y]>me[pe]?Y:pe)};return C.$$set=_e=>{"clientX"in _e&&F(0,q=_e.clientX),"clientY"in _e&&F(1,G=_e.clientY),"results"in _e&&F(2,ie=_e.results)},C.$$.update=()=>{C.$$.dirty&4&&F(3,X=a(ie))},[q,G,ie,X]}class fd extends zn{constructor(k){super(),Mn(this,k,dd,pd,Ur,{clientX:0,clientY:1,results:2})}}const xm="",vm="";function Gu(C){let k=JSON.stringify(C[2]),F,X,q=Zu(C);return{c(){q.c(),F=Hl()},m(G,ie){q.m(G,ie),gi(G,F,ie),X=!0},p(G,ie){ie&4&&Ur(k,k=JSON.stringify(G[2]))?(cn(),Lt(q,1,1,Dt),un(),q=Zu(G),q.c(),bt(q,1),q.m(F.parentNode,F)):q.p(G,ie)},i(G){X||(bt(q),X=!0)},o(G){Lt(q),X=!1},d(G){G&&si(F),q.d(G)}}}function Zu(C){let k,F;return k=new Qp({props:{selected:C[2].feature,results:C[2].results,map:C[0]}}),k.$on("close",C[4]),{c(){sr(k.$$.fragment)},m(X,q){Hi(k,X,q),F=!0},p(X,q){const G={};q&4&&(G.selected=X[2].feature),q&4&&(G.results=X[2].results),q&1&&(G.map=X[0]),k.$set(G)},i(X){F||(bt(k.$$.fragment,X),F=!0)},o(X){Lt(k.$$.fragment,X),F=!1},d(X){Ki(k,X)}}}function ju(C){let k,F;const X=[C[3]];let q={};for(let G=0;G<X.length;G+=1)q=lu(q,X[G]);return k=new fd({props:q}),{c(){sr(k.$$.fragment)},m(G,ie){Hi(k,G,ie),F=!0},p(G,ie){const a=ie&8?wu(X,[Pp(G[3])]):{};k.$set(a)},i(G){F||(bt(k.$$.fragment,G),F=!0)},o(G){Lt(k.$$.fragment,G),F=!1},d(G){Ki(k,G)}}}function md(C){let k,F,X,q=C[2]&&Gu(C),G=C[3]&&ju(C);return{c(){k=It("div"),q&&q.c(),F=nr(),G&&G.c(),nt(k,"class","map svelte-1uxdzvo")},m(ie,a){gi(ie,k,a),q&&q.m(k,null),ut(k,F),G&&G.m(k,null),C[6](k),X=!0},p(ie,[a]){ie[2]?q?(q.p(ie,a),a&4&&bt(q,1)):(q=Gu(ie),q.c(),bt(q,1),q.m(k,F)):q&&(cn(),Lt(q,1,1,()=>{q=null}),un()),ie[3]?G?(G.p(ie,a),a&8&&bt(G,1)):(G=ju(ie),G.c(),bt(G,1),G.m(k,null)):G&&(cn(),Lt(G,1,1,()=>{G=null}),un())},i(ie){X||(bt(q),bt(G),X=!0)},o(ie){Lt(q),Lt(G),X=!1},d(ie){ie&&si(k),q&&q.d(),G&&G.d(),C[6](null)}}}function gd(C,k,F){let{results:X}=k,q,G,ie=null,a=null;const _e=be=>new Promise(Ne=>{const We=be.properties.cluster_id;We?G.getSource("results-source").getClusterLeaves(We,1/0,0,(ht,At)=>{Ne(At.map(st=>st.properties))}):Ne([be.properties])}),le=be=>{const Ne=We=>G.getSource("selection-source").setData({type:"FeatureCollection",features:[We]});_e(be).then(We=>{Ne(be),F(2,ie={feature:be,results:We})})},me=be=>{const{clientX:Ne,clientY:We}=be.originalEvent,Tt=G.queryRenderedFeatures(be.point,{layers:["results"]});Tt.length>0?_e(Tt[0]).then(ht=>F(3,a={clientX:Ne,clientY:We,results:ht})):F(3,a=null)},pe=be=>{const Ne=[[be.point.x-Oa,be.point.y-Oa],[be.point.x+Oa,be.point.y+Oa]],We=G.queryRenderedFeatures(Ne,{layers:["results"]});We.length===0?(F(2,ie=null),G.getSource("selection-source").setData({type:"FeatureCollection",features:[]})):(F(3,a=null),le(We[0]))},Y=()=>{F(2,ie=null),G.getSource("selection-source").setData(Lu)},Ee=()=>{G.addSource("selection-source",{type:"geojson",data:(ie==null?void 0:ie.feature)||Lu}),G.addLayer({...Fu,id:"selection",source:"selection-source"}),G.addSource("results-source",{type:"geojson",data:Bu(X),cluster:!0,clusterRadius:10}),G.addLayer({...Ru,id:"results",source:"results-source"})};Ao(()=>{F(0,G=new Mo.exports.Map({container:q,style:rc("maptiler"),center:[nd,sd],zoom:Ou,bounds:td(X),fitBoundsOptions:{padding:50}})),G.addControl(new Mo.exports.NavigationControl,"top-right"),G.addControl(new hd({onChange:Ee}),"top-right"),G.on("mousemove",me),G.on("click",pe),G.on("load",Ee)}),yu(()=>G.remove());function qe(be){cs[be?"unshift":"push"](()=>{q=be,F(1,q)})}return C.$$set=be=>{"results"in be&&F(5,X=be.results)},C.$$.update=()=>{var be;C.$$.dirty&33&&((be=G==null?void 0:G.getSource("results-source"))==null||be.setData(Bu(X)))},[G,q,ie,a,Y,X,qe]}class _d extends zn{constructor(k){super(),Mn(this,k,gd,md,Ur,{results:5})}}const bm="";function yd(C){let k;return{c(){k=It("div"),nt(k,"class","map svelte-16jw124")},m(F,X){gi(F,k,X),C[3](k)},p:Dt,i:Dt,o:Dt,d(F){F&&si(k),C[3](null)}}}function xd(C,k,F){let X,{lonlat:q=[0,0]}=k,{zoom:G=Ou}=k,ie,a;Ao(()=>{a=new Mo.exports.Map({container:ie,style:rc("dare"),center:q,attributionControl:!1,zoom:G}),a.addControl(new Mo.exports.NavigationControl,"top-right"),a.on("load",()=>{a.addSource("halo-source",{type:"geojson",data:X}),a.addLayer({...Fu,id:"halo",source:"halo-source"}),a.addSource("marker-source",{type:"geojson",data:X}),a.addLayer({...Ru,id:"marker",source:"marker-source"})})}),yu(()=>a.remove());function _e(le){cs[le?"unshift":"push"](()=>{ie=le,F(0,ie)})}return C.$$set=le=>{"lonlat"in le&&F(1,q=le.lonlat),"zoom"in le&&F(2,G=le.zoom)},C.$$.update=()=>{C.$$.dirty&2&&(X={type:"Feature",properties:{},geometry:{type:"Point",coordinates:[...q]}})},[ie,q,G,_e]}class vd extends zn{constructor(k){super(),Mn(this,k,xd,yd,Ur,{lonlat:1,zoom:2})}}const Xu=C=>{var k;return C.parent||console.error("Missing property 'parent' in ProfileMap config"),C.parent.nodeType||console.error("ProfileMap parent must be a DOM node"),Boolean((k=C==null?void 0:C.parent)==null?void 0:k.nodeType)},Wu=C=>C.filter(k=>{var F;return((F=k.coords)==null?void 0:F.length)===2&&k.coords[0]&&k.coords[1]});class bd{constructor(k){_p(this,"setResults",k=>this.map.$set({results:Wu(k)}));if(Xu(k)){const{parent:F,results:X,...q}=k,G=X?Wu(X):null;this.map=new _d({target:k.parent,props:{results:G,...q}})}}}class wd{constructor(k){if(Xu(k)){const{parent:F,...X}=k;this.map=new vd({target:k.parent,props:{...X}})}}}rr.ProfileMap=wd,rr.SearchResultMap=bd,Object.defineProperties(rr,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=mappola-maps.js.map
